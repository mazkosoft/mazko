<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAX OS - ËôöÊãüÂÆáÂÆôÁªàÁ´Ø (Frutiger Aero Style)</title>
    <!-- Favicon - ‰ΩøÁî®‰∏Ä‰∏™ÁÆÄÂçïÁöÑSVG‰Ωú‰∏∫Á§∫‰æã -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><text x='0' y='14' font-size='16'>üåå</text></svg>\" type=\"image/svg+xml\">
    <!-- ÂºïÂÖ• Tailwind CSS CDNÔºåÁî®‰∫éÂø´ÈÄüÊûÑÂª∫ÂíåÂìçÂ∫îÂºèÂ∏ÉÂ±Ä -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ÂºïÂÖ• Google Fonts - Inter Â≠ó‰Ωì‰Ωú‰∏∫ÈÄöÁî®Â≠ó‰ΩìÔºåÂ¶ÇÊûúÈúÄË¶Å‚ÄúChocolate Classical Sans‚ÄùËØ∑Âú®Ê≠§Â§ÑÂºïÂÖ•ÂÖ∂CDNÊàñÊú¨Âú∞Ë∑ØÂæÑ -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <!-- Marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* Global styles and variables */
        :root {
            --primary-blue: #00BFFF; /* Sky blue, as the main color */
            --dark-blue: #007ACC; /* Dark blue */
            --light-blue: #CCEEFF; /* Light blue */
            --background-dark: #1A1A2E; /* Dark background */
            --glass-bg: rgba(255, 255, 255, 0.15); /* Frosted glass background color */
            --glass-border: rgba(255, 255, 255, 0.3); /* Frosted glass border color */
            --text-color: #E0FFFF; /* Text color */
            /* Â∞ÜÂ≠ó‰ΩìÂèòÈáèÂêçÁß∞Êîπ‰∏∫ --font-mainÔºåÂπ∂ËÆæÁΩÆ‰∏∫ 'Chocolate Classical Sans'Ôºå‰ª• Inter ‰Ωú‰∏∫Â§áÁî®Â≠ó‰Ωì */
            --font-main: 'Chocolate Classical Sans', 'Inter', sans-serif; 

            /* Frutiger Aero specific gradients for elements */
            --fa-title-active-gradient: linear-gradient(to bottom, #00BFFF 0%, #007ACC 100%);
            --fa-title-inactive-gradient: linear-gradient(to bottom, #A7BBD4 0%, #6699CC 100%); /* Muted blue for inactive */
            --fa-button-bg: linear-gradient(to bottom, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0.1) 100%);
            --fa-button-hover-bg: linear-gradient(to bottom, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0.2) 100%);
            --fa-button-active-bg: linear-gradient(to top, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0.1) 100%);

            --taskbar-height: 48px; /* Define taskbar height */

            /* Cursors - These will be set dynamically by JavaScript */
            --cursor-default: auto;
            --cursor-active: auto;
            --cursor-pointer: pointer;
        }

        body {
            font-family: var(--font-main); /* Apply the new main font globally */
            background-color: var(--background-dark); /* Dark background */
            color: var(--text-color); /* Text color */
            margin: 0;
            padding: 0;
            overflow: hidden; /* Prevent scrollbars, as we simulate a desktop environment */
            position: relative; /* For background animation positioning */
            width: 100vw; /* Ensure body takes full viewport width */
            height: 100vh; /* Ensure body takes full viewport height */
            /* Custom mouse cursor styles (will be populated by JS) */
            cursor: var(--cursor-default);
        }

        body:active {
            cursor: var(--cursor-active);
        }

        a, button, .clickable-element {
            cursor: var(--cursor-pointer);
        }

        /* Frutiger Aero style desktop background */
        .desktop-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* More complex background with multiple gradients for depth and gloss */
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(0,191,255,0.2) 0%, transparent 40%),
                radial-gradient(circle at 80% 20%, rgba(0,191,255,0.2) 0%, transparent 40%),
                linear-gradient(to bottom right, #6699CC, #CCEEFF);
            background-size: cover;
            background-position: center;
            opacity: 0.8; /* Slightly transparent */
            filter: brightness(0.8) contrast(1.2); /* Adjust brightness and contrast */
            z-index: 0;
            /* Placeholder for a background image URL if user wants it */
            /* background-image: url(var(--desktop-background-image)); */
        }

        /* Simulate dot matrix effect, overlaid on the background */
        .desktop-background::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            opacity: 0.3;
            animation: scanline 10s linear infinite; /* Scanline animation */
        }

        /* Simulate glow effect */
        .desktop-background::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(0,191,255,0.3) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            animation: pulse-glow 15s infinite alternate; /* Glow pulse animation */
        }

        /* Scanline animation */
        @keyframes scanline {
            0% { background-position: 0 0; }
            100% { background-position: 0 100%; }
        }

        /* Glow pulse animation */
        @keyframes pulse-glow {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 0.3; }
            50% { transform: translate(-50%, -50%) scale(1.1); opacity: 0.4; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 0.3; }
        }

        /* Desktop container, now acting as the main content wrapper */
        .desktop-container {
            position: absolute; /* Position it to fill the body */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            z-index: 1; /* Ensure it's above the background */
        }

        /* Desktop Layout - holds the main desktop area and the taskbar */
        .desktop-layout {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
        }

        /* Main Desktop Area - where icons and windows reside */
        .main-desktop-area {
            flex-grow: 1;
            position: relative;
            overflow: hidden; /* For windows */
            padding: 10px; /* Padding for desktop icons */
            padding-bottom: calc(10px + var(--taskbar-height)); /* Account for taskbar height only */
        }

        /* Taskbar (formerly dock) */
        .taskbar {
            position: absolute;
            bottom: 0; /* Position at the very bottom */
            left: 0;
            width: 100%; /* Full width */
            height: var(--taskbar-height); /* Fixed height */
            background: rgba(255, 255, 255, 0.18); /* Slightly more opaque glass background for taskbar */
            backdrop-filter: blur(12px); /* Subtle blur for glass effect */
            -webkit-backdrop-filter: blur(12px); /* For Safari */
            border-top: 1px solid rgba(255, 255, 255, 0.4); /* Stronger top border */
            box-shadow: 0 -2px 15px rgba(0, 191, 255, 0.3), inset 0 1px 8px rgba(255, 255, 255, 0.2); /* More prominent shadow and inner highlight */
            display: flex;
            align-items: center;
            justify-content: space-between; /* Space between start button, icons, and tray */
            padding: 0 10px; /* Padding on sides */
            z-index: 100; /* Ensure taskbar is always on top */
        }

        /* Start Button */
        .start-button {
            /* Updated background for a more glossy, Aero feel */
            background: linear-gradient(to bottom, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0.2) 100%);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 50%; /* Changed to circular */
            width: 40px; /* Fixed width for circular button */
            height: 40px; /* Fixed height for circular button */
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9rem;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(0, 191, 255, 0.5); /* Subtle text glow */
            box-shadow: 0 2px 10px rgba(0,0,0,0.5), inset 0 1px 6px rgba(255,255,255,0.6); /* More prominent shadow and inner highlight */
            cursor: pointer; /* Changed to default pointer */
            transition: all 0.1s ease-in-out;
            white-space: nowrap;
        }

        .start-button:hover {
            background: linear-gradient(to bottom, rgba(255,255,255,0.5) 0%, rgba(255,255,255,0.3) 100%);
            transform: translateY(-2px); /* Slight lift effect */
            box-shadow: 0 4px 15px rgba(0, 191, 255, 0.7), inset 0 1px 8px rgba(255,255,255,0.7);
        }

        .start-button:active {
            background: linear-gradient(to top, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0.2) 100%);
            transform: translateY(0);
            box-shadow: inset 0 1px 6px rgba(0,0,0,0.7), inset 0 -1px 4px rgba(255,255,255,0.4);
        }

        .start-button .icon-image { /* Sizing for dynamically loaded image */
            width: 1.5em; /* Larger icon size */
            height: 1.5em; /* Larger icon size */
            filter: drop-shadow(0 0 5px rgba(0, 191, 255, 0.5)); /* text-shadow equivalent for image */
        }

        /* Taskbar Icons (for open/minimized windows) */
        .taskbar-icons-container {
            display: flex;
            flex-grow: 1; /* Take up available space */
            justify-content: flex-start; /* Align to start */
            align-items: center;
            height: 100%;
            overflow-x: auto; /* Allow horizontal scrolling if many windows */
            padding: 0 10px;
            gap: 5px; /* Gap between taskbar items */
        }

        /* System Tray */
        .system-tray {
            display: flex;
            align-items: center;
            gap: 8px; /* Gap between system icons */
        }

        .system-tray-icon {
            font-size: 1rem; /* Standard icon size */
            color: var(--light-blue); /* Light blue color */
            transition: all 0.2s ease;
            cursor: default; /* Changed to default cursor */
            padding: 5px;
            border-radius: 50%; /* Circular for system icons */
        }
        .system-tray-icon:hover {
            color: white;
            background-color: rgba(255,255,255,0.1);
            transform: translateY(-1px);
        }
        /* Style for SVG icons */
        .system-tray-icon svg {
            width: 1.5em; /* Slightly larger for better visibility */
            height: 1.5em;
            vertical-align: middle;
            filter: drop-shadow(0 0 3px rgba(0, 191, 255, 0.3));
        }

        /* Desktop Icons (Shortcuts) */
        .desktop-icons-container {
            position: relative; /* Changed to relative to allow absolute positioning of children */
            top: 0;
            left: 0;
            width: 100%;
            height: calc(100% - var(--taskbar-height)); /* Account for taskbar height only */
            padding: 20px;
            z-index: 2; /* Below windows, above background */
        }

        .desktop-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            width: 80px; /* Fixed width for icon block */
            cursor: pointer; /* Changed to default pointer */
            transition: transform 0.1s ease, filter 0.1s ease, background-color 0.1s ease; /* Added background-color transition */
            padding: 5px;
            border-radius: 8px;
            user-select: none; /* Prevent text selection on double click */
            position: absolute; /* Enable absolute positioning for dragging */
        }

        .desktop-icon:hover {
            filter: brightness(1.2); /* Subtle brightness increase on hover */
            background-color: rgba(255, 255, 255, 0.15); /* Subtle highlight on hover */
            box-shadow: 0 0 10px rgba(0, 191, 255, 0.3); /* Subtle blue glow on hover */
        }

        .desktop-icon:active {
            transform: scale(0.95);
            filter: brightness(0.9);
            background-color: rgba(0, 191, 255, 0.3); /* More pronounced active state */
            box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
        }

        .desktop-icon .icon-image { /* Sizing for dynamically loaded image */
            width: 48px; /* Larger icon size */
            height: 48px;
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.5)); /* Subtle shadow */
        }

        .desktop-icon-label {
            font-size: 0.8rem;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            margin-top: 5px;
            word-wrap: break-word; /* Allow long labels to wrap */
            max-width: 100%;
        }

        /* Start Menu styles */
        .start-menu {
            position: absolute;
            bottom: var(--taskbar-height); /* Position above the taskbar */
            left: 10px; /* Align with the start button's left edge */
            width: 320px; /* Wider for more content */
            height: auto;
            max-height: calc(100% - var(--taskbar-height) - 20px); /* Max height to fit screen, with some margin */
            background: rgba(255, 255, 255, 0.25); /* More opaque glass background for start menu */
            backdrop-filter: blur(20px); /* Stronger blur for glass effect */
            -webkit-backdrop-filter: blur(20px); /* For Safari */
            border: 1px solid rgba(255, 255, 255, 0.5); /* Stronger border */
            border-radius: 15px; /* Rounded corners */
            box-shadow: 0 10px 40px rgba(0, 191, 255, 0.5), inset 0 0 20px rgba(255, 255, 255, 0.3); /* More prominent shadow and inner glow */
            padding: 10px;
            display: none; /* Hidden by default */
            flex-direction: column;
            z-index: 100;
            transform-origin: bottom left; /* For animation to originate from bottom-left */
            animation: fadeInScaleUpFromBottomLeft 0.3s ease-out forwards; /* Fade in and scale up animation */
        }

        .start-menu.hidden {
            display: none;
        }
        .start-menu.visible {
            display: flex;
        }

        /* Start Menu header (with profile info) */
        .start-menu-header {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 10px;
            background: linear-gradient(to right, rgba(0,191,255,0.2) 0%, rgba(0,122,204,0.2) 100%); /* Subtle blue gradient */
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
            cursor: pointer; /* Changed to default pointer */
        }

        .start-menu-header .icon-image { /* Sizing for dynamically loaded image */
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 1px solid white;
            margin-right: 10px;
            /* fill: white; - This was for SVG, not needed for image */
        }

        .start-menu-header span {
            color: white;
            font-size: 1.1rem;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(0, 191, 255, 0.5);
        }


        /* Start Menu item styles */
        .start-menu-item {
            padding: 10px 15px;
            display: flex;
            align-items: center;
            color: white;
            text-decoration: none;
            transition: background-color 0.2s ease, transform 0.1s ease, filter 0.2s ease;
            cursor: pointer; /* Changed to default pointer */
            font-size: 0.95rem;
            font-weight: normal; /* Lighter font weight */
            border-radius: 8px; /* More rounded for Aero style */
            margin: 3px 0; /* Vertical margin for items */
            position: relative; /* For pseudo-elements */
            overflow: hidden; /* Hide overflow for shine effect */
        }

        .start-menu-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.3s ease;
        }

        .start-menu-item:hover::before {
            left: 100%;
        }

        .start-menu-item:hover {
            background: linear-gradient(to right, rgba(0, 191, 255, 0.3) 0%, rgba(0, 122, 204, 0.3) 100%); /* Blue gradient hover */
            transform: translateX(5px); /* More pronounced slide effect */
            color: white;
            text-shadow: 0 0 8px rgba(255,255,255,0.8);
            filter: brightness(1.2);
            box-shadow: inset 0 0 5px rgba(0,0,0,0.3);
        }

        .start-menu-item .icon-image { /* Style for dynamically loaded images within menu items */
            margin-right: 12px;
            width: 1.2em; /* Slightly larger icons */
            height: 1.2em;
            filter: drop-shadow(0 0 3px rgba(0, 191, 255, 0.3)); /* Subtle glow for image */
            transition: filter 0.2s ease;
        }
        .start-menu-item:hover .icon-image {
            filter: brightness(1.5) drop-shadow(0 0 8px rgba(255,255,255,0.8)); /* Brighten and stronger glow on hover */
        }
        /* Style for SVG icons in menu items */
        .start-menu-item svg {
            margin-right: 12px;
            width: 1.2em;
            height: 1.2em;
            filter: drop-shadow(0 0 3px rgba(0, 191, 255, 0.3));
            transition: filter 0.2s ease;
        }
        .start-menu-item:hover svg {
            filter: brightness(1.5) drop-shadow(0 0 8px rgba(255,255,255,0.8));
        }
        
        /* New style for the text label within start menu items */
        .start-menu-item .menu-item-label {
            flex-grow: 1; /* Allow the label to take available space */
            text-align: left;
        }

        /* Start Menu Buttons Container (for Settings and Shutdown) */
        .start-menu-buttons-container { 
            display: flex;
            flex-direction: row; /* Changed to row for horizontal layout */
            justify-content: flex-end; /* Align to the right */
            gap: 10px; /* Space between buttons */
            padding-top: 10px;
            /* Removed border-top: 1px solid rgba(255,255,255,0.2); */
            margin-top: 10px;
            padding-right: 5px; /* Small padding to the right */
        }

        /* New style for icon-only buttons in the start menu footer */
        .start-menu-footer-button {
            width: 48px; /* Fixed width for square button */
            height: 48px; /* Fixed height for square button */
            display: flex;
            flex-direction: column; /* Stack icon and text */
            align-items: center;
            justify-content: center;
            background-color: transparent; /* Transparent background */
            border: none; /* No border */
            border-radius: 8px; /* Rounded corners */
            cursor: pointer; /* Changed to default pointer */
            transition: background-color 0.2s ease, transform 0.1s ease;
            color: white; /* Icon color */
            /* Removed font-size and text-shadow as there's no text */
            padding: 5px; /* Padding inside the button */
        }

        .start-menu-footer-button:hover {
            background-color: rgba(255, 255, 255, 0.15); /* Subtle highlight on hover */
            transform: translateY(-2px); /* Slight lift */
        }

        .start-menu-footer-button:active {
            transform: translateY(0);
            background-color: rgba(255, 255, 255, 0.25); /* More pronounced active state */
        }

        /* Style for SVG icons in footer buttons */
        .start-menu-footer-button svg {
            width: 24px;
            height: 24px;
            filter: drop-shadow(0 0 3px rgba(0, 191, 255, 0.3));
        }

        /* Animation for menu appearance - Adjusted for bottom-left origin */
        @keyframes fadeInScaleUpFromBottomLeft {
            from {
                opacity: 0;
                transform: scale(0.8); /* Adjusted for bottom-left origin */
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Window styles (retaining glassmorphism) */
        .os-window {
            position: absolute;
            background: rgba(255, 255, 255, 0.25); /* More opaque glass background */
            backdrop-filter: blur(20px); /* Stronger blur for windows */
            -webkit-backdrop-filter: blur(20px); /* For Safari */
            border: 3px solid rgba(255, 255, 255, 0.7); /* Thicker, stronger border */
            border-radius: 12px; /* More rounded for Aero style */
            box-shadow: 0 10px 40px rgba(0, 191, 255, 0.5), inset 0 0 20px rgba(255, 255, 255, 0.3); /* More prominent shadow and inner glow */
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Hide content overflow */
            min-width: 300px;
            min-height: 200px;
            z-index: 5; /* Default z-index, will be updated on focus */
            /* REMOVED: animation: windowPopIn 0.3s ease-out forwards; */
            resize: both; /* Allow resizing */
        }

        /* NEW: Keyframes for smooth window opening */
        @keyframes windowOpenAnimation {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .os-window.minimized {
            display: none; /* Hide the window when minimized */
        }

        .os-window.maximized {
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: calc(100% - var(--taskbar-height)) !important; /* Maximize to full height minus taskbar height */
            border-radius: 0; /* No rounded corners when maximized */
            box-shadow: none; /* No shadow when maximized */
            transition: all 0.3s ease-in-out; /* Smooth transition for maximize/restore */
        }

        /* Window title bar - Frutiger Aero style */
        .os-window-title-bar {
            background: var(--fa-title-active-gradient); /* Active title bar gradient */
            padding: 8px 15px; /* Slightly larger padding */
            display: flex;
            justify-content: space-between;
            align-items: center;
            /* Added small border matching title bar color */
            border-bottom: 2px solid rgba(255, 255, 255, 0.8); /* Thicker, stronger border */
            cursor: grab; /* Changed to grab cursor */
            border-radius: 9px 9px 0 0; /* Match window border-radius, adjusted for 3px window border */
            position: relative;
            font-size: 1rem; /* Standard title font size */
            font-weight: bold;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.7); /* Stronger text shadow */
            box-shadow: inset 0 1px 4px rgba(255,255,255,0.4); /* Inner top highlight */
        }
        /* Small border matching title bar color */
        .os-window-title-bar::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px; /* Small border height */
            background: var(--fa-title-active-gradient); /* Match title bar gradient */
            z-index: 1;
        }
        .os-window-title-bar.inactive {
            background: var(--fa-title-inactive-gradient); /* Inactive title bar color - more muted blue */
            border-bottom: 2px solid rgba(255, 255, 255, 0.5); /* Thicker, muted border */
            box-shadow: inset 0 1px 2px rgba(255,255,255,0.2);
        }
        .os-window-title-bar.inactive::after {
            background: var(--fa-title-inactive-gradient); /* Match inactive title bar gradient */
        }

        /* Window title and logo container */
        .os-window-title-content {
            display: flex;
            align-items: center;
            gap: 8px; /* Space between logo and title */
        }

        .os-window-title-content .icon-image { /* Sizing for dynamically loaded image */
            width: 24px; /* Size for the M-logo */
            height: 24px;
            filter: drop-shadow(0 0 3px rgba(0, 191, 255, 0.3));
        }

        .os-window-title {
            color: white;
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }

        /* Window control buttons (minimize, maximize, close) - Frutiger Aero style */
        .os-window-controls {
            display: flex;
            gap: 8px; /* Larger gap */
        }

        .os-window-controls .control-button {
            width: 28px; /* Larger circular buttons */
            height: 28px;
            border-radius: 50%; /* Circular */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem; /* Adjusted for SVG size */
            color: white; /* White icons */
            cursor: pointer; /* Changed to default pointer */
            transition: background-color 0.1s ease, transform 0.05s ease, box-shadow 0.1s ease;
            /* More glossy, 3D effect for control buttons */
            box-shadow: inset 0 1px 4px rgba(255,255,255,0.7), 0 1px 5px rgba(0,0,0,0.5);
            border: 1px solid rgba(255, 255, 255, 0.6);
            background: rgba(255,255,255,0.2); /* Base white background for buttons */
        }

        /* Specific button colors for hover/active states - ALL WHITE NOW */
        .os-window-controls .control-button.close { background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.6); }
        .os-window-controls .control-button.minimize { background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.6); }
        .os-window-controls .control-button.maximize { background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.6); }

        .os-window-controls .control-button:hover {
            transform: scale(1.1);
            filter: brightness(1.2);
            box-shadow: inset 0 1px 6px rgba(255,255,255,0.9), 0 2px 10px rgba(0,0,0,0.6);
            background: rgba(255,255,255,0.4); /* Lighter white on hover */
        }
        /* Ensure all hover states are white/transparent */
        .os-window-controls .control-button.close:hover { background: rgba(255,255,255,0.4); border-color: rgba(255,255,255,0.7); }
        .os-window-controls .control-button.minimize:hover { background: rgba(255,255,255,0.4); border-color: rgba(255,255,255,0.7); }
        .os-window-controls .control-button.maximize:hover { background: rgba(255,255,255,0.4); border-color: rgba(255,255,255,0.7); }


        .os-window-controls .control-button:active {
            transform: scale(0.9);
            opacity: 1;
            box-shadow: inset 0 0 6px rgba(0,0,0,0.8), inset 0 -1px 4px rgba(255,255,255,0.5);
            filter: brightness(0.8);
            background: rgba(255,255,255,0.1); /* Darker white on active */
        }
        /* Style for SVG icons in control buttons */
        .os-window-controls .control-button svg {
            width: 0.8em;
            height: 0.8em;
            filter: drop-shadow(0 0 3px rgba(0, 191, 255, 0.3));
        }

        /* Window content area */
        .os-window-content {
            flex-grow: 1;
            padding: 15px;
            color: var(--text-color);
            font-size: 0.9rem;
            line-height: 1.5;
            overflow: auto; /* Allow content to scroll if it overflows */
        }

        /* Status bar at the bottom of each window */
        .os-window-status-bar {
            background: linear-gradient(to top, rgba(0, 191, 255, 0.2) 0%, rgba(0, 122, 204, 0.2) 100%); /* Subtle blue gradient */
            border-top: 1px solid rgba(255, 255, 255, 0.3);
            padding: 5px 15px;
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.7);
            text-align: right;
            border-radius: 0 0 9px 9px; /* Match window border-radius, adjusted for 3px window border */
            box-shadow: inset 0 -1px 3px rgba(0,0,0,0.3);
        }

        /* Markdown specific styles within window content */
        .os-window-content .markdown-content h1 { font-size: 2em; margin-bottom: 0.5em; color: var(--primary-blue); border-bottom: 1px solid rgba(0,191,255,0.3); padding-bottom: 0.3em; }
        .os-window-content .markdown-content h2 { font-size: 1.5em; margin-bottom: 0.4em; color: var(--light-blue); }
        .os-window-content .markdown-content h3 { font-size: 1.2em; margin-bottom: 0.3em; color: var(--text-color); }
        .os-window-content .markdown-content p { margin-bottom: 1em; }
        .os-window-content .markdown-content ul, .os-window-content .markdown-content ol { margin-left: 1.5em; margin-bottom: 1em; list-style-type: disc; }
        .os-window-content .markdown-content li { margin-bottom: 0.5em; }
        .os-window-content .markdown-content strong { font-weight: bold; color: white; }
        .os-window-content .markdown-content em { font-style: italic; opacity: 0.9; }
        .os-window-content .markdown-content a { color: var(--primary-blue); text-decoration: underline; }
        .os-window-content .markdown-content code { background-color: rgba(255,255,255,0.1); padding: 0.2em 0.4em; border-radius: 4px; font-family: monospace; font-size: 0.85em; }
        .os-window-content .markdown-content pre { background-color: rgba(0,0,0,0.3); padding: 1em; border-radius: 8px; overflow-x: auto; margin-bottom: 1em; }
        .os-window-content .markdown-content blockquote { border-left: 4px solid var(--primary-blue); padding-left: 1em; margin-left: 0; opacity: 0.8; }


        /* Window pop-in animation */
        /* REMOVED @keyframes windowPopIn - replaced by windowOpenAnimation */

        /* Works grid specific styles */
        .works-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); /* Responsive grid */
            gap: 15px;
            padding: 10px;
        }

        .work-card {
            background: rgba(255, 255, 255, 0.1); /* Slightly more transparent */
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer; /* Changed to default pointer */
            transition: all 0.2s ease-in-out, filter 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4), inset 0 0 8px rgba(255,255,255,0.1); /* More prominent shadow and subtle inner glow */
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding-bottom: 10px;
        }

        .work-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 25px rgba(0, 191, 255, 0.6), inset 0 0 12px rgba(255,255,255,0.2); /* Stronger blue glow */
            border-color: var(--primary-blue);
            filter: brightness(1.1);
        }

        .work-card img {
            width: 100%;
            height: 150px; /* Fixed height for consistency */
            object-fit: cover; /* Cover the area, crop if necessary */
            border-radius: 8px 8px 0 0;
            filter: brightness(0.9); /* Slightly dim */
            transition: filter 0.2s ease;
        }

        .work-card:hover img {
            filter: brightness(1.1); /* Brighten on hover */
        }

        .work-card-title {
            font-size: 0.9rem;
            font-weight: bold;
            margin-top: 10px;
            color: var(--text-color);
        }

        .work-card-category {
            font-size: 0.75rem;
            color: var(--light-blue);
            opacity: 0.8;
            margin-top: 2px;
        }

        /* Work Detail Window Specific Styles */
        .work-detail-content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .work-detail-content .gallery-main-image-container {
            position: relative;
            width: 100%;
            max-width: 600px; /* Limit main image width */
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border-radius: 8px;
            overflow: hidden;
        }

        .work-detail-content .gallery-main-image {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 8px;
        }

        .work-detail-content .gallery-nav-button {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.6); /* Slightly darker for better contrast */
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer; /* Changed to default pointer */
            font-size: 1.5rem; /* Adjusted for SVG size */
            border-radius: 50%;
            transition: background-color 0.2s ease, filter 0.2s ease;
            z-index: 2; /* Above image */
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .work-detail-content .gallery-nav-button:hover {
            background: rgba(0, 0, 0, 0.9);
            filter: brightness(1.2);
            box-shadow: 0 4px 8px rgba(0,0,0,0.5);
        }
        /* Style for SVG icons in gallery nav buttons */
        .work-detail-content .gallery-nav-button svg {
            width: 1.5em;
            height: 1.5em;
            filter: drop-shadow(0 0 3px rgba(0, 191, 255, 0.3));
        }

        .work-detail-content .gallery-nav-button.prev {
            left: 10px;
        }

        .work-detail-content .gallery-nav-button.next {
            right: 10px;
        }

        .work-detail-content .gallery-thumbnails {
            display: flex;
            justify-content: center;
            flex-wrap: wrap; /* Allow thumbnails to wrap */
            gap: 10px;
            margin-top: 10px;
            margin-bottom: 15px;
        }

        .work-detail-content .gallery-thumbnail {
            width: 80px;
            height: 60px;
            object-fit: cover;
            border-radius: 5px;
            border: 2px solid transparent;
            cursor: pointer; /* Changed to default pointer */
            transition: border-color 0.2s ease, transform 0.1s ease, filter 0.2s ease, box-shadow 0.2s ease;
        }

        .work-detail-content .gallery-thumbnail.active {
            border-color: var(--primary-blue);
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(0, 191, 255, 0.8); /* Stronger glow for active thumbnail */
        }
        .work-detail-content .gallery-thumbnail:hover {
            filter: brightness(1.1);
            box-shadow: 0 0 5px rgba(0, 191, 255, 0.4);
        }

        .work-detail-content h3 {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-blue);
            margin-bottom: 10px;
            text-align: center;
        }
        .work-detail-content p {
            margin-bottom: 10px;
            text-align: justify; /* Justify text for better readability */
        }
        .work-detail-content .category-tag {
            display: inline-block;
            background-color: rgba(0, 191, 255, 0.3);
            border: 1px solid var(--primary-blue);
            border-radius: 5px;
            padding: 4px 8px;
            font-size: 0.8rem;
            color: var(--light-blue);
            margin-top: 10px;
        }

        /* Taskbar icon for minimized windows */
        .taskbar-minimized-icon {
            background: rgba(255, 255, 255, 0.25); /* More transparent background */
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 8px; /* Rounded square */
            padding: 4px 8px;
            margin: 0 3px;
            cursor: pointer; /* Changed to default pointer */
            display: flex;
            align-items: center;
            gap: 5px;
            color: white; /* White text */
            font-size: 0.8rem;
            box-shadow: inset 0 1px 3px rgba(255,255,255,0.5), 0 1px 3px rgba(0,0,0,0.4);
            transition: all 0.2s ease;
            white-space: nowrap;
            max-width: 150px; /* Increased max-width for more text */
            overflow: hidden;
            text-overflow: ellipsis; /* Add ellipsis for overflow */
        }

        .taskbar-minimized-icon:hover {
            background: rgba(255, 255, 255, 0.35);
            transform: translateY(-2px); /* Lift effect on hover */
            box-shadow: inset 0 1px 3px rgba(255,255,255,0.6), 0 2px 8px rgba(0,0,0,0.5);
        }

        /* Active taskbar icon style */
        .taskbar-minimized-icon.active {
            background: linear-gradient(to bottom, rgba(0, 191, 255, 0.5) 0%, rgba(0, 122, 204, 0.5) 100%); /* Blue gradient active */
            border-color: var(--primary-blue);
            box-shadow: inset 0 1px 4px rgba(0,0,0,0.6), 0 0 12px var(--primary-blue); /* Stronger glow */
            transform: translateY(0);
        }

        /* Style for SVG icons in minimized taskbar icons */
        .taskbar-minimized-icon svg {
            width: 1em;
            height: 1em;
            filter: drop-shadow(0 0 3px rgba(0, 191, 255, 0.3));
            transition: filter 0.2s ease;
        }
        .taskbar-minimized-icon.active svg {
            filter: brightness(1.5) drop-shadow(0 0 5px rgba(255,255,255,0.8));
        }

        /* Loading spinner styles */
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid var(--primary-blue);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Sub-menu for language selection */
        .start-menu-submenu {
            position: absolute;
            left: 100%; /* Position to the right of the parent menu item */
            top: 0;
            width: 200px; /* Fixed width for submenu */
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 191, 255, 0.3), inset 0 0 10px rgba(255, 255, 255, 0.2);
            padding: 10px;
            display: none; /* Hidden by default */
            flex-direction: column;
            z-index: 101; /* Higher than main start menu */
        }
        .start-menu-item.has-submenu:hover .start-menu-submenu {
            display: flex; /* Show submenu on hover */
        }

        /* Toggle switch styles */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer; /* Changed to default pointer */
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary-blue);
        }

        input:focus + .toggle-slider {
            box-shadow: 0 0 1px var(--primary-blue);
        }

        input:checked + .toggle-slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        /* Round sliders */
        .toggle-slider.round {
            border-radius: 34px;
        }

        .toggle-slider.round:before {
            border-radius: 50%;
        }

        /* Custom Scrollbar Styles (for Webkit browsers like Chrome/Safari) */
        /* Track */
        ::-webkit-scrollbar {
            width: 16px; /* Thicker scrollbar width */
        }

        /* Handle */
        ::-webkit-scrollbar-thumb {
            background: rgba(0, 191, 255, 0.7); /* Blueish transparent, slightly darker */
            border-radius: 10px; /* Rounded corners for the thumb */
            border: 4px solid rgba(255, 255, 255, 0.3); /* Thicker transparent border around thumb */
            transition: background 0.2s ease;
        }

        /* Handle on hover */
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 191, 255, 0.9); /* Darker blue on hover */
        }

        /* Track background */
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.15); /* Slightly less transparent track */
            border-radius: 10px;
        }

        /* Buttons (arrows) */
        ::-webkit-scrollbar-button {
            background: rgba(255,255,255,0.2); /* White transparent */
            border-radius: 50%; /* Circular buttons */
            height: 20px; /* Adjust height to make it circular */
            width: 20px; /* Adjust width to make it circular */
            display: block; /* Ensure it takes up space */
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: inset 0 1px 4px rgba(255,255,255,0.7), 0 1px 5px rgba(0,0,0,0.5);
            transition: background-color 0.1s ease, transform 0.05s ease, box-shadow 0.1s ease;
        }

        ::-webkit-scrollbar-button:hover {
            background: rgba(255,255,255,0.4); /* Lighter white on hover */
            transform: scale(1.1);
            filter: brightness(1.2);
            box-shadow: inset 0 1px 6px rgba(255,255,255,0.9), 0 2px 10px rgba(0,0,0,0.6);
        }

        ::-webkit-scrollbar-button:active {
            background: rgba(255,255,255,0.1); /* Darker white on active */
            transform: scale(0.9);
            opacity: 1;
            box-shadow: inset 0 0 6px rgba(0,0,0,0.8), inset 0 -1px 4px rgba(255,255,255,0.5);
            filter: brightness(0.8);
        }

        /* For Firefox scrollbars */
        html {
            scrollbar-width: thin; /* "auto" or "thin" */
            scrollbar-color: rgba(0, 191, 255, 0.7) rgba(255, 255, 255, 0.15); /* thumb and track color */
        }
        /* Note: Firefox doesn't support styling scrollbar buttons with standard CSS */

    </style>
</head>
<body>
    <!-- Desktop background layer for dynamic Frutiger Aero style background -->
    <div class="desktop-background" id="desktop-background"></div>

    <!-- Desktop container, simulating a screen -->
    <div class="desktop-container" id="desktop-container">
        <!-- Desktop Layout - holds the main desktop area and the taskbar -->
        <div class="desktop-layout">
            <!-- Main Desktop Area - where icons and windows reside -->
            <div class="main-desktop-area" id="main-desktop-area">
                <!-- Initial welcome message, will be hidden when windows open -->
                <div id="welcome-message" class="absolute inset-0 flex items-center justify-center pointer-events-none">
                    <p class="text-3xl text-white opacity-70" id="welcome-message-text">Ê¨¢ËøéÊù•Âà∞ MAX OS ËôöÊãüÂÆáÂÆôÁªàÁ´Ø</p>
                </div>
                
                <!-- Desktop Icons (Shortcuts) -->
                <div class="desktop-icons-container" id="desktop-icons-container">
                    <div class="desktop-icon" data-section="works" data-title-zh="ÊàëÁöÑ‰ΩúÂìÅÈõÜ" data-title-en="My Works">
                        <span class="icon-placeholder" data-asset-key="icon_works"></span>
                        <span class="desktop-icon-label" data-lang-key="worksIcon">‰ΩúÂìÅÈõÜ</span>
                    </div>
                    <div class="desktop-icon" data-section="characters" data-title-zh="ËßíËâ≤Â∫ì" data-title-en="Characters">
                        <span class="icon-placeholder" data-asset-key="icon_characters"></span>
                        <span class="desktop-icon-label" data-lang-key="charactersIcon">ËßíËâ≤</span>
                    </div>
                    <!-- About Me icon changed to mazko.exe with M icon -->
                    <div class="desktop-icon" data-section="about" data-title-zh="ÂÖ≥‰∫é MAZKO" data-title-en="About MAZKO">
                        <span class="icon-placeholder" data-asset-key="icon_mazko_logo"></span>
                        <span class="desktop-icon-label" data-lang-key="mazkoExeIcon">MAZKO</span>
                    </div>
                    <div class="desktop-icon" data-section="services" data-title-zh="ÊúçÂä°‰∏éÊä•‰ª∑" data-title-en="Services & Pricing">
                        <span class="icon-placeholder" data-asset-key="icon_services"></span>
                        <span class="desktop-icon-label" data-lang-key="servicesIcon">ÊúçÂä°</span>
                    </div>
                    <div class="desktop-icon" data-section="socials" data-title-zh="Á§æ‰∫§Â™í‰Ωì" data-title-en="Social Media">
                        <span class="icon-placeholder" data-asset-key="icon_socials"></span>
                        <span class="desktop-icon-label" data-lang-key="socialsIcon">Á§æ‰∫§</span>
                    </div>
                </div>
                <!-- Windows will be appended here by JavaScript -->
            </div>

            <!-- Start Menu -->
            <div id="start-menu" class="start-menu hidden">
                <div class="start-menu-header" data-section="about" data-title-zh="ÂÖ≥‰∫é MAZKO" data-title-en="About MAZKO"> <!-- Make header clickable to open About Me -->
                    <span class="icon-placeholder" data-asset-key="icon_mazko_logo"></span>
                    <span data-lang-key="profileName">MAZKO</span>
                </div>
                <a href="#" class="start-menu-item" data-section="works" data-lang-key="worksMenuItem" data-title-zh="ÊàëÁöÑ‰ΩúÂìÅÈõÜ" data-title-en="My Works">
                    <span class="icon-placeholder" data-asset-key="icon_works"></span>
                    <span class="menu-item-label"></span>
                </a>
                <a href="#" class="start-menu-item" data-section="characters" data-lang-key="charactersMenuItem" data-title-zh="ËßíËâ≤Â∫ì" data-title-en="Characters">
                    <span class="icon-placeholder" data-asset-key="icon_characters"></span>
                    <span class="menu-item-label"></span>
                </a>
                <a href="#" class="start-menu-item" data-section="services" data-lang-key="servicesMenuItem" data-title-zh="ÊúçÂä°‰∏éÊä•‰ª∑" data-title-en="Services & Pricing">
                    <span class="icon-placeholder" data-asset-key="icon_services"></span>
                    <span class="menu-item-label"></span>
                </a>
                <a href="#" class="start-menu-item" data-section="socials" data-lang-key="socialsMenuItem" data-title-zh="Á§æ‰∫§Â™í‰Ωì" data-title-en="Social Media">
                    <!-- Socials menu item icon using inline SVG now, not ASSETS -->
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg>
                    <span class="menu-item-label"></span>
                </a>
                <!-- Removed the horizontal line as requested -->
                <!-- <div class="border-t border-gray-600 my-2 mx-4"></div> -->
                <!-- Settings and Shutdown Buttons in a container, now using start-menu-footer-button class -->
                <div class="start-menu-buttons-container">
                    <button class="start-menu-footer-button" data-section="settings" data-lang-key="settingsMenuItem" title="ËÆæÁΩÆ" data-title-zh="Á≥ªÁªüËÆæÁΩÆ" data-title-en="Settings">
                        <!-- Settings footer button icon changed to a more conventional gear SVG -->
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.4-1.07-.75-1.67-1.03l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.5.44l-.38 2.65c-.6.28-1.15.63-1.67 1.03l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.12.22-.07.49.12.64l2.11 1.65c-.04.32-.07.64-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.31.61.22l2.49-1c.52.4 1.07.75 1.67 1.03l.38 2.65c.04.26.25.44.5.44h4c.25 0 .46-.18.5-.44l-.38-2.65c.6-.28 1.15-.63 1.67-1.03l2.49 1c-.22.09-.49 0-.61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/></svg>
                        <!-- Removed text span as requested -->
                    </button>
                    <button class="start-menu-footer-button" data-section="shutdown" data-lang-key="shutdownMenuItem" title="ÂÖ≥Èó≠Á≥ªÁªü" data-title-zh="ÂÖ≥Èó≠Á≥ªÁªü" data-title-en="Shutdown">
                        <!-- Shutdown footer button icon changed to a more conventional power symbol SVG -->
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M13 3c-4.97 0-9 4.03-9 9H1l3.05 3.05L7 12H5c0-3.86 3.14-7 7-7s7 3.14 7 7-3.14 7-7 7c-.64 0-1.27-.09-1.87-.27l-.76 1.24c.94.49 2 .78 3.07.78 4.97 0 9-4.03 9-9s-4.03-9-9-9z"/></svg>
                        <!-- Removed text span as requested -->
                    </button>
                </div>
            </div>

            <!-- Taskbar at the bottom -->
            <div class="taskbar" id="taskbar">
                <!-- Start Button changed to M icon -->
                <button class="start-button" id="start-button-taskbar">
                    <span class="icon-placeholder" data-asset-key="icon_mazko_logo" id="start-button-icon-placeholder"></span>
                    <!-- <span data-lang-key="startButton">ÂºÄÂßã</span> Removed text -->
                </button>

                <!-- Taskbar icons for open/minimized windows -->
                <div id="taskbar-icons" class="taskbar-icons-container">
                    <!-- Minimized window icons will be appended here -->
                </div>

                <!-- Right side system tray -->
                <div class="system-tray">
                    <div class="system-tray-icon">
                        <!-- WiFi icon changed to a more conventional signal SVG -->
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 4C7.31 4 3.07 5.9 0 8.98L12 21l12-12.02C20.93 5.9 16.69 4 12 4zm0 2c3.48 0 6.64 1.48 8.06 3.63L12 18.06 3.94 9.63C5.36 7.48 8.52 6 12 6z"/></svg>
                    </div>
                    <div class="system-tray-icon">
                        <!-- Battery icon changed to a horizontal battery SVG -->
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 9h-2V7c0-.55-.45-1-1-1H7c-.55 0-1 .45-1 1v2H4c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1h2v2c0 .55.45 1 1 1h10c.55 0 1-.45 1-1v-2h2c.55 0 1-.45 1-1v-4c0-.55-.45-1-1-1zM6 8h12v8H6V8z"/></svg>
                    </div>
                    <div class="system-tray-icon">
                        <!-- Volume icon - Kept the existing conventional one -->
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.98 7-4.99 7-8.77s-2.99-7.79-7-8.77z"/></svg>
                    </div>
                    <span class="text-sm text-white opacity-80" id="current-time"></span> <!-- Time display -->
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('Script started parsing.'); // Added for debugging
        
        /**
         * @object ASSETS
         * @description ÈõÜ‰∏≠ÁÆ°ÁêÜÊâÄÊúâÂõæÁâáÂíåÂõæÊ†áÁöÑË∑ØÂæÑ„ÄÇ
         * ËØ∑Â∞ÜÊÇ®ÁöÑÂõæÁâáÊñá‰ª∂ÊîæÁΩÆÂú®Áõ∏Â∫îÁöÑ `assets/` Êñá‰ª∂Â§π‰∏≠„ÄÇ
         * ‰æãÂ¶ÇÔºå`./assets/cursors/hand_open.png` Ë°®Á§∫Êñá‰ª∂‰Ωç‰∫éÈ°πÁõÆÊ†πÁõÆÂΩï‰∏ãÁöÑ `assets/cursors/` Êñá‰ª∂Â§π‰∏≠„ÄÇ
         * ÊÇ®ÂèØ‰ª•Ê†πÊçÆÈúÄË¶Å‰øÆÊîπËøô‰∫õË∑ØÂæÑÂíåÊñá‰ª∂Âêç„ÄÇ
         */
        const ASSETS = {
            // ÂÖâÊ†áÂõæÁâá (Using provided files)
            'cursor_default': 'hand_open.png',
            'cursor_active': 'hand_closed.png',
            'cursor_pointer': 'hand_point.png',

            // Ê°åÈù¢ÂõæÊ†á / ÂºÄÂßãËèúÂçïÂõæÊ†á (Using user-provided image files)
            'icon_works': 'image_4106dc.png', 
            'icon_characters': 'image_5bf20c.png', 
            'icon_mazko_logo': 'https://placehold.co/48x48/6699CC/FFFFFF?text=M', // Using placeholder for now
            'icon_services': 'https://placehold.co/48x48/6699CC/FFFFFF?text=Services', // Placeholder for social icon as image asset
            'icon_socials': 'https://placehold.co/48x48/6699CC/FFFFFF?text=Social', // Placeholder for social icon as image asset
            'icon_settings': 'https://placehold.co/48x48/6699CC/FFFFFF?text=Settings', // Placeholder for settings icon as image asset
            
            // Desktop background image (User-provided image)
            'desktop_background_image': 'https://placehold.co/1920x1080/00BFFF/FFFFFF?text=Desktop+Background', // Using placeholder for now

            // Work section images (placeholders as files were not provided)
            'image_d0f029.png': 'https://placehold.co/300x200/00BFFF/FFFFFF?text=Work1', 
            'image_d160ec.png': 'https://placehold.co/300x200/007ACC/FFFFFF?text=Work1_Detail1', 
            'image_057d28.png': 'https://placehold.co/300x200/00BFFF/FFFFFF?text=Work1_Detail2', 
            'image_0597aa.jpg': 'https://placehold.co/300x200/007ACC/FFFFFF?text=Work2', 
            'image_0597eb.png': 'https://placehold.co/300x200/00BFFF/FFFFFF?text=Work2_Detail1', 
        };

        /**
         * @function getAssetUrl
         * @param {string} assetKey - ASSETS ÂØπË±°‰∏≠ÁöÑÈîÆÂêç„ÄÇ
         * @returns {string} ÂØπÂ∫îËµÑ‰∫ßÁöÑ URL Ë∑ØÂæÑ„ÄÇ
         * @description ‰ªé ASSETS ÂØπË±°‰∏≠Ëé∑ÂèñÊåáÂÆöËµÑ‰∫ßÁöÑ URL„ÄÇ
         */
        function getAssetUrl(assetKey) {
            return ASSETS[assetKey] || ''; 
        }

        // All text content for different languages
        const LANG_CONTENT = {
            'zh': {
                systemName: 'MAX OS', // New system name
                systemVersion: 'Ver1.0', // New system version
                welcomeMessage: 'Ê¨¢ËøéÊù•Âà∞ MAX OS ËôöÊãüÂÆáÂÆôÁªàÁ´Ø',
                startButton: 'ÂºÄÂßã', // This will no longer be used for the button text
                profileName: 'MAZKO',
                worksIcon: '‰ΩúÂìÅÈõÜ',
                charactersIcon: 'ËßíËâ≤',
                mazkoExeIcon: 'MAZKO', // Removed .exe
                servicesIcon: 'ÊúçÂä°',
                socialsIcon: 'Á§æ‰∫§',
                settingsIcon: 'ËÆæÁΩÆ', // New
                worksMenuItem: '‰ΩúÂìÅÈõÜ', // Simplified for menu item label
                charactersMenuItem: 'ËßíËâ≤', // Simplified for menu item label
                servicesMenuItem: 'ÊúçÂä°‰∏éÊä•‰ª∑', // Simplified for menu item label
                socialsMenuItem: 'Á§æ‰∫§Â™í‰Ωì', // Simplified for menu item label
                settingsMenuItem: 'ËÆæÁΩÆ', // Now a button, simplified text
                languageMenuItem: 'ËØ≠Ë®Ä', // This will still be used for the settings window
                shutdownMenuItem: 'ÂÖ≥Èó≠Á≥ªÁªü', // Now a button, simplified text
                shutdownMessage: 'ÊÑüË∞¢ÊÇ®ÁöÑËÆøÈóÆÔºåMAX OS ËôöÊãüÂÆáÂÆôÁªàÁ´ØÊ≠£Âú®ÂÆâÂÖ®ÈÄÄÂá∫„ÄÇ', // Updated shutdown message
                loadingMessage: 'Âä†ËΩΩ‰∏≠...',
                errorLoadingContent: 'Âä†ËΩΩÂÜÖÂÆπÂ§±Ë¥•Ôºö',
                unknownModule: 'ÈîôËØØÔºöÊú™Áü•Ê®°Âùó„ÄÇ',
                worksTitle: 'ÊàëÁöÑ‰ΩúÂìÅÈõÜ',
                worksClickPrompt: 'ÁÇπÂáª‰ΩúÂìÅÂç°ÁâáÊü•ÁúãËØ¶ÊÉÖ...',
                worksDetailsSuffix: ' - ËØ¶ÊÉÖ', // New suffix for work details
                charactersTitle: 'ËßíËâ≤ËÆæËÆ°',
                charactersDescription: `
Êé¢Á¥¢ÊàëÁã¨ÁâπÁöÑPSXÊ∏∏ÊàèÈ£éÊ†ºÂç°ÈÄöËßíËâ≤„ÄÇ

ÊàëÁó¥Ëø∑‰∫éÂ∞ÜÊ∏∏ÊàèËßíËâ≤ÁöÑÂÉèÁ¥†ÁæéÂ≠¶ËûçÂÖ•ÊàëÁöÑËÆæËÆ°‰∏≠ÔºåÂàõÈÄ†Âá∫Êó¢Â§çÂè§ÂèàÂÖÖÊª°Êú™Êù•ÊÑüÁöÑÂç°ÈÄö‰∫∫Áâ©„ÄÇËøô‰∫õËßíËâ≤Êã•ÊúâÁÆÄÊ¥ÅÁöÑÂá†‰ΩïÂΩ¢ÊÄÅÂíåÊòé‰∫ÆÁöÑËâ≤ÂΩ©ÔºåÊØè‰∏Ä‰∏™ÈÉΩÊó®Âú®ËÆ≤Ëø∞‰∏Ä‰∏™Áã¨ÁâπÁöÑÊïÖ‰∫ã„ÄÇ

ÊàëÁöÑËßíËâ≤ËÆæËÆ°ÁÅµÊÑüÊù•Ê∫ê‰∫é90Âπ¥‰ª£ÁöÑÁªèÂÖ∏Ê∏∏ÊàèÔºåÂäõÊ±ÇÈÄöËøá‰ΩéÂ§öËæπÂΩ¢Âª∫Ê®°ÂíåÁã¨ÁâπÁ∫πÁêÜÊù•Âî§Ëµ∑ÊÄÄÊóßÊÉÖÊÄÄÔºåÂêåÊó∂Ê≥®ÂÖ•Áé∞‰ª£ÁöÑËâ∫ÊúØÊÑü„ÄÇÂÆÉ‰ª¨‰∏ç‰ªÖÊòØËßÜËßâË°®ËææÔºåÊõ¥ÊòØÂØπÊï∞Â≠óÊó∂‰ª£Êó©ÊúüÁæéÂ≠¶ÁöÑËá¥Êï¨„ÄÇ
                `, // Now Markdown
                aboutTitle: 'ÂÖ≥‰∫é MAZKO', // Title for About Me window
                aboutContent: `
ÊàëÊòØ‰∏ÄÂêçÊù•Ëá™‰∏≠ÂõΩÁöÑ 3D Ëâ∫ÊúØÂÆ∂‰∏éÂπ≥Èù¢ËÆæËÆ°Â∏àÔºå‰∏ìÊ≥®‰∫é PSX Ê∏∏ÊàèÈ£éÊ†ºÂç°ÈÄöÂª∫Ê®°‰∏é lowpoly Â§çÂè§ÂÉèÁ¥†Ë¥®ÊÑüÔºåÂêåÊó∂Ê≤âÊµ∏‰∫éÂú∞‰∏ã club ÊñáÂåñ‰∏éÂÖàÈîãËßÜËßâÁöÑÂ§öÂÖÉËûçÂêàÂàõ‰Ωú„ÄÇ

Áó¥Ëø∑‰∫é‰∏ÄÂàáÁ™ÅÁ†¥Â∏∏ËßÑÁöÑÁæéÂ≠¶ËØ≠Ë®Ä‚Äî‚Äî‰ªé ASAP Rocky MV„ÄäTailor Swift„Äã‰∏≠ÁöÑËßÜËßâÂº†ÂäõÔºåÂà∞„ÄäÂºÇÂÖΩÈ≠îÈÉΩ„ÄãÁöÑËçíËØûËßíËâ≤ËÆæÂÆöÔºåÂÜçÂà∞„ÄäÁëûÂÖãÂíåËé´ËíÇ„ÄãÁöÑÁª¥Â∫¶Èîô‰π±ÔºåÊàëÂ∞ÜÂä®Êº´Âèô‰∫ã„ÄÅË°óÂ§¥ÂòªÂìà„ÄÅÂ§çÂè§ÁßëÂπªÁ≠âÊñáÂåñÂü∫Âõ†Ê≥®ÂÖ•‰ΩúÂìÅ‰πã‰∏≠ÔºåÁî®ÂÉèÁ¥†È¢óÁ≤í‰∏é‰ΩéÊ®°ÊûÑÂª∫Âá∫Áã¨‰∏ÄÊó†‰∫åÁöÑËßÜËßâÁ≥ªÁªü„ÄÇ

ÊàëÊìÖÈïø‰ΩøÁî® Blender„ÄÅSubstance Painter„ÄÅZbrush„ÄÅPhotoshop ‰∏é IllustratorÔºåÊ∂µÁõñËßíËâ≤ËÆæËÆ°„ÄÅCG Âä®Áîª„ÄÅÊµ∑Êä•„ÄÅVJ„ÄÅËôöÊãüÊó∂Â∞ö‰∏é LOGO ËÆæËÆ°Á≠âÂ§ö‰∏™È¢ÜÂüü„ÄÇ
                `, // Now Markdown
                services: {
                    title: 'ÊúçÂä°‰∏éÊä•‰ª∑',
                    description: '‰ª•‰∏ãÊòØÊàëÁöÑ‰∏ªË¶ÅÊúçÂä°È°πÁõÆÂèäÂ§ßËá¥Êä•‰ª∑ËåÉÂõ¥Ôºö', // Now Markdown
                    categories: [
                        {
                            id: 'character-modeling-category',
                            name: 'ËßíËâ≤Âª∫Ê®°ÊúçÂä°',
                            nameEn: 'Character Modeling Service', // Added English name for title bar
                            shortDescription: '‰ΩéÂ§öËæπÂΩ¢‰∫∫Áâ©Âª∫Ê®°‰∏éÂ§çÂè§Âä®ÁîªÊúçÂä°„ÄÇ',
                            detailContent: `
### üë§„Äêùêãùê®ùê∞-ùêèùê®ùê•ùê≤ ùêÇùê°ùêöùê´ùêöùêúùê≠ùêûùê´ ùêåùê®ùêùùêûùê•ùê¢ùêßùê†„Äë‰ΩéËæπÂΩ¢‰∫∫Áâ©Âª∫Ê®°
**‰ª∑Ê†ºÔºö** 500¬•+ / ‰∫∫
ÊàëÂ∞Ü‰∏∫‰Ω†ÁöÑËßíËâ≤ËøõË°å‰ΩéÂ§öËæπÂΩ¢Âª∫Ê®°‰∏éËÆæËÆ°ÔºÅ

#### ‚ñ∑ Âü∫Á°ÄÊúçÂä°ÂÜÖÂÆπÔºö
* ËßíËâ≤Âª∫Ê®°Ôºà‰ΩéÂ§öËæπÂΩ¢Ôºâ
* ÁÆÄÂçïÂä®‰ΩúÁªëÂÆö
* Ê∏≤ÊüìËßÜÈ¢ëÂØºÂá∫

‚ñ† ‰∫§‰ªòÊ†ºÂºèÔºö FBX / Blender / mp4

### üï∫„Äêùêëùêûùê≠ùê´ùê® ùêÄùêßùê¢mùêöùê≠ùê¢ùê®ùêß ùêåùê®ùêùùêÆùê•ùêû„Äë‰ΩéËæπÂΩ¢‰∫∫Áâ©Â§çÂè§Âä®Áîª
**‰ª∑Ê†ºÔºö** 1000¬•+ / ‰∏™
ÊàëÂ∞Ü‰∏∫ÊÇ®Êèê‰æõÂÆåÊï¥ÁöÑ‰ΩéÂ§öËæπÂΩ¢ËßíËâ≤Âä®ÁîªÊúçÂä°„ÄÇÂåÖÂê´‰ªéÂª∫Ê®°„ÄÅÁªëÂÆö„ÄÅÂà∞Âä®‰ΩúËÆæÂÆö‰∏éÊ∏≤ÊüìÂØºÂá∫ÔºåÈÄÇÂêàÁî®‰∫éÊºîÁ§∫Áü≠Áâá„ÄÅÁ§æ‰∫§Â™í‰ΩìËßíËâ≤Â±ïÁ§∫„ÄÅÂ§çÂè§Âú∫ÊôØÊ∞õÂõ¥Ê∏≤ÊüìÁ≠â„ÄÇ

#### ‚ñ∑ Âü∫Á°ÄÊúçÂä°ÂÜÖÂÆπÔºö
* ËßíËâ≤Âª∫Ê®° + È™®È™ºÂä®ÁîªËÆæÂÆö
* Âú∫ÊôØÊê≠Âª∫ÔºàÊ†πÊçÆÈúÄÊ±ÇÂÆöÂà∂Ôºâ
* ÊºîÁ§∫Ê∏≤ÊüìÔºàÈªòËÆ§Âä®ÁîªÈïøÂ∫¶‰∏∫ 20 ÁßíÂÜÖÔºâ

‚ñ† ‰∫§‰ªòÊ†ºÂºèÔºö FBX / Blender / mp4

### ‚ö†Ô∏è „Äêùêíùê©ùêûùêúùê¢ùêöùê• ùêçùê®ùê≠ùêûùê¨„ÄëÁâπÂà´ËØ¥Êòé
ÊéàÊùÉËåÉÂõ¥Ôºö‰ªÖÈôê‰∏™‰∫∫ÈùûÂïÜ‰∏öÂú∫ÊôØÔºàÂ¶ÇÂæÆ‰ø° / ÂæÆÂçö / ÊäñÈü≥Á≠âÁ§æ‰∫§ÂàÜ‰∫´„ÄÅÈùûÁõàÂà©‰∏™‰∫∫Â±ïÁ§∫ÔºâÔºõÂïÜÁî®Âú∫ÊôØÔºàÂìÅÁâåÂÆ£‰º†„ÄÅ‰∫ßÂìÅÊ§çÂÖ•„ÄÅ‰ªòË¥πÂÜÖÂÆπÁ≠âÔºâÈúÄÊèêÂâçÊ≤üÈÄöÔºåÊä•‰ª∑Èöè‰ΩøÁî®ËåÉÂõ¥ / Êó∂ÈïøË∞ÉÊï¥„ÄÇ

Ë¥πÁî®Ë°•ÂÖÖÔºöÂä®ÁîªË∂Ö 20 ÁßíÊàñÂÜÖÂÆπÂ§çÊùÇÂåñÔºàÂ¶ÇÁâπÊïà / Â§öËßíËâ≤‰∫íÂä®ÔºâÔºåÂ∞ÜÊåâÂ∑•‰ΩúÈáèËøΩÂä†Ë¥πÁî®ÔºåÂÖ∑‰Ωì‰ª•ÂèåÊñπÁ°ÆËÆ§Ê∏ÖÂçï‰∏∫ÂáÜ„ÄÇ

Âª∫ËÆÆÔºöÊèê‰æõÂ∞ΩÂèØËÉΩÊ∏ÖÊô∞ÁöÑÂèÇËÄÉÂõæÊàñÁÅµÊÑüÊñπÂêëÔºåÊúâÂä©‰∫éÊõ¥È´òÊïàËøòÂéü‰Ω†ÁöÑËßÜËßâÈúÄÊ±Ç„ÄÇ

### üìú„ÄêùêÇùê®ùê©ùê≤ùê´ùê¢ùê†ùê°ùê≠ ùêíùê≠ùêöùê≠ùêûùê¶ùêûùêß„ÄëÁâàÊùÉÁî≥Êòé
ÊâÄÊúâÊàêÊûúÔºàÊ®°Âûã / Âä®Áîª / Ê∫êÊñá‰ª∂Á≠âÔºâÁâàÊùÉÂΩíÊúçÂä°ÊñπÔºàüÖúÔºâÊâÄÊúâ„ÄÇ

ÂÆ¢Êà∑‰ªÖËé∑ÈùûÂïÜ‰∏ö‰ΩøÁî®ÊùÉÔºåÁ¶ÅÊ≠¢ÂïÜÁî®„ÄÅ‰∫åÊ¨°Âàõ‰Ωú„ÄÅËΩ¨ÂîÆÊàñÊéàÊùÉÁ¨¨‰∏âÊñπ„ÄÇ

ÈúÄÁâàÊùÉËΩ¨ËÆ©ÁöÑÔºåÂè¶Ë°åÁ≠æÁΩ≤ÂçèËÆÆÂπ∂ÊîØ‰ªòÂéüÊä•‰ª∑ 3-5 ÂÄçË¥πÁî®„ÄÇ

Ë∂ÖËåÉÂõ¥‰ΩøÁî®ÂºïÂèëÁöÑÁ∫†Á∫∑ÔºåÁî±ÂÆ¢Êà∑ÊâøÊãÖÂÖ®ÈÉ®Ë¥£‰ªª„ÄÇ

üÖú ÂçèËÆÆÁâàÊú¨Ôºö*ùòù1.2* | ‰∏ãÂçïÂç≥ËßÜ‰∏∫ÂêåÊÑèÂÖ®ÈÉ®ÂÜÖÂÆπ
                            `, // Now Markdown
                        },
                        {
                            id: 'poster-design-category',
                            name: 'Êµ∑Êä•ËÆæËÆ°ÊúçÂä°',
                            nameEn: 'Poster Design Service', // Added English name for title bar
                            shortDescription: 'Âπ≥Èù¢„ÄÅAIÂä®ÊÄÅ„ÄÅ3DÂèä3DÂä®ÊÄÅÊµ∑Êä•ËÆæËÆ°ÊúçÂä°„ÄÇ',
                            detailContent: `
### [Âπ≥Èù¢Êµ∑Êä• 500¬• / Âº†]
**‰ª∑Ê†ºÔºö** 500¬• / Âº†
Êèê‰æõÊ∫êÊñá‰ª∂ÂíåÊåáÂÆöÊ†ºÂºèÂíåÂ∞∫ÂØ∏ÁöÑÂõæÁâá

### [AIÂä®ÊÄÅÊµ∑Êä• 500¬• / Âº†]
**‰ª∑Ê†ºÔºö** 500¬• / Âº†
Êèê‰æõÊåáÂÆöÊ†ºÂºèÂíåÂ∞∫ÂØ∏ÁöÑËßÜÈ¢ëÂíåÂõæÁâá

### [3DÊµ∑Êä• 700¬•+/ Âº†]
**‰ª∑Ê†ºÔºö** 700¬•+ / Âº†
Êèê‰æõÊåáÂÆöÊ†ºÂºèÂíåÂ∞∫ÂØ∏ÁöÑÂõæÁâá

### [3DÂä®ÊÄÅÊµ∑Êä• 1000¬•+/ Âº†]
**‰ª∑Ê†ºÔºö** 1000¬•+/ Âº†
ÂèØÊèê‰æõÊåáÂÆöÊ†ºÂºèÂíåÂ∞∫ÂØ∏ÁöÑËßÜÈ¢ë

### üì¶ „ÄêùêíùêÑùêëùêïùêàùêÇùêÑ ùêÖùêãùêéùêñ & ùêÉùêÑùêãùêàùêïùêÑùêëùêò„ÄëÊúçÂä°ÊµÅÁ®ã‰∏é‰∫§‰ªòËØ¥Êòé
È°πÁõÆÂêØÂä®ÔºöÈ¢Ñ‰ªò50%ÁöÑËÆ¢ÈáëÂêéÂºÄÂßãËÆæËÆ°ÔºåÂ∑•ÊúüÁ∫¶ 1‚Äì2 Â§©/ Âº†

Â∞æÊ¨æÊîØ‰ªòÔºöËÆæËÆ°ÂÆöÁ®øÂπ∂ÁªèÁî≤ÊñπÁ°ÆËÆ§ÂêéÔºåÊîØ‰ªò50%ÁöÑÂ∞æÊ¨æ

ÊàêÊûú‰∫§‰ªòÔºöÊî∂Âà∞Â∞æÊ¨æÂêé‰∫§‰ªòÊúÄÁªàÊàêÂìÅÊñá‰ª∂

### üîÅ „ÄêùêëùêÑùêïùêàùêíùêàùêéùêç ùêëùêîùêãùêÑùêí & ùêÑùêóùêìùêëùêÄ ùêÖùêÑùêÑùêí„Äë‰øÆÊîπËßÑÂàô‰∏éË∂ÖÈ¢ùË¥πÁî®
Êèê‰æõ 3 Ê¨°ÂÖçË¥πÂü∫Á°ÄË∞ÉÊï¥Ë∞É + 1 Ê¨°ÂÖçË¥πÈáçÂ§ßË∞ÉÊï¥

Ë∂ÖÂá∫ÂÖçË¥πÂü∫Á°ÄË∞ÉÊï¥Ê¨°Êï∞ÂêéÔºåÊØèÊ¨°Âä†Êî∂ËÆæËÆ°Ë¥πÁöÑ 25%

Ë∂ÖÂá∫ÂÖçË¥πÈáçÂ§ßË∞ÉÊï¥Ê¨°Êï∞ÂêéÔºåÊØèÊ¨°Âä†Êî∂ËÆæËÆ°Ë¥πÁöÑ 50%

### üìå „ÄêùêíùêèùêÑùêÇùêàùêÄùêã ùêçùêéùêìùêÑùêí„ÄëÁâπÂà´ËØ¥Êòé
Âü∫Á°ÄË∞ÉÊï¥ÔºöÈôêÁªÜËäÇ‰ºòÂåñÔºàÂ¶ÇÊñáÂ≠ó‰øÆÊ≠£„ÄÅÈ¢úËâ≤ÂæÆË∞É„ÄÅÊéíÁâàÂ±ÄÈÉ®Ë∞ÉÊï¥Á≠âÔºâÔºå‰∏çÊ∂âÂèäÊ†∏ÂøÉÂàõÊÑèÊàñÊ°ÜÊû∂ÂèòÊõ¥

ÈáçÂ§ßË∞ÉÊï¥ÔºöÈôêÊ†∏ÂøÉÊñπÂêë‰ºòÂåñÔºàÂ¶ÇÊï¥‰ΩìÈ£éÊ†ºË∞ÉÊï¥„ÄÅÊ†∏ÂøÉÂÖÉÁ¥†ÊõøÊç¢Á≠âÔºâÔºå‰∏çÊ∂âÂèäÂÆåÂÖ®Êé®ÁøªÈáçËÆæËÆ°

Ë¥£‰ªªÁïåÂÆöÔºöÂõ†Áî≤ÊñπÈúÄÊ±ÇË°®Ëø∞‰∏çÊ∏Ö„ÄÅËµÑÊñô‰∏çÂÖ®ÊàñÂèçÂ§ç‰øÆÊîπÂØºËá¥ÁöÑÂ∑•ÊúüÂª∂ËØØÂèäÈ¢ùÂ§ñË∞ÉÊï¥ÔºåÁõ∏ÂÖ≥ÂêéÊûúÁî±Áî≤ÊñπÊâøÊãÖ

ÊïàÁéáÂª∫ËÆÆÔºöÊèê‰æõÂ∞ΩÂèØËÉΩÊ∏ÖÊô∞ÁöÑÂèÇËÄÉÂõæÊàñÁÅµÊÑüÊñπÂêëÔºåÊúâÂä©‰∫éÊõ¥È´òÊïàËøòÂéü‰Ω†ÁöÑËßÜËßâÈúÄÊ±Ç„ÄÇ

### üìú „ÄêùêÇùê®ùê©ùê≤ùê´ùê¢ùê†ùê°ùê≠ ùêíùê≠ùêöùê≠ùêûmùêûùêß„ÄëÁâàÊùÉÁî≥Êòé
ÊâÄÊúâÊàêÊûúÁü•ËØÜ‰∫ßÊùÉÂΩíÊúçÂä°ÊñπÔºàüÖúÔºâÊâÄÊúâ„ÄÇ

Áî≤ÊñπËé∑‰ªÖÈôêËØ• club Ëá™Ë∫´ÂÆ£‰º†ÁöÑÂïÜÁî®‰ΩøÁî®ÊùÉÔºàÂê´Á∫ø‰∏ãÂº†Ë¥¥„ÄÅÂÆòÊñπÁ§æ‰∫§Âπ≥Âè∞Êé®ÂπøÁ≠âÔºâÔºåÁ¶ÅÊ≠¢ËΩ¨ÂîÆÊàñÊéàÊùÉÁ¨¨‰∏âÊñπ„ÄÇ

ÁâàÊùÉËΩ¨ËÆ©ÈúÄÂè¶Á≠æÂçèËÆÆÂπ∂‰ªòË¥π„ÄÇ

Ë∂ÖËåÉÂõ¥‰ΩøÁî®ÂºïÂèëÁöÑÁ∫†Á∫∑ÔºåÁî±Áî≤ÊñπÊâøÊãÖË¥£‰ªª„ÄÇ

üÖú ÂçèËÆÆÁâàÊú¨Ôºö*ùòù1.2* | ‰∏ãÂçïÂç≥ËßÜ‰∏∫ÂêåÊÑèÂÖ®ÈÉ®ÂÜÖÂÆπ
                            `, // Now Markdown
                        },
                    ]
                },
                socialsTitle: 'Á§æ‰∫§Â™í‰Ωì‰∏éÁ§æÁæ§',
                socialsDescription: 'Ê¨¢ËøéÈÄöËøá‰ª•‰∏ãÂπ≥Âè∞ÊâæÂà∞ÊàëÔºåÂä†ÂÖ•ÊàëÁöÑËôöÊãüÂÆáÂÆôÔºö', // Now Markdown
                socialsLinks: [
                    { name: 'ÂæÆÂçö', url: 'https://weibo.com/yourprofile', iconSvg: `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm4.331 8.875c.01.204.017.411.017.618 0 6.302-4.814 13.582-13.582 13.582-2.697 0-5.207-.79-7.348-2.155.371.044.749.066 1.134.066 2.232 0 4.29-2.022 4.29-4.29 0-.083-.004-.165-.012-.247-.417-.298-.784-.664-1.071-1.077-.923-.274-2.03-.437-3.093-.437-1.12 0-2.164.218-3.136.602-.519-.39-.993-.822-1.428-1.285.497.058 1.002.086 1.512.086.993 0 1.95-.27 2.802-.821-.29-.007-.577-.02-.862-.038-.577-.038-1.139-.074-1.683-.118-.895-.084-1.683-.162-2.36-.263-1.087-.16-2.126-.403-3.09-.728-.426-.145-.838-.306-1.235-.49-.78-.363-1.503-.787-2.167-1.267.31-.03.62-.047.93-.047 1.055 0 2.062.193 3.012.573.535.216 1.037.46 1.518.72 1.393.74 2.658 1.63 3.79 2.652 1.134 1.026 2.115 2.14 2.946 3.328-.158.214-.306.435-.44.664-.475.807-.866 1.636-1.17 2.474-.298.81-.462 1.65-.487 2.508-.024.858.058 1.708.243 2.52.185.812.45 1.57.785 2.26.335.69.75 1.32 1.235 1.88.485.56.983 1.066 1.488 1.493.505.426.985.768 1.442 1.025.456.258.88.428 1.263.51.382.083.738.07 1.066-.038.328-.108.62-.31.865-.606.245-.296.42-.647.525-1.037.105-.39.125-.798.057-1.21-.068-.41-.23-.8-.485-1.157-.255-.357-.59-.68-.992-.95-.403-.272-.89-.523-1.458-.75-.568-.228-1.21-.433-1.92-.612-1.42-.36-2.82-.678-4.185-.945-1.36-.268-2.67-.487-3.89-.64-.52-.066-1.01-.116-1.46-.15-.45-.034-.85-.05-1.2-.05-.88 0-1.74.12-2.58.35-.84.23-1.64.55-2.39.95-.75.4-1.45.89-2.09 1.47-.64.58-1.2 1.25-1.68 1.99-.48.74-.83 1.55-1.05 2.43-.22.88-.27 1.78-.15 2.69.12.91.43 1.78.93 2.59.5.81 1.1 1.57 1.8 2.26.7.69 1.45 1.32 2.26 1.88.81.56 1.66 1.07 2.54 1.49.88.42 1.78.77 2.7 1.05.92.28 1.86.49 2.82.63.96.14 1.92.14 2.88.003.96-.137 1.86-.39 2.7-.75.84-.36 1.6-.83 2.29-1.42.69-.59 1.3-1.27 1.83-2.05.53-.78.97-1.6 1.3-2.5.33-.9.47-1.83.42-2.77-.05-.94-.3-1.85-.75-2.69-.45-.84-1.05-1.6-1.8-2.26-.75-.66-1.58-1.24-2.48-1.74-.9-.5-1.86-.89-2.88-1.17-1.02-.28-2.06-.41-3.12-.4-.73.0-1.45.04-2.17.11z"/></svg>` },
                    { name: 'Instagram', url: 'https://instagram.com/yourprofile', iconSvg: `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M7.8 2h8.4C18.14 2 20 3.86 20 6.2v8.4c0 2.34-1.86 4.2-4.2 4.2H7.8C5.46 19 3.6 17.14 3.6 14.8V6.2C3.6 3.86 5.46 2 7.8 2zm-.2 4A2 2 0 0 0 5.6 6.2v8.4A2 2 0 0 0 7.8 17h8.4a2 2 0 0 0 2.2-2.2V6.2A2 2 0 0 0 16.2 4H7.6zM12 7a5 5 0 1 0 0 10 5 5 0 0 0 0-10zm0 2a3 3 0 1 1 0 6 3 3 0 0 1 0-6zm6.5-3a1.2 1.2 0 1 0 0 2.4 1.2 1.2 0 0 0 0-2.4z"/></svg>` },
                    { name: 'ArtStation', url: 'https://www.artstation.com/yourprofile', iconSvg: `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M22 17.3c-.2-.7-.4-1.3-.7-2-.3-.6-.6-1.2-1-1.7-.4-.5-.9-1-1.5-1.4-.6-.4-1.2-.7-1.9-.8-.7-.1-1.4-.1-2.1-.1s-1.4.1-2.1.3c-.7.2-1.3.5-1.9.8-.6.3-1.1.7-1.6 1.2-.5.5-.9 1-1.3 1.6-.4.6-.7 1.2-.9 1.8-.2.7-.3 1.4-.3 2.1s.1 1.4.3 2.1c.2.7.4 1.3.7 2 .3.6.6 1.2 1 1.7.4.5.9 1 1.5 1.4.6.4 1.2.7 1.9.8.7.1 1.4.1 2.1.1s1.4-.1 2.1-.3c.7-.2 1.3-.5 1.9-.8.6-.3 1.1-.7 1.6-1.2.5-.5.9-1 1.3-1.6.4-.6.7-1.2.9-1.8.2-.7.3-1.4.3-2.1s-.1-1.4-.3-2.1zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-.66 0-1.2.54-1.2 1.2s.54 1.2 1.2 1.2 1.2-.54 1.2-1.2-.54-1.2-1.2-1.2zm-2.8 10h5.6c.66 0 1.2-.54 1.2-1.2s-.54-1.2-1.2-1.2h-5.6c-.66 0-1.2.54-1.2 1.2s.54 1.2 1.2 1.2z"/></svg>` },
                    { name: 'Behance', url: 'https://www.behance.net/yourprofile', iconSvg: `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12s4.48 10 10 10 10-4.48 10-10zm-6.2 3.8h-7.6V8.2h7.6v7.6zM12 6c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm-1 9h-2V9h2v6z"/></svg>` },
                    { name: 'Email', url: 'mailto:your_email@example.com', iconSvg: `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>` },
                ]
            }
        };

        let currentLanguage = 'zh'; // Default language
        let windows = []; // Array to keep track of open windows
        let zIndexCounter = 10; // For managing window z-index
        let isDragging = false;
        let activeDraggableElement = null; // Can be a window or a desktop icon

        // Mock data for works section
        const WORKS_DATA = [
            {
                id: 'work1',
                title: '‰ΩéÂ§öËæπÂΩ¢ËßíËâ≤ËÆæËÆ°ÔºöÂÆáËà™Âëò',
                titleEn: 'Low-Poly Character Design: Astronaut', // Added English title
                category: '3D Âª∫Ê®° / ËßíËâ≤ËÆæËÆ°',
                thumbnail: 'image_d0f029.png', // Placeholder image from assets
                images: [
                    'image_d0f029.png',
                    'image_d160ec.png', // Additional images for gallery
                    'image_057d28.png'
                ],
                description: `
Ëøô‰∏™È°πÁõÆÊé¢Á¥¢‰∫Ü‰ΩéÂ§öËæπÂΩ¢Ôºàlow-polyÔºâËâ∫ÊúØÈ£éÊ†ºÂú®ËßíËâ≤ËÆæËÆ°‰∏≠ÁöÑÂ∫îÁî®ÔºåÂàõÈÄ†‰∫Ü‰∏Ä‰∏™Êú™Êù•‰∏ª‰πâÁöÑÂÆáËà™ÂëòËßíËâ≤„ÄÇËÆæËÆ°ÁêÜÂøµ‰æßÈáç‰∫éÈÄöËøáÁÆÄÊ¥ÅÁöÑÂá†‰ΩïÂΩ¢Áä∂ÂíåÊúâÈôêÁöÑÈ¢úËâ≤Ë∞ÉËâ≤ÊùøÊù•‰º†ËææÂ§çÊùÇÊÄßÂíåÊ∑±Â∫¶„ÄÇÂÆáËà™ÂëòÁöÑÊúçË£ÖËûçÂêà‰∫ÜÁªèÂÖ∏ÁßëÂπªÂÖÉÁ¥†‰∏éÁé∞‰ª£ÁæéÂ≠¶ÔºåÊó®Âú® evoking ‰∏ÄÁßçÊÄÄÊóßËÄåÂèàÂâçÂç´ÁöÑÊÑüËßâ„ÄÇÁ∫πÁêÜÂíåÂÖâÂΩ±Â§ÑÁêÜÊó®Âú®Ê®°ÊãüÊó©Êúü3DÊ∏∏ÊàèÁöÑËßÜËßâÊïàÊûúÔºåÂêåÊó∂‰øùÊåÅÈ´òÊ∞¥Âπ≥ÁöÑÁªÜËäÇÂíåË°®Áé∞Âäõ„ÄÇ

**ÊäÄÊúØÊ†àÔºö**
* **Âª∫Ê®°:** Blender
* **Á∫πÁêÜ:** Substance Painter (Áî®‰∫éÁÉòÁÑô AO ÂíåÈ¢úËâ≤ÔºåÁÑ∂ÂêéÊâãÁªòÂÉèÁ¥†ÁªÜËäÇ)
* **Ê∏≤Êüì:** Blender Eevee (ÂÆûÊó∂Ê∏≤ÊüìÂô®ÔºåÂº∫Ë∞ÉÂç°ÈÄöÊ∏≤Êüì)

ÈÄöËøáËøô‰∏™È°πÁõÆÔºåÊàëÊó®Âú®Â±ïÁ§∫Â¶Ç‰ΩïÂà©Áî®‰ΩéÂ§öËæπÂΩ¢ÊäÄÊúØÂú®‰øùÊåÅËßÜËßâÂê∏ÂºïÂäõÁöÑÂêåÊó∂‰ºòÂåñËµÑÊ∫êÔºå‰ΩøÂÖ∂ÈÄÇÁî®‰∫éÊ∏∏ÊàèÂºÄÂèëÊàñÊ¶ÇÂøµËâ∫ÊúØ„ÄÇÊØè‰∏™ËßíÂ∫¶ÈÉΩÁªèËøáÁ≤æÂøÉËÆæËÆ°Ôºå‰ª•Á°Æ‰øùËßíËâ≤ÁöÑÂèØËØÜÂà´ÊÄßÂíåËßÜËßâÂÜ≤ÂáªÂäõ„ÄÇ
                `
            },
            {
                id: 'work2',
                title: 'MAZKO ÂìÅÁâåËßÜËßâÊ¶ÇÂøµ',
                titleEn: 'MAZKO Brand Visual Concept', // Added English title
                category: 'Âπ≥Èù¢ËÆæËÆ° / ÂìÅÁâåËÆæËÆ°',
                thumbnail: 'image_0597aa.jpg', // Placeholder image
                images: [
                    'image_0597aa.jpg',
                    'image_0597eb.png'
                ],
                description: `
MAZKO ÂìÅÁâåËßÜËßâÊ¶ÇÂøµÈ°πÁõÆÊó®Âú®ÂàõÂª∫‰∏Ä‰∏™ÁªìÂêàÂ§çÂè§ÁæéÂ≠¶‰∏éÊú™Êù•‰∏ª‰πâÂÖÉÁ¥†ÁöÑÁã¨ÁâπÂìÅÁâåÂΩ¢Ë±°„ÄÇËøô‰∏™È°πÁõÆÊ∂µÁõñ‰∫ÜÊ†áÂøóËÆæËÆ°„ÄÅÊéíÁâàÈÄâÊã©„ÄÅËâ≤ÂΩ©ÊñπÊ°à‰ª•ÂèäÂú®ÂêÑÁßçÂ™í‰ªã‰∏äÁöÑÂ∫îÁî®ÔºåÂåÖÊã¨Êï∞Â≠óÁïåÈù¢ÂíåÂç∞Âà∑ÂìÅ„ÄÇ

**Ê†∏ÂøÉÁêÜÂøµÔºö**
ÂìÅÁâåÁöÑÊ†∏ÂøÉÊòØ‚ÄúËôöÊãüÂÆáÂÆôÁªàÁ´Ø‚ÄùÁöÑÊ¶ÇÂøµÔºåÂÆÉÈÄöËøáÂÉèÁ¥†Âåñ„ÄÅÊïÖÈöúËâ∫ÊúØÔºàglitch artÔºâÂíåÈúìËôπÁÅØÂÖâÊïàÊù•‰ΩìÁé∞ÔºåÊó®Âú®‰º†Ëææ‰∏ÄÁßçÊ≤âÊµ∏Âºè„ÄÅÊé¢Á¥¢ÊÄßÁöÑ‰ΩìÈ™å„ÄÇ‰∏ªÊ†áÂøóËÆæËÆ°ÁÆÄÊ¥ÅËÄåÂØåÊúâÂÜ≤ÂáªÂäõÔºåÊòì‰∫éËØÜÂà´ÔºåÂπ∂ËÉΩÈÄÇÂ∫î‰∏çÂêåÂ∞∫ÂØ∏ÂíåËÉåÊôØ„ÄÇ

**ËÆæËÆ°ÂÖÉÁ¥†Ôºö**
* **Ê†áÂøó:** ÊäΩË±°ÁöÑÂá†‰ΩïÂΩ¢Áä∂ÁªìÂêà‰∫ÜËµõÂçöÊúãÂÖãÂíåÊó©ÊúüÊï∞Â≠óËâ∫ÊúØÁöÑÁÅµÊÑü„ÄÇ
* **ÈÖçËâ≤:** ‰∏ªË¶Å‰ΩøÁî®Ê∑±ËìùËâ≤„ÄÅÈùíËâ≤ÂíåÁ¥´Ëâ≤ÔºåËæÖ‰ª•È´òÂØπÊØîÂ∫¶ÁöÑ‰∫ÆËâ≤‰Ωú‰∏∫ÁÇπÁºÄÔºåËê•ÈÄ†Âá∫Ëø∑ÂπªËÄåÁßëÊäÄÊÑüÂçÅË∂≥ÁöÑÊ∞õÂõ¥„ÄÇ
* **ÊéíÁâà:** ÈÄâÁî®ÂÖ∑ÊúâÊú™Êù•ÊÑüÁöÑÊó†Ë°¨Á∫øÂ≠ó‰ΩìÔºåÂπ∂ÁªìÂêàÂÉèÁ¥†Â≠ó‰ΩìÔºå‰ª•Â¢ûÂº∫Â§çÂè§ÊÑü„ÄÇ

Ëøô‰∏™Ê¶ÇÂøµÈÄöËøáËßÜËßâÂèô‰∫ãÔºåÂ∞ÜËßÇ‰ºóÂ∏¶ÂÖ•‰∏Ä‰∏™ÂÖÖÊª°Ê¥ªÂäõÂíåÁ•ûÁßòÊÑüÁöÑÊï∞Â≠ó‰∏ñÁïåÔºåÂº∫Ë∞É MAZKO ‰Ωú‰∏∫‰∏Ä‰∏™ÂàõÊÑèÂíåËâ∫ÊúØÂπ≥Âè∞ÁöÑÁã¨ÁâπË∫´‰ªΩ„ÄÇ
                `
            }
            // Add more work items here
        ];

        // Functions for OS features

        /**
         * @function updateTime
         * @description Updates the current time displayed in the system tray.
         */
        function updateTime() {
            const currentTimeElement = document.getElementById('current-time');
            if (currentTimeElement) { // Add null check
                const now = new Date();
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                currentTimeElement.textContent = `${hours}:${minutes}`;
            }
        }

        /**
         * @function renderDynamicAssets
         * @description Replaces placeholder spans with actual image elements based on ASSETS object.
         * This ensures dynamic asset loading for desktop icons and start menu items.
         */
        function renderDynamicAssets() {
            document.querySelectorAll('.icon-placeholder').forEach(placeholder => {
                const assetKey = placeholder.getAttribute('data-asset-key');
                if (assetKey) {
                    const img = document.createElement('img');
                    img.src = getAssetUrl(assetKey);
                    img.alt = assetKey;
                    img.classList.add('icon-image'); // Add a class for styling
                    // Check if placeholder still exists before replacing
                    if (placeholder.parentNode) {
                        // Prevent re-rendering if image is already there and src is the same
                        const existingImg = placeholder.querySelector('img.icon-image');
                        if (existingImg && existingImg.src === img.src) {
                            return; 
                        }
                        placeholder.innerHTML = ''; // Clear existing content before appending
                        placeholder.appendChild(img);
                    }
                }
            });
            // Set desktop background image if defined
            const desktopBackground = document.getElementById('desktop-background');
            if (desktopBackground) { // Add null check
                const bgImageUrl = getAssetUrl('desktop_background_image');
                if (bgImageUrl && bgImageUrl !== 'https://placehold.co/1920x1080/00BFFF/FFFFFF?text=Desktop+Background') { // Check if it's not the placeholder
                    desktopBackground.style.backgroundImage = `url(${bgImageUrl})`;
                    desktopBackground.style.opacity = '1'; // Make it fully opaque if using an image
                    desktopBackground.style.filter = 'none'; // Remove filters if using an image
                } else {
                    // Fallback to CSS gradients if no image or if it's the placeholder
                    desktopBackground.style.backgroundImage = `
                        radial-gradient(circle at 20% 80%, rgba(0,191,255,0.2) 0%, transparent 40%),
                        radial-gradient(circle at 80% 20%, rgba(0,191,255,0.2) 0%, transparent 40%),
                        linear-gradient(to bottom right, #6699CC, #CCEEFF)
                    `;
                    desktopBackground.style.opacity = '0.8';
                    desktopBackground.style.filter = 'brightness(0.8) contrast(1.2)';
                }
            }

            // Update custom cursor styles (assuming these are image assets for custom cursors)
            document.documentElement.style.setProperty('--cursor-default', `url(${getAssetUrl('cursor_default')}), auto`);
            document.documentElement.style.setProperty('--cursor-active', `url(${getAssetUrl('cursor_active')}), grabbing`);
            document.documentElement.style.setProperty('--cursor-pointer', `url(${getAssetUrl('cursor_pointer')}), pointer`);
        }

        /**
         * @function positionDesktopIcons
         * @description Arranges desktop icons in a grid-like fashion (vertical first) and makes them draggable.
         */
        function positionDesktopIcons() {
            const desktopIconsContainer = document.getElementById('desktop-icons-container');
            if (!desktopIconsContainer) return;

            const icons = desktopIconsContainer.querySelectorAll('.desktop-icon');
            const iconWidth = 90; // Approximate width including padding/margin
            const iconHeight = 100; // Approximate height including padding/margin
            const padding = 20; // Padding from desktop edges

            let col = 0;
            let row = 0;
            const maxRows = Math.floor((desktopIconsContainer.offsetHeight - 2 * padding) / iconHeight);

            icons.forEach(icon => {
                icon.style.left = `${padding + col * iconWidth}px`;
                icon.style.top = `${padding + row * iconHeight}px`;
                icon.style.zIndex = 3; // Ensure icons are above background but below windows

                // Make icons draggable
                makeDraggable(icon, icon); // Icon itself is the drag handle

                row++;
                // Move to next column if maxRows reached
                if (row >= maxRows) {
                    row = 0;
                    col++;
                }
            });
        }

        /**
         * @function applyLanguage
         * @param {string} langCode - The language code (e.g., 'zh', 'en').
         * @description Applies the selected language to all relevant UI elements.
         */
        function applyLanguage(langCode) {
            currentLanguage = langCode;
            document.querySelectorAll('[data-lang-key]').forEach(element => {
                if (element) { // Add null check for element
                    const key = element.getAttribute('data-lang-key');
                    if (LANG_CONTENT[currentLanguage] && LANG_CONTENT[currentLanguage][key]) {
                        if (element.tagName === 'SPAN' || element.tagName === 'P') {
                            element.textContent = LANG_CONTENT[currentLanguage][key];
                        } else if (element.tagName === 'BUTTON') {
                            // For buttons, update title attribute for hover text
                            element.title = LANG_CONTENT[currentLanguage][key];
                        }
                        // For menu items, update the text within the .menu-item-label span
                        if (element.classList.contains('start-menu-item')) {
                            const labelSpan = element.querySelector('.menu-item-label');
                            if (labelSpan) { // Add null check for labelSpan
                                labelSpan.textContent = LANG_CONTENT[currentLanguage][key];
                            }
                        }
                    }
                }
            });

            // Update window titles of open windows
            windows.forEach(win => {
                const section = win.getAttribute('data-section');
                const titleElement = win.querySelector('.os-window-title');
                const statusBar = win.querySelector('.os-window-status-bar'); 

                if (titleElement) { 
                    const newTitleZh = win.getAttribute('data-title-zh') || '';
                    const newTitleEn = win.getAttribute('data-title-en') || '';
                    titleElement.textContent = `${newTitleZh} / ${newTitleEn}`;
                }

                // Update status bar with version
                if (statusBar) {
                    let statusPrefix = 'Ready'; // Default
                    if (section === 'works' && win.getAttribute('data-work-id')) {
                        const work = WORKS_DATA.find(w => w.id === win.getAttribute('data-work-id'));
                        if (work) statusPrefix = `ÂõæÁâá: ${win.dataset.currentImageIndex || 1}/${work.images.length}`;
                    } else if (LANG_CONTENT[currentLanguage] && LANG_CONTENT[currentLanguage][section] && LANG_CONTENT[currentLanguage][section].statusText) {
                        statusPrefix = LANG_CONTENT[currentLanguage][section].statusText;
                    } else if (section === 'service-detail') {
                        const category = (LANG_CONTENT[currentLanguage] && LANG_CONTENT[currentLanguage].services && LANG_CONTENT[currentLanguage].services.categories) ? LANG_CONTENT[currentLanguage].services.categories.find(c => c.id === win.getAttribute('data-work-id')) : null;
                        statusPrefix = category ? `Viewing: ${category.name}` : 'Ready';
                    } else if (section === 'settings') {
                        statusPrefix = (LANG_CONTENT[currentLanguage] && LANG_CONTENT[currentLanguage].settingsIcon) ? LANG_CONTENT[currentLanguage].settingsIcon : 'Setting preferences'; // Changed to use settingsIcon for status
                    } else if (section === 'shutdown') {
                         statusPrefix = (LANG_CONTENT[currentLanguage] && LANG_CONTENT[currentLanguage].shutdownMenuItem) ? LANG_CONTENT[currentLanguage].shutdownMenuItem : 'Shutting down...';
                    }
                    
                    const systemName = (LANG_CONTENT[currentLanguage] && LANG_CONTENT[currentLanguage].systemName) ? LANG_CONTENT[currentLanguage].systemName : 'MAX OS';
                    const systemVersion = (LANG_CONTENT[currentLanguage] && LANG_CONTENT[currentLanguage].systemVersion) ? LANG_CONTENT[currentLanguage].systemVersion : 'Ver1.0';
                    statusBar.textContent = `${statusPrefix} - ${systemName} ${systemVersion}`;
                }
            });

            // IMPORTANT: Update taskbar icons when language changes
            document.querySelectorAll('.taskbar-minimized-icon').forEach(taskbarIcon => {
                const windowId = taskbarIcon.getAttribute('data-window-id');
                const windowElement = document.getElementById(windowId);
                if (windowElement) {
                    const titleSpan = taskbarIcon.querySelector('span:last-child'); // Assuming the last span is the title text
                    if (titleSpan) {
                         // Get title directly from data attributes on the window element
                        const newTitleText = currentLanguage === 'zh' ? 
                                            windowElement.getAttribute('data-title-zh') : 
                                            windowElement.getAttribute('data-title-en');
                        titleSpan.textContent = newTitleText || 'Êú™Áü•Á™óÂè£'; // Fallback
                    }
                }
            });

            // Update welcome message
            const welcomeMessageText = document.getElementById('welcome-message-text');
            if (welcomeMessageText) { // Add null check
                const welcomeMsgKey = LANG_CONTENT[currentLanguage] && LANG_CONTENT[currentLanguage].welcomeMessage ? LANG_CONTENT[currentLanguage].welcomeMessage : 'Welcome to MAX OS Virtual Universe Terminal';
                welcomeMessageText.textContent = welcomeMsgKey;
            }
        }

        /**
         * @function openWindow
         * @param {string} section - The section identifier (e.g., 'works', 'about').
         * @param {string} [dataId] - Optional ID for specific content within a section (e.g., work ID or service category ID).
         * @description Opens a new OS window or brings an existing one to the front.
         */
        async function openWindow(section, dataId = null) {
            let windowId = section + (dataId ? `-${dataId}` : '');
            let existingWindow = document.getElementById(windowId);

            if (existingWindow) {
                // If window exists, bring to front and restore if minimized
                bringWindowToFront(existingWindow);
                if (existingWindow.classList.contains('minimized')) {
                    existingWindow.classList.remove('minimized');
                    // Ensure active state on taskbar icon is set when restored
                    const taskbarIcon = document.querySelector(`.taskbar-minimized-icon[data-window-id="${windowId}"]`);
                    if (taskbarIcon) { 
                        taskbarIcon.classList.add('active'); 
                    }
                }
                loadWindowContent(existingWindow, section, dataId); // Always reload content to ensure language is correct
                return;
            }

            // Create new window
            const newWindow = document.createElement('div');
            newWindow.id = windowId;
            newWindow.classList.add('os-window', 'shadow-lg', 'rounded-xl');
            newWindow.setAttribute('data-section', section);
            if (dataId) {
                newWindow.setAttribute('data-work-id', dataId); // Using data-work-id generically for any dataId
            }

            // Set initial position and size
            const mainDesktopArea = document.getElementById('main-desktop-area');
            if (!mainDesktopArea) {
                console.error("Error: main-desktop-area not found, cannot open window.");
                return;
            }
            
            const desktopWidth = mainDesktopArea.offsetWidth;
            const desktopHeight = mainDesktopArea.offsetHeight;
            const taskbarHeight = document.getElementById('taskbar').offsetHeight;
            const effectiveDesktopHeight = desktopHeight - taskbarHeight; // Area above taskbar

            // Define fixed default initial dimensions, not based on ratios
            const DEFAULT_OPEN_WIDTH = 900;
            const DEFAULT_OPEN_HEIGHT = 600;

            const minWindowWidth = 300; 
            const minWindowHeight = 200;
            const PADDING_MARGIN = 20; // Small margin to prevent window flush against edges

            // Calculate initial width and height, clamped by defaults, mins, and desktop bounds
            let initialWidth = Math.max(minWindowWidth, Math.min(DEFAULT_OPEN_WIDTH, desktopWidth - PADDING_MARGIN)); 
            let initialHeight = Math.max(minWindowHeight, Math.min(DEFAULT_OPEN_HEIGHT, effectiveDesktopHeight - PADDING_MARGIN)); 

            // Center the window based on these initial clamped dimensions
            const posX = Math.max(0, (desktopWidth - initialWidth) / 2); 
            const posY = Math.max(0, (effectiveDesktopHeight - initialHeight) / 2);
            
            console.log('openWindow: Desktop Area Dimensions:', { desktopWidth, effectiveDesktopHeight });
            console.log('openWindow: Fixed Default Dimensions:', { DEFAULT_OPEN_WIDTH, DEFAULT_OPEN_HEIGHT });
            console.log('openWindow: Clamped Initial Dimensions:', { initialWidth, initialHeight });
            console.log('openWindow: Calculated Position (Centered):', { posX, posY });


            newWindow.style.width = `${initialWidth}px`;
            newWindow.style.height = `${initialHeight}px`;
            newWindow.style.left = `${posX}px`;
            newWindow.style.top = `${posY}px`; 

            // Window title bar
            const titleBar = document.createElement('div');
            titleBar.classList.add('os-window-title-bar', 'flex', 'justify-between', 'items-center', 'px-4', 'py-2', 'rounded-t-lg', 'cursor-grab', 'select-none');
            
            const titleContent = document.createElement('div');
            titleContent.classList.add('os-window-title-content');
            
            const windowIcon = document.createElement('img'); // Use img for the M-logo
            windowIcon.classList.add('icon-image');
            windowIcon.src = getAssetUrl('icon_mazko_logo'); // Always use MAZKO logo for window icon
            windowIcon.alt = 'Window Icon';
            titleContent.appendChild(windowIcon);

            const titleText = document.createElement('span');
            titleText.classList.add('os-window-title', 'text-white', 'font-bold');
            titleContent.appendChild(titleText);
            titleBar.appendChild(titleContent);

            // Window controls
            const controls = document.createElement('div');
            controls.classList.add('os-window-controls', 'flex', 'space-x-2');

            // Minimize button
            const minimizeBtn = document.createElement('button');
            minimizeBtn.classList.add('control-button', 'minimize');
            minimizeBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 13H5v-2h14v2z"/></svg>';
            minimizeBtn.onclick = (e) => {
                e.stopPropagation(); // Prevent drag event
                minimizeWindow(newWindow.id);
            };
            controls.appendChild(minimizeBtn);

            // Maximize/Restore button
            const maximizeBtn = document.createElement('button');
            maximizeBtn.classList.add('control-button', 'maximize');
            maximizeBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 7h10v10H7z" fill="none"/><path d="M3 5v14h18V5H3zm16 12H5V7h14v10z"/></svg>'; // Restore icon
            maximizeBtn.onclick = (e) => {
                e.stopPropagation(); // Prevent drag event
                toggleMaximizeWindow(newWindow.id);
            };
            controls.appendChild(maximizeBtn);

            // Close button
            const closeBtn = document.createElement('button');
            closeBtn.classList.add('control-button', 'close');
            closeBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>';
            closeBtn.onclick = (e) => {
                e.stopPropagation(); // Prevent drag event
                closeWindow(newWindow.id);
            };
            controls.appendChild(closeBtn);

            titleBar.appendChild(controls);
            newWindow.appendChild(titleBar);

            // Window content
            const content = document.createElement('div');
            content.classList.add('os-window-content', 'flex-grow', 'p-4', 'overflow-auto');
            newWindow.appendChild(content);

            // Status bar
            const statusBar = document.createElement('div');
            statusBar.classList.add('os-window-status-bar', 'p-2', 'text-right', 'text-xs', 'text-gray-400');
            newWindow.appendChild(statusBar);

            // Append to desktop area
            mainDesktopArea.appendChild(newWindow); // Use mainDesktopArea
            windows.push(newWindow); // Add to tracking array

            // Apply the new smooth opening animation AFTER appending to DOM
            newWindow.style.animation = 'windowOpenAnimation 0.3s ease-out forwards';

            // Load content into the new window (this will set data-title-zh/en attributes)
            // It's crucial this happens BEFORE createTaskbarIcon
            await loadWindowContent(newWindow, section, dataId); // Await content loading

            // Add to taskbar (now called AFTER content is loaded so titles are set)
            createTaskbarIcon(newWindow);

            // Make window draggable
            makeDraggable(newWindow, titleBar);

            // Make window resizable
            makeWindowResizable(newWindow);

            // Bring to front on click
            newWindow.addEventListener('mousedown', () => bringWindowToFront(newWindow));
            newWindow.addEventListener('touchstart', () => bringWindowToFront(newWindow)); // Touch support
            
            bringWindowToFront(newWindow); // Bring new window to front
            hideWelcomeMessage(); // Hide welcome message when a window is open
        }

        /**
         * @function loadWindowContent
         * @param {HTMLElement} windowElement - The window element to load content into.
         * @param {string} section - The section identifier.
         * @param {string} [dataId] - Optional ID for specific content within a section.
         * @description Loads content into the window based on the section.
         */
        async function loadWindowContent(windowElement, section, dataId = null) {
            console.log('loadWindowContent called for section:', section, 'dataId:', dataId);
            console.log('Current language:', currentLanguage);
            console.log('LANG_CONTENT[currentLanguage]:', LANG_CONTENT[currentLanguage]);

            const contentArea = windowElement.querySelector('.os-window-content');
            const titleElement = windowElement.querySelector('.os-window-title');
            const statusBar = windowElement.querySelector('.os-window-status-bar');

            // Add null checks for contentArea, titleElement, statusBar
            if (!contentArea || !titleElement || !statusBar) {
                console.error("Error: Missing window content elements.", { contentArea, titleElement, statusBar });
                return;
            }

            // Ensure language content exists for the current language
            const currentLangContent = LANG_CONTENT[currentLanguage] || LANG_CONTENT['zh']; // Fallback to Chinese if current language content is missing

            contentArea.innerHTML = `<div class="loading-spinner"></div><p class="text-center text-white mt-4">${currentLangContent.loadingMessage}</p>`;
            
            let contentHTML = '';
            let windowTitleZh = '';
            let windowTitleEn = '';
            let statusText = '';

            try {
                switch (section) {
                    case 'works':
                        if (dataId) {
                            const work = WORKS_DATA.find(w => w.id === dataId);
                            if (work) {
                                windowTitleZh = `${work.title} ${(LANG_CONTENT['zh'] && LANG_CONTENT['zh'].worksDetailsSuffix) ? LANG_CONTENT['zh'].worksDetailsSuffix : ' - ËØ¶ÊÉÖ'}`;
                                windowTitleEn = `${work.titleEn || work.title} ${(LANG_CONTENT['en'] && LANG_CONTENT['en'].worksDetailsSuffix) ? LANG_CONTENT['en'].worksDetailsSuffix : ' - Details'}`; 
                                contentHTML = `
                                    <div class="work-detail-content text-center">
                                        <div class="gallery-main-image-container">
                                            <img src="${getAssetUrl(work.images[0])}" class="gallery-main-image" alt="${work.title} Main Image">
                                            <button class="gallery-nav-button prev"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg></button>
                                            <button class="gallery-nav-button next"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"/></svg></button>
                                        </div>
                                        <div class="gallery-thumbnails">
                                            ${work.images.map((imgSrc, index) => `<img src="${getAssetUrl(imgSrc)}" class="gallery-thumbnail ${index === 0 ? 'active' : ''}" data-image-index="${index}" alt="Thumbnail ${index + 1}">`).join('')}
                                        </div>
                                        <h3 class="text-xl font-bold mb-2">${currentLanguage === 'zh' ? work.title : (work.titleEn || work.title)}</h3>
                                        <p class="category-tag">${work.category}</p>
                                        <div class="markdown-content mt-4 text-left w-full max-w-prose">
                                            ${marked.parse(work.description)}
                                        </div>
                                    </div>
                                `;
                                statusText = `ÂõæÁâá: 1/${work.images.length}`; // Dynamic status
                                windowElement.dataset.currentImageIndex = 1; // Store current image index
                            } else {
                                contentHTML = `<p class="text-center text-red-500">${currentLangContent.errorLoadingContent} ‰ΩúÂìÅÊú™ÊâæÂà∞„ÄÇ</p>`;
                                windowTitleZh = (LANG_CONTENT['zh'] && LANG_CONTENT['zh'].worksTitle) ? LANG_CONTENT['zh'].worksTitle : 'ÊàëÁöÑ‰ΩúÂìÅÈõÜ';
                                windowTitleEn = (LANG_CONTENT['en'] && LANG_CONTENT['en'].worksTitle) ? LANG_CONTENT['en'].worksTitle : 'My Works';
                            }
                        } else {
                            // Works grid overview
                            windowTitleZh = (LANG_CONTENT['zh'] && LANG_CONTENT['zh'].worksTitle) ? LANG_CONTENT['zh'].worksTitle : 'ÊàëÁöÑ‰ΩúÂìÅÈõÜ';
                            windowTitleEn = (LANG_CONTENT['en'] && LANG_CONTENT['en'].worksTitle) ? LANG_CONTENT['en'].worksTitle : 'My Works';
                            contentHTML = `
                                <p class="text-center mb-4 text-gray-300">${currentLangContent.worksClickPrompt}</p>
                                <div class="works-grid">
                                    ${WORKS_DATA.map(work => `
                                        <div class="work-card" data-work-id="${work.id}">
                                            <img src="${getAssetUrl(work.thumbnail)}" alt="${work.title}" class="w-full h-32 object-cover rounded-t-lg">
                                            <div class="p-2">
                                                <h4 class="work-card-title">${currentLanguage === 'zh' ? work.title : (work.titleEn || work.title)}</h4>
                                                <p class="work-card-category">${work.category}</p>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            `;
                            statusText = `${WORKS_DATA.length} ${currentLangContent.worksIcon}`;
                        }
                        break;
                    case 'characters':
                        windowTitleZh = (LANG_CONTENT['zh'] && LANG_CONTENT['zh'].charactersTitle) ? LANG_CONTENT['zh'].charactersTitle : 'ËßíËâ≤ËÆæËÆ°';
                        windowTitleEn = (LANG_CONTENT['en'] && LANG_CONTENT['en'].charactersTitle) ? LANG_CONTENT['en'].charactersTitle : 'Character Design';
                        contentHTML = `
                            <div class="markdown-content">
                                <h1 class="text-center">${currentLanguage === 'zh' ? windowTitleZh : windowTitleEn}</h1>
                                ${marked.parse(currentLangContent.charactersDescription)}
                                <!-- Placeholder for character images/models -->
                                <div class="flex flex-wrap justify-center gap-4 mt-8">
                                    <img src="https://placehold.co/200x200/00BFFF/FFFFFF?text=Character+1" alt="Character 1" class="rounded-lg shadow-md">
                                    <img src="https://placehold.co/200x200/00BFFF/FFFFFF?text=Character+2" alt="Character 2" class="rounded-lg shadow-md">
                                    <img src="https://placehold.co/200x200/00BFFF/FFFFFF?text=Character+3" alt="Character 3" class="rounded-lg shadow-md">
                                </div>
                                <p class="mt-8 text-center">Êõ¥Â§öËßíËâ≤Âç≥Â∞ÜÊé®Âá∫„ÄÇ</p>
                            </div>
                        `;
                        statusText = 'Ready'; 
                        break;
                    case 'about':
                        windowTitleZh = (LANG_CONTENT['zh'] && LANG_CONTENT['zh'].aboutTitle) ? LANG_CONTENT['zh'].aboutTitle : 'ÂÖ≥‰∫é MAZKO'; 
                        windowTitleEn = (LANG_CONTENT['en'] && LANG_CONTENT['en'].aboutTitle) ? LANG_CONTENT['en'].aboutTitle : 'About MAZKO'; 
                        contentHTML = `
                            <div class="markdown-content">
                                <h1 class="text-center">${currentLanguage === 'zh' ? windowTitleZh : windowTitleEn}</h1>
                                ${marked.parse(currentLangContent.aboutContent)}
                                <div class="flex justify-center mt-6">
                                    <img src="${getAssetUrl('icon_mazko_logo')}" alt="MAZKO Logo" class="w-24 h-24 filter drop-shadow-lg">
                                </div>
                            </div>
                        `;
                        statusText = 'Ready'; 
                        break;
                    case 'services':
                        windowTitleZh = (LANG_CONTENT['zh'] && LANG_CONTENT['zh'].services && LANG_CONTENT['zh'].services.title) ? LANG_CONTENT['zh'].services.title : 'ÊúçÂä°‰∏éÊä•‰ª∑'; 
                        windowTitleEn = (LANG_CONTENT['en'] && LANG_CONTENT['en'].services && LANG_CONTENT['en'].services.title) ? LANG_CONTENT['en'].services.title : 'Services & Pricing';
                        contentHTML = `
                            <div class="markdown-content">
                                <h1 class="text-center">${currentLanguage === 'zh' ? windowTitleZh : windowTitleEn}</h1>
                                ${marked.parse(currentLangContent.services.description)}
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                                    ${currentLangContent.services.categories.map(cat => `
                                        <div class="service-category-card bg-white bg-opacity-10 p-4 rounded-lg shadow-md border border-white border-opacity-20 transition-all hover:bg-opacity-20 cursor-pointer" data-category-id="${cat.id}">
                                            <h3 class="text-lg font-semibold text-primary-blue mb-2">${cat.name}</h3>
                                            <p class="text-sm text-gray-300">${cat.shortDescription}</p>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                        statusText = `${currentLangContent.services.categories.length} Services`; 
                        break;
                    case 'service-detail': // New case for service detail window
                        console.log('loadWindowContent: Attempting to load service detail for dataId:', dataId);
                        const allServiceCategories = (currentLangContent.services && currentLangContent.services.categories) ? currentLangContent.services.categories : [];
                        console.log('loadWindowContent: All service categories:', allServiceCategories);

                        // Ensure dataId is treated as a string for comparison
                        const categoryFound = allServiceCategories.find(c => String(c.id) === String(dataId));
                        console.log('loadWindowContent: Category found:', categoryFound);

                        if (categoryFound) {
                            windowTitleZh = categoryFound.name; // Use service name as title
                            const categoryEnContent = (LANG_CONTENT['en'] && LANG_CONTENT['en'].services && LANG_CONTENT['en'].services.categories) ? LANG_CONTENT['en'].services.categories.find(c => String(c.id) === String(dataId)) : null;
                            windowTitleEn = categoryEnContent ? categoryEnContent.nameEn : (categoryFound.nameEn || categoryFound.name);


                            contentHTML = `
                                <div class="markdown-content">
                                    ${marked.parse(categoryFound.detailContent)}
                                </div>
                            `;
                            statusText = `Viewing: ${categoryFound.name}`; 
                        } else {
                            console.error('loadWindowContent: Service category not found for dataId:', dataId);
                            contentHTML = `<p class="text-center text-red-500">${currentLangContent.errorLoadingContent} ÊúçÂä°Á±ªÂà´Êú™ÊâæÂà∞„ÄÇ</p>`;
                            windowTitleZh = (LANG_CONTENT['zh'] && LANG_CONTENT['zh'].services && LANG_CONTENT['zh'].services.title) ? LANG_CONTENT['zh'].services.title : 'ÊúçÂä°‰∏éÊä•‰ª∑';
                            windowTitleEn = (LANG_CONTENT['en'] && LANG_CONTENT['en'].services && LANG_CONTENT['en'].services.title) ? LANG_CONTENT['en'].services.title : 'Services & Pricing';
                        }
                        break;
                    case 'socials':
                        windowTitleZh = (LANG_CONTENT['zh'] && LANG_CONTENT['zh'].socialsTitle) ? LANG_CONTENT['zh'].socialsTitle : 'Á§æ‰∫§Â™í‰Ωì‰∏éÁ§æÁæ§'; 
                        windowTitleEn = (LANG_CONTENT['en'] && LANG_CONTENT['en'].socialsTitle) ? LANG_CONTENT['en'].socialsTitle : 'Social Media & Community'; 
                        contentHTML = `
                            <div class="markdown-content">
                                <h1 class="text-center">${currentLanguage === 'zh' ? windowTitleZh : windowTitleEn}</h1>
                                ${marked.parse(currentLangContent.socialsDescription)}
                                <div class="flex flex-col items-center gap-4 mt-6">
                                    ${currentLangContent.socialsLinks.map(link => `
                                        <a href="${link.url}" target="_blank" class="flex items-center bg-white bg-opacity-10 p-3 rounded-lg w-64 justify-center hover:bg-opacity-20 transition-colors shadow-md">
                                            <span class="text-2xl mr-3">${link.iconSvg}</span>
                                            <span class="text-lg font-medium">${link.name}</span>
                                        </a>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                        statusText = 'Stay connected!'; 
                        break;
                    case 'settings':
                        windowTitleZh = (LANG_CONTENT['zh'] && LANG_CONTENT['zh'].settingsMenuItem) ? LANG_CONTENT['zh'].settingsMenuItem : 'Á≥ªÁªüËÆæÁΩÆ'; 
                        windowTitleEn = (LANG_CONTENT['en'] && LANG_CONTENT['en'].settingsMenuItem) ? LANG_CONTENT['en'].settingsMenuItem : 'Settings'; 
                        contentHTML = `
                            <div class="settings-content markdown-content">
                                <h1 class="text-center">${currentLanguage === 'zh' ? windowTitleZh : windowTitleEn}</h1>
                                <h2 class="mt-6 mb-3">ËØ≠Ë®ÄËÆæÁΩÆ</h2>
                                <div class="flex items-center justify-between bg-white bg-opacity-10 p-3 rounded-lg shadow-md border border-white border-opacity-20">
                                    <label for="language-select" class="text-lg font-medium text-white mr-4">ÈÄâÊã©ËØ≠Ë®Ä:</label>
                                    <select id="language-select" class="bg-transparent border border-gray-400 rounded-md p-2 text-white focus:outline-none focus:border-primary-blue">
                                        <option value="zh" ${currentLanguage === 'zh' ? 'selected' : ''}>‰∏≠Êñá (ÁÆÄ‰Ωì)</option>
                                        <option value="en" ${currentLanguage === 'en' ? 'selected' : ''}>English</option>
                                    </select>
                                </div>
                                <h2 class="mt-6 mb-3">Á≥ªÁªü‰ø°ÊÅØ</h2>
                                <p><strong>Á≥ªÁªüÂêçÁß∞:</strong> ${currentLangContent.systemName}</p>
                                <p><strong>ÁâàÊú¨:</strong> ${currentLangContent.systemVersion}</p>
                                <p class="mt-4 text-gray-400">Êõ¥Â§öËÆæÁΩÆÈ°πÂç≥Â∞ÜÊé®Âá∫„ÄÇ</p>
                            </div>
                        `;
                        statusText = 'Setting preferences'; 
                        break;
                    case 'shutdown':
                        windowTitleZh = (LANG_CONTENT['zh'] && LANG_CONTENT['zh'].shutdownMenuItem) ? LANG_CONTENT['zh'].shutdownMenuItem : 'ÂÖ≥Èó≠Á≥ªÁªü'; 
                        windowTitleEn = (LANG_CONTENT['en'] && LANG_CONTENT['en'].shutdownMenuItem) ? LANG_CONTENT['en'].shutdownMenuItem : 'Shutdown'; 
                        contentHTML = `
                            <div class="text-center p-8">
                                <h1 class="text-2xl font-bold mb-4">${currentLanguage === 'zh' ? windowTitleZh : windowTitleEn}</h1>
                                <p class="text-lg mb-8">${currentLangContent.shutdownMessage}</p>
                                <div class="loading-spinner"></div>
                            </div>
                        `;
                        statusText = 'Shutting down...'; 
                        setTimeout(() => {
                            closeAllWindows();
                            // Possibly hide desktop elements or show a "Powered Off" screen
                            const desktopContainer = document.getElementById('desktop-container');
                            if (desktopContainer) { // Add null check
                                desktopContainer.style.display = 'none';
                            }
                            // You might want to fade out the body or show a black screen here
                            document.body.innerHTML = '<div class="flex items-center justify-center w-screen h-screen bg-black text-white text-3xl">Á≥ªÁªüÂ∑≤ÂÖ≥Èó≠</div>';
                        }, 3000); // Simulate shutdown time
                        break;
                    default:
                        contentHTML = `<p class="text-center text-red-500">${currentLangContent.unknownModule}</p>`;
                        windowTitleZh = 'ÈîôËØØ';
                        windowTitleEn = 'Error';
                        statusText = 'Failed to load'; 
                        break;
                }

                contentArea.innerHTML = contentHTML;
                titleElement.textContent = `${windowTitleZh} / ${windowTitleEn}`; // Display both languages
                
                // Store the individual titles as data attributes on the window itself
                windowElement.setAttribute('data-title-zh', windowTitleZh);
                windowElement.setAttribute('data-title-en', windowTitleEn);

                statusBar.textContent = `${statusText} - ${currentLangContent.systemName} ${currentLangContent.systemVersion}`; 

                // Add event listeners for work detail gallery if applicable
                if (section === 'works' && dataId) {
                    const mainImage = contentArea.querySelector('.gallery-main-image');
                    const thumbnails = contentArea.querySelectorAll('.gallery-thumbnail');
                    const prevBtn = contentArea.querySelector('.gallery-nav-button.prev');
                    // FIX: Changed selector for nextBtn
                    const nextBtn = contentArea.querySelector('.gallery-nav-button.next'); 
                    const work = WORKS_DATA.find(w => w.id === dataId);
                    let currentImageIndex = windowElement.dataset.currentImageIndex ? parseInt(windowElement.dataset.currentImageIndex) - 1 : 0; // Get from dataset, default to 0

                    function updateGallery() {
                        if (mainImage && work && work.images[currentImageIndex]) { // Add null checks
                            mainImage.src = getAssetUrl(work.images[currentImageIndex]);
                        }
                        thumbnails.forEach((thumb, idx) => {
                            thumb.classList.toggle('active', idx === currentImageIndex);
                        });
                        if (statusBar && work) { // Add null checks
                            statusBar.textContent = `ÂõæÁâá: ${currentImageIndex + 1}/${work.images.length} - ${currentLangContent.systemName} ${currentLangContent.systemVersion}`;
                        }
                        windowElement.dataset.currentImageIndex = currentImageIndex + 1; // Update stored index
                    }
                    updateGallery(); // Initial call to set gallery and status bar

                    if (prevBtn) { // Add null check
                        prevBtn.onclick = () => {
                            currentImageIndex = (currentImageIndex - 1 + work.images.length) % work.images.length;
                            updateGallery();
                        };
                    }

                    if (nextBtn) { // Add null check
                        nextBtn.onclick = () => {
                            currentImageIndex = (currentImageIndex + 1) % work.images.length;
                            updateGallery();
                        };
                    }

                    thumbnails.forEach(thumbnail => {
                        if (thumbnail) { // Add null check
                            // FIX: Changed data-image-index to dataImageIndex
                            thumbnail.onclick = (e) => {
                                currentImageIndex = parseInt(e.target.dataset.imageIndex); 
                                updateGallery();
                            };
                        }
                    });
                }
                
                // Add event listeners for service category cards
                if (section === 'services') {
                    contentArea.querySelectorAll('.service-category-card').forEach(card => {
                        if (card) { // Add null check
                            card.onclick = () => {
                                const categoryId = card.getAttribute('data-category-id');
                                console.log('Clicked service card with ID:', categoryId); // Log for debugging
                                openWindow('service-detail', categoryId);
                            };
                        }
                    });
                }

                // Add event listener for language select in settings
                if (section === 'settings') {
                    const languageSelect = contentArea.querySelector('#language-select');
                    if (languageSelect) { // Add null check
                        languageSelect.onchange = (e) => {
                            applyLanguage(e.target.value);
                            // Re-render settings window to update content based on new language
                            loadWindowContent(windowElement, 'settings');
                        };
                    }
                }

            } catch (error) {
                console.error(`Error loading content for section ${section}:`, error);
                if (contentArea) { // Add null check
                    contentArea.innerHTML = `<p class="text-center text-red-500">${currentLangContent.errorLoadingContent} ${error.message}</p>`;
                }
                if (titleElement) { // Add null check
                    titleElement.textContent = `ÈîôËØØ / Error`;
                }
                if (statusBar) { // Add null check
                    statusBar.textContent = `Âä†ËΩΩÂ§±Ë¥• / Failed to load - ${currentLangContent.systemName} ${currentLangContent.systemVersion}`;
                }
            }
        }


        /**
         * @function bringWindowToFront
         * @param {HTMLElement} element - The window or draggable element to bring to front.
         * @description Updates the z-index of the given element to bring it to the front.
         */
        function bringWindowToFront(element) {
            if (!element) return;
            zIndexCounter++;
            element.style.zIndex = zIndexCounter;

            // Only apply active/inactive to actual windows
            if (element.classList.contains('os-window')) {
                windows.forEach(win => {
                    const titleBar = win.querySelector('.os-window-title-bar');
                    if (titleBar) { 
                        if (win === element) {
                            titleBar.classList.remove('inactive');
                        } else {
                            titleBar.classList.add('inactive');
                        }
                    }
                });

                // Update active taskbar icon
                document.querySelectorAll('.taskbar-minimized-icon').forEach(icon => {
                    if (icon) { 
                        icon.classList.remove('active');
                    }
                });
                const taskbarIcon = document.querySelector(`.taskbar-minimized-icon[data-window-id="${element.id}"]`);
                if (taskbarIcon) { 
                    taskbarIcon.classList.add('active');
                }
            }
            // For desktop icons, they also need to come to front on drag/click
            if (element.classList.contains('desktop-icon')) {
                element.style.zIndex = zIndexCounter; // Bring icon to front when clicked/dragged
            }
        }

        /**
         * @function minimizeWindow
         * @param {string} windowId - The ID of the window to minimize.
         * @description Minimizes a window and updates its taskbar icon state.
         */
        function minimizeWindow(windowId) {
            const windowElement = document.getElementById(windowId);
            if (windowElement) {
                windowElement.classList.add('minimized');
                // Remove active state from taskbar icon
                const taskbarIcon = document.querySelector(`.taskbar-minimized-icon[data-window-id="${windowId}"]`);
                if (taskbarIcon) {
                    taskbarIcon.classList.remove('active');
                }
                // If the minimized window was active, activate the next available window
                if (activeDraggableElement && activeDraggableElement.id === windowId) { // Changed activeWindow to activeDraggableElement
                    activeDraggableElement = null;
                    const otherOpenWindows = windows.filter(win => win.id !== windowId && !win.classList.contains('minimized'));
                    if (otherOpenWindows.length > 0) {
                        bringWindowToFront(otherOpenWindows[otherOpenWindows.length - 1]); // Bring the most recent non-minimized window to front
                    }
                }
            }
        }

        /**
         * @function toggleMaximizeWindow
         * @param {string} windowId - The ID of the window to toggle maximize state.
         * @description Toggles the maximized state of a window.
         */
        function toggleMaximizeWindow(windowId) {
            const windowElement = document.getElementById(windowId);
            if (windowElement) {
                const maximizeBtn = windowElement.querySelector('.control-button.maximize');
                if (windowElement.classList.contains('maximized')) {
                    // Restore
                    windowElement.classList.remove('maximized');
                    // Restore original size and position (store these as data attributes)
                    windowElement.style.width = windowElement.dataset.originalWidth;
                    windowElement.style.height = windowElement.dataset.originalHeight;
                    windowElement.style.left = windowElement.dataset.originalLeft;
                    windowElement.style.top = windowElement.dataset.originalTop;
                    if (maximizeBtn) { 
                        maximizeBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 7h10v10H7z" fill="none"/><path d="M3 5v14h18V5H3zm16 12H5V7h14v10z"/></svg>'; // Restore icon
                    }
                } else {
                    // Maximize
                    // Store original size and position
                    windowElement.dataset.originalWidth = windowElement.style.width;
                    windowElement.dataset.originalHeight = windowElement.style.height;
                    windowElement.dataset.originalLeft = windowElement.style.left;
                    windowElement.dataset.originalTop = windowElement.style.top;

                    windowElement.classList.add('maximized');
                    if (maximizeBtn) { 
                        maximizeBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 7h-2v2h2v10H5V9h2V7H3v14h18V7zM17 2h-12c-1.1 0-2 .9-2 2v12h2V4h12V2z"/></svg>'; // Maximize icon
                    }
                }
            }
        }


        /**
         * @function closeWindow
         * @param {string} windowId - The ID of the window to close.
         * @description Closes a window and removes its taskbar icon.
         */
        function closeWindow(windowId) {
            const windowElement = document.getElementById(windowId);
            if (windowElement) {
                // Disconnect ResizeObserver before removing the element
                if (windowElement._resizeObserver) {
                    windowElement._resizeObserver.disconnect();
                    windowElement._resizeObserver = null;
                }

                windowElement.remove(); // Remove from DOM
                windows = windows.filter(win => win.id !== windowId); // Remove from tracking array

                // Remove from taskbar
                const taskbarIcon = document.querySelector(`.taskbar-minimized-icon[data-window-id="${windowId}"]`);
                if (taskbarIcon) {
                    taskbarIcon.remove();
                }

                // If no windows are open, show welcome message
                if (windows.length === 0) {
                    showWelcomeMessage();
                } else if (activeDraggableElement && activeDraggableElement.id === windowId) { // Changed activeWindow to activeDraggableElement
                    activeDraggableElement = null;
                    const openWindows = windows.filter(win => !win.classList.contains('minimized'));
                    if (openWindows.length > 0) {
                        bringWindowToFront(openWindows[openWindows.length - 1]); // Bring the most recent non-minimized window to front
                    }
                }
            }
        }

        /**
         * @function closeAllWindows
         * @description Closes all open windows.
         */
        function closeAllWindows() {
            // Iterate over a copy of the array because we're modifying it
            [...windows].forEach(win => {
                closeWindow(win.id);
            });
            windows = []; // Clear the array
        }

        /**
         * @function createTaskbarIcon
         * @param {HTMLElement} windowElement - The window element for which to create a taskbar icon.
         * @description Creates a taskbar icon for the given window.
         */
        function createTaskbarIcon(windowElement) {
            const taskbarIconsContainer = document.getElementById('taskbar-icons');
            if (!taskbarIconsContainer) { 
                console.error("Error: taskbar-icons container not found.");
                return;
            }
            const taskbarIcon = document.createElement('div');
            taskbarIcon.classList.add('taskbar-minimized-icon');
            taskbarIcon.setAttribute('data-window-id', windowElement.id);

            // Get the title directly from the window's data attributes
            const windowTitleText = currentLanguage === 'zh' ? 
                                    windowElement.getAttribute('data-title-zh') : 
                                    windowElement.getAttribute('data-title-en');
            
            console.log(`Creating taskbar icon for window ID: ${windowElement.id} with title: "${windowTitleText}"`);

            // Determine the icon for the taskbar based on section
            let iconHtml = '';
            const section = windowElement.getAttribute('data-section');

            if (section === 'socials') {
                 // For socials, use the specific social icon from LANG_CONTENT if available, otherwise a default SVG
                 const socialLink = (LANG_CONTENT[currentLanguage] && LANG_CONTENT[currentLanguage].socialsLinks) ? LANG_CONTENT[currentLanguage].socialsLinks.find(link => windowTitleText.includes(link.name)) : null;
                 iconHtml = socialLink ? socialLink.iconSvg : '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg>';
            } else if (section === 'settings') {
                iconHtml = '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.4-1.07-.75-1.67-1.03l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.5.44l-.38 2.65c-.6.28-1.15.63-1.67 1.03l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.12.22-.07.49.12.64l2.11 1.65c-.04.32-.07.64-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.31.61.22l2.49-1c.52.4 1.07.75 1.67 1.03l.38 2.65c.04.26.25.44.5.44h4c.25 0 .46-.18.5-.44l-.38-2.65c.6-.28 1.15-.63 1.67-1.03l2.49 1c-.22.09-.49 0-.61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/></svg>';
            } else if (section === 'shutdown') {
                iconHtml = '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M13 3c-4.97 0-9 4.03-9 9H1l3.05 3.05L7 12H5c0-3.86 3.14-7 7-7s7 3.14 7 7-3.14 7-7 7c-.64 0-1.27-.09-1.87-.27l-.76 1.24c.94.49 2 .78 3.07.78 4.97 0 9-4.03 9-9s-4.03-9-9-9z"/></svg>';
            } else if (section === 'service-detail') {
                 // For service details, use the service icon from ASSETS
                 iconHtml = `<img src="${getAssetUrl('icon_services')}" alt="Service Icon" class="w-4 h-4">`;
            } else {
                // For other sections, use the image asset
                iconHtml = `<img src="${getAssetUrl(`icon_${section}`)}" alt="${windowTitleText}" class="w-4 h-4">`;
            }
            
            // Append icon (either img or SVG)
            if (iconHtml.startsWith('<img')) {
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = iconHtml;
                taskbarIcon.appendChild(tempDiv.firstChild);
            } else {
                taskbarIcon.innerHTML += `<span class="w-4 h-4 flex items-center justify-center">${iconHtml}</span>`; // Wrap SVG in a span for consistent sizing
            }

            const titleSpan = document.createElement('span');
            titleSpan.textContent = windowTitleText; // Set the determined title text
            taskbarIcon.appendChild(titleSpan);

            taskbarIcon.onclick = () => {
                if (windowElement.classList.contains('minimized')) {
                    windowElement.classList.remove('minimized');
                    bringWindowToFront(windowElement);
                } else if (windowElement === activeDraggableElement) { // Use activeDraggableElement
                    // If already active, minimize it
                    minimizeWindow(windowElement.id);
                } else {
                    bringWindowToFront(windowElement);
                }
            };

            taskbarIconsContainer.appendChild(taskbarIcon);
            bringWindowToFront(windowElement); // Bring the newly opened window to front
        }

        /**
         * @function makeDraggable
         * @param {HTMLElement} element - The element to make draggable (e.g., window, desktop icon).
         * @param {HTMLElement} dragHandle - The element that initiates the drag (e.g., title bar, the icon itself).
         * @description Adds drag functionality to any element.
         */
        function makeDraggable(element, dragHandle) {
            let dragOffsetX, dragOffsetY; // Declare drag offset variables here

            dragHandle.addEventListener('mousedown', (e) => {
                if (element.classList.contains('os-window') && element.classList.contains('maximized')) return; // Prevent dragging maximized windows
                isDragging = true;
                activeDraggableElement = element; // Set the active draggable element
                bringWindowToFront(element); // Bring the element to front on drag start
                dragOffsetX = e.clientX - element.getBoundingClientRect().left;
                dragOffsetY = e.clientY - element.getBoundingClientRect().top;
                dragHandle.style.cursor = 'grabbing';
                e.preventDefault(); // Prevent default browser drag behavior
            });

            // Touch events for dragging
            dragHandle.addEventListener('touchstart', (e) => {
                if (element.classList.contains('os-window') && element.classList.contains('maximized')) return;
                isDragging = true;
                activeDraggableElement = element;
                bringWindowToFront(element);
                const touch = e.touches[0];
                dragOffsetX = touch.clientX - element.getBoundingClientRect().left;
                dragOffsetY = touch.clientY - element.getBoundingClientRect().top;
                dragHandle.style.cursor = 'grabbing';
                e.preventDefault(); // Prevent scrolling while dragging on touch devices
            }, { passive: false }); // Use passive: false to allow preventDefault

            document.addEventListener('mousemove', (e) => {
                if (!isDragging || !activeDraggableElement) return;
                let newX = e.clientX - dragOffsetX;
                let newY = e.clientY - dragOffsetY;

                // Boundary checks
                const desktopArea = document.getElementById('main-desktop-area');
                if (!desktopArea) { 
                    console.warn("Desktop area not found during drag.");
                    return;
                }
                const desktopRect = desktopArea.getBoundingClientRect();
                const elementRect = activeDraggableElement.getBoundingClientRect();

                // Constrain within desktop area
                if (newY < 0) newY = 0;
                if (newX < 0) newX = 0;
                if (newX + elementRect.width > desktopRect.width) newX = desktopRect.width - elementRect.width;
                if (newY + elementRect.height > desktopRect.height - (element.classList.contains('os-window') ? 0 : document.getElementById('taskbar').offsetHeight)) {
                    newY = desktopRect.height - elementRect.height - (element.classList.contains('os-window') ? 0 : document.getElementById('taskbar').offsetHeight);
                }


                activeDraggableElement.style.left = `${newX}px`;
                activeDraggableElement.style.top = `${newY}px`;
            });

            document.addEventListener('touchmove', (e) => {
                if (!isDragging || !activeDraggableElement || e.touches.length === 0) return;
                const touch = e.touches[0];
                let newX = touch.clientX - dragOffsetX;
                let newY = touch.clientY - dragOffsetY;

                // Boundary checks (same as mousemove)
                const desktopArea = document.getElementById('main-desktop-area');
                if (!desktopArea) { 
                    console.warn("Desktop area not found during touch drag.");
                    return;
                }
                const desktopRect = desktopArea.getBoundingClientRect();
                const elementRect = activeDraggableElement.getBoundingClientRect();

                if (newY < 0) newY = 0;
                if (newX < 0) newX = 0;
                if (newX + elementRect.width > desktopRect.width) newX = desktopRect.width - elementRect.width;
                if (newY + elementRect.height > desktopRect.height - (element.classList.contains('os-window') ? 0 : document.getElementById('taskbar').offsetHeight)) {
                    newY = desktopRect.height - elementRect.height - (element.classList.contains('os-window') ? 0 : document.getElementById('taskbar').offsetHeight);
                }

                activeDraggableElement.style.left = `${newX}px`;
                activeDraggableElement.style.top = `${newY}px`;
                e.preventDefault(); 
            }, { passive: false });

            document.addEventListener('mouseup', () => {
                isDragging = false;
                if (activeDraggableElement && dragHandle) { 
                    dragHandle.style.cursor = 'grab';
                }
                activeDraggableElement = null;
            });

            document.addEventListener('touchend', () => {
                isDragging = false;
                if (activeDraggableElement && dragHandle) { 
                    dragHandle.style.cursor = 'grab';
                }
                activeDraggableElement = null;
            });
        } // This '}' closes makeDraggable

        // Global debounce timer for ResizeObserver
        let resizeObserverTimeout;
        const RESIZE_DEBOUNCE_DELAY = 50; // Milliseconds

        /**
         * @function makeWindowResizable
         * @param {HTMLElement} windowElement - The window element to make resizable.
         * @description Adds basic resize functionality to a window.
         */
        function makeWindowResizable(windowElement) {
            if (!windowElement) return;
            
            const minWidth = 300;
            const minHeight = 200;
            const desktopArea = document.getElementById('main-desktop-area');
            if (!desktopArea) {
                console.warn("Desktop area not found, resize observer might not work correctly.");
                return;
            }
            const taskbarHeight = document.getElementById('taskbar').offsetHeight;
            const RESIZE_BOUND_MARGIN = 10;

            // Disconnect previous observer if re-applying to the same element
            if (windowElement._resizeObserver) {
                windowElement._resizeObserver.disconnect();
            }

            const observerCallback = (entries) => {
                clearTimeout(resizeObserverTimeout);
                resizeObserverTimeout = setTimeout(() => {
                    for (let entry of entries) {
                        // Skip if the window is maximized, CSS handles sizing in this case
                        if (windowElement.classList.contains('maximized')) {
                            continue; 
                        }

                        // Use getBoundingClientRect for current live dimensions and position
                        const windowRect = windowElement.getBoundingClientRect();
                        const desktopRect = desktopArea.getBoundingClientRect();

                        let currentWidth = windowRect.width;
                        let currentHeight = windowRect.height;
                        let currentLeft = windowRect.left;
                        let currentTop = windowRect.top;

                        // Calculate potential new dimensions and positions
                        let newWidth = currentWidth;
                        let newHeight = currentHeight;
                        let newLeft = currentLeft;
                        let newTop = currentTop;

                        // 1. Clamp Width and Height (respecting min and max based on desktop bounds)
                        newWidth = Math.max(minWidth, Math.min(currentWidth, desktopRect.width - currentLeft - RESIZE_BOUND_MARGIN));
                        newHeight = Math.max(minHeight, Math.min(currentHeight, (desktopRect.height - taskbarHeight) - currentTop - RESIZE_BOUND_MARGIN));
                        
                        // 2. Clamp Position (after adjusting size, ensure it still fits)
                        newLeft = Math.max(RESIZE_BOUND_MARGIN, Math.min(currentLeft, desktopRect.width - newWidth - RESIZE_BOUND_MARGIN));
                        newTop = Math.max(RESIZE_BOUND_MARGIN, Math.min(currentTop, (desktopRect.height - taskbarHeight) - newHeight - RESIZE_BOUND_MARGIN));

                        // Round values to integers to prevent floating-point discrepancies causing re-renders
                        newWidth = Math.round(newWidth);
                        newHeight = Math.round(newHeight);
                        newLeft = Math.round(newLeft);
                        newTop = Math.round(newTop);

                        // Get the currently applied computed styles for comparison
                        const computedStyle = window.getComputedStyle(windowElement);
                        const appliedWidth = Math.round(parseFloat(computedStyle.width));
                        const appliedHeight = Math.round(parseFloat(computedStyle.height));
                        const appliedLeft = Math.round(parseFloat(computedStyle.left));
                        const appliedTop = Math.round(parseFloat(computedStyle.top));

                        let changed = false;

                        // Only update style if there's a significant change from currently applied style
                        if (Math.abs(newWidth - appliedWidth) > 1) { // Allow for 1px tolerance
                            windowElement.style.width = `${newWidth}px`;
                            changed = true;
                        }
                        if (Math.abs(newHeight - appliedHeight) > 1) { // Allow for 1px tolerance
                            windowElement.style.height = `${newHeight}px`;
                            changed = true;
                        }
                        // Only update position if it's outside bounds OR significantly different
                        if (Math.abs(newLeft - appliedLeft) > 1 || newLeft < RESIZE_BOUND_MARGIN || (newLeft + newWidth) > (desktopRect.width - RESIZE_BOUND_MARGIN)) {
                            windowElement.style.left = `${newLeft}px`;
                            changed = true;
                        }
                        if (Math.abs(newTop - appliedTop) > 1 || newTop < RESIZE_BOUND_MARGIN || (newTop + newHeight) > (desktopRect.height - taskbarHeight - RESIZE_BOUND_MARGIN)) {
                             windowElement.style.top = `${newTop}px`;
                             changed = true;
                        }

                        if (changed) {
                            console.log(`Window ${windowElement.id} adjusted: W:${newWidth}, H:${newHeight}, X:${newLeft}, Y:${newTop}`);
                        }
                    }
                }, RESIZE_DEBOUNCE_DELAY); 
            };

            const observer = new ResizeObserver(observerCallback);
            observer.observe(windowElement);
            windowElement._resizeObserver = observer; // Store observer instance for later disconnection
        }


        /**
         * @function hideWelcomeMessage
         * @description Hides the initial welcome message.
         */
        function hideWelcomeMessage() {
            const welcomeMessage = document.getElementById('welcome-message');
            if (welcomeMessage) { // Add null check
                welcomeMessage.style.display = 'none';
            }
        }

        /**
         * @function showWelcomeMessage
         * @description Shows the initial welcome message.
         */
        function showWelcomeMessage() {
            const welcomeMessage = document.getElementById('welcome-message');
            if (welcomeMessage) { // Add null check
                welcomeMessage.style.display = 'flex';
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM Content Loaded. Initializing...');
            updateTime();
            setInterval(updateTime, 1000); // Update time every second

            renderDynamicAssets(); // Render initial assets
            applyLanguage(currentLanguage); // Apply default language content
            positionDesktopIcons(); // Position desktop icons after assets are rendered

            // Start button toggle Start Menu
            const startButtonTaskbar = document.getElementById('start-button-taskbar');
            const startMenu = document.getElementById('start-menu');

            if (startButtonTaskbar && startMenu) { // Add null checks
                startButtonTaskbar.addEventListener('click', (e) => {
                    e.stopPropagation(); // Prevent document click from closing immediately
                    startMenu.classList.toggle('hidden');
                    startMenu.classList.toggle('visible');
                });
            }


            // Close Start Menu when clicking outside
            document.addEventListener('click', (e) => {
                const startMenu = document.getElementById('start-menu');
                const startButton = document.getElementById('start-button-taskbar');
                if (startMenu && startButton) { // Add null checks
                    if (startMenu.classList.contains('visible') && !startMenu.contains(e.target) && !startButton.contains(e.target)) {
                        startMenu.classList.remove('visible');
                        startMenu.classList.add('hidden');
                    }
                }
            });

            // Desktop icons double-click handler (to open window)
            document.querySelectorAll('.desktop-icon').forEach(icon => {
                if (icon) { // Add null check
                    icon.addEventListener('dblclick', async (e) => { // Made async here
                        e.stopPropagation(); // Prevent this click from interfering with drag
                        const section = icon.getAttribute('data-section');
                        await openWindow(section); // Await openWindow
                        const startMenuAfterClick = document.getElementById('start-menu'); // Re-get reference as it might have changed state
                        if (startMenuAfterClick) { // Add null check
                            startMenuAfterClick.classList.remove('visible'); // Close start menu on app launch
                            startMenuAfterClick.classList.add('hidden');
                        }
                    });
                     // Single click to bring to front for desktop icons (consistent with windows)
                    icon.addEventListener('mousedown', () => bringWindowToFront(icon));
                    icon.addEventListener('touchstart', () => bringWindowToFront(icon));
                }
            });

            // Start menu item click handler
            document.querySelectorAll('.start-menu-item').forEach(item => {
                if (item) { // Add null check
                    item.addEventListener('click', async (e) => { 
                        e.preventDefault(); // Prevent default link behavior
                        const section = item.getAttribute('data-section');
                        await openWindow(section); // Await openWindow
                        const startMenuAfterClick = document.getElementById('start-menu'); // Re-get reference
                        if (startMenuAfterClick) { // Add null check
                            startMenuAfterClick.classList.remove('visible'); // Close start menu on app launch
                            startMenuAfterClick.classList.add('hidden');
                        }
                    });
                }
            });

            // Start menu footer button click handler
            document.querySelectorAll('.start-menu-footer-button').forEach(button => {
                if (button) { // Add null check
                    button.addEventListener('click', async (e) => { 
                        e.preventDefault();
                        const section = button.getAttribute('data-section');
                        await openWindow(section); // Await openWindow
                        const startMenuAfterClick = document.getElementById('start-menu'); // Re-get reference
                        if (startMenuAfterClick) { // Add null check
                            startMenuAfterClick.classList.remove('visible');
                            startMenuAfterClick.classList.add('hidden');
                        }
                    });
                }
            });

            // Event delegation for dynamically added work cards (in Works window)
            document.getElementById('main-desktop-area').addEventListener('click', async (e) => { 
                // Ensure main-desktop-area exists before adding listener
                const mainDesktopArea = document.getElementById('main-desktop-area');
                if (!mainDesktopArea) return; // Double check as this is a top-level listener

                if (e.target.closest('.work-card')) {
                    const workCard = e.target.closest('.work-card');
                    if (workCard) { // Add null check
                        const workId = workCard.getAttribute('data-work-id');
                        await openWindow('works', workId); // Await openWindow
                    }
                }
            });

            // Handle window resizing (on window load and resize events)
            window.addEventListener('resize', positionDesktopIcons); // Re-position icons on window resize
        });

        // Ensure functions are globally accessible if needed for HTML attributes or for clarity
        window.getAssetUrl = getAssetUrl;
        window.openWindow = openWindow;
        window.minimizeWindow = minimizeWindow;
        window.toggleMaximizeWindow = toggleMaximizeWindow;
        window.closeWindow = closeWindow;
        window.bringWindowToFront = bringWindowToFront;
        window.applyLanguage = applyLanguage; // Make it accessible for console/debugging
    </script>
</body>
</html>
