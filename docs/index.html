<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAX OS - ËôöÊãüÂÆáÂÆôÁªàÁ´Ø (Frutiger Aero Style)</title>
    <!-- Favicon - ‰ΩøÁî®‰∏Ä‰∏™ÁÆÄÂçïÁöÑSVG‰Ωú‰∏∫Á§∫‰æã -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><text x='0' y='14' font-size='16'>üåå</text></svg>" type="image/svg+xml">
    <!-- ÂºïÂÖ• Tailwind CSS CDNÔºåÁî®‰∫éÂø´ÈÄüÊûÑÂª∫ÂíåÂìçÂ∫îÂºèÂ∏ÉÂ±Ä -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ÂºïÂÖ• Google Fonts - Inter Â≠ó‰Ωì‰Ωú‰∏∫ÈÄöÁî®Â≠ó‰ΩìÔºåÂ¶ÇÊûúÈúÄË¶Å‚ÄúChocolate Classical Sans‚ÄùËØ∑Âú®Ê≠§Â§ÑÂºïÂÖ•ÂÖ∂CDNÊàñÊú¨Âú∞Ë∑ØÂæÑ -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <!-- Marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* Global styles and variables */
        :root {
            --primary-blue: #00BFFF; /* Sky blue, as the main color */
            --dark-blue: #007ACC; /* Dark blue */
            --light-blue: #CCEEFF; /* Light blue */
            --background-dark: #1A1A2E; /* Dark background */
            --glass-bg: rgba(255, 255, 255, 0.15); /* Frosted glass background color */
            --glass-border: rgba(255, 255, 255, 0.3); /* Frosted glass border color */
            --text-color: #E0FFFF; /* Text color */
            /* Â∞ÜÂ≠ó‰ΩìÂèòÈáèÂêçÁß∞Êîπ‰∏∫ --font-mainÔºåÂπ∂ËÆæÁΩÆ‰∏∫ 'Chocolate Classical Sans'Ôºå‰ª• Inter ‰Ωú‰∏∫Â§áÁî®Â≠ó‰Ωì */
            --font-main: 'Chocolate Classical Sans', 'Inter', sans-serif; 

            /* Frutiger Aero specific gradients for elements */
            --fa-title-active-gradient: linear-gradient(to bottom, #00BFFF 0%, #007ACC 100%);
            --fa-title-inactive-gradient: linear-gradient(to bottom, #A7BBD4 0%, #6699CC 100%); /* Muted blue for inactive */
            --fa-button-bg: linear-gradient(to bottom, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0.1) 100%);
            --fa-button-hover-bg: linear-gradient(to bottom, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0.2) 100%);
            --fa-button-active-bg: linear-gradient(to top, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0.1) 100%);

            --taskbar-height: 48px; /* Define taskbar height */

            /* Cursors - These will be set dynamically by JavaScript */
            --cursor-default: auto;
            --cursor-active: auto;
            --cursor-pointer: pointer;
        }

        body {
            font-family: var(--font-main); /* Apply the new main font globally */
            background-color: var(--background-dark); /* Dark background */
            color: var(--text-color); /* Text color */
            margin: 0;
            padding: 0;
            overflow: hidden; /* Prevent scrollbars, as we simulate a desktop environment */
            position: relative; /* For background animation positioning */
            width: 100vw; /* Ensure body takes full viewport width */
            height: 100vh; /* Ensure body takes full viewport height */
            /* Custom mouse cursor styles (will be populated by JS) */
            cursor: var(--cursor-default);
        }

        body:active {
            cursor: var(--cursor-active);
        }

        a, button, .clickable-element {
            cursor: var(--cursor-pointer);
        }

        /* Frutiger Aero style desktop background */
        .desktop-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* More complex background with multiple gradients for depth and gloss */
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(0,191,255,0.2) 0%, transparent 40%),
                radial-gradient(circle at 80% 20%, rgba(0,191,255,0.2) 0%, transparent 40%),
                linear-gradient(to bottom right, #6699CC, #CCEEFF);
            background-size: cover;
            background-position: center;
            opacity: 0.8; /* Slightly transparent */
            filter: brightness(0.8) contrast(1.2); /* Adjust brightness and contrast */
            z-index: 0;
            /* Placeholder for a background image URL if user wants it */
            /* background-image: url(var(--desktop-background-image)); */
        }

        /* Simulate dot matrix effect, overlaid on the background */
        .desktop-background::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            opacity: 0.3;
            animation: scanline 10s linear infinite; /* Scanline animation */
        }

        /* Simulate glow effect */
        .desktop-background::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(0,191,255,0.3) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            animation: pulse-glow 15s infinite alternate; /* Glow pulse animation */
        }

        /* Scanline animation */
        @keyframes scanline {
            0% { background-position: 0 0; }
            100% { background-position: 0 100%; }
        }

        /* Glow pulse animation */
        @keyframes pulse-glow {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 0.3; }
            50% { transform: translate(-50%, -50%) scale(1.1); opacity: 0.4; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 0.3; }
        }

        /* Desktop container, now acting as the main content wrapper */
        .desktop-container {
            position: absolute; /* Position it to fill the body */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            z-index: 1; /* Ensure it's above the background */
        }

        /* Desktop Layout - holds the main desktop area and the taskbar */
        .desktop-layout {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
        }

        /* Main Desktop Area - where icons and windows reside */
        .main-desktop-area {
            flex-grow: 1;
            position: relative;
            overflow: hidden; /* For windows */
            padding: 10px; /* Padding for desktop icons */
            padding-bottom: calc(10px + var(--taskbar-height)); /* Account for taskbar height only */
        }

        /* Taskbar (formerly dock) */
        .taskbar {
            position: absolute;
            bottom: 0; /* Position at the very bottom */
            left: 0;
            width: 100%; /* Full width */
            height: var(--taskbar-height); /* Fixed height */
            background: rgba(255, 255, 255, 0.18); /* Slightly more opaque glass background for taskbar */
            backdrop-filter: blur(12px); /* Subtle blur for glass effect */
            -webkit-backdrop-filter: blur(12px); /* For Safari */
            border-top: 1px solid rgba(255, 255, 255, 0.4); /* Stronger top border */
            box-shadow: 0 -2px 15px rgba(0, 191, 255, 0.3), inset 0 1px 8px rgba(255, 255, 255, 0.2); /* More prominent shadow and inner highlight */
            display: flex;
            align-items: center;
            justify-content: space-between; /* Space between start button, icons, and tray */
            padding: 0 10px; /* Padding on sides */
            z-index: 100; /* Ensure taskbar is always on top */
        }

        /* Start Button */
        .start-button {
            /* Updated background for a more glossy, Aero feel */
            background: linear-gradient(to bottom, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0.2) 100%);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 50%; /* Changed to circular */
            width: 40px; /* Fixed width for circular button */
            height: 40px; /* Fixed height for circular button */
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9rem;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(0, 191, 255, 0.5); /* Subtle text glow */
            box-shadow: 0 2px 10px rgba(0,0,0,0.5), inset 0 1px 6px rgba(255,255,255,0.6); /* More prominent shadow and inner highlight */
            cursor: pointer; /* Changed to default pointer */
            transition: all 0.1s ease-in-out;
            white-space: nowrap;
        }

        .start-button:hover {
            background: linear-gradient(to bottom, rgba(255,255,255,0.5) 0%, rgba(255,255,255,0.3) 100%);
            transform: translateY(-2px); /* Slight lift effect */
            box-shadow: 0 4px 15px rgba(0, 191, 255, 0.7), inset 0 1px 8px rgba(255,255,255,0.7);
        }

        .start-button:active {
            background: linear-gradient(to top, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0.2) 100%);
            transform: translateY(0);
            box-shadow: inset 0 1px 6px rgba(0,0,0,0.7), inset 0 -1px 4px rgba(255,255,255,0.4);
        }

        .start-button .icon-image { /* Sizing for dynamically loaded image */
            width: 1.5em; /* Larger icon size */
            height: 1.5em; /* Larger icon size */
            filter: drop-shadow(0 0 5px rgba(0, 191, 255, 0.5)); /* text-shadow equivalent for image */
        }

        /* Taskbar Icons (for open/minimized windows) */
        .taskbar-icons-container {
            display: flex;
            flex-grow: 1; /* Take up available space */
            justify-content: flex-start; /* Align to start */
            align-items: center;
            height: 100%;
            overflow-x: auto; /* Allow horizontal scrolling if many windows */
            padding: 0 10px;
            gap: 5px; /* Gap between taskbar items */
        }

        /* System Tray */
        .system-tray {
            display: flex;
            align-items: center;
            gap: 8px; /* Gap between system icons */
        }

        .system-tray-icon {
            font-size: 1rem; /* Standard icon size */
            color: var(--light-blue); /* Light blue color */
            transition: all 0.2s ease;
            cursor: default; /* Changed to default cursor */
            padding: 5px;
            border-radius: 50%; /* Circular for system icons */
        }
        .system-tray-icon:hover {
            color: white;
            background-color: rgba(255,255,255,0.1);
            transform: translateY(-1px);
        }
        .system-tray-icon .icon-image { /* Sizing for dynamically loaded image */
            width: 1em;
            height: 1em;
            vertical-align: middle;
            filter: drop-shadow(0 0 3px rgba(0, 191, 255, 0.3));
        }

        /* Desktop Icons (Shortcuts) */
        .desktop-icons-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: calc(100% - var(--taskbar-height)); /* Account for taskbar height only */
            padding: 20px;
            z-index: 2; /* Below windows, above background */
        }

        .desktop-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            width: 80px; /* Fixed width for icon block */
            cursor: pointer; /* Changed to default pointer */
            transition: transform 0.1s ease, filter 0.1s ease, background-color 0.1s ease; /* Added background-color transition */
            padding: 5px;
            border-radius: 8px;
            user-select: none; /* Prevent text selection on double click */
            position: absolute; /* Enable absolute positioning for dragging */
        }

        .desktop-icon:hover {
            filter: brightness(1.2); /* Subtle brightness increase on hover */
            background-color: rgba(255, 255, 255, 0.15); /* Subtle highlight on hover */
            box-shadow: 0 0 10px rgba(0, 191, 255, 0.3); /* Subtle blue glow on hover */
        }

        .desktop-icon:active {
            transform: scale(0.95);
            filter: brightness(0.9);
            background-color: rgba(0, 191, 255, 0.3); /* More pronounced active state */
            box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
        }

        .desktop-icon .icon-image { /* Sizing for dynamically loaded image */
            width: 48px; /* Larger icon size */
            height: 48px;
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.5)); /* Subtle shadow */
        }

        .desktop-icon-label {
            font-size: 0.8rem;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            margin-top: 5px;
            word-wrap: break-word; /* Allow long labels to wrap */
            max-width: 100%;
        }

        /* Start Menu styles */
        .start-menu {
            position: absolute;
            bottom: var(--taskbar-height); /* Position above the taskbar */
            left: 10px; /* Align with the start button's left edge */
            width: 320px; /* Wider for more content */
            height: auto;
            max-height: calc(100% - var(--taskbar-height) - 20px); /* Max height to fit screen, with some margin */
            background: rgba(255, 255, 255, 0.25); /* More opaque glass background for start menu */
            backdrop-filter: blur(20px); /* Stronger blur for glass effect */
            -webkit-backdrop-filter: blur(20px); /* For Safari */
            border: 1px solid rgba(255, 255, 255, 0.5); /* Stronger border */
            border-radius: 15px; /* Rounded corners */
            box-shadow: 0 10px 40px rgba(0, 191, 255, 0.5), inset 0 0 20px rgba(255, 255, 255, 0.3); /* More prominent shadow and inner glow */
            padding: 10px;
            display: none; /* Hidden by default */
            flex-direction: column;
            z-index: 100;
            transform-origin: bottom left; /* For animation to originate from bottom-left */
            animation: fadeInScaleUpFromBottomLeft 0.3s ease-out forwards; /* Fade in and scale up animation */
        }

        .start-menu.hidden {
            display: none;
        }
        .start-menu.visible {
            display: flex;
        }

        /* Start Menu header (with profile info) */
        .start-menu-header {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 10px;
            background: linear-gradient(to right, rgba(0,191,255,0.2) 0%, rgba(0,122,204,0.2) 100%); /* Subtle blue gradient */
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
            cursor: pointer; /* Changed to default pointer */
        }

        .start-menu-header .icon-image { /* Sizing for dynamically loaded image */
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 1px solid white;
            margin-right: 10px;
            /* fill: white; - This was for SVG, not needed for image */
        }

        .start-menu-header span {
            color: white;
            font-size: 1.1rem;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(0, 191, 255, 0.5);
        }


        /* Start Menu item styles */
        .start-menu-item {
            padding: 10px 15px;
            display: flex;
            align-items: center;
            color: white;
            text-decoration: none;
            transition: background-color 0.2s ease, transform 0.1s ease, filter 0.2s ease;
            cursor: pointer; /* Changed to default pointer */
            font-size: 0.95rem;
            font-weight: normal; /* Lighter font weight */
            border-radius: 8px; /* More rounded for Aero style */
            margin: 3px 0; /* Vertical margin for items */
            position: relative; /* For pseudo-elements */
            overflow: hidden; /* Hide overflow for shine effect */
        }

        .start-menu-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.3s ease;
        }

        .start-menu-item:hover::before {
            left: 100%;
        }

        .start-menu-item:hover {
            background: linear-gradient(to right, rgba(0, 191, 255, 0.3) 0%, rgba(0, 122, 204, 0.3) 100%); /* Blue gradient hover */
            transform: translateX(5px); /* More pronounced slide effect */
            color: white;
            text-shadow: 0 0 8px rgba(255,255,255,0.8);
            filter: brightness(1.2);
            box-shadow: inset 0 0 5px rgba(0,0,0,0.3);
        }

        .start-menu-item .icon-image { /* Style for dynamically loaded images within menu items */
            margin-right: 12px;
            width: 1.2em; /* Slightly larger icons */
            height: 1.2em;
            filter: drop-shadow(0 0 3px rgba(0, 191, 255, 0.3)); /* Subtle glow for image */
            transition: filter 0.2s ease;
        }
        .start-menu-item:hover .icon-image {
            filter: brightness(1.5) drop-shadow(0 0 8px rgba(255,255,255,0.8)); /* Brighten and stronger glow on hover */
        }
        
        /* New style for the text label within start menu items */
        .start-menu-item .menu-item-label {
            flex-grow: 1; /* Allow the label to take available space */
            text-align: left;
        }

        /* Start Menu Buttons Container (for Settings and Shutdown) */
        .start-menu-buttons-container { 
            display: flex;
            flex-direction: row; /* Changed to row for horizontal layout */
            justify-content: flex-end; /* Align to the right */
            gap: 10px; /* Space between buttons */
            padding-top: 10px;
            /* Removed border-top: 1px solid rgba(255,255,255,0.2); */
            margin-top: 10px;
            padding-right: 5px; /* Small padding to the right */
        }

        /* New style for icon-only buttons in the start menu footer */
        .start-menu-footer-button {
            width: 48px; /* Fixed width for square button */
            height: 48px; /* Fixed height for square button */
            display: flex;
            flex-direction: column; /* Stack icon and text */
            align-items: center;
            justify-content: center;
            background-color: transparent; /* Transparent background */
            border: none; /* No border */
            border-radius: 8px; /* Rounded corners */
            cursor: pointer; /* Changed to default pointer */
            transition: background-color 0.2s ease, transform 0.1s ease;
            color: white; /* Icon color */
            /* Removed font-size and text-shadow as there's no text */
            padding: 5px; /* Padding inside the button */
        }

        .start-menu-footer-button:hover {
            background-color: rgba(255, 255, 255, 0.15); /* Subtle highlight on hover */
            transform: translateY(-2px); /* Slight lift */
        }

        .start-menu-footer-button:active {
            transform: translateY(0);
            background-color: rgba(255, 255, 255, 0.25); /* More pronounced active state */
        }

        .start-menu-footer-button .icon-image { /* Sizing for dynamically loaded image */
            width: 24px; /* Icon size */
            height: 24px;
            filter: drop-shadow(0 0 3px rgba(0, 191, 255, 0.3));
        }

        /* Animation for menu appearance - Adjusted for bottom-left origin */
        @keyframes fadeInScaleUpFromBottomLeft {
            from {
                opacity: 0;
                transform: scale(0.8); /* Adjusted for bottom-left origin */
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Window styles (retaining glassmorphism) */
        .os-window {
            position: absolute;
            background: rgba(255, 255, 255, 0.25); /* More opaque glass background */
            backdrop-filter: blur(20px); /* Stronger blur for windows */
            -webkit-backdrop-filter: blur(20px); /* For Safari */
            border: 3px solid rgba(255, 255, 255, 0.7); /* Thicker, stronger border */
            border-radius: 12px; /* More rounded for Aero style */
            box-shadow: 0 10px 40px rgba(0, 191, 255, 0.5), inset 0 0 20px rgba(255, 255, 255, 0.3); /* More prominent shadow and inner glow */
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Hide content overflow */
            min-width: 300px;
            min-height: 200px;
            z-index: 5; /* Default z-index, will be updated on focus */
            animation: windowPopIn 0.3s ease-out forwards; /* Pop-in animation */
            resize: both; /* Allow resizing */
        }

        .os-window.minimized {
            display: none; /* Hide the window when minimized */
        }

        .os-window.maximized {
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: calc(100% - var(--taskbar-height)) !important; /* Maximize to full height minus taskbar height */
            border-radius: 0; /* No rounded corners when maximized */
            box-shadow: none; /* No shadow when maximized */
            transition: all 0.3s ease-in-out; /* Smooth transition for maximize/restore */
        }

        /* Window title bar - Frutiger Aero style */
        .os-window-title-bar {
            background: var(--fa-title-active-gradient); /* Active title bar gradient */
            padding: 8px 15px; /* Slightly larger padding */
            display: flex;
            justify-content: space-between;
            align-items: center;
            /* Added small border matching title bar color */
            border-bottom: 2px solid rgba(255, 255, 255, 0.8); /* Thicker, more visible border */
            cursor: grab; /* Changed to grab cursor */
            border-radius: 9px 9px 0 0; /* Match window border-radius, adjusted for 3px window border */
            position: relative;
            font-size: 1rem; /* Standard title font size */
            font-weight: bold;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.7); /* Stronger text shadow */
            box-shadow: inset 0 1px 4px rgba(255,255,255,0.4); /* Inner top highlight */
        }
        /* Small border matching title bar color */
        .os-window-title-bar::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px; /* Small border height */
            background: var(--fa-title-active-gradient); /* Match title bar gradient */
            z-index: 1;
        }
        .os-window-title-bar.inactive {
            background: var(--fa-title-inactive-gradient); /* Inactive title bar color - more muted blue */
            border-bottom: 2px solid rgba(255, 255, 255, 0.5); /* Thicker, muted border */
            box-shadow: inset 0 1px 2px rgba(255,255,255,0.2);
        }
        .os-window-title-bar.inactive::after {
            background: var(--fa-title-inactive-gradient); /* Match inactive title bar gradient */
        }

        /* Window title and logo container */
        .os-window-title-content {
            display: flex;
            align-items: center;
            gap: 8px; /* Space between logo and title */
        }

        .os-window-title-content .icon-image { /* Sizing for dynamically loaded image */
            width: 24px; /* Size for the M-logo */
            height: 24px;
            filter: drop-shadow(0 0 3px rgba(0, 191, 255, 0.3));
        }

        .os-window-title {
            color: white;
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }

        /* Window control buttons (minimize, maximize, close) - Frutiger Aero style */
        .os-window-controls {
            display: flex;
            gap: 8px; /* Larger gap */
        }

        .os-window-controls .control-button {
            width: 28px; /* Larger circular buttons */
            height: 28px;
            border-radius: 50%; /* Circular */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem; /* Adjusted for SVG size */
            color: white; /* White icons */
            cursor: pointer; /* Changed to default pointer */
            transition: background-color 0.1s ease, transform 0.05s ease, box-shadow 0.1s ease;
            /* More glossy, 3D effect for control buttons */
            box-shadow: inset 0 1px 4px rgba(255,255,255,0.7), 0 1px 5px rgba(0,0,0,0.5);
            border: 1px solid rgba(255, 255, 255, 0.6);
            background: rgba(255,255,255,0.2); /* Base white background for buttons */
        }

        /* Specific button colors for hover/active states - ALL WHITE NOW */
        .os-window-controls .control-button.close { background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.6); }
        .os-window-controls .control-button.minimize { background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.6); }
        .os-window-controls .control-button.maximize { background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.6); }

        .os-window-controls .control-button:hover {
            transform: scale(1.1);
            filter: brightness(1.2);
            box-shadow: inset 0 1px 6px rgba(255,255,255,0.9), 0 2px 10px rgba(0,0,0,0.6);
            background: rgba(255,255,255,0.4); /* Lighter white on hover */
        }
        /* Ensure all hover states are white/transparent */
        .os-window-controls .control-button.close:hover { background: rgba(255,255,255,0.4); border-color: rgba(255,255,255,0.7); }
        .os-window-controls .control-button.minimize:hover { background: rgba(255,255,255,0.4); border-color: rgba(255,255,255,0.7); }
        .os-window-controls .control-button.maximize:hover { background: rgba(255,255,255,0.4); border-color: rgba(255,255,255,0.7); }


        .os-window-controls .control-button:active {
            transform: scale(0.9);
            opacity: 1;
            box-shadow: inset 0 0 6px rgba(0,0,0,0.8), inset 0 -1px 4px rgba(255,255,255,0.5);
            filter: brightness(0.8);
            background: rgba(255,255,255,0.1); /* Darker white on active */
        }
        .os-window-controls .control-button .icon-image { /* Sizing for dynamically loaded image */
            width: 0.8em;
            height: 0.8em;
            filter: drop-shadow(0 0 3px rgba(0, 191, 255, 0.3));
        }

        /* Window content area */
        .os-window-content {
            flex-grow: 1;
            padding: 15px;
            color: var(--text-color);
            font-size: 0.9rem;
            line-height: 1.5;
            overflow: auto; /* Allow content to scroll if it overflows */
        }

        /* Status bar at the bottom of each window */
        .os-window-status-bar {
            background: linear-gradient(to top, rgba(0, 191, 255, 0.2) 0%, rgba(0, 122, 204, 0.2) 100%); /* Subtle blue gradient */
            border-top: 1px solid rgba(255, 255, 255, 0.3);
            padding: 5px 15px;
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.7);
            text-align: right;
            border-radius: 0 0 9px 9px; /* Match window border-radius, adjusted for 3px window border */
            box-shadow: inset 0 -1px 3px rgba(0,0,0,0.3);
        }

        /* Markdown specific styles within window content */
        .os-window-content .markdown-content h1 { font-size: 2em; margin-bottom: 0.5em; color: var(--primary-blue); border-bottom: 1px solid rgba(0,191,255,0.3); padding-bottom: 0.3em; }
        .os-window-content .markdown-content h2 { font-size: 1.5em; margin-bottom: 0.4em; color: var(--light-blue); }
        .os-window-content .markdown-content h3 { font-size: 1.2em; margin-bottom: 0.3em; color: var(--text-color); }
        .os-window-content .markdown-content p { margin-bottom: 1em; }
        .os-window-content .markdown-content ul, .os-window-content .markdown-content ol { margin-left: 1.5em; margin-bottom: 1em; list-style-type: disc; }
        .os-window-content .markdown-content li { margin-bottom: 0.5em; }
        .os-window-content .markdown-content strong { font-weight: bold; color: white; }
        .os-window-content .markdown-content em { font-style: italic; opacity: 0.9; }
        .os-window-content .markdown-content a { color: var(--primary-blue); text-decoration: underline; }
        .os-window-content .markdown-content code { background-color: rgba(255,255,255,0.1); padding: 0.2em 0.4em; border-radius: 4px; font-family: monospace; font-size: 0.85em; }
        .os-window-content .markdown-content pre { background-color: rgba(0,0,0,0.3); padding: 1em; border-radius: 8px; overflow-x: auto; margin-bottom: 1em; }
        .os-window-content .markdown-content blockquote { border-left: 4px solid var(--primary-blue); padding-left: 1em; margin-left: 0; opacity: 0.8; }


        /* Window pop-in animation */
        @keyframes windowPopIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* Works grid specific styles */
        .works-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); /* Responsive grid */
            gap: 15px;
            padding: 10px;
        }

        .work-card {
            background: rgba(255, 255, 255, 0.1); /* Slightly more transparent */
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer; /* Changed to default pointer */
            transition: all 0.2s ease-in-out, filter 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4), inset 0 0 8px rgba(255,255,255,0.1); /* More prominent shadow and subtle inner glow */
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding-bottom: 10px;
        }

        .work-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 25px rgba(0, 191, 255, 0.6), inset 0 0 12px rgba(255,255,255,0.2); /* Stronger blue glow */
            border-color: var(--primary-blue);
            filter: brightness(1.1);
        }

        .work-card img {
            width: 100%;
            height: 150px; /* Fixed height for consistency */
            object-fit: cover; /* Cover the area, crop if necessary */
            border-radius: 8px 8px 0 0;
            filter: brightness(0.9); /* Slightly dim */
            transition: filter 0.2s ease;
        }

        .work-card:hover img {
            filter: brightness(1.1); /* Brighten on hover */
        }

        .work-card-title {
            font-size: 0.9rem;
            font-weight: bold;
            margin-top: 10px;
            color: var(--text-color);
        }

        .work-card-category {
            font-size: 0.75rem;
            color: var(--light-blue);
            opacity: 0.8;
            margin-top: 2px;
        }

        /* Work Detail Window Specific Styles */
        .work-detail-content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .work-detail-content .gallery-main-image-container {
            position: relative;
            width: 100%;
            max-width: 600px; /* Limit main image width */
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border-radius: 8px;
            overflow: hidden;
        }

        .work-detail-content .gallery-main-image {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 8px;
        }

        .work-detail-content .gallery-nav-button {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.6); /* Slightly darker for better contrast */
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer; /* Changed to default pointer */
            font-size: 1.5rem; /* Adjusted for SVG size */
            border-radius: 50%;
            transition: background-color 0.2s ease, filter 0.2s ease;
            z-index: 2; /* Above image */
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .work-detail-content .gallery-nav-button:hover {
            background: rgba(0, 0, 0, 0.9);
            filter: brightness(1.2);
            box-shadow: 0 4px 8px rgba(0,0,0,0.5);
        }
        .work-detail-content .gallery-nav-button .icon-image { /* Sizing for dynamically loaded image */
            width: 1.5em;
            height: 1.5em;
            filter: drop-shadow(0 0 3px rgba(0, 191, 255, 0.3));
        }

        .work-detail-content .gallery-nav-button.prev {
            left: 10px;
        }

        .work-detail-content .gallery-nav-button.next {
            right: 10px;
        }

        .work-detail-content .gallery-thumbnails {
            display: flex;
            justify-content: center;
            flex-wrap: wrap; /* Allow thumbnails to wrap */
            gap: 10px;
            margin-top: 10px;
            margin-bottom: 15px;
        }

        .work-detail-content .gallery-thumbnail {
            width: 80px;
            height: 60px;
            object-fit: cover;
            border-radius: 5px;
            border: 2px solid transparent;
            cursor: pointer; /* Changed to default pointer */
            transition: border-color 0.2s ease, transform 0.1s ease, filter 0.2s ease, box-shadow 0.2s ease;
        }

        .work-detail-content .gallery-thumbnail.active {
            border-color: var(--primary-blue);
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(0, 191, 255, 0.8); /* Stronger glow for active thumbnail */
        }
        .work-detail-content .gallery-thumbnail:hover {
            filter: brightness(1.1);
            box-shadow: 0 0 5px rgba(0, 191, 255, 0.4);
        }

        .work-detail-content h3 {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-blue);
            margin-bottom: 10px;
            text-align: center;
        }
        .work-detail-content p {
            margin-bottom: 10px;
            text-align: justify; /* Justify text for better readability */
        }
        .work-detail-content .category-tag {
            display: inline-block;
            background-color: rgba(0, 191, 255, 0.3);
            border: 1px solid var(--primary-blue);
            border-radius: 5px;
            padding: 4px 8px;
            font-size: 0.8rem;
            color: var(--light-blue);
            margin-top: 10px;
        }

        /* Taskbar icon for minimized windows */
        .taskbar-minimized-icon {
            background: rgba(255, 255, 255, 0.25); /* More transparent background */
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 8px; /* Rounded square */
            padding: 4px 8px;
            margin: 0 3px;
            cursor: pointer; /* Changed to default pointer */
            display: flex;
            align-items: center;
            gap: 5px;
            color: white; /* White text */
            font-size: 0.8rem;
            box-shadow: inset 0 1px 3px rgba(255,255,255,0.5), 0 1px 3px rgba(0,0,0,0.4);
            transition: all 0.2s ease;
            white-space: nowrap;
            max-width: 120px; /* Limit width */
            overflow: hidden;
            text-overflow: ellipsis; /* Add ellipsis for overflow */
        }

        .taskbar-minimized-icon:hover {
            background: rgba(255, 255, 255, 0.35);
            transform: translateY(-2px); /* Lift effect on hover */
            box-shadow: inset 0 1px 3px rgba(255,255,255,0.6), 0 2px 8px rgba(0,0,0,0.5);
        }

        /* Active taskbar icon style */
        .taskbar-minimized-icon.active {
            background: linear-gradient(to bottom, rgba(0, 191, 255, 0.5) 0%, rgba(0, 122, 204, 0.5) 100%); /* Blue gradient active */
            border-color: var(--primary-blue);
            box-shadow: inset 0 1px 4px rgba(0,0,0,0.6), 0 0 12px var(--primary-blue); /* Stronger glow */
            transform: translateY(0);
        }

        .taskbar-minimized-icon .icon-image { /* Sizing for dynamically loaded image */
            width: 1em;
            height: 1em;
            filter: drop-shadow(0 0 3px rgba(0, 191, 255, 0.3));
            transition: filter 0.2s ease;
        }
        .taskbar-minimized-icon.active .icon-image {
            filter: brightness(1.5) drop-shadow(0 0 5px rgba(255,255,255,0.8));
        }

        /* Loading spinner styles */
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid var(--primary-blue);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Sub-menu for language selection */
        .start-menu-submenu {
            position: absolute;
            left: 100%; /* Position to the right of the parent menu item */
            top: 0;
            width: 200px; /* Fixed width for submenu */
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 191, 255, 0.3), inset 0 0 10px rgba(255, 255, 255, 0.2);
            padding: 10px;
            display: none; /* Hidden by default */
            flex-direction: column;
            z-index: 101; /* Higher than main start menu */
        }
        .start-menu-item.has-submenu:hover .start-menu-submenu {
            display: flex; /* Show submenu on hover */
        }

        /* Toggle switch styles */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer; /* Changed to default pointer */
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary-blue);
        }

        input:focus + .toggle-slider {
            box-shadow: 0 0 1px var(--primary-blue);
        }

        input:checked + .toggle-slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        /* Round sliders */
        .toggle-slider.round {
            border-radius: 34px;
        }

        .toggle-slider.round:before {
            border-radius: 50%;
        }

        /* Custom Scrollbar Styles (for Webkit browsers like Chrome/Safari) */
        /* Track */
        ::-webkit-scrollbar {
            width: 16px; /* Thicker scrollbar width */
        }

        /* Handle */
        ::-webkit-scrollbar-thumb {
            background: rgba(0, 191, 255, 0.7); /* Blueish transparent, slightly darker */
            border-radius: 10px; /* Rounded corners for the thumb */
            border: 4px solid rgba(255, 255, 255, 0.3); /* Thicker transparent border around thumb */
            transition: background 0.2s ease;
        }

        /* Handle on hover */
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 191, 255, 0.9); /* Darker blue on hover */
        }

        /* Track background */
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.15); /* Slightly less transparent track */
            border-radius: 10px;
        }

        /* Buttons (arrows) */
        ::-webkit-scrollbar-button {
            background: rgba(255,255,255,0.2); /* White transparent */
            border-radius: 50%; /* Circular buttons */
            height: 20px; /* Adjust height to make it circular */
            width: 20px; /* Adjust width to make it circular */
            display: block; /* Ensure it takes up space */
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: inset 0 1px 4px rgba(255,255,255,0.7), 0 1px 5px rgba(0,0,0,0.5);
            transition: background-color 0.1s ease, transform 0.05s ease, box-shadow 0.1s ease;
        }

        ::-webkit-scrollbar-button:hover {
            background: rgba(255,255,255,0.4); /* Lighter white on hover */
            transform: scale(1.1);
            filter: brightness(1.2);
            box-shadow: inset 0 1px 6px rgba(255,255,255,0.9), 0 2px 10px rgba(0,0,0,0.6);
        }

        ::-webkit-scrollbar-button:active {
            background: rgba(255,255,255,0.1); /* Darker white on active */
            transform: scale(0.9);
            opacity: 1;
            box-shadow: inset 0 0 6px rgba(0,0,0,0.8), inset 0 -1px 4px rgba(255,255,255,0.5);
            filter: brightness(0.8);
        }

        /* For Firefox scrollbars */
        html {
            scrollbar-width: thin; /* "auto" or "thin" */
            scrollbar-color: rgba(0, 191, 255, 0.7) rgba(255, 255, 255, 0.15); /* thumb and track color */
        }
        /* Note: Firefox doesn't support styling scrollbar buttons with standard CSS */

    </style>
</head>
<body>
    <!-- Desktop background layer for dynamic Frutiger Aero style background -->
    <div class="desktop-background" id="desktop-background"></div>

    <!-- Desktop container, simulating a screen -->
    <div class="desktop-container" id="desktop-container">
        <!-- Desktop Layout - holds the main desktop area and the taskbar -->
        <div class="desktop-layout">
            <!-- Main Desktop Area - where icons and windows reside -->
            <div class="main-desktop-area" id="main-desktop-area">
                <!-- Initial welcome message, will be hidden when windows open -->
                <div id="welcome-message" class="absolute inset-0 flex items-center justify-center pointer-events-none">
                    <p class="text-3xl text-white opacity-70" id="welcome-message-text">Ê¨¢ËøéÊù•Âà∞ MAX OS ËôöÊãüÂÆáÂÆôÁªàÁ´Ø</p>
                </div>
                
                <!-- Desktop Icons (Shortcuts) -->
                <div class="desktop-icons-container" id="desktop-icons-container">
                    <div class="desktop-icon" data-section="works" data-title-zh="ÊàëÁöÑ‰ΩúÂìÅÈõÜ" data-title-en="My Works">
                        <span class="icon-placeholder" data-asset-key="icon_works"></span>
                        <span class="desktop-icon-label" data-lang-key="worksIcon">‰ΩúÂìÅÈõÜ</span>
                    </div>
                    <div class="desktop-icon" data-section="characters" data-title-zh="ËßíËâ≤Â∫ì" data-title-en="Characters">
                        <span class="icon-placeholder" data-asset-key="icon_characters"></span>
                        <span class="desktop-icon-label" data-lang-key="charactersIcon">ËßíËâ≤</span>
                    </div>
                    <!-- About Me icon changed to mazko.exe with M icon -->
                    <div class="desktop-icon" data-section="about" data-title-zh="ÂÖ≥‰∫é MAZKO" data-title-en="About MAZKO">
                        <span class="icon-placeholder" data-asset-key="icon_mazko_logo"></span>
                        <span class="desktop-icon-label" data-lang-key="mazkoExeIcon">MAZKO</span>
                    </div>
                    <div class="desktop-icon" data-section="services" data-title-zh="ÊúçÂä°‰∏éÊä•‰ª∑" data-title-en="Services & Pricing">
                        <span class="icon-placeholder" data-asset-key="icon_services"></span>
                        <span class="desktop-icon-label" data-lang-key="servicesIcon">ÊúçÂä°</span>
                    </div>
                    <div class="desktop-icon" data-section="socials" data-title-zh="Á§æ‰∫§Â™í‰Ωì" data-title-en="Social Media">
                        <span class="icon-placeholder" data-asset-key="icon_socials"></span>
                        <span class="desktop-icon-label" data-lang-key="socialsIcon">Á§æ‰∫§</span>
                    </div>
                </div>
                <!-- Windows will be appended here by JavaScript -->
            </div>

            <!-- Start Menu -->
            <div id="start-menu" class="start-menu hidden">
                <div class="start-menu-header" data-section="about" data-title-zh="ÂÖ≥‰∫é MAZKO" data-title-en="About MAZKO"> <!-- Make header clickable to open About Me -->
                    <span class="icon-placeholder" data-asset-key="icon_mazko_logo"></span>
                    <span data-lang-key="profileName">MAZKO</span>
                </div>
                <a href="#" class="start-menu-item" data-section="works" data-lang-key="worksMenuItem" data-title-zh="ÊàëÁöÑ‰ΩúÂìÅÈõÜ" data-title-en="My Works">
                    <span class="icon-placeholder" data-asset-key="icon_works"></span>
                    <span class="menu-item-label"></span>
                </a>
                <a href="#" class="start-menu-item" data-section="characters" data-lang-key="charactersMenuItem" data-title-zh="ËßíËâ≤Â∫ì" data-title-en="Characters">
                    <span class="icon-placeholder" data-asset-key="icon_characters"></span>
                    <span class="menu-item-label"></span>
                </a>
                <a href="#" class="start-menu-item" data-section="services" data-lang-key="servicesMenuItem" data-title-zh="ÊúçÂä°‰∏éÊä•‰ª∑" data-title-en="Services & Pricing">
                    <span class="icon-placeholder" data-asset-key="icon_services"></span>
                    <span class="menu-item-label"></span>
                </a>
                <a href="#" class="start-menu-item" data-section="socials" data-lang-key="socialsMenuItem" data-title-zh="Á§æ‰∫§Â™í‰Ωì" data-title-en="Social Media">
                    <span class="icon-placeholder" data-asset-key="icon_socials"></span>
                    <span class="menu-item-label"></span>
                </a>
                <!-- Removed the horizontal line as requested -->
                <!-- <div class="border-t border-gray-600 my-2 mx-4"></div> -->
                <!-- Settings and Shutdown Buttons in a container, now using start-menu-footer-button class -->
                <div class="start-menu-buttons-container">
                    <button class="start-menu-footer-button" data-section="settings" data-lang-key="settingsMenuItem" title="ËÆæÁΩÆ" data-title-zh="Á≥ªÁªüËÆæÁΩÆ" data-title-en="Settings">
                        <span class="icon-placeholder" data-asset-key="icon_settings"></span>
                        <!-- Removed text span as requested -->
                    </button>
                    <button class="start-menu-footer-button" data-section="shutdown" data-lang-key="shutdownMenuItem" title="ÂÖ≥Èó≠Á≥ªÁªü" data-title-zh="ÂÖ≥Èó≠Á≥ªÁªü" data-title-en="Shutdown">
                        <span class="icon-placeholder" data-asset-key="icon_shutdown"></span>
                        <!-- Removed text span as requested -->
                    </button>
                </div>
            </div>

            <!-- Taskbar at the bottom -->
            <div class="taskbar" id="taskbar">
                <!-- Start Button changed to M icon -->
                <button class="start-button" id="start-button-taskbar">
                    <span class="icon-placeholder" data-asset-key="icon_mazko_logo" id="start-button-icon-placeholder"></span>
                    <!-- <span data-lang-key="startButton">ÂºÄÂßã</span> Removed text -->
                </button>

                <!-- Taskbar icons for open/minimized windows -->
                <div id="taskbar-icons" class="taskbar-icons-container">
                    <!-- Minimized window icons will be appended here -->
                </div>

                <!-- Right side system tray -->
                <div class="system-tray">
                    <div class="system-tray-icon">
                        <span class="icon-placeholder" data-asset-key="icon_wifi"></span>
                    </div>
                    <div class="system-tray-icon">
                        <span class="icon-placeholder" data-asset-key="icon_battery"></span>
                    </div>
                    <div class="system-tray-icon">
                        <span class="icon-placeholder" data-asset-key="icon_volume"></span>
                    </div>
                    <span class="text-sm text-white opacity-80" id="current-time"></span> <!-- Time display -->
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('Script started parsing.'); // Added for debugging
        
        /**
         * @object ASSETS
         * @description ÈõÜ‰∏≠ÁÆ°ÁêÜÊâÄÊúâÂõæÁâáÂíåÂõæÊ†áÁöÑË∑ØÂæÑ„ÄÇ
         * ËØ∑Â∞ÜÊÇ®ÁöÑÂõæÁâáÊñá‰ª∂ÊîæÁΩÆÂú®Áõ∏Â∫îÁöÑ `assets/` Êñá‰ª∂Â§π‰∏≠„ÄÇ
         * ‰æãÂ¶ÇÔºå`./assets/cursors/hand_open.png` Ë°®Á§∫Êñá‰ª∂‰Ωç‰∫éÈ°πÁõÆÊ†πÁõÆÂΩï‰∏ãÁöÑ `assets/cursors/` Êñá‰ª∂Â§π‰∏≠„ÄÇ
         * ÊÇ®ÂèØ‰ª•Ê†πÊçÆÈúÄË¶Å‰øÆÊîπËøô‰∫õË∑ØÂæÑÂíåÊñá‰ª∂Âêç„ÄÇ
         */
        const ASSETS = {
            // ÂÖâÊ†áÂõæÁâá (ËØ∑ÊõøÊç¢‰∏∫ÊÇ®ÁöÑ PNG Êàñ CUR Êñá‰ª∂Ë∑ØÂæÑ)
            'cursor_default': './assets/cursors/hand_open.png',
            'cursor_active': './assets/cursors/hand_closed.png',
            'cursor_pointer': './assets/cursors/hand_point.png',

            // Ê°åÈù¢ÂõæÊ†á / ÂºÄÂßãËèúÂçïÂõæÊ†á (ËØ∑ÊõøÊç¢‰∏∫ÊÇ®ÁöÑ PNG/SVG Êñá‰ª∂Ë∑ØÂæÑ)
            'icon_works': './assets/icons/folder.png', // ‰ΩúÂìÅÈõÜÊñá‰ª∂Â§πÂõæÊ†á
            'icon_characters': './assets/icons/users.png', // ËßíËâ≤Áî®Êà∑ÂõæÊ†á
            'icon_mazko_logo': './assets/icons/mazko_logo.png', // ÊÇ®ÁöÑËá™ÂÆö‰πâ 'M' Ê†áÂøó
            'icon_services': './assets/icons/handshake.png', // ÊúçÂä°Êè°ÊâãÂõæÊ†á
            'icon_socials': './assets/icons/share.png', // Á§æ‰∫§ÂàÜ‰∫´ÂõæÊ†á

            // ‰ªªÂä°Ê†èÁ≥ªÁªüÊâòÁõòÂõæÊ†á (ËØ∑ÊõøÊç¢‰∏∫ÊÇ®ÁöÑ PNG/SVG Êñá‰ª∂Ë∑ØÂæÑ)
            'icon_wifi': './assets/icons/wifi.png',
            'icon_battery': './assets/icons/battery_full.png',
            'icon_volume': './assets/icons/volume_up.png',

            // ÂºÄÂßãËèúÂçïÂ∫ïÈÉ®ÊåâÈíÆÂõæÊ†á (ËØ∑ÊõøÊç¢‰∏∫ÊÇ®ÁöÑ PNG/SVG Êñá‰ª∂Ë∑ØÂæÑ)
            'icon_settings': './assets/icons/cog.png', // ËÆæÁΩÆÈΩøËΩÆÂõæÊ†á
            'icon_shutdown': './assets/icons/power_off.png', // ÂÖ≥Êú∫ÁîµÊ∫êÂõæÊ†á

            // Á™óÂè£ÊéßÂà∂ÊåâÈíÆÂõæÊ†á (ËØ∑ÊõøÊç¢‰∏∫ÊÇ®ÁöÑ PNG/SVG Êñá‰ª∂Ë∑ØÂæÑ)
            'icon_minus': './assets/icons/minus.png', // ÊúÄÂ∞èÂåñÂõæÊ†á
            'icon_square': './assets/icons/square.png', // ÊúÄÂ§ßÂåñ/ËøòÂéüÂõæÊ†á
            'icon_times': './assets/icons/times.png', // ÂÖ≥Èó≠ÂõæÊ†á
            'icon_window_restore': './assets/icons/window_restore.png', // ‰ªªÂä°Ê†èÊúÄÂ∞èÂåñÁ™óÂè£ÂõæÊ†á

            // ÁîªÂªäÂØºËà™ÊåâÈíÆÂõæÊ†á (ËØ∑ÊõøÊç¢‰∏∫ÊÇ®ÁöÑ PNG/SVG Êñá‰ª∂Ë∑ØÂæÑ)
            'icon_chevron_left': './assets/icons/chevron_left.png', // Â∑¶ÁÆ≠Â§¥
            'icon_chevron_right': './assets/icons/chevron_right.png', // Âè≥ÁÆ≠Â§¥

            // Á§æ‰∫§Â™í‰ΩìÂõæÊ†á (ÁâπÂà´Ê≥®ÊÑèÔºöËøô‰∫õÈúÄË¶ÅÊÇ®Êèê‰æõÂØπÂ∫îÁöÑÂõæÂÉèÊñá‰ª∂Ôºå‰ª•‰øÆÊ≠£Áé∞ÊúâÊòæÁ§∫‰∏çÊ≠£Á°ÆÁöÑÈóÆÈ¢ò)
            'icon_weibo': './assets/socials/weibo.png',
            'icon_instagram': './assets/socials/instagram.png',
            'icon_artstation': './assets/socials/artstation.png',
            'icon_behance_square': './assets/socials/behance.png',
            'icon_envelope': './assets/socials/envelope.png',

            // Ê°åÈù¢ËÉåÊôØÂõæÁâá (ÂèØÈÄâÔºöÂ¶ÇÊûúÊÇ®ÊÉ≥‰ΩøÁî®ÂõæÁâáËÉåÊôØÔºåÂèñÊ∂àÊ≥®ÈáäÂπ∂Êèê‰æõË∑ØÂæÑ)
            // 'desktop_background_image': './assets/backgrounds/your_desktop_bg.jpg',
        };

        /**
         * @function getAssetUrl
         * @param {string} assetKey - ASSETS ÂØπË±°‰∏≠ÁöÑÈîÆÂêç„ÄÇ
         * @returns {string} ÂØπÂ∫îËµÑ‰∫ßÁöÑ URL Ë∑ØÂæÑ„ÄÇ
         * @description ‰ªé ASSETS ÂØπË±°‰∏≠Ëé∑ÂèñÊåáÂÆöËµÑ‰∫ßÁöÑ URL„ÄÇ
         */
        function getAssetUrl(assetKey) {
            return ASSETS[assetKey] || ''; 
        }

        // All text content for different languages
        const LANG_CONTENT = {
            'zh': {
                systemName: 'MAX OS', // New system name
                systemVersion: 'Ver1.0', // New system version
                welcomeMessage: 'Ê¨¢ËøéÊù•Âà∞ MAX OS ËôöÊãüÂÆáÂÆôÁªàÁ´Ø',
                startButton: 'ÂºÄÂßã', // This will no longer be used for the button text
                profileName: 'MAZKO',
                worksIcon: '‰ΩúÂìÅÈõÜ',
                charactersIcon: 'ËßíËâ≤',
                mazkoExeIcon: 'MAZKO', // Removed .exe
                servicesIcon: 'ÊúçÂä°',
                socialsIcon: 'Á§æ‰∫§',
                settingsIcon: 'ËÆæÁΩÆ', // New
                worksMenuItem: '‰ΩúÂìÅÈõÜ', // Simplified for menu item label
                charactersMenuItem: 'ËßíËâ≤', // Simplified for menu item label
                servicesMenuItem: 'ÊúçÂä°‰∏éÊä•‰ª∑', // Simplified for menu item label
                socialsMenuItem: 'Á§æ‰∫§Â™í‰Ωì', // Simplified for menu item label
                settingsMenuItem: 'ËÆæÁΩÆ', // Now a button, simplified text
                languageMenuItem: 'ËØ≠Ë®Ä', // This will still be used for the settings window
                shutdownMenuItem: 'ÂÖ≥Èó≠Á≥ªÁªü', // Now a button, simplified text
                shutdownMessage: 'ÊÑüË∞¢ÊÇ®ÁöÑËÆøÈóÆÔºåMAX OS ËôöÊãüÂÆáÂÆôÁªàÁ´ØÊ≠£Âú®ÂÆâÂÖ®ÈÄÄÂá∫„ÄÇ', // Updated shutdown message
                loadingMessage: 'Âä†ËΩΩ‰∏≠...',
                errorLoadingContent: 'Âä†ËΩΩÂÜÖÂÆπÂ§±Ë¥•Ôºö',
                unknownModule: 'ÈîôËØØÔºöÊú™Áü•Ê®°Âùó„ÄÇ',
                worksTitle: 'ÊàëÁöÑ‰ΩúÂìÅÈõÜ',
                worksClickPrompt: 'ÁÇπÂáª‰ΩúÂìÅÂç°ÁâáÊü•ÁúãËØ¶ÊÉÖ...',
                worksDetailsSuffix: ' - ËØ¶ÊÉÖ', // New suffix for work details
                charactersTitle: 'ËßíËâ≤ËÆæËÆ°',
                charactersDescription: 'Êé¢Á¥¢ÊàëÁã¨ÁâπÁöÑPSXÊ∏∏ÊàèÈ£éÊ†ºÂç°ÈÄöËßíËâ≤„ÄÇ',
                aboutTitle: 'ÂÖ≥‰∫é MAZKO', // Title for About Me window
                aboutContent: `
ÊàëÊòØ‰∏ÄÂêçÊù•Ëá™‰∏≠ÂõΩÁöÑ 3D Ëâ∫ÊúØÂÆ∂‰∏éÂπ≥Èù¢ËÆæËÆ°Â∏àÔºå‰∏ìÊ≥®‰∫é PSX Ê∏∏ÊàèÈ£éÊ†ºÂç°ÈÄöÂª∫Ê®°‰∏é lowpoly Â§çÂè§ÂÉèÁ¥†Ë¥®ÊÑüÔºåÂêåÊó∂Ê≤âÊµ∏‰∫éÂú∞‰∏ã club ÊñáÂåñ‰∏éÂÖàÈîãËßÜËßâÁöÑÂ§öÂÖÉËûçÂêàÂàõ‰Ωú„ÄÇ

Áó¥Ëø∑‰∫é‰∏ÄÂàáÁ™ÅÁ†¥Â∏∏ËßÑÁöÑÁæéÂ≠¶ËØ≠Ë®Ä‚Äî‚Äî‰ªé ASAP Rocky MV„ÄäTailor Swift„Äã‰∏≠ÁöÑËßÜËßâÂº†ÂäõÔºåÂà∞„ÄäÂºÇÂÖΩÈ≠îÈÉΩ„ÄãÁöÑËçíËØûËßíËâ≤ËÆæÂÆöÔºåÂÜçÂà∞„ÄäÁëûÂÖãÂíåËé´ËíÇ„ÄãÁöÑÁª¥Â∫¶Èîô‰π±ÔºåÊàëÂ∞ÜÂä®Êº´Âèô‰∫ã„ÄÅË°óÂ§¥ÂòªÂìà„ÄÅÂ§çÂè§ÁßëÂπªÁ≠âÊñáÂåñÂü∫Âõ†Ê≥®ÂÖ•‰ΩúÂìÅ‰πã‰∏≠ÔºåÁî®ÂÉèÁ¥†È¢óÁ≤í‰∏é‰ΩéÊ®°ÊûÑÂª∫Âá∫Áã¨‰∏ÄÊó†‰∫åÁöÑËßÜËßâÁ≥ªÁªü„ÄÇ

ÊàëÊìÖÈïø‰ΩøÁî® Blender„ÄÅSubstance Painter„ÄÅZbrush„ÄÅPhotoshop ‰∏é IllustratorÔºåÊ∂µÁõñËßíËâ≤ËÆæËÆ°„ÄÅCG Âä®Áîª„ÄÅÊµ∑Êä•„ÄÅVJ„ÄÅËôöÊãüÊó∂Â∞ö‰∏é LOGO ËÆæËÆ°Á≠âÂ§ö‰∏™È¢ÜÂüü„ÄÇ
                `, // Now Markdown
                services: {
                    title: 'ÊúçÂä°‰∏éÊä•‰ª∑',
                    description: '‰ª•‰∏ãÊòØÊàëÁöÑ‰∏ªË¶ÅÊúçÂä°È°πÁõÆÂèäÂ§ßËá¥Êä•‰ª∑ËåÉÂõ¥Ôºö', // Now Markdown
                    categories: [
                        {
                            id: 'character-modeling-category',
                            name: 'ËßíËâ≤Âª∫Ê®°ÊúçÂä°',
                            nameEn: 'Character Modeling Service', // Added English name for title bar
                            shortDescription: '‰ΩéÂ§öËæπÂΩ¢‰∫∫Áâ©Âª∫Ê®°‰∏éÂ§çÂè§Âä®ÁîªÊúçÂä°„ÄÇ',
                            detailContent: `
### üë§„Äêùêãùê®ùê∞-ùêèùê®ùê•ùê≤ ùêÇùê°ùêöùê´ùêöùêúùê≠ùêûùê´ ùêåùê®ùêùùêûùê•ùê¢ùêßùê†„Äë‰ΩéËæπÂΩ¢‰∫∫Áâ©Âª∫Ê®°
**‰ª∑Ê†ºÔºö** 500¬•+ / ‰∫∫
ÊàëÂ∞Ü‰∏∫‰Ω†ÁöÑËßíËâ≤ËøõË°å‰ΩéÂ§öËæπÂΩ¢Âª∫Ê®°‰∏éËÆæËÆ°ÔºÅ

#### ‚ñ∑ Âü∫Á°ÄÊúçÂä°ÂÜÖÂÆπÔºö
* ËßíËâ≤Âª∫Ê®°Ôºà‰ΩéÂ§öËæπÂΩ¢Ôºâ
* ÁÆÄÂçïÂä®‰ΩúÁªëÂÆö
* Ê∏≤ÊüìËßÜÈ¢ëÂØºÂá∫

‚ñ† ‰∫§‰ªòÊ†ºÂºèÔºö FBX / Blender / mp4

### üï∫„Äêùêëùêûùê≠ùê´ùê® ùêÄùêßùê¢mùêöùê≠ùê¢ùê®ùêß ùêåùê®ùêùùêÆùê•ùêû„Äë‰ΩéËæπÂΩ¢‰∫∫Áâ©Â§çÂè§Âä®Áîª
**‰ª∑Ê†ºÔºö** 1000¬•+ / ‰∏™
ÊàëÂ∞Ü‰∏∫ÊÇ®Êèê‰æõÂÆåÊï¥ÁöÑ‰ΩéÂ§öËæπÂΩ¢ËßíËâ≤Âä®ÁîªÊúçÂä°„ÄÇÂåÖÂê´‰ªéÂª∫Ê®°„ÄÅÁªëÂÆö„ÄÅÂà∞Âä®‰ΩúËÆæÂÆö‰∏éÊ∏≤ÊüìÂØºÂá∫ÔºåÈÄÇÂêàÁî®‰∫éÊºîÁ§∫Áü≠Áâá„ÄÅÁ§æ‰∫§Â™í‰ΩìËßíËâ≤Â±ïÁ§∫„ÄÅÂ§çÂè§Âú∫ÊôØÊ∞õÂõ¥Ê∏≤ÊüìÁ≠â„ÄÇ

#### ‚ñ∑ Âü∫Á°ÄÊúçÂä°ÂÜÖÂÆπÔºö
* ËßíËâ≤Âª∫Ê®° + È™®È™ºÂä®ÁîªËÆæÂÆö
* Âú∫ÊôØÊê≠Âª∫ÔºàÊ†πÊçÆÈúÄÊ±ÇÂÆöÂà∂Ôºâ
* ÊºîÁ§∫Ê∏≤ÊüìÔºàÈªòËÆ§Âä®ÁîªÈïøÂ∫¶‰∏∫ 20 ÁßíÂÜÖÔºâ

‚ñ† ‰∫§‰ªòÊ†ºÂºèÔºö FBX / Blender / mp4

### ‚ö†Ô∏è „Äêùêíùê©ùêûùêúùê¢ùêöùê• ùêçùê®ùê≠ùêûùê¨„ÄëÁâπÂà´ËØ¥Êòé
ÊéàÊùÉËåÉÂõ¥Ôºö‰ªÖÈôê‰∏™‰∫∫ÈùûÂïÜ‰∏öÂú∫ÊôØÔºàÂ¶ÇÂæÆ‰ø° / ÂæÆÂçö / ÊäñÈü≥Á≠âÁ§æ‰∫§ÂàÜ‰∫´„ÄÅÈùûÁõàÂà©‰∏™‰∫∫Â±ïÁ§∫ÔºâÔºõÂïÜÁî®Âú∫ÊôØÔºàÂìÅÁâåÂÆ£‰º†„ÄÅ‰∫ßÂìÅÊ§çÂÖ•„ÄÅ‰ªòË¥πÂÜÖÂÆπÁ≠âÔºâÈúÄÊèêÂâçÊ≤üÈÄöÔºåÊä•‰ª∑Èöè‰ΩøÁî®ËåÉÂõ¥ / Êó∂ÈïøË∞ÉÊï¥„ÄÇ

Ë¥πÁî®Ë°•ÂÖÖÔºöÂä®ÁîªË∂Ö 20 ÁßíÊàñÂÜÖÂÆπÂ§çÊùÇÂåñÔºàÂ¶ÇÁâπÊïà / Â§öËßíËâ≤‰∫íÂä®ÔºâÔºåÂ∞ÜÊåâÂ∑•‰ΩúÈáèËøΩÂä†Ë¥πÁî®ÔºåÂÖ∑‰Ωì‰ª•ÂèåÊñπÁ°ÆËÆ§Ê∏ÖÂçï‰∏∫ÂáÜ„ÄÇ

Âª∫ËÆÆÔºöÊèê‰æõÂ∞ΩÂèØËÉΩÊ∏ÖÊô∞ÁöÑÂèÇËÄÉÂõæÊàñÁÅµÊÑüÊñπÂêëÔºåÊúâÂä©‰∫éÊõ¥È´òÊïàËøòÂéü‰Ω†ÁöÑËßÜËßâÈúÄÊ±Ç„ÄÇ

### üìú„ÄêùêÇùê®ùê©ùê≤ùê´ùê¢ùê†ùê°ùê≠ ùêíùê≠ùêöùê≠ùêûùê¶ùêûùêßùê≠„ÄëÁâàÊùÉÁî≥Êòé
ÊâÄÊúâÊàêÊûúÔºàÊ®°Âûã / Âä®Áîª / Ê∫êÊñá‰ª∂Á≠âÔºâÁâàÊùÉÂΩíÊúçÂä°ÊñπÔºàüÖúÔºâÊâÄÊúâ„ÄÇ

ÂÆ¢Êà∑‰ªÖËé∑ÈùûÂïÜ‰∏ö‰ΩøÁî®ÊùÉÔºåÁ¶ÅÊ≠¢ÂïÜÁî®„ÄÅ‰∫åÊ¨°Âàõ‰Ωú„ÄÅËΩ¨ÂîÆÊàñÊéàÊùÉÁ¨¨‰∏âÊñπ„ÄÇ

ÈúÄÁâàÊùÉËΩ¨ËÆ©ÁöÑÔºåÂè¶Ë°åÁ≠æÁΩ≤ÂçèËÆÆÂπ∂ÊîØ‰ªòÂéüÊä•‰ª∑ 3-5 ÂÄçË¥πÁî®„ÄÇ

Ë∂ÖËåÉÂõ¥‰ΩøÁî®ÂºïÂèëÁöÑÁ∫†Á∫∑ÔºåÁî±ÂÆ¢Êà∑ÊâøÊãÖÂÖ®ÈÉ®Ë¥£‰ªª„ÄÇ

üÖú ÂçèËÆÆÁâàÊú¨Ôºö*ùòù1.2* | ‰∏ãÂçïÂç≥ËßÜ‰∏∫ÂêåÊÑèÂÖ®ÈÉ®ÂÜÖÂÆπ
                            `, // Now Markdown
                        },
                        {
                            id: 'poster-design-category',
                            name: 'Êµ∑Êä•ËÆæËÆ°ÊúçÂä°',
                            nameEn: 'Poster Design Service', // Added English name for title bar
                            shortDescription: 'Âπ≥Èù¢„ÄÅAIÂä®ÊÄÅ„ÄÅ3DÂèä3DÂä®ÊÄÅÊµ∑Êä•ËÆæËÆ°ÊúçÂä°„ÄÇ',
                            detailContent: `
### [Âπ≥Èù¢Êµ∑Êä• 500¬• / Âº†]
**‰ª∑Ê†ºÔºö** 500¬• / Âº†
Êèê‰æõÊ∫êÊñá‰ª∂ÂíåÊåáÂÆöÊ†ºÂºèÂíåÂ∞∫ÂØ∏ÁöÑÂõæÁâá

### [AIÂä®ÊÄÅÊµ∑Êä• 500¬• / Âº†]
**‰ª∑Ê†ºÔºö** 500¬• / Âº†
Êèê‰æõÊåáÂÆöÊ†ºÂºèÂíåÂ∞∫ÂØ∏ÁöÑËßÜÈ¢ëÂíåÂõæÁâá

### [3DÊµ∑Êä• 700¬•+/ Âº†]
**‰ª∑Ê†ºÔºö** 700¬•+ / Âº†
Êèê‰æõÊåáÂÆöÊ†ºÂºèÂíåÂ∞∫ÂØ∏ÁöÑÂõæÁâá

### [3DÂä®ÊÄÅÊµ∑Êä• 1000¬•+/ Âº†]
**‰ª∑Ê†ºÔºö** 1000¬•+ / Âº†
ÂèØÊèê‰æõÊåáÂÆöÊ†ºÂºèÂíåÂ∞∫ÂØ∏ÁöÑËßÜÈ¢ë

### üì¶ „ÄêùêíùêÑùêëùêïùêàùêÇùêÑ ùêÖùêãùêéùêñ & ùêÉùêÑùêãùêàùêïùêÑùêëùêò„ÄëÊúçÂä°ÊµÅÁ®ã‰∏é‰∫§‰ªòËØ¥Êòé
È°πÁõÆÂêØÂä®ÔºöÈ¢Ñ‰ªò50%ÁöÑËÆ¢ÈáëÂêéÂºÄÂßãËÆæËÆ°ÔºåÂ∑•ÊúüÁ∫¶ 1‚Äì2 Â§©/ Âº†

Â∞æÊ¨æÊîØ‰ªòÔºöËÆæËÆ°ÂÆöÁ®øÂπ∂ÁªèÁî≤ÊñπÁ°ÆËÆ§ÂêéÔºåÊîØ‰ªò50%ÁöÑÂ∞æÊ¨æ

ÊàêÊûú‰∫§‰ªòÔºöÊî∂Âà∞Â∞æÊ¨æÂêé‰∫§‰ªòÊúÄÁªàÊàêÂìÅÊñá‰ª∂

### üîÅ „ÄêùêëùêÑùêïùêàùêíùêàùêéùêç ùêëùêîùêãùêÑùêí & ùêÑùêóùêìùêëùêÄ ùêÖùêÑùêÑùêí„Äë‰øÆÊîπËßÑÂàô‰∏éË∂ÖÈ¢ùË¥πÁî®
Êèê‰æõ 3 Ê¨°ÂÖçË¥πÂü∫Á°ÄË∞ÉÊï¥Ë∞É + 1 Ê¨°ÂÖçË¥πÈáçÂ§ßË∞ÉÊï¥

Ë∂ÖÂá∫ÂÖçË¥πÂü∫Á°ÄË∞ÉÊï¥Ê¨°Êï∞ÂêéÔºåÊØèÊ¨°Âä†Êî∂ËÆæËÆ°Ë¥πÁöÑ 25%

Ë∂ÖÂá∫ÂÖçË¥πÈáçÂ§ßË∞ÉÊï¥Ê¨°Êï∞ÂêéÔºåÊØèÊ¨°Âä†Êî∂ËÆæËÆ°Ë¥πÁöÑ 50%

### üìå „ÄêùêíùêèùêÑùêÇùêàùêÄùêã ùêçùêéùêìùêÑùêí„ÄëÁâπÂà´ËØ¥Êòé
Âü∫Á°ÄË∞ÉÊï¥ÔºöÈôêÁªÜËäÇ‰ºòÂåñÔºàÂ¶ÇÊñáÂ≠ó‰øÆÊ≠£„ÄÅÈ¢úËâ≤ÂæÆË∞É„ÄÅÊéíÁâàÂ±ÄÈÉ®Ë∞ÉÊï¥Á≠âÔºâÔºå‰∏çÊ∂âÂèäÊ†∏ÂøÉÂàõÊÑèÊàñÊ°ÜÊû∂ÂèòÊõ¥

ÈáçÂ§ßË∞ÉÊï¥ÔºöÈôêÊ†∏ÂøÉÊñπÂêë‰ºòÂåñÔºàÂ¶ÇÊï¥‰ΩìÈ£éÊ†ºË∞ÉÊï¥„ÄÅÊ†∏ÂøÉÂÖÉÁ¥†ÊõøÊç¢Á≠âÔºâÔºå‰∏çÊ∂âÂèäÂÆåÂÖ®Êé®ÁøªÈáçËÆæËÆ°

Ë¥£‰ªªÁïåÂÆöÔºöÂõ†Áî≤ÊñπÈúÄÊ±ÇË°®Ëø∞‰∏çÊ∏Ö„ÄÅËµÑÊñô‰∏çÂÖ®ÊàñÂèçÂ§ç‰øÆÊîπÂØºËá¥ÁöÑÂ∑•ÊúüÂª∂ËØØÂèäÈ¢ùÂ§ñË∞ÉÊï¥ÔºåÁõ∏ÂÖ≥ÂêéÊûúÁî±Áî≤ÊñπÊâøÊãÖ

ÊïàÁéáÂª∫ËÆÆÔºöÊèê‰æõÊ∏ÖÊô∞ÂèÇËÄÉÂõæÊàñÁÅµÊÑüÊñπÂêëÔºåÂèØÂ§ßÂπÖÊèêÂçáËøòÂéüÁ≤æÂ∫¶‰∏éÊúçÂä°ÊïàÁéá

### üìú „ÄêùêÇùê®ùê©ùê≤ùê´ùê¢ùê†ùê°ùê≠ ùêíùê≠ùêöùê≠ùêûùê¶ùêûùêßùê≠„ÄëÁâàÊùÉÁî≥Êòé
ÊâÄÊúâÊàêÊûúÁü•ËØÜ‰∫ßÊùÉÂΩíÊúçÂä°ÊñπÔºàüÖúÔºâÊâÄÊúâ„ÄÇ

Áî≤ÊñπËé∑‰ªÖÈôêËØ• club Ëá™Ë∫´ÂÆ£‰º†ÁöÑÂïÜÁî®‰ΩøÁî®ÊùÉÔºàÂê´Á∫ø‰∏ãÂº†Ë¥¥„ÄÅÂÆòÊñπÁ§æ‰∫§Âπ≥Âè∞Êé®ÂπøÁ≠âÔºâÔºåÁ¶ÅÊ≠¢ËΩ¨ÂîÆÊàñÊéàÊùÉÁ¨¨‰∏âÊñπ„ÄÇ

ÁâàÊùÉËΩ¨ËÆ©ÈúÄÂè¶Á≠æÂçèËÆÆÂπ∂‰ªòË¥π„ÄÇ

Ë∂ÖËåÉÂõ¥‰ΩøÁî®ÂºïÂèëÁöÑÁ∫†Á∫∑ÔºåÁî±Áî≤ÊñπÊâøÊãÖË¥£‰ªª„ÄÇ

üÖú ÂçèËÆÆÁâàÊú¨Ôºö*ùòù1.2* | ‰∏ãÂçïÂç≥ËßÜ‰∏∫ÂêåÊÑèÂÖ®ÈÉ®ÂÜÖÂÆπ
                            `, // Now Markdown
                        },
                    ]
                },
                socialsTitle: 'Á§æ‰∫§Â™í‰Ωì‰∏éÁ§æÁæ§',
                socialsDescription: 'Ê¨¢ËøéÈÄöËøá‰ª•‰∏ãÂπ≥Âè∞ÊâæÂà∞ÊàëÔºåÂä†ÂÖ•ÊàëÁöÑËôöÊãüÂÆáÂÆôÔºö', // Now Markdown
                socialsLinks: [
                    { name: 'ÂæÆÂçö', url: 'https://weibo.com/yourprofile', iconAssetKey: 'icon_weibo', nameEn: 'Weibo' }, // Changed to iconAssetKey
                    { name: 'Instagram', url: 'https://www.instagram.com/yourprofile', iconAssetKey: 'icon_instagram', nameEn: 'Instagram' },
                    { name: 'ArtStation', url: 'https://www.artstation.com/yourprofile', iconAssetKey: 'icon_artstation', nameEn: 'ArtStation' },
                    { name: 'Behance', url: 'https://www.behance.net/yourprofile', iconAssetKey: 'icon_behance_square', nameEn: 'Behance' },
                    { name: 'Email', url: 'mailto:your.email@example.com', iconAssetKey: 'icon_envelope', nameEn: 'Email' }
                ],
                settings: { // New settings content
                    title: 'Á≥ªÁªüËÆæÁΩÆ',
                    titleEn: 'System Settings', // Added English title
                    description: 'Ë∞ÉÊï¥MAX OS‰ª•Êª°Ë∂≥ÊÇ®ÁöÑÂÅèÂ•ΩÔºö', // Now Markdown
                    options: [
                        { label: 'ÂêØÁî®Ê∑±Ëâ≤Ê®°Âºè (ÂæÖÂºÄÂèë)', labelEn: 'Enable Dark Mode (Coming Soon)', type: 'toggle', id: 'dark-mode-toggle', disabled: true },
                        { label: 'ÊòæÁ§∫Ê°åÈù¢ÂõæÊ†á', labelEn: 'Show Desktop Icons', type: 'toggle', id: 'desktop-icons-toggle', checked: true },
                        { label: 'ËØ≠Ë®ÄÂàáÊç¢', labelEn: 'Language Switch', type: 'language-toggle', id: 'language-toggle' },
                        { label: 'ÈáçÁΩÆÂ∏ÉÂ±Ä (ÂæÖÂºÄÂèë)', labelEn: 'Reset Layout (Coming Soon)', type: 'button', id: 'reset-layout-button', disabled: true }
                    ]
                }
            },
            'en': { // Added English content object for language switching
                systemName: 'MAX OS',
                systemVersion: 'Ver1.0',
                welcomeMessage: 'Welcome to MAX OS Virtual Universe Terminal',
                startButton: 'Start',
                profileName: 'MAZKO',
                worksIcon: 'Works',
                charactersIcon: 'Characters',
                mazkoExeIcon: 'MAZKO',
                servicesIcon: 'Services',
                socialsIcon: 'Socials',
                settingsIcon: 'Settings',
                worksMenuItem: 'Works',
                charactersMenuItem: 'Characters',
                servicesMenuItem: 'Services & Pricing',
                socialsMenuItem: 'Social Media',
                settingsMenuItem: 'Settings',
                languageMenuItem: 'Language',
                shutdownMenuItem: 'Shutdown',
                shutdownMessage: 'Thank you for visiting, MAX OS Virtual Universe Terminal is safely exiting.',
                loadingMessage: 'Loading...',
                errorLoadingContent: 'Failed to load content:',
                unknownModule: 'Error: Unknown module.',
                worksTitle: 'My Works',
                worksClickPrompt: 'Click on a work card to view details...',
                worksDetailsSuffix: ' - Details',
                charactersTitle: 'Character Design',
                charactersDescription: 'Explore my unique PSX game style cartoon characters.',
                aboutTitle: 'About MAZKO',
                aboutContent: `
I am a 3D artist and graphic designer from China, specializing in PSX game-style cartoon modeling and low-poly retro pixel textures. I also immerse myself in multidisciplinary creative work that fuses underground club culture with avant-garde visuals.

Obsessed with all aesthetic languages that break conventions ‚Äì from the visual intensity in ASAP Rocky's MV "Tailor Swift," to the absurd character designs in "Dorohedoro," to the dimensional chaos of "Rick and Morty," I inject cultural genes like anime narratives, street hip-hop, and retro sci-fi into my work, constructing a unique visual system with pixel particles and low-poly models.

I am proficient in Blender, Substance Painter, Zbrush, Photoshop, and Illustrator, covering various fields such as character design, CG animation, posters, VJ, virtual fashion, and LOGO design.
                `,
                services: {
                    title: 'Services & Pricing',
                    description: 'Below are my main services and estimated pricing ranges:',
                    categories: [
                        {
                            id: 'character-modeling-category',
                            name: 'Character Modeling Service',
                            nameEn: 'Character Modeling Service',
                            shortDescription: 'Low-poly character modeling and retro animation services.',
                            detailContent: `
### üë§„Äêùêãùê®ùê∞-ùêèùê®ùê•ùê≤ ùêÇùê°ùêöùê´ùêöùêúùê≠ùêûùê´ ùêåùê®ùêùùêûùê•ùê¢ùêßùê†„ÄëLow-Poly Character Modeling
**Price:** 500¬•+ / person
I will provide low-poly modeling and design for your characters!

#### ‚ñ∑ Basic Service Content:
* Character modeling (low-poly)
* Simple rigging
* Render video export

‚ñ† Deliverable Formats: FBX / Blender / mp4

### üï∫„Äêùêëùêûùê≠ùê´ùê® ùêÄùêßùê¢mùêöùê≠ùê¢ùê®ùêß ùêåùê®ùêùùêÆùê•ùêû„ÄëLow-Poly Character Retro Animation
**Price:** 1000¬•+ / item
I will provide complete low-poly character animation services. This includes modeling, rigging, motion design, and render export, suitable for demo reels, social media character showcases, retro scene ambiance rendering, etc.

#### ‚ñ∑ Basic Service Content:
* Character modeling + skeletal animation setup
* Scene construction (customized according to requirements)
* Demo rendering (default animation length within 20 seconds)

‚ñ† Deliverable Formats: FBX / Blender / mp4

### ‚ö†Ô∏è „Äêùêíùê©ùêûùêúùê¢ùêöùê• ùêçùê®ùê≠ùêûùê¨„Äë
Authorization Scope: Limited to personal non-commercial use (e.g., WeChat / Weibo / Douyin social sharing, non-profit personal display); Commercial use (brand promotion, product placement, paid content, etc.) requires prior communication, and pricing will be adjusted according to usage scope / duration.

Additional Costs: Animations exceeding 20 seconds or with increased complexity (e.g., special effects / multi-character interaction) will incur additional fees based on workload, subject to mutual confirmation.

Suggestion: Providing clear reference images or inspirational directions will help to efficiently achieve your visual requirements.

### üìú„ÄêùêÇùê®ùê©ùê≤ùê´ùê¢ùê†ùê°ùê≠ ùêíùê≠ùêöùê≠ùêûùê¶ùêûùêßùê≠„Äë
All deliverables (models / animations / source files, etc.) copyright belongs to the service provider (üÖú).

The client only obtains non-commercial usage rights, and is prohibited from commercial use, secondary creation, resale, or authorization to third parties.

For copyright transfer, a separate agreement must be signed, and 3-5 times the original quoted fee must be paid.

The client shall be responsible for disputes arising from unauthorized use beyond the scope.

üÖú Agreement Version: *ùòù1.2* | Placing an order is deemed acceptance of all content.
                            `,
                        },
                        {
                            id: 'poster-design-category',
                            name: 'Poster Design Service',
                            nameEn: 'Poster Design Service',
                            shortDescription: '2D, AI dynamic, 3D, and 3D dynamic poster design services.',
                            detailContent: `
### [2D Poster 500¬• / piece]
**Price:** 500¬• / piece
Provides source files and images in specified formats and sizes.

### [AI Dynamic Poster 500¬• / piece]
**Price:** 500¬• / piece
Provides videos and images in specified formats and sizes.

### [3D Poster 700¬•+ / piece]
**Price:** 700¬•+ / piece
Provides images in specified formats and sizes.

### [3D Dynamic Poster 1000¬•+ / piece]
**Price:** 1000¬•+ / piece
Provides videos in specified formats and sizes.

### üì¶ „ÄêùêíùêÑùêëùêïùêàùêÇùêÑ ùêÖùêãùêéùêñ & ùêÉùêÑùêãùêàùêïùêÑùêëùêò„ÄëService Process & Delivery Instructions
Project Start: Design begins upon receipt of a 50% deposit, with a turnaround time of approximately 1‚Äì2 days per piece.

Final Payment: Upon design finalization and client confirmation, the remaining 50% payment is due.

Deliverables: Final product files are delivered upon receipt of the final payment.

### üîÅ „ÄêùêëùêÑùêïùêàùêíùêàùêéùêç ùêëùêîùêãùêÑùêí & ùêÑùêóùêìùêëùêÄ ùêÖùêÑùêÑùêí„ÄëRevision Rules & Extra Fees
Includes 3 free basic revisions + 1 free major revision.

After exceeding the free basic revision limit, each additional basic revision will incur a 25% surcharge of the design fee.

After exceeding the free major revision limit, each additional major revision will incur a 50% surcharge of the design fee.

### üìå „ÄêùêíùêèùêÑùêÇùêàùêÄùêã ùêçùêéùêìùêÑùêí„Äë
Basic Revisions: Limited to minor adjustments (e.g., text corrections, slight color adjustments, minor layout changes), not involving core creative or structural changes.

Major Revisions: Limited to core direction adjustments (e.g., overall style adjustment, core element replacement), not involving complete redesign.

Responsibility: Delays in project timeline and additional revisions caused by unclear client requirements, incomplete information, or repeated changes shall be borne by the client.

Efficiency Tip: Providing clear reference images or inspirational directions can significantly improve accuracy and service efficiency.

### üìú „ÄêùêÇùê®ùê©ùê≤ùê´ùê¢ùê†ùê°ùê≠ ùêíùê≠ùêöùê≠ùêûmùêûùêßùê≠„Äë
All intellectual property rights of the deliverables belong to the service provider (üÖú).

The client is granted commercial use rights strictly for their own club's promotion (including offline display, official social media promotion, etc.), and is prohibited from resale or authorization to third parties.

For copyright transfer, a separate agreement must be signed and paid for.

The client shall be responsible for any disputes arising from unauthorized use beyond the scope.

üÖú Agreement Version: *ùòù1.2* | Placing an order is deemed acceptance of all content.
                            `,
                        },
                    ],
                },
                socialsTitle: 'Social Media & Community',
                socialsDescription: 'Find me on the following platforms and join my virtual universe:',
                socialsLinks: [
                    { name: 'Weibo', url: 'https://weibo.com/yourprofile', iconAssetKey: 'icon_weibo', nameEn: 'Weibo' }, // Changed to iconAssetKey
                    { name: 'Instagram', url: 'https://www.instagram.com/yourprofile', iconAssetKey: 'icon_instagram', nameEn: 'Instagram' },
                    { name: 'ArtStation', url: 'https://www.artstation.com/yourprofile', iconAssetKey: 'icon_artstation', nameEn: 'ArtStation' },
                    { name: 'Behance', url: 'https://www.behance.net/yourprofile', iconAssetKey: 'icon_behance_square', nameEn: 'Behance' },
                    { name: 'Email', url: 'mailto:your.email@example.com', iconAssetKey: 'icon_envelope', nameEn: 'Email' }
                ],
                settings: {
                    title: 'System Settings',
                    titleEn: 'System Settings',
                    description: 'Adjust MAX OS to your preferences:',
                    options: [
                        { label: 'Enable Dark Mode (Coming Soon)', labelEn: 'Enable Dark Mode (Coming Soon)', type: 'toggle', id: 'dark-mode-toggle', disabled: true },
                        { label: 'Show Desktop Icons', labelEn: 'Show Desktop Icons', type: 'toggle', id: 'desktop-icons-toggle', checked: true },
                        { label: 'Language Switch', labelEn: 'Language Switch', type: 'language-toggle', id: 'language-toggle' },
                        { label: 'Reset Layout (Coming Soon)', labelEn: 'Reset Layout (Coming Soon)', type: 'button', id: 'reset-layout-button', disabled: true }
                    ]
                }
            }
        };

        let currentLanguage = 'zh'; // Moved declaration outside DOMContentLoaded

        document.addEventListener('DOMContentLoaded', () => {
            console.log('Script started parsing.'); // Added for debugging
            
            // JavaScript for dynamic elements (e.g., time display)
            function updateTime() {
                const now = new Date();
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const timeElement = document.getElementById('current-time');
                if (timeElement) {
                    timeElement.textContent = `${hours}:${minutes}`;
                } else {
                    console.warn('Time element not found.');
                }
            }

            // Update time every minute
            setInterval(updateTime, 60000); // Update every minute for HH:MM
            // Initial call to display time immediately
            updateTime();

            // Get elements for the desktop environment
            const startButton = document.getElementById('start-button-taskbar');
            const startMenu = document.getElementById('start-menu');
            const startMenuHeader = document.querySelector('.start-menu-header'); // Get the header
            const mainDesktopArea = document.getElementById('main-desktop-area');
            const welcomeMessage = document.getElementById('welcome-message');
            let welcomeMessageText = document.getElementById('welcome-message-text'); 
            const taskbarIconsContainer = document.getElementById('taskbar-icons');
            const desktopIconsContainer = document.getElementById('desktop-icons-container');
            const desktopBackground = document.getElementById('desktop-background'); // Get desktop background element
            let highestZIndex = 5; // To manage window stacking order

            // Store references to open windows to re-render them on language change
            const openWindowsMap = new Map(); // Map<windowId, {section, chineseTitle, englishTitle, windowElement}>

            console.log('Core DOM elements and variables initialized.');

            /**
             * @function updateCursors
             * @description Ê†πÊçÆ ASSETS ‰∏≠ÂÆö‰πâÁöÑÂÖâÊ†áË∑ØÂæÑÂä®ÊÄÅÊõ¥Êñ∞ CSS Ëá™ÂÆö‰πâÂ±ûÊÄßÔºå‰ªéËÄåÊîπÂèòÂÖâÊ†áÊ†∑Âºè„ÄÇ
             */
            function updateCursors() {
                const root = document.documentElement;
                root.style.setProperty('--cursor-default', `url('${getAssetUrl('cursor_default')}'), auto`);
                root.style.setProperty('--cursor-active', `url('${getAssetUrl('cursor_active')}'), auto`);
                root.style.setProperty('--cursor-pointer', `url('${getAssetUrl('cursor_pointer')}'), auto`);
                console.log('Custom cursors updated.');
            }

            /**
             * @function renderDynamicAssets
             * @description ÈÅçÂéÜÊâÄÊúâÂ∏¶Êúâ data-asset-key Â±ûÊÄßÁöÑÂç†‰ΩçÁ¨¶ÂÖÉÁ¥†ÔºåÂπ∂Áî® <img> Ê†áÁ≠æÊõøÊç¢ÂÆÉ‰ª¨ÔºåÂä†ËΩΩÂØπÂ∫îÁöÑÂõæÁâá„ÄÇ
             */
            function renderDynamicAssets() {
                document.querySelectorAll('.icon-placeholder[data-asset-key]').forEach(placeholder => {
                    const assetKey = placeholder.dataset.assetKey;
                    const iconUrl = getAssetUrl(assetKey);
                    if (iconUrl) {
                        // Â¶ÇÊûú placeholder Â∑≤ÁªèÊúâÂõæÁâáÔºåÈÅøÂÖçÈáçÂ§çÊ∑ªÂä†
                        if (placeholder.querySelector('img')) {
                            placeholder.querySelector('img').src = iconUrl;
                        } else {
                            const img = document.createElement('img');
                            img.src = iconUrl;
                            img.alt = assetKey.replace('icon_', '').replace(/_/g, ' '); // ÁÆÄÂçïÁöÑ alt ÊñáÊú¨
                            img.classList.add('icon-image'); // Â∫îÁî® CSS ‰∏≠ÂÆö‰πâÁöÑÈÄöÁî®ÂõæÊ†áÊ†∑Âºè
                            placeholder.innerHTML = ''; // Ê∏ÖÈô§‰ªª‰ΩïÁé∞ÊúâÂÜÖÂÆπ
                            placeholder.appendChild(img);
                        }
                    } else {
                        console.warn(`Asset not found for key: ${assetKey}`);
                        // Â¶ÇÊûúÊâæ‰∏çÂà∞ËµÑ‰∫ßÔºåÂèØ‰ª•ÊòæÁ§∫‰∏Ä‰∏™ÈªòËÆ§ÁöÑÁ†¥Á¢éÂõæÊ†áÔºåÊàñ‰øùÊåÅ‰∏∫Á©∫
                        placeholder.innerHTML = '‚ö†Ô∏è';
                    }
                });

                // Ê£ÄÊü•Âπ∂ËÆæÁΩÆÊ°åÈù¢ËÉåÊôØÂõæÁâáÔºàÂ¶ÇÊûú ASSETS ‰∏≠ÊúâÂÆö‰πâÔºâ
                const desktopBgImage = getAssetUrl('desktop_background_image');
                if (desktopBgImage && desktopBackground) {
                    desktopBackground.style.backgroundImage = `url('${desktopBgImage}')`;
                    desktopBackground.style.opacity = '1'; // ÂèØËÉΩÈúÄË¶ÅË∞ÉÊï¥‰∏çÈÄèÊòéÂ∫¶ÔºåÂ¶ÇÊûúÂõæÁâáÊú¨Ë∫´Â∑≤ÁªèÊúâÂÖâÊÑü
                    desktopBackground.style.filter = 'none'; // Â¶ÇÊûúËÉåÊôØÂõæÁâáËá™Â∏¶ÊïàÊûúÔºåÂèØ‰ª•ÁßªÈô§Êª§Èïú
                    console.log('Desktop background image applied.');
                }
            }


            // Function to update all UI text based on currentLanguage
            function updateUIForLanguage() {
                const langData = LANG_CONTENT[currentLanguage];

                // Update welcome message
                if (welcomeMessageText) {
                    welcomeMessageText.textContent = langData.welcomeMessage;
                }

                // Update Start Menu header profile name
                const profileNameElement = startMenu.querySelector('[data-lang-key="profileName"]');
                if (profileNameElement) {
                    profileNameElement.textContent = langData.profileName;
                }

                // Update Desktop Icons
                document.querySelectorAll('.desktop-icon').forEach(icon => {
                    const langKey = icon.querySelector('.desktop-icon-label').dataset.langKey;
                    if (langKey && langData[langKey]) {
                        icon.querySelector('.desktop-icon-label').textContent = langData[langKey];
                    }
                    // Update data-title for window opening (using current language for display, but keep zh/en for internal)
                    icon.dataset.title = icon.dataset[`title-${currentLanguage}`];
                });

                // Update Start Menu Items (links and buttons)
                document.querySelectorAll('.start-menu-item').forEach(item => {
                    const langKey = item.dataset.langKey;
                    const chineseLabel = LANG_CONTENT['zh'][langKey]; 
                    const englishLabel = LANG_CONTENT['en'][langKey]; 

                    const labelSpan = item.querySelector('.menu-item-label');
                    if (labelSpan) {
                        labelSpan.textContent = `${chineseLabel} [${englishLabel}]`; 
                    }
                });

                // Update Start Menu Footer Buttons (now icon-only)
                document.querySelectorAll('.start-menu-footer-button').forEach(button => {
                    const langKey = button.dataset.langKey;
                    if (langKey && langData[langKey]) {
                        button.title = langData[langKey];
                    }
                });
                
                // Re-open/re-render all active windows
                reopenAllWindows();
                // Re-render all dynamic assets (icons) for current language
                renderDynamicAssets();
            }

            // Function to get window titles (Chinese and English) based on section and currentWork/currentCategory
            function getWindowTitles(section, currentWork = null, currentCategory = null) {
                let chineseTitle = LANG_CONTENT[currentLanguage]?.unknownModule || 'Untitled Window';
                let englishTitle = LANG_CONTENT['en']?.unknownModule || 'Untitled Window';

                if (section.startsWith('work-detail-') && currentWork) {
                    chineseTitle = currentWork.title + (LANG_CONTENT[currentLanguage]?.worksDetailsSuffix || '');
                    englishTitle = currentWork.title + (LANG_CONTENT['en']?.worksDetailsSuffix || ''); 
                } else if (section.startsWith('service-category-') && currentCategory) {
                    chineseTitle = currentCategory.name;
                    englishTitle = currentCategory.nameEn || currentCategory.name; // Use nameEn if available, otherwise fallback
                } else {
                    // For main sections, use data-title-zh and data-title-en from desktop icons or menu items
                    const desktopIcon = document.querySelector(`.desktop-icon[data-section="${section}"]`);
                    const startMenuItem = document.querySelector(`.start-menu-item[data-section="${section}"]`);
                    const startMenuFooterButton = document.querySelector(`.start-menu-footer-button[data-section="${section}"]`);
                    const startMenuHeader = document.querySelector('.start-menu-header[data-section="about"]'); // For about section

                    if (desktopIcon) {
                        chineseTitle = desktopIcon.dataset.titleZh;
                        englishTitle = desktopIcon.dataset.titleEn;
                    } else if (startMenuItem) {
                        chineseTitle = LANG_CONTENT['zh'][`${section}MenuItem`]; 
                        englishTitle = LANG_CONTENT['en'][`${section}MenuItem`]; 
                    } else if (startMenuFooterButton) {
                        chineseTitle = LANG_CONTENT['zh'][`${section}MenuItem`]; 
                        englishTitle = LANG_CONTENT['en'][`${section}MenuItem`]; 
                    } else if (section === 'about' && startMenuHeader) {
                        chineseTitle = startMenuHeader.dataset.titleZh;
                        englishTitle = startMenuHeader.dataset.titleEn;
                    } else if (section === 'settings') {
                        chineseTitle = LANG_CONTENT['zh']?.settings?.title; 
                        englishTitle = LANG_CONTENT['en']?.settings?.title; 
                    } else if (section === 'shutdown') {
                        chineseTitle = LANG_CONTENT['zh']?.shutdownMenuItem; 
                        englishTitle = LANG_CONTENT['en']?.shutdownMenuItem; 
                    }
                }
                return { chineseTitle, englishTitle };
            }


            // Function to re-open all currently open windows to update their content
            async function reopenAllWindows() {
                // Get a snapshot of currently open windows and their original positions/sizes
                const activeWindowsData = [];
                document.querySelectorAll('.os-window').forEach(win => {
                    // Only re-open if not minimized, as minimized state will be re-applied
                    if (!win.classList.contains('minimized')) {
                        activeWindowsData.push({
                            section: win.dataset.section,
                            windowId: win.dataset.windowId,
                            originalLeft: win.dataset.originalLeft,
                            originalTop: win.dataset.originalTop,
                            originalWidth: win.dataset.originalWidth,
                            originalHeight: win.dataset.originalHeight,
                            isMaximized: win.classList.contains('maximized')
                        });
                        win.remove(); // Remove old window
                    }
                });
                // Clear taskbar icons for removed windows
                taskbarIconsContainer.innerHTML = '';

                // Re-open windows one by one
                for (const winData of activeWindowsData) {
                    const data = await fetchContent(winData.section); // Re-fetch content in new language
                    let contentHTML = '';
                    let isMarkdown = false;
                    let currentWork = null;
                    let currentCategory = null;

                    if (winData.section.startsWith('work-detail-')) {
                        const workId = winData.windowId.replace('work-detail-', '');
                        const worksData = await fetchContent('works'); // Re-fetch works data to find the work
                        currentWork = worksData.find(w => w.id === workId);
                    } else if (winData.section.startsWith('service-category-')) {
                        const categoryId = winData.windowId.replace('service-category-', '');
                        // Get category directly from LANG_CONTENT as it's static
                        currentCategory = LANG_CONTENT[currentLanguage]?.services?.categories.find(cat => cat.id === categoryId);
                    }

                    const { chineseTitle, englishTitle } = getWindowTitles(winData.section, currentWork, currentCategory);

                    // Re-generate content based on section and new language
                    switch (winData.section) {
                        case 'works':
                            contentHTML = `
                                <h2 class="text-xl font-bold mb-4">${chineseTitle}</h2>
                                <div class="works-grid">
                                    ${data?.map(work => `
                                        <div class="work-card" data-work-id="${work.id}">
                                            <img src="${work.thumbnail}" alt="${work.title}">
                                            <div class="work-card-title">${work.title}</div>
                                            <div class="work-card-category">${work.category}</div>
                                        </div>
                                    `).join('')}
                                </div>
                                <p class="mt-4 opacity-70 text-center">${LANG_CONTENT[currentLanguage]?.worksClickPrompt}</p>
                            `;
                            break;
                        case 'characters':
                            contentHTML = `
                                <h2 class="text-xl font-bold mb-4">${chineseTitle}</h2>
                                <p>${LANG_CONTENT[currentLanguage]?.charactersDescription}</p>
                                <div class="grid grid-cols-2 gap-4 mt-4">
                                    ${data?.map(char => `
                                        <div class="flex flex-col items-center">
                                            <img src="${char.image}" alt="${char.name}" class="rounded-lg shadow-md mb-2">
                                            <p class="font-bold">${char.name}</p>
                                            <p class="text-sm opacity-80 text-center">${char.description}</p>
                                        </div>
                                    `).join('')}
                                </div>
                            `;
                            break;
                        case 'about':
                            contentHTML = LANG_CONTENT[currentLanguage]?.aboutContent;
                            isMarkdown = true;
                            break;
                        case 'services':
                            contentHTML = marked.parse(LANG_CONTENT[currentLanguage]?.services?.description || '') + `
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                                    ${data?.categories.map(category => `
                                        <div class="service-category-card p-4 rounded-lg border border-primary-blue hover:bg-glass-bg cursor-pointer transition-all duration-200" data-category-id="${category.id}">
                                            <h3 class="font-bold text-lg text-light-blue">${category.name}</h3>
                                            <p class="text-sm opacity-80 mt-1">${category.shortDescription}</p>
                                        </div>
                                    `).join('')}
                                </div>
                            `;
                            break;
                        case 'socials':
                            contentHTML = marked.parse(LANG_CONTENT[currentLanguage]?.socialsDescription || '') + `
                                <div class="flex flex-wrap gap-4 mt-4">
                                    ${data?.links.map(link => `
                                        <a href="${link.url}" target="_blank" class="flex items-center space-x-2 text-white hover:text-primary-blue transition-colors">
                                            <span class="icon-placeholder w-6 h-6" data-asset-key="${link.iconAssetKey}"></span>
                                            <span>${link.name}</span>
                                        </a>
                                    `).join('')}
                                </div>
                            `;
                            break;
                        case 'settings': // New case for settings window
                            contentHTML = marked.parse(LANG_CONTENT[currentLanguage]?.settings?.description || '') + `
                                <div class="flex flex-col gap-4 mt-4">
                                    ${data?.options.map(option => {
                                        const labelText = LANG_CONTENT[currentLanguage]?.settings?.options.find(opt => opt.id === option.id)?.label || option.label; 
                                        if (option.type === 'toggle') {
                                            return `
                                                <div class="flex items-center justify-between p-3 rounded-lg bg-white bg-opacity-5 border border-white border-opacity-20">
                                                    <label for="${option.id}" class="text-lg">${labelText}</label>
                                                    <label class="toggle-switch">
                                                        <input type="checkbox" id="${option.id}" ${option.checked ? 'checked' : ''} ${option.disabled ? 'disabled' : ''}>
                                                        <span class="toggle-slider round"></span>
                                                    </label>
                                                </div>
                                            `;
                                        } else if (option.type === 'language-toggle') {
                                            return `
                                                <div class="flex items-center justify-between p-3 rounded-lg bg-white bg-opacity-5 border border-white border-opacity-20">
                                                    <span class="text-lg">${labelText}</span>
                                                    <label class="toggle-switch">
                                                        <input type="checkbox" id="${option.id}" ${currentLanguage === 'en' ? 'checked' : ''}>
                                                        <span class="toggle-slider round"></span>
                                                    </label>
                                                </div>
                                            `;
                                        } else if (option.type === 'button') {
                                            return `
                                                <button id="${option.id}" class="py-2 px-4 rounded-lg bg-primary-blue hover:bg-dark-blue transition-colors text-white font-bold ${option.disabled ? 'opacity-50 cursor-not-allowed' : ''}" ${option.disabled ? 'disabled' : ''}>
                                                    ${labelText}
                                                </button>
                                            `;
                                        }
                                        return '';
                                    }).join('')}
                                </div>
                            `;
                            break;
                        case 'service-category-character-modeling-category': 
                        case 'service-category-poster-design-category':
                            contentHTML = currentCategory ? currentCategory.detailContent : `<p class="text-xl text-red-400">${LANG_CONTENT[currentLanguage]?.unknownModule}</p>`;
                            isMarkdown = true;
                            break;
                        case 'work-detail-' + winData.windowId.replace('work-detail-', ''):
                            if (currentWork) {
                                let currentImageIndex = 0; // This state is lost on re-render, will default to 0
                                contentHTML = `
                                    <div class="work-detail-content">
                                        <div class="gallery-main-image-container">
                                            <img src="${currentWork.images[currentImageIndex]}" alt="${currentWork.title}" class="gallery-main-image">
                                            ${currentWork.images.length > 1 ? `
                                                <button class="gallery-nav-button prev" data-direction="prev"><span class="icon-placeholder" data-asset-key="icon_chevron_left"></span></button>
                                                <button class="gallery-nav-button next" data-direction="next"><span class="icon-placeholder" data-asset-key="icon_chevron_right"></span></button>
                                            ` : ''}
                                        </div>
                                        ${currentWork.images.length > 1 ? `
                                            <div class="gallery-thumbnails">
                                                ${currentWork.images.map((imgSrc, index) => `
                                                    <img src="${imgSrc}" alt="${currentWork.title} thumbnail ${index + 1}" class="gallery-thumbnail ${index === currentImageIndex ? 'active' : ''}" data-index="${index}">
                                                `).join('')}
                                            </div>
                                        ` : ''}
                                        <h3>${currentWork.title}</h3>
                                        <p class="text-sm opacity-90 mb-2">${currentWork.category}</p>
                                        <p>${currentWork.description}</p>
                                        <div class="flex flex-wrap gap-2 mt-4">
                                            ${currentWork.tags.map(tag => `<span class="category-tag">${tag}</span>`).join('')}
                                        </div>
                                    </div>
                                `;
                            } else {
                                contentHTML = `<p class="text-xl text-red-400">${LANG_CONTENT[currentLanguage]?.unknownModule}</p>`;
                            }
                            break;
                        default:
                            contentHTML = `<p class="text-xl text-red-400">${LANG_CONTENT[currentLanguage]?.unknownModule || 'Unknown Module'}</p>`;
                    }

                    // Re-open the window with its original properties
                    const newWindowElement = await openWindow(winData.section, chineseTitle, englishTitle, contentHTML, winData.windowId, {
                        left: winData.originalLeft,
                        top: winData.originalTop,
                        width: winData.originalWidth,
                        height: winData.originalHeight
                    }, isMarkdown);

                    if (winData.isMaximized) {
                        newWindowElement.classList.add('maximized');
                        // Re-apply maximized styles if necessary, or let CSS handle it
                        newWindowElement.style.borderRadius = '0';
                        newWindowElement.style.boxShadow = 'none';
                    }
                }
            }


            // --- Desktop Icon Positioning Logic ---
            // Function to position desktop icons in a regular grid
            function positionDesktopIcons() {
                const iconWidth = 80; // Defined in CSS .desktop-icon width
                const iconHeight = 100; // Approximate height including label and padding
                const paddingX = 20; // Horizontal padding from desktop edge
                const paddingY = 20; // Vertical padding from desktop edge
                const gapX = 20; // Gap between icons horizontally
                const gapY = 20; // Gap between icons vertically

                const icons = Array.from(desktopIconsContainer.children);
                let currentX = paddingX;
                let currentY = paddingY;
                let column = 0;

                icons.forEach((icon, index) => {
                    // Check if icon fits in current column, otherwise move to next column
                    if (currentY + iconHeight > mainDesktopArea.clientHeight - (paddingY + 10)) { // Add small buffer for taskbar
                        column++;
                        currentX = paddingX + (column * (iconWidth + gapX));
                        currentY = paddingY;
                    }

                    icon.style.left = `${currentX}px`;
                    icon.style.top = `${currentY}px`;
                    currentY += (iconHeight + gapY);
                });
            }

            // Call positioning function initially and on window resize
            positionDesktopIcons();
            window.addEventListener('resize', positionDesktopIcons);

            console.log('Desktop icon positioning logic initialized.');

            // --- Mock Data Fetching (Simulating Headless CMS API Calls) ---
            // In a real application, these would be actual fetch() calls to your CMS API endpoints.

            // Function to simulate fetching data
            async function fetchContent(section) {
                console.log(`Fetching content for: ${section} in language: ${currentLanguage}...`);
                // Simulate network delay
                await new Promise(resolve => setTimeout(resolve, 300)); 

                const langData = LANG_CONTENT[currentLanguage];
                let data = null;

                switch (section) {
                    case 'works':
                        data = [
                            {
                                id: 'work-001',
                                title: 'Âú∞‰∏ã‰ø±‰πêÈÉ®Âú∫ÊôØ',
                                category: 'Âú∫ÊôØËÆæËÆ° / PSXÈ£éÊ†º',
                                thumbnail: 'https://placehold.co/400x300/00BFFF/FFFFFF?text=Scene+1', // Updated to use placeholder
                                images: [
                                    'https://placehold.co/800x600/00BFFF/FFFFFF?text=Scene+Full+1',
                                    'https://placehold.co/800x600/007ACC/FFFFFF?text=Scene+Full+2',
                                    'https://placehold.co/800x600/CCEEFF/000000?text=Scene+Full+3'
                                ],
                                description: '‰∏Ä‰∏™ÂÖÖÊª°ÈúìËôπÁÅØÂíå‰ΩéÂ§öËæπÂΩ¢ÂÖÉÁ¥†ÁöÑÂú∞‰∏ã‰ø±‰πêÈÉ®Âú∫ÊôØÔºåËûçÂêà‰∫ÜY2KÂíåÊïÖÈöúÁæéÂ≠¶„ÄÇ',
                                tags: ['Âú∫ÊôØ', 'PSX', 'Y2K', 'Blender']
                            },
                            {
                                id: 'work-002',
                                title: 'ËµõÂçöÊúãÂÖãËßíËâ≤ - KAI',
                                category: 'ËßíËâ≤ËÆæËÆ° / Lowpoly',
                                thumbnail: 'https://placehold.co/400x300/00BFFF/FFFFFF?text=Character+1', // Updated to use placeholder
                                images: [
                                    'https://placehold.co/800x600/00BFFF/FFFFFF?text=Character+Full+1',
                                    'https://placehold.co/800x600/007ACC/FFFFFF?text=Character+Full+2',
                                    'https://placehold.co/800x600/CCEEFF/000000?text=Character+Full+3'
                                ],
                                description: '‰∏Ä‰∏™ÂÖ∑ÊúâÂ§çÂè§ÁßëÂπªÊÑüÁöÑËµõÂçöÊúãÂÖãËßíËâ≤ÔºåÈááÁî®‰ΩéÂ§öËæπÂΩ¢Âª∫Ê®°ÂíåÂÉèÁ¥†Ë¥®ÊÑüÁ∫πÁêÜ„ÄÇ',
                                tags: ['ËßíËâ≤', 'Lowpoly', 'ËµõÂçöÊúãK', 'Substance Painter']
                            }
                        ];
                        break;
                    case 'characters':
                        data = [
                            {
                                id: 'char-001',
                                name: 'ÊòüÈôÖÊº´Ê∏∏ËÄÖ',
                                description: '‰∏Ä‰∏™Â≠§Áã¨ÁöÑÊòüÈôÖÊóÖË°åËÄÖÔºåÊé¢Á¥¢ÂÆáÂÆôÊ∑±Â§ÑÁöÑÂ••Áßò„ÄÇPSXÈ£éÊ†ºÔºå‰ΩéÂ§öËæπÂΩ¢ËÆæËÆ°„ÄÇ',
                                image: 'https://placehold.co/200x200/00BFFF/FFFFFF?text=Character+A' // Updated to use placeholder
                            },
                            {
                                id: 'char-002',
                                name: 'ÈÉΩÂ∏ÇÂøçËÄÖ',
                                description: 'Á©øÊ¢≠‰∫éÈúìËôπÈÉΩÂ∏ÇÈò¥ÂΩ±‰∏≠ÁöÑÁ•ûÁßòÂøçËÄÖ„ÄÇ',
                                image: 'https://placehold.co/200x200/007ACC/FFFFFF?text=Character+B' // Updated to use placeholder
                            }
                        ];
                        break;
                    case 'about':
                        data = {
                            title: langData.aboutTitle,
                            content: langData.aboutContent
                        };
                        break;
                    case 'services':
                        data = {
                            title: langData.services.title,
                            description: langData.services.description,
                            categories: langData.services.categories
                        };
                        break;
                    case 'socials':
                        data = {
                            title: langData.socialsTitle,
                            description: langData.socialsDescription,
                            links: langData.socialsLinks
                        };
                        break;
                    case 'settings': // New case for settings
                        data = langData.settings;
                        break;
                    case 'shutdown':
                        data = null; // No specific data needed for shutdown
                        break;
                    default:
                        data = null;
                }
                console.log(`Content fetched for ${section}:`, data);
                return data;
            }

            // Function to manage active taskbar icons
            function setActiveTaskbarIcon(windowId) {
                document.querySelectorAll('.taskbar-minimized-icon').forEach(icon => {
                    if (icon.dataset.windowId === windowId) {
                        icon.classList.add('active');
                    } else {
                        icon.classList.remove('active');
                    }
                });
            }

            // Function to bring a window to the front
            function bringToFront(windowElement) {
                highestZIndex++;
                windowElement.style.zIndex = highestZIndex;
                console.log(`Window "${windowElement.dataset.windowId}" brought to front. New z-index: ${highestZIndex}`);
                setActiveTaskbarIcon(windowElement.dataset.windowId); // Set its taskbar icon as active
                // Also set window title bar to active style
                document.querySelectorAll('.os-window-title-bar').forEach(bar => bar.classList.add('inactive'));
                const titleBar = windowElement.querySelector('.os-window-title-bar');
                if (titleBar) {
                    titleBar.classList.remove('inactive');
                }
            }

            // Function to create and open a new window
            async function openWindow(section, chineseTitle, englishTitle, contentHTML, windowId = section, initialProps = {}, isMarkdown = false) {
                console.log(`Attempting to open window: ${chineseTitle} [${englishTitle}] (Section: ${section}, ID: ${windowId}, Markdown: ${isMarkdown}`);

                // Hide welcome message if it's visible
                if (welcomeMessage) {
                    welcomeMessage.style.display = 'none';
                    console.log('Welcome message hidden.');
                }

                // Check if a window for this section already exists
                let existingWindow = document.querySelector(`.os-window[data-window-id="${windowId}"]`);
                if (existingWindow) {
                    bringToFront(existingWindow);
                    // If it exists and is minimized, restore it
                    if (existingWindow.classList.contains('minimized')) {
                        restoreWindow(existingWindow);
                    }
                    return existingWindow; // Return existing window
                }

                const windowElement = document.createElement('div');
                windowElement.classList.add('os-window');
                windowElement.dataset.section = section; // Store section for identification
                windowElement.dataset.windowId = windowId; // Unique ID for this specific window instance
                
                // Store initial position and size for restore functionality
                const desktopWidth = mainDesktopArea.offsetWidth;
                const desktopHeight = mainDesktopArea.offsetHeight;
                const defaultWidth = Math.min(desktopWidth * 0.7, 800); // Max 800px or 70%
                const defaultHeight = Math.min(desktopHeight * 0.7, 600); // Max 600px or 70%

                // Position new windows slightly offset from each other
                const openWindows = document.querySelectorAll('.os-window:not(.minimized)');
                let offsetX = 50 * (openWindows.length % 5); // Max 5 offsets before repeating
                let offsetY = 50 * (openWindows.length % 5);

                windowElement.style.width = initialProps.width || `${defaultWidth}px`;
                windowElement.style.height = initialProps.height || `${defaultHeight}px`;
                windowElement.style.left = initialProps.left || `${(desktopWidth / 2 - defaultWidth / 2) + offsetX}px`;
                windowElement.style.top = initialProps.top || `${(desktopHeight / 2 - defaultHeight / 2) + offsetY}px`;

                // Ensure window is within bounds after offset
                if (parseFloat(windowElement.style.left) + parseFloat(windowElement.style.width) > desktopWidth) {
                    windowElement.style.left = `${desktopWidth - parseFloat(windowElement.style.width) - 20}px`;
                }
                if (parseFloat(windowElement.style.top) + parseFloat(windowElement.style.height) > desktopHeight) {
                    windowElement.style.top = `${desktopHeight - parseFloat(windowElement.style.height) - 20}px`;
                }

                // Store current position and size for restoration
                windowElement.dataset.originalLeft = windowElement.style.left;
                windowElement.dataset.originalTop = windowElement.style.top;
                windowElement.dataset.originalWidth = windowElement.style.width;
                windowElement.dataset.originalHeight = windowElement.style.height;


                bringToFront(windowElement); // Bring new window to front
                console.log(`New window "${windowId}" created at left: ${windowElement.style.left}, top: ${windowElement.style.top}`);

                // Parse Markdown if required
                const finalContent = isMarkdown ? marked.parse(contentHTML) : contentHTML;
                const contentClass = isMarkdown ? 'markdown-content' : '';

                // Construct the full title bar text
                const fullTitle = `${chineseTitle} [${englishTitle}]`;
                windowElement.dataset.windowTitle = fullTitle; // Store the full title in dataset

                // Construct window HTML dynamically, using data-asset-key for icons
                windowElement.innerHTML = `
                    <div class="os-window-title-bar">
                        <div class="os-window-title-content">
                            <span class="icon-placeholder" data-asset-key="icon_mazko_logo"></span>
                            <span class="os-window-title">${fullTitle}</span>
                        </div>
                        <div class="os-window-controls">
                            <div class="control-button minimize" title="ÊúÄÂ∞èÂåñ">
                                <span class="icon-placeholder" data-asset-key="icon_minus"></span>
                            </div>
                            <div class="control-button maximize" title="ÊúÄÂ§ßÂåñ">
                                <span class="icon-placeholder" data-asset-key="icon_square"></span>
                            </div>
                            <div class="control-button close" title="ÂÖ≥Èó≠">
                                <span class="icon-placeholder" data-asset-key="icon_times"></span>
                            </div>
                        </div>
                    </div>
                    <div class="os-window-content ${contentClass}">
                        ${finalContent}
                    </div>
                    <div class="os-window-status-bar">
                        ${LANG_CONTENT[currentLanguage].systemName} ${LANG_CONTENT[currentLanguage].systemVersion}
                    </div>
                `;

                mainDesktopArea.appendChild(windowElement); // Append to main desktop area
                console.log(`Window "${windowId}" appended to main desktop area.`);
                renderDynamicAssets(); // Render icons for the newly created window

                // Add to map for language switching
                openWindowsMap.set(windowId, {
                    section: section,
                    chineseTitle: chineseTitle, // Store both for re-rendering
                    englishTitle: englishTitle,
                    windowElement: windowElement
                });

                // Immediately create and add taskbar icon for the new window
                createTaskbarIcon(windowElement, chineseTitle, windowId);


                // Make window draggable
                const titleBar = windowElement.querySelector('.os-window-title-bar');
                let isDraggingWindow = false; // Renamed to avoid conflict with desktop icon dragging
                let offsetXWindow, offsetYWindow;

                if (titleBar) { // Ensure titleBar exists
                    titleBar.addEventListener('mousedown', (e) => {
                        isDraggingWindow = true;
                        offsetXWindow = e.clientX - windowElement.getBoundingClientRect().left;
                        offsetYWindow = e.clientY - windowElement.getBoundingClientRect().top;
                        titleBar.style.cursor = 'grabbing'; // Changed to grab cursor
                        bringToFront(windowElement); // Bring to front when dragging starts
                        console.log(`Started dragging window "${windowId}".`);
                    });
                } else {
                    console.error(`Title bar not found for window "${windowId}". Dragging disabled.`);
                }

                document.addEventListener('mousemove', (e) => {
                    if (!isDraggingWindow) return;
                    let newX = e.clientX - offsetXWindow;
                    let newY = e.clientY - offsetYWindow;

                    // Boundary checks for dragging within mainDesktopArea
                    const parentRect = mainDesktopArea.getBoundingClientRect();
                    const windowRect = windowElement.getBoundingClientRect();

                    if (newX < 0) newX = 0;
                    if (newY < 0) newY = 0;
                    if (newX + windowRect.width > parentRect.width) newX = parentRect.width - windowRect.width;
                    if (newY + windowRect.height > parentRect.height) newY = parentRect.height - windowRect.height;

                    windowElement.style.left = `${newX}px`;
                    windowElement.style.top = `${newY}px`;
                });

                document.addEventListener('mouseup', () => {
                    if (isDraggingWindow) {
                        isDraggingWindow = false;
                        if (titleBar) titleBar.style.cursor = 'grab'; // Changed to grab cursor
                        console.log(`Stopped dragging window "${windowId}".`);
                    }
                });

                // Handle window control buttons
                const closeButton = windowElement.querySelector('.control-button.close');
                const minimizeButton = windowElement.querySelector('.control-button.minimize');
                const maximizeButton = windowElement.querySelector('.control-button.maximize');

                if (closeButton) {
                    closeButton.addEventListener('click', () => {
                        windowElement.remove();
                        openWindowsMap.delete(windowId); // Remove from map
                        // Remove taskbar icon if it exists
                        const taskbarIcon = document.querySelector(`.taskbar-minimized-icon[data-window-id="${windowId}"]`);
                        if (taskbarIcon) {
                            taskbarIcon.remove();
                        }
                        console.log(`Window "${windowId}" closed.`);
                        // If no windows are open, show welcome message again
                        if (mainDesktopArea.querySelectorAll('.os-window').length === 0 && taskbarIconsContainer.children.length === 0) {
                            if (welcomeMessage) {
                                welcomeMessage.style.display = 'flex';
                                console.log('All windows closed, welcome message shown.');
                            }
                        }
                    });
                } else {
                    console.error(`Close button not found for window "${windowId}".`);
                }

                if (minimizeButton) {
                    minimizeButton.addEventListener('click', () => {
                        minimizeWindow(windowElement, chineseTitle, windowId);
                    });
                }
                if (maximizeButton) {
                    maximizeButton.addEventListener('click', () => {
                        toggleMaximizeWindow(windowElement);
                    });
                }

                // Bring to front on click anywhere on the window
                windowElement.addEventListener('mousedown', () => {
                    bringToFront(windowElement);
                });

                return windowElement; // Return the newly created window element
            }

            // Function to create a taskbar icon for a window
            function createTaskbarIcon(windowElement, title, windowId) {
                console.log('createTaskbarIcon received title:', title, 'type:', typeof title, 'windowId:', windowId); // Debug log
                let taskbarIcon = document.querySelector(`.taskbar-minimized-icon[data-window-id="${windowId}"]`);
                if (!taskbarIcon) {
                    taskbarIcon = document.createElement('div');
                    taskbarIcon.classList.add('taskbar-minimized-icon');
                    taskbarIcon.dataset.windowId = windowId;

                    // Initialize displayTitle with a safe fallback
                    let displayTitle = String(title || 'Untitled Window'); // Ensure it's a string, even if title is null/undefined

                    // Attempt to get a more specific display title from language content if available
                    const langData = LANG_CONTENT[currentLanguage];
                    const section = windowElement.dataset.section;

                    if (langData && section) { // Ensure both langData and section are defined
                        if (langData[`${section}MenuItem`]) {
                            displayTitle = String(langData[`${section}MenuItem`]); // Use the simplified menu item label
                        } else if (section === 'about' && langData.mazkoExeIcon) {
                            displayTitle = String(langData.mazkoExeIcon);
                        } else if (section.startsWith('service-category-')) {
                            const categoryId = section.replace('service-category-', '');
                            if (langData.services && langData.services.categories) {
                                const category = langData.services.categories.find(cat => cat.id === categoryId);
                                if (category && category.name) {
                                    displayTitle = String(category.name);
                                }
                            }
                        } else if (section.startsWith('work-detail-')) {
                            // For work-detail windows, the 'title' parameter already contains the full title
                            // so no further modification needed here.
                            displayTitle = String(title); // Ensure it's explicitly a string
                        }
                    }
                    // Final fallback to ensure displayTitle is always a non-empty string
                    displayTitle = displayTitle.trim() || 'Untitled'; // Trim and ensure it's not empty

                    taskbarIcon.innerHTML = `<span class="icon-placeholder" data-asset-key="icon_window_restore"></span> <span>${displayTitle}</span>`;
                    taskbarIconsContainer.appendChild(taskbarIcon);
                    renderDynamicAssets(); // Render icons for the newly created taskbar icon

                    taskbarIcon.addEventListener('click', () => {
                        restoreWindow(windowElement);
                    });
                }
                setActiveTaskbarIcon(windowId); // Set its taskbar icon as active
            }

            // Function to minimize a window
            function minimizeWindow(windowElement, title, windowId) {
                windowElement.classList.add('minimized');
                console.log(`Window "${windowId}" minimized.`);
                // Ensure taskbar icon is active even when minimized
                setActiveTaskbarIcon(windowId); 
            }

            // Function to restore a minimized window
            function restoreWindow(windowElement) {
                windowElement.classList.remove('minimized');
                windowElement.classList.remove('maximized'); // Ensure it's not maximized either
                windowElement.style.width = windowElement.dataset.originalWidth;
                windowElement.style.height = windowElement.dataset.originalHeight;
                windowElement.style.left = windowElement.dataset.originalLeft;
                windowElement.style.top = windowElement.dataset.originalTop;
                windowElement.style.borderRadius = '12px'; // Restore border-radius for Aero
                // Fix: Changed box-shadow to boxShadow for correct CSS property access
                windowElement.style.boxShadow = '0 10px 40px rgba(0, 191, 255, 0.5), inset 0 0 20px rgba(255, 255, 255, 0.3)'; // Restore shadow
                bringToFront(windowElement);
                console.log(`Window "${windowElement.dataset.windowId}" restored.`);
                setActiveTaskbarIcon(windowElement.dataset.windowId); // Set its taskbar icon as active
            }

            // Function to toggle maximize/restore a window
            function toggleMaximizeWindow(windowElement) {
                if (windowElement.classList.contains('maximized')) {
                    // Restore
                    windowElement.classList.remove('maximized');
                    windowElement.style.width = windowElement.dataset.originalWidth;
                    windowElement.style.height = windowElement.dataset.originalHeight;
                    windowElement.style.left = windowElement.dataset.originalLeft;
                    windowElement.style.top = windowElement.dataset.originalTop;
                    windowElement.style.borderRadius = '12px'; // Restore border-radius for Aero
                    // Fix: Changed box-shadow to boxShadow for correct CSS property access
                    windowElement.style.boxShadow = '0 10px 40px rgba(0, 191, 255, 0.5), inset 0 0 20px rgba(255, 255, 255, 0.3)'; // Restore shadow
                    console.log(`Window "${windowElement.dataset.windowId}" restored from maximized.`);
                } else {
                    // Maximize
                    // Save current position and size before maximizing (if not already saved)
                    if (!windowElement.dataset.originalLeft) {
                        windowElement.dataset.originalLeft = windowElement.style.left;
                        windowElement.dataset.originalTop = windowElement.style.top;
                        windowElement.dataset.originalWidth = windowElement.style.width;
                        windowElement.dataset.originalHeight = windowElement.style.height;
                    }
                    windowElement.classList.add('maximized');
                    // CSS handles the full-screen positioning via the .maximized class
                    console.log(`Window "${windowElement.dataset.windowId}" maximized.`);
                }
                bringToFront(windowElement); // Bring to front after state change
                setActiveTaskbarIcon(windowElement.dataset.windowId); // Set its taskbar icon as active
            }

            // Function to open work detail window with gallery
            function openWorkDetail(work) {
                // Initialize current image index for this work
                let currentImageIndex = 0;

                const { chineseTitle, englishTitle } = getWindowTitles('work-detail-' + work.id, work);

                const detailContent = `
                    <div class="work-detail-content">
                        <div class="gallery-main-image-container">
                            <img src="${work.images[currentImageIndex]}" alt="${work.title}" class="gallery-main-image">
                            ${work.images.length > 1 ? `
                                <button class="gallery-nav-button prev" data-direction="prev"><span class="icon-placeholder" data-asset-key="icon_chevron_left"></span></button>
                                <button class="gallery-nav-button next" data-direction="next"><span class="icon-placeholder" data-asset-key="icon_chevron_right"></span></button>
                            ` : ''}
                        </div>
                        ${work.images.length > 1 ? `
                            <div class="gallery-thumbnails">
                                ${work.images.map((imgSrc, index) => `
                                    <img src="${imgSrc}" alt="${work.title} thumbnail ${index + 1}" class="gallery-thumbnail ${index === currentImageIndex ? 'active' : ''}" data-index="${index}">
                                `).join('')}
                            </div>
                        ` : ''}
                        <h3>${work.title}</h3>
                        <p class="text-sm opacity-90 mb-2">${work.category}</p>
                        <p>${work.description}</p>
                        <div class="flex flex-wrap gap-2 mt-4">
                            ${work.tags.map(tag => `<span class="category-tag">${tag}</span>`).join('')}
                        </div>
                    </div>
                `;
                
                openWindow('work-detail-' + work.id, chineseTitle, englishTitle, detailContent, 'work-detail-' + work.id);

                // Add event listeners for gallery navigation after the window is opened and content is rendered
                setTimeout(() => {
                    const detailWindow = document.querySelector(`.os-window[data-window-id="work-detail-${work.id}"]`);
                    if (!detailWindow) return;

                    const mainImage = detailWindow.querySelector('.gallery-main-image');
                    const thumbnailsContainer = detailWindow.querySelector('.gallery-thumbnails');
                    const prevButton = detailWindow.querySelector('.gallery-nav-button.prev');
                    const nextButton = detailWindow.querySelector('.gallery-nav-button.next');

                    function updateGallery() {
                        if (mainImage) {
                            mainImage.src = work.images[currentImageIndex];
                        }
                        if (thumbnailsContainer) {
                            thumbnailsContainer.querySelectorAll('.gallery-thumbnail').forEach((thumb, idx) => {
                                if (idx === currentImageIndex) {
                                    thumb.classList.add('active');
                                } else {
                                    thumb.classList.remove('active');
                                }
                            });
                        }
                        renderDynamicAssets(); // Render newly inserted icons (chevrons)
                    }

                    if (prevButton) {
                        prevButton.addEventListener('click', () => {
                            currentImageIndex = (currentImageIndex - 1 + work.images.length) % work.images.length;
                            updateGallery();
                        });
                    }
                    if (nextButton) {
                        nextButton.addEventListener('click', () => { 
                            currentImageIndex = (currentImageIndex + 1) % work.images.length;
                            updateGallery();
                        });
                    }
                    if (thumbnailsContainer) {
                        thumbnailsContainer.addEventListener('click', (e) => {
                            if (e.target.classList.contains('gallery-thumbnail')) {
                                const index = parseInt(e.target.dataset.index);
                                if (!isNaN(index)) {
                                    currentImageIndex = index;
                                    updateGallery();
                                }
                            }
                        });
                    }
                    updateGallery(); // Initial update to set the first image and active thumbnail
                }, 100); // Small delay to ensure DOM is ready
            }

            // Function to open a specific service category detail window
            function openServiceCategoryDetail(category) {
                const { chineseTitle, englishTitle } = getWindowTitles('service-category-' + category.id, null, category);
                const contentHTML = category.detailContent;
                openWindow('service-category-' + category.id, chineseTitle, englishTitle, contentHTML, 'service-category-' + category.id, {}, true); // Pass true for Markdown
            }


            // Toggle Start Menu visibility
            if (startButton && startMenu) { // Ensure elements exist before adding listeners
                console.log('START button and Start Menu elements found. Attaching event listeners.');
                startButton.addEventListener('click', (event) => {
                    event.stopPropagation(); // Prevent click from propagating to document
                    console.log('START button clicked!'); // Debug: Confirm button click
                    startMenu.classList.toggle('hidden');
                    startMenu.classList.toggle('visible');
                    console.log(`Start Menu visibility toggled. Current classes: ${startMenu.classList}`);
                });

                // Hide Start Menu when clicking outside of it
                document.addEventListener('click', (event) => {
                    if (!startMenu.contains(event.target) && !startButton.contains(event.target)) {
                        if (startMenu.classList.contains('visible')) {
                            startMenu.classList.add('hidden');
                            startMenu.classList.remove('visible');
                            console.log('Clicked outside menu, Start Menu hidden.');
                        }
                    }
                });
            } else {
                console.error('Error: START button or Start Menu element not found in the DOM. Check IDs and HTML structure.');
            }

            // Handle Start Menu item clicks (for links)
            document.querySelectorAll('.start-menu-item, .start-menu-footer-button').forEach(item => {
                item.addEventListener('click', async (event) => { // Made async to await fetchContent
                    event.preventDefault(); // Prevent default link behavior

                    const section = item.dataset.section;
                    const { chineseTitle, englishTitle } = getWindowTitles(section);
                    
                    startMenu.classList.add('hidden'); // Hide menu after clicking an item
                    startMenu.classList.remove('visible'); // Ensure it's explicitly removed
                    console.log(`Start Menu item "${section}" clicked. Menu hidden.`);

                    let content = '';
                    let data = null;
                    let isMarkdown = false;

                    // Show loading spinner while fetching data
                    content = `
                        <div class="flex flex-col items-center justify-center h-full">
                            <div class="loading-spinner"></div>
                            <p class="mt-4 text-lg">${LANG_CONTENT[currentLanguage]?.loadingMessage}</p>
                        </div>
                    `;
                    // Pass windowId to openWindow for correct targeting
                    const openedWindow = await openWindow(section, chineseTitle, englishTitle, content, section); 

                    try {
                        data = await fetchContent(section); // Fetch data
                    } catch (error) {
                        console.error(`${LANG_CONTENT[currentLanguage]?.errorLoadingContent} ${section}:`, error);
                        content = `<p class="text-xl text-red-400">${LANG_CONTENT[currentLanguage]?.errorLoadingContent} ${error.message || LANG_CONTENT[currentLanguage]?.unknownModule}</p>`;
                        // Update existing window with error message
                        if (openedWindow) {
                            openedWindow.querySelector('.os-window-content').innerHTML = content;
                            renderDynamicAssets(); // Re-render icons after content update
                        }
                        return;
                    }

                    // Re-render content based on fetched data
                    switch (section) {
                        case 'works':
                            content = `
                                <h2 class="text-xl font-bold mb-4">${LANG_CONTENT[currentLanguage]?.worksTitle}</h2>
                                <div class="works-grid">
                                    ${data?.map(work => `
                                        <div class="work-card" data-work-id="${work.id}">
                                            <img src="${work.thumbnail}" alt="${work.title}">
                                            <div class="work-card-title">${work.title}</div>
                                            <div class="work-card-category">${work.category}</div>
                                        </div>
                                    `).join('')}
                                </div>
                                <p class="mt-4 opacity-70 text-center">${LANG_CONTENT[currentLanguage]?.worksClickPrompt}</p>
                            `;
                            // Update content of existing window
                            if (openedWindow) {
                                openedWindow.querySelector('.os-window-content').innerHTML = content;
                                // Attach event listeners to newly created work cards
                                setTimeout(() => { // Use setTimeout to ensure elements are rendered
                                    openedWindow.querySelectorAll('.work-card').forEach(card => {
                                        card.addEventListener('click', () => {
                                            const workId = card.dataset.workId;
                                            const selectedWork = data?.find(w => w.id === workId); // Use fetched data
                                            if (selectedWork) {
                                                console.log(`Work card "${workId}" clicked. Opening detail window.`);
                                                openWorkDetail(selectedWork);
                                            } else {
                                                console.warn(`Work with ID "${workId}" not found.`);
                                            }
                                        });
                                    });
                                }, 100); // Small delay
                                renderDynamicAssets(); // Re-render icons after content update
                            }
                            break;
                        case 'characters':
                            content = `
                                <h2 class="text-xl font-bold mb-4">${LANG_CONTENT[currentLanguage]?.charactersTitle}</h2>
                                <p>${LANG_CONTENT[currentLanguage]?.charactersDescription}</p>
                                <div class="grid grid-cols-2 gap-4 mt-4">
                                    ${data?.map(char => `
                                        <div class="flex flex-col items-center">
                                            <img src="${char.image}" alt="${char.name}" class="rounded-lg shadow-md mb-2">
                                            <p class="font-bold">${char.name}</p>
                                            <p class="text-sm opacity-80 text-center">${char.description}</p>
                                        </div>
                                    `).join('')}
                                </div>
                            `;
                            if (openedWindow) {
                                openedWindow.querySelector('.os-window-content').innerHTML = content;
                                renderDynamicAssets(); // Re-render icons after content update
                            }
                            break;
                        case 'about':
                            content = data?.content;
                            isMarkdown = true;
                            if (openedWindow) {
                                openedWindow.querySelector('.os-window-content').innerHTML = marked.parse(content || '');
                                renderDynamicAssets(); // Re-render icons after content update
                            }
                            break;
                        case 'services':
                            content = marked.parse(data?.description || '') + `
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                                    ${data?.categories.map(category => `
                                        <div class="service-category-card p-4 rounded-lg border border-primary-blue hover:bg-glass-bg cursor-pointer transition-all duration-200" data-category-id="${category.id}">
                                            <h3 class="font-bold text-lg text-light-blue">${category.name}</h3>
                                            <p class="text-sm opacity-80 mt-1">${category.shortDescription}</p>
                                        </div>
                                    `).join('')}
                                </div>
                            `;
                            if (openedWindow) {
                                openedWindow.querySelector('.os-window-content').innerHTML = content;
                                // Attach event listeners to newly created service category cards
                                setTimeout(() => {
                                    openedWindow.querySelectorAll('.service-category-card').forEach(card => {
                                        card.addEventListener('click', () => {
                                            const categoryId = card.dataset.categoryId;
                                            const selectedCategory = data?.categories.find(cat => cat.id === categoryId);
                                            if (selectedCategory) {
                                                console.log(`Service category "${categoryId}" clicked. Opening detail window.`);
                                                openServiceCategoryDetail(selectedCategory);
                                            } else {
                                                console.warn(`Service category with ID "${categoryId}" not found.`);
                                            }
                                        });
                                    });
                                }, 100);
                                renderDynamicAssets(); // Re-render icons after content update
                            }
                            break;
                        case 'socials':
                            content = marked.parse(data?.description || '') + `
                                <div class="flex flex-wrap gap-4 mt-4">
                                    ${data?.links.map(link => `
                                        <a href="${link.url}" target="_blank" class="flex items-center space-x-2 text-white hover:text-primary-blue transition-colors">
                                            <span class="icon-placeholder w-6 h-6" data-asset-key="${link.iconAssetKey}"></span> <!-- Using iconAssetKey -->
                                            <span>${link.name}</span>
                                        </a>
                                    `).join('')}
                                </div>
                            `;
                            if (openedWindow) {
                                openedWindow.querySelector('.os-window-content').innerHTML = content;
                                renderDynamicAssets(); // Re-render icons after content update
                            }
                            break;
                        case 'settings':
                            content = marked.parse(data?.description || '') + `
                                <div class="flex flex-col gap-4 mt-4">
                                    ${data?.options.map(option => {
                                        const labelText = LANG_CONTENT[currentLanguage]?.settings?.options.find(opt => opt.id === option.id)?.label || option.label;
                                        if (option.type === 'toggle') {
                                            return `
                                                <div class="flex items-center justify-between p-3 rounded-lg bg-white bg-opacity-5 border border-white border-opacity-20">
                                                    <label for="${option.id}" class="text-lg">${labelText}</label>
                                                    <label class="toggle-switch">
                                                        <input type="checkbox" id="${option.id}" ${option.checked ? 'checked' : ''} ${option.disabled ? 'disabled' : ''}>
                                                        <span class="toggle-slider round"></span>
                                                    </label>
                                                </div>
                                            `;
                                        } else if (option.type === 'language-toggle') {
                                            return `
                                                <div class="flex items-center justify-between p-3 rounded-lg bg-white bg-opacity-5 border border-white border-opacity-20">
                                                    <span class="text-lg">${labelText}</span>
                                                    <label class="toggle-switch">
                                                        <input type="checkbox" id="${option.id}" ${currentLanguage === 'en' ? 'checked' : ''}>
                                                        <span class="toggle-slider round"></span>
                                                    </label>
                                                </div>
                                            `;
                                        } else if (option.type === 'button') {
                                            return `
                                                <button id="${option.id}" class="py-2 px-4 rounded-lg bg-primary-blue hover:bg-dark-blue transition-colors text-white font-bold ${option.disabled ? 'opacity-50 cursor-not-allowed' : ''}" ${option.disabled ? 'disabled' : ''}>
                                                    ${labelText}
                                                </button>
                                            `;
                                        }
                                        return '';
                                    }).join('')}
                            </div>
                        `;
                            if (openedWindow) {
                                openedWindow.querySelector('.os-window-content').innerHTML = content;
                                setTimeout(() => {
                                    const languageToggle = openedWindow.querySelector('#language-toggle');
                                    if (languageToggle) {
                                        languageToggle.addEventListener('change', (e) => {
                                            const newLang = e.target.checked ? 'en' : 'zh';
                                            if (newLang !== currentLanguage) {
                                                currentLanguage = newLang;
                                                console.log(`Language switched via settings toggle to: ${currentLanguage}`);
                                                updateUIForLanguage();
                                                // Re-render the settings window to reflect the new language
                                                const { chineseTitle: settingsZh, englishTitle: settingsEn } = getWindowTitles('settings');
                                                openWindow('settings', settingsZh, settingsEn, content, 'settings');
                                            }
                                        });
                                    }

                                    const desktopIconsToggle = openedWindow.querySelector('#desktop-icons-toggle');
                                    if (desktopIconsToggle) {
                                        desktopIconsToggle.addEventListener('change', (e) => {
                                            if (e.target.checked) {
                                                desktopIconsContainer.style.display = 'block';
                                                console.log('Desktop icons enabled.');
                                            } else {
                                                desktopIconsContainer.style.display = 'none';
                                                console.log('Desktop icons disabled.');
                                            }
                                        });
                                    }
                                }, 100);
                                renderDynamicAssets(); // Re-render icons after content update
                            }
                            break;
                        case 'shutdown':
                            content = `
                                <h2 class="text-xl font-bold mb-4 text-red-400">${LANG_CONTENT[currentLanguage]?.shutdownMenuItem}...</h2>
                                <p>${LANG_CONTENT[currentLanguage]?.shutdownMessage}</p>
                                <p class="mt-4 opacity-70">${(LANG_CONTENT[currentLanguage]?.loadingMessage || 'Âä†ËΩΩ‰∏≠...').replace('Âä†ËΩΩ‰∏≠...', 'ËØ∑Á®çÂÄô...')}</p>
                            `;
                            if (openedWindow) {
                                openedWindow.querySelector('.os-window-content').innerHTML = content;
                                renderDynamicAssets(); // Re-render icons after content update
                            }
                            // For a real shutdown, you might redirect or show a final message
                            setTimeout(() => {
                                console.log(LANG_CONTENT[currentLanguage]?.shutdownMessage);
                                mainDesktopArea.innerHTML = `<div id="welcome-message" class="absolute inset-0 flex items-center justify-center pointer-events-none">
                                    <p class="text-3xl text-white opacity-70" id="welcome-message-text">${LANG_CONTENT[currentLanguage]?.shutdownMessage}</p>
                                </div>`;
                                // Clear all open windows from map and taskbar
                                openWindowsMap.clear();
                                taskbarIconsContainer.innerHTML = '';
                                // Re-initialize welcome message text element
                                welcomeMessageText = document.getElementById('welcome-message-text'); // Re-assign the element
                                renderDynamicAssets(); // Ensure icons in shutdown message are rendered if any
                            }, 2000);
                            break;
                    }
                });
            });


            // Handle Start Menu header click to open About Me
            if (startMenuHeader) {
                startMenuHeader.addEventListener('click', async (event) => {
                    event.preventDefault();
                    event.stopPropagation(); // Prevent start menu from closing immediately
                    startMenu.classList.add('hidden');
                    startMenu.classList.remove('visible');

                    const section = 'about';
                    // Directly get titles from LANG_CONTENT, as getWindowTitles is for generic sections
                    const chineseTitle = LANG_CONTENT[currentLanguage]?.aboutTitle;
                    const englishTitle = LANG_CONTENT['en']?.aboutTitle;
                    
                    let content = '';
                    let data = null;
                    let isMarkdown = true;

                    content = `
                        <div class="flex flex-col items-center justify-center h-full">
                            <div class="loading-spinner"></div>
                            <p class="mt-4 text-lg">${LANG_CONTENT[currentLanguage]?.loadingMessage}</p>
                        </div>
                    `;
                    const openedWindow = await openWindow(section, chineseTitle, englishTitle, content, 'about', {}, true); // Pass 'about' as windowId

                    try {
                        data = await fetchContent(section);
                        if (data && typeof data.content !== 'undefined') { // Added check
                            content = data.content;
                            if (openedWindow) openedWindow.querySelector('.os-window-content').innerHTML = marked.parse(content || '');
                        } else {
                            console.error(`Fetched data for section "${section}" is invalid or missing 'content':`, data);
                            content = `<p class="text-xl text-red-400">${LANG_CONTENT[currentLanguage]?.errorLoadingContent} ${LANG_CONTENT[currentLanguage]?.unknownModule}</p>`;
                            if (openedWindow) {
                                openedWindow.querySelector('.os-window-content').innerHTML = content;
                            }
                        }
                    } catch (error) {
                        console.error(`${LANG_CONTENT[currentLanguage]?.errorLoadingContent} ${section}:`, error);
                        content = `<p class="text-xl text-red-400">${LANG_CONTENT[currentLanguage]?.errorLoadingContent} ${error.message || LANG_CONTENT[currentLanguage]?.unknownModule}</p>`;
                        if (openedWindow) {
                            openedWindow.querySelector('.os-window-content').innerHTML = content;
                        }
                    } finally {
                        renderDynamicAssets(); // Ensure icons within the content are rendered
                    }
                });
            }


            // --- Desktop Icon Dragging Logic ---
            let isDraggingIcon = false;
            let currentDraggedIcon = null;
            let initialMouseX, initialMouseY;
            let initialIconX, initialIconY;

            if (desktopIconsContainer) {
                desktopIconsContainer.querySelectorAll('.desktop-icon').forEach(icon => {
                    // Set initial positions (from inline style)
                    icon.style.position = 'absolute'; // Ensure position is absolute for dragging

                    icon.addEventListener('mousedown', (e) => {
                        if (e.button !== 0) return; // Only allow left-click drag
                        isDraggingIcon = true;
                        currentDraggedIcon = icon;
                        initialMouseX = e.clientX;
                        initialMouseY = e.clientY;
                        initialIconX = icon.offsetLeft;
                        initialIconY = icon.offsetTop;

                        // Bring the icon to front while dragging (optional, but good UX)
                        currentDraggedIcon.style.zIndex = highestZIndex + 1; 

                        e.preventDefault(); // Prevent default browser drag behavior (e.g., ghost image)
                        console.log(`Started dragging icon: ${icon.dataset.title}`);
                    });

                    // Handle icon click (separate from drag)
                    icon.addEventListener('click', (event) => {
                        // If it was a drag, don't open the window
                        if (currentDraggedIcon === icon && (Math.abs(event.clientX - initialMouseX) > 5 || Math.abs(event.clientY - initialMouseY) > 5)) {
                            console.log("Icon was dragged, preventing click action.");
                            return; 
                        }

                        const section = icon.dataset.section;
                        const { chineseTitle, englishTitle } = getWindowTitles(section);
                        
                        let existingWindow = document.querySelector(`.os-window[data-window-id="${section}"]`);
                        if (existingWindow) {
                            if (existingWindow.classList.contains('minimized')) {
                                restoreWindow(existingWindow);
                            } else {
                                bringToFront(existingWindow);
                            }
                            return;
                        }

                        // Simulate click on the corresponding start menu item or button to trigger window opening logic
                        // For mazko.exe, directly open the about window
                        if (section === 'about') {
                            console.log('Desktop MAZKO icon clicked. currentLanguage:', currentLanguage);
                            // Directly access aboutTitle and aboutContent from LANG_CONTENT
                            const aboutTitleForWindow = LANG_CONTENT[currentLanguage]?.aboutTitle;
                            const aboutContentForWindow = LANG_CONTENT[currentLanguage]?.aboutContent;

                            if (aboutContentForWindow) { // Check if content exists
                                openWindow('about', aboutTitleForWindow, LANG_CONTENT['en']?.aboutTitle, aboutContentForWindow, 'about', {}, true);
                            } else {
                                console.error(`Error: 'about' content not found for language ${currentLanguage} or is undefined.`);
                                openWindow('about', 'Error', 'Error', `<p class="text-xl text-red-400">Failed to load About MAZKO content.</p>`, 'about', {}, false);
                            }
                        } else {
                            // Find the corresponding start menu item or button and click it
                            const startMenuItem = document.querySelector(`.start-menu-item[data-section="${section}"]`);
                            const startMenuFooterButton = document.querySelector(`.start-menu-footer-button[data-section="${section}"]`);
                            if (startMenuItem) {
                                startMenuItem.click();
                            } else if (startMenuFooterButton) {
                                startMenuFooterButton.click();
                            } else {
                                console.warn(`No start menu item or footer button found for section: ${section}`);
                            }
                        }
                    });
                });
            }

            document.addEventListener('mousemove', (e) => {
                if (!isDraggingIcon || !currentDraggedIcon) return;

                const dx = e.clientX - initialMouseX;
                const dy = e.clientY - initialMouseY;

                let newX = initialIconX + dx;
                let newY = initialIconY + dy;

                // Boundary checks for dragging within mainDesktopArea
                const desktopRect = mainDesktopArea.getBoundingClientRect();
                const iconRect = currentDraggedIcon.getBoundingClientRect();

                // Adjust for desktop area's position relative to viewport
                const desktopLeft = desktopRect.left;
                const desktopTop = desktopRect.top;

                // Calculate bounds relative to the desktop area's top-left corner
                const minX = 0;
                const minY = 0;
                const maxX = desktopRect.width - iconRect.width;
                const maxY = desktopRect.height - iconRect.height;

                newX = Math.max(minX, Math.min(newX, maxX));
                newY = Math.max(minY, Math.min(newY, maxY));

                currentDraggedIcon.style.left = `${newX}px`;
                currentDraggedIcon.style.top = `${newY}px`;
            });

            document.addEventListener('mouseup', () => {
                if (isDraggingIcon) {
                    isDraggingIcon = false;
                    if (currentDraggedIcon) {
                        // Reset z-index if desired, or keep it high if windows can overlap icons
                        currentDraggedIcon.style.zIndex = 2; 
                        console.log(`Stopped dragging icon: ${currentDraggedIcon.dataset.title}`);
                    }
                    currentDraggedIcon = null;
                }
            });

            // Handle window focus/blur to update title bar active state
            document.addEventListener('mousedown', (e) => {
                const clickedWindow = e.target.closest('.os-window');
                document.querySelectorAll('.os-window').forEach(win => {
                    const titleBar = win.querySelector('.os-window-title-bar');
                    if (titleBar) {
                        if (win === clickedWindow) {
                            titleBar.classList.remove('inactive');
                        } else {
                            titleBar.classList.add('inactive');
                        }
                    }
                });
            });

            // Initial UI update based on default language
            updateCursors(); // Set cursors initially
            updateUIForLanguage(); // Render text and initial assets
            renderDynamicAssets(); // Render all initial icons
            console.log('All event listeners attached and script initialization complete.');
        });
    </script>
</body>
</html>
