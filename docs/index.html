<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAX OS - 虚拟宇宙终端 (Frutiger Aero Style)</title>
    <!-- Favicon - Using a simple SVG as an example -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><text x='0' y='14' font-size='16'>🌌</text></svg>" type="image/svg+xml">
    <!-- Include Tailwind CSS CDN for rapid building and responsive layouts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Include Google Fonts - Inter font as general font, if 'Chocolate Classical Sans' is needed, include its CDN or local path here -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <!-- Marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* Global styles and variables, optimized for Frutiger Aero (Enhanced) */
        :root {
            /* Core Blue Palette - Tuned to match the reference image's vibrant blues */
            --primary-blue: #00BFFF; /* Bright Sky Blue for highlights and active states */
            --dark-blue: #007ACC; /* Deeper blue for gradients and shadows */
            --light-blue: #CCEEFF; /* Very light blue for subtle highlights and text */
            --mid-blue: #3A92CE; /* New intermediate blue for smoother gradients */
            --accent-glow-blue: #87CEEB; /* A more subtle, airy blue for glows */

            /* Glassmorphism & Translucency - Enhanced for realistic Aero feel */
            /* Adjusted glass border colors to match status bar blue tones, more opaque */
            --glass-border-light: rgba(0, 191, 255, 0.8); /* Changed from white to primary blue with high opacity */
            --glass-border-dark: rgba(0, 122, 204, 0.8); /* Changed from white to dark blue with high opacity */
            --glass-bg: rgba(255, 255, 255, 0.08); /* Even more subtle white tint for background of glass */
            --glass-overlay-light: rgba(255, 255, 255, 0.2); /* Lighter overlay for internal elements, slightly stronger */
            --glass-overlay-dark: rgba(0, 0, 0, 0.1); /* Subtle dark overlay for depth */

            /* Backgrounds - Reflecting the image's vibrant and slightly dark context */
            --background-dark: #10152B; /* Darker, slightly blue-tinted background */
            /* Adjusted text color to a deeper blue for most elements, white for prominent ones */
            --text-color: #004D80; /* Deeper blue for general text (e.g., body, paragraphs) */

            /* Fonts - Keeping Inter as a fallback, prioritize a classic Aero-like font if possible */
            --font-main: 'Inter', sans-serif; /* Default to Inter */

            /* Frutiger Aero Specific Gradients - More complex and subtle */
            /* Updated title bar gradients to use status bar blue hues and transparencies */
            --fa-title-active-gradient: linear-gradient(to bottom, rgba(0, 191, 255, 0.5) 0%, rgba(0, 122, 204, 0.5) 100%); /* Brighter active title bar with transparency */
            --fa-title-inactive-gradient: linear-gradient(to bottom, rgba(0, 191, 255, 0.25) 0%, rgba(0, 122, 204, 0.25) 100%); /* Muted blue for inactive with transparency */
            
            --fa-button-bg: linear-gradient(to bottom, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0.1) 100%); /* More pronounced button base */
            --fa-button-hover-bg: linear-gradient(to bottom, rgba(255,255,255,0.5) 0%, rgba(255,255,255,0.2) 100%); /* Lighter on hover */
            --fa-button-active-bg: linear-gradient(to top, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0.1) 100%); /* Depressed look */
            
            /* Enhanced gloss effect for buttons and elements */
            --fa-gloss-effect: inset 0 1px 12px rgba(255, 255, 255, 0.7); /* Stronger inner highlight */
            --fa-dark-gloss-effect: inset 0 -1px 8px rgba(0, 0, 0, 0.3); /* Subtle inner shadow for depth */

            /* Shadows & Glows - Increased intensity and spread for Aero feel */
            --fa-shadow-soft: 0 4px 15px rgba(0, 0, 0, 0.3); /* Slightly softer shadow */
            --fa-shadow-deep: 0 8px 20px rgba(0, 0, 0, 0.5); /* Deeper shadow, but less spread */
            --fa-glow-blue: 0 0 12px rgba(0, 191, 255, 0.8); /* Stronger blue glow matching status bar */
            --fa-inner-highlight: inset 0 1px 6px rgba(255, 255, 255, 0.3); /* Subtle inner highlight for gloss */
            --fa-inner-shadow: inset 0 -1px 3px rgba(0, 0, 0, 0.15); /* Inner shadow for depth */

            --taskbar-height: 48px; /* Define taskbar height */

            /* Cursors - These will be set dynamically by JavaScript */
            --cursor-default: auto;
            --cursor-active: auto;
            --cursor-pointer: pointer;

            --desktop-image-url: none; /* New CSS variable for desktop background image URL */
        }

        body {
            font-family: var(--font-main); /* Apply the new main font globally */
            background-color: var(--background-dark); /* Dark background */
            color: var(--text-color); /* Text color set to deeper blue */
            margin: 0;
            padding: 0;
            overflow: hidden; /* Prevent scrollbars, as we simulate a desktop environment */
            position: relative; /* For background animation positioning */
            width: 100vw; /* Ensure body takes full viewport width */
            height: 100vh; /* Ensure body takes full viewport height */
            cursor: var(--cursor-default);
            display: flex; /* Use flexbox for desktop container */
            flex-direction: column;
        }

        body:active {
            cursor: var(--cursor-active);
        }

        a, button, .clickable-element {
            cursor: var(--cursor-pointer);
        }

        /* Frutiger Aero style desktop background - Complex gradients and effects (default fallback) */
        .desktop-background {
            position: fixed; /* Changed to fixed for full viewport coverage */
            top: 0; /* Explicitly set top to 0 */
            left: 0; /* Explicitly set left to 0 */
            width: 100vw; /* Ensure full viewport width */
            height: 100vh; /* Ensure full viewport height */
            min-height: 100vh; /* Added for robustness */
            /* Default background with multiple gradients for depth and gloss */
            background-image: 
                radial-gradient(circle at 10% 90%, rgba(0,191,255,0.3) 0%, transparent 45%), /* Stronger corner glow */
                radial-gradient(circle at 90% 10%, rgba(0,191,255,0.3) 0%, transparent 45%),
                radial-gradient(ellipse at center, rgba(0,122,204,0.15) 0%, transparent 55%),
                linear-gradient(to bottom right, #3A92CE, #CCEEFF);
            background-size: cover;
            background-position: center;
            opacity: 0.95; /* Slightly more opaque for richer colors */
            filter: brightness(0.9) contrast(1.1); /* Subtle adjustments */
            z-index: -1; /* Changed to -1 to ensure it's always behind other elements */
        }
        /* When a background image is active, hide pseudo-elements */
        .desktop-background-image-active {
            background-image: var(--desktop-image-url) !important; /* Set image and ensure it overrides */
            background-color: transparent !important; /* Crucial: make sure no solid color underneath */
            opacity: 1 !important; /* Ensure full opacity */
            filter: none !important; /* No filters */
        }
        .desktop-background-image-active::before,
        .desktop-background-image-active::after {
            display: none !important; /* Ensure pseudo-elements are truly hidden */
        }

        /* Simulate subtle noise/grain texture - critical for Aero feel */
        .desktop-background::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAGCAYAAADgzJ6OAAAAAXNSR0IArs4c6QAAABJJREFUGFdjYGBgYGJgaAgGAIAADoA7X0jYAAAAAElFTkSuQmCC"); /* Tiny noise texture */
            background-repeat: repeat;
            opacity: 0.08; /* Slightly more visible */
            z-index: 1;
        }

        /* Simulate glow effect - enhanced */
        .desktop-background::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(0,191,255,0.5) 0%, transparent 65%); /* Stronger center glow */
            transform: translate(-50%, -50%);
            animation: pulse-glow 12s infinite alternate; /* Faster glow pulse animation */
            z-index: 2; /* Above noise, below content */
        }

        /* Glow pulse animation - adjusted */
        @keyframes pulse-glow {
            0% { transform: translate(-50%, -50%) scale(0.98); opacity: 0.4; }
            50% { transform: translate(-50%, -50%) scale(1.02); opacity: 0.6; }
            100% { transform: translate(-50%, -50%) scale(0.98); opacity: 0.4; }
        }

        /* Desktop container, now acting as the main content wrapper */
        .desktop-container {
            position: relative; /* Position relative to body */
            flex-grow: 1; /* Take up all available space */
            width: 100%;
            height: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            z-index: 3; /* Ensure it's above the background effects */
        }

        /* Desktop Layout - holds the main desktop area and the taskbar */
        .desktop-layout {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
        }

        /* Main Desktop Area - where icons and windows reside */
        .main-desktop-area {
            flex-grow: 1;
            position: relative;
            overflow: hidden; /* For windows */
            padding: 10px; /* Padding for desktop icons */
            padding-bottom: calc(10px + var(--taskbar-height)); /* Account for taskbar height only */
        }

        /* Taskbar (formerly dock) */
        .taskbar {
            position: absolute;
            bottom: 0; /* Position at the very bottom */
            left: 0;
            width: 100%; /* Full width */
            height: var(--taskbar-height); /* Fixed height */
            /* Background and borders adjusted to match status bar */
            background: linear-gradient(to top, rgba(0, 191, 255, 0.4), rgba(0, 122, 204, 0.4)); /* Match status bar gradient */
            backdrop-filter: blur(20px); /* Stronger blur for glass effect */
            -webkit-backdrop-filter: blur(20px); /* For Safari */
            border-top: 1px solid var(--glass-border-light); /* Changed to new blue border */
            border-bottom: 1px solid var(--glass-border-dark); /* Changed to new blue border */
            box-shadow: 0 -6px 25px var(--fa-glow-blue), inset 0 2px 15px rgba(255, 255, 255, 0.4); /* More prominent shadow and inner highlight */
            display: flex;
            align-items: center;
            justify-content: space-between; /* Space between start button, icons, and tray */
            padding: 0 10px; /* Padding on sides */
            z-index: 100; /* Ensure taskbar is always on top */
            position: fixed; /* Keep taskbar fixed */
        }

        /* Start Button - Highly detailed Aero look */
        .start-button {
            background: linear-gradient(to bottom, rgba(255,255,255,0.7) 0%, rgba(255,255,255,0.3) 100%); /* Stronger white highlight */
            border: 2px solid rgba(255, 255, 255, 0.8); /* Thicker, more prominent border */
            border-radius: 50%; /* Circular */
            width: 48px; /* Slightly larger */
            height: 48px; /* Slightly larger */
            display: flex;
            align-items: center;
            justify-content: center;
            color: white; /* Text color explicitly white */
            font-size: 0.9rem;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(0, 191, 255, 0.8); /* Stronger blue glow */
            box-shadow: 0 6px 20px rgba(0,0,0,0.7), inset 0 2px 10px rgba(255,255,255,0.8); /* More prominent shadow and inner highlight */
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            white-space: nowrap;
            position: relative;
            overflow: hidden;
        }

        /* Inner shine for the start button */
        .start-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at top left, rgba(255,255,255,0.6) 0%, transparent 60%); /* Top-left highlight */
            border-radius: 50%;
            opacity: 0.9;
            pointer-events: none;
        }
        .start-button::after {
            content: '';
            position: absolute;
            bottom: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at center, rgba(0,191,255,0.4) 0%, transparent 70%); /* Subtle blue glow */
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }


        .start-button:hover {
            background: linear-gradient(to bottom, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0.4) 100%);
            transform: translateY(-4px); /* More pronounced lift effect */
            box-shadow: 0 8px 25px rgba(0, 191, 255, 0.9), inset 0 2px 12px rgba(255,255,255,0.9);
        }
        .start-button:hover::after {
            opacity: 1; /* Show glow on hover */
        }

        .start-button:active {
            background: linear-gradient(to top, rgba(255,255,255,0.7) 0%, rgba(255,255,255,0.3) 100%);
            transform: translateY(0);
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.9), inset 0 -2px 8px rgba(255,255,255,0.6);
            filter: brightness(0.9);
        }

        .start-button .icon-image { /* Sizing for dynamically loaded image */
            width: 2em; /* Larger icon size */
            height: 2em;
            filter: drop-shadow(0 0 10px rgba(0, 191, 255, 0.8)); /* Stronger text-shadow equivalent for image */
        }

        /* Taskbar Icons (for open/minimized windows) */
        .taskbar-icons-container {
            display: flex;
            flex-grow: 1;
            justify-content: flex-start;
            align-items: center;
            height: 100%;
            overflow-x: auto;
            padding: 0 10px;
            gap: 10px; /* Larger gap between taskbar items */
        }

        /* System Tray */
        .system-tray {
            display: flex;
            align-items: center;
            gap: 12px; /* Larger gap between system icons */
        }

        .system-tray-icon {
            font-size: 1.2rem; /* Slightly larger icon size */
            color: var(--text-color); /* Adjusted to deeper blue */
            transition: all 0.2s ease;
            cursor: default;
            padding: 8px; /* Slightly more padding */
            border-radius: 50%;
            box-shadow: 0 1px 5px rgba(0,0,0,0.3); /* Subtle shadow */
        }
        .system-tray-icon:hover {
            color: white; /* White on hover */
            background-color: rgba(255,255,255,0.25); /* More visible hover */
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 191, 255, 0.4); /* Stronger blue glow */
        }
        .system-tray-icon .icon-image { /* Sizing for dynamically loaded image */
            width: 1.2em;
            height: 1.2em;
            vertical-align: middle;
            filter: drop-shadow(0 0 8px rgba(0, 191, 255, 0.6)); /* More prominent glow */
        }

        /* Desktop Icons (Shortcuts) */
        .desktop-icons-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: calc(100% - var(--taskbar-height));
            padding: 20px;
            z-index: 2;
        }

        .desktop-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            width: 100px; /* Slightly wider for better spacing */
            cursor: pointer;
            transition: transform 0.15s ease, filter 0.15s ease;
            padding: 10px;
            border-radius: 15px;
            user-select: none;
            position: absolute;
        }

        .desktop-icon:hover {
            filter: brightness(1.1);
            background-color: transparent;
        }

        .desktop-icon:active {
            transform: scale(0.95);
            filter: brightness(0.9);
            background-color: transparent;
        }

        .desktop-icon .icon-image { /* Sizing for dynamically loaded image */
            width: 60px;
            height: 60px;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.8));
            transition: filter 0.15s ease;
        }

        .desktop-icon:hover .icon-image {
            /* Apply glow around the icon itself using drop-shadow */
            filter: drop-shadow(0 0 8px var(--primary-blue))
                    drop-shadow(0 0 15px var(--accent-glow-blue))
                    drop-shadow(0 0 25px rgba(0, 191, 255, 0.3));
        }

        .desktop-icon:active .icon-image {
            filter: drop-shadow(0 0 3px rgba(0,0,0,0.6));
        }

        .desktop-icon-label {
            font-size: 0.9rem;
            color: white;
            text-shadow: 1px 1px 4px rgba(0,0,0,0.9);
            margin-top: 10px;
            word-wrap: break-word;
            max-width: 100%;
        }

        /* Start Menu styles - Highly glass-like */
        .start-menu {
            position: absolute;
            bottom: var(--taskbar-height);
            left: 10px;
            width: 380px;
            height: auto;
            max-height: calc(100% - var(--taskbar-height) - 40px);
            background: linear-gradient(to bottom right, rgba(0, 191, 255, 0.3), rgba(0, 122, 204, 0.2));
            backdrop-filter: blur(28px);
            -webkit-backdrop-filter: blur(28px);
            border: 2px solid var(--glass-border-light);
            border-radius: 25px;
            box-shadow: 0 20px 60px var(--fa-glow-blue), inset 0 0 30px rgba(255, 255, 255, 0.5);
            padding: 20px;
            display: none;
            flex-direction: column;
            z-index: 100;
            transform-origin: bottom left;
            animation: fadeInScaleUpFromBottomLeft 0.3s ease-out forwards;
            overflow-y: auto;
        }

        .start-menu.hidden {
            display: none;
        }
        .start-menu.visible {
            display: flex;
        }

        /* Start Menu header (with profile info) - More defined */
        .start-menu-header {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 15px;
            background: linear-gradient(to right, rgba(0,191,255,0.6) 0%, rgba(0,122,204,0.6) 100%);
            border-radius: 18px;
            border: 1px solid var(--glass-border-light);
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.5), inset 0 -1px 5px rgba(255,255,255,0.4);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }
        .start-menu-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at top left, rgba(255,255,255,0.2) 0%, transparent 50%);
            border-radius: inherit;
            pointer-events: none;
        }
        .start-menu-header:hover {
            transform: translateX(8px);
            box-shadow: 0 8px 20px var(--fa-glow-blue), inset 0 2px 10px rgba(255,255,255,0.6);
            filter: brightness(1.2);
        }

        .start-menu-header span {
            color: white;
            font-size: 1.3rem;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(0, 191, 255, 0.8);
        }

        /* Start Menu item styles - More interactive and glossy */
        .start-menu-item {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            color: var(--text-color);
            text-decoration: none;
            transition: background-color 0.2s ease, transform 0.15s ease, filter 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer;
            font-size: 1.05rem;
            font-weight: normal;
            border-radius: 12px;
            margin: 6px 0;
            position: relative;
            overflow: hidden;
            box-shadow: var(--fa-inner-highlight), var(--fa-dark-gloss-effect);
            border: 1px solid var(--glass-border-dark);
        }

        .start-menu-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s ease;
        }

        .start-menu-item:hover::before {
            left: 100%;
        }

        .start-menu-item:hover {
            background: linear-gradient(to right, rgba(0, 191, 255, 0.7) 0%, rgba(0, 122, 204, 0.7) 100%);
            transform: translateX(10px);
            color: white;
            text-shadow: 0 0 12px rgba(255,255,255,1);
            filter: brightness(1.4);
            box-shadow: var(--fa-glow-blue), inset 0 0 10px rgba(0,0,0,0.5);
        }

        .start-menu-item .icon-image {
            margin-right: 18px;
            width: 1.5em;
            height: 1.5em;
            filter: drop-shadow(0 0 8px rgba(0, 191, 255, 0.7));
            transition: filter 0.2s ease;
        }
        .start-menu-item:hover .icon-image {
            filter: brightness(2) drop-shadow(0 0 15px rgba(255,255,255,1));
        }
        
        .start-menu-item .menu-item-label {
            flex-grow: 1;
            text-align: left;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Start Menu Buttons Container (for Settings and Shutdown) */
        .start-menu-buttons-container { 
            display: flex;
            flex-direction: row;
            justify-content: flex-end;
            gap: 15px;
            padding-top: 18px;
            margin-top: 18px;
            padding-right: 10px;
            border-top: 1px solid var(--glass-border-dark);
        }

        /* New style for icon-only buttons in the start menu footer - more jelly-like */
        .start-menu-footer-button {
            width: 58px;
            height: 58px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(to bottom, rgba(0,191,255,0.5) 0%, rgba(0,122,204,0.2) 100%);
            border: 2px solid var(--glass-border-light);
            border-radius: 15px;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.6), inset 0 2px 8px rgba(255,255,255,0.5);
            position: relative;
            overflow: hidden;
        }
        .start-menu-footer-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at top left, rgba(255,255,255,0.3) 0%, transparent 50%);
            border-radius: inherit;
            pointer-events: none;
        }

        .start-menu-footer-button:hover {
            background: linear-gradient(to bottom, rgba(0,191,255,0.6) 0%, rgba(0,122,204,0.3) 100%);
            transform: translateY(-4px);
            box-shadow: 0 6px 20px var(--fa-glow-blue), inset 0 2px 10px rgba(255,255,255,0.7);
        }

        .start-menu-footer-button:active {
            transform: translateY(0);
            background: linear-gradient(to top, rgba(0,191,255,0.5) 0%, rgba(0,122,204,0.2) 100%);
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.8), inset 0 -2px 6px rgba(255,255,255,0.5);
            filter: brightness(0.9);
        }

        .start-menu-footer-button .icon-image {
            width: 32px;
            height: 32px;
            filter: drop-shadow(0 0 8px rgba(0, 191, 255, 0.7));
        }

        /* Animation for menu appearance - Adjusted for bottom-left origin */
        @keyframes fadeInScaleUpFromBottomLeft {
            from {
                opacity: 0;
                transform: scale(0.6);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Window styles (retaining glassmorphism) - Main focus of Aero */
        .os-window {
            position: absolute;
            background: linear-gradient(to bottom right, rgba(0, 191, 255, 0.2), rgba(0, 122, 204, 0.1));
            backdrop-filter: blur(35px);
            -webkit-backdrop-filter: blur(35px);
            border: 2px solid var(--glass-border-light);
            border-bottom: 2px solid var(--glass-border-dark);
            border-right: 2px solid var(--glass-border-dark);
            border-radius: 20px;
            box-shadow: 0 10px 40px var(--fa-glow-blue), inset 0 0 25px rgba(255, 255, 255, 0.4);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-width: 400px;
            min-height: 300px;
            z-index: 5;
            animation: windowPopIn 0.3s ease-out forwards;
            resize: both;
        }

        .os-window.minimized {
            display: none;
        }

        .os-window.maximized {
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: calc(100% - var(--taskbar-height)) !important;
            border-radius: 0;
            box-shadow: none;
            transition: all 0.3s ease-in-out;
            border: none;
        }

        /* Window title bar - Enhanced Frutiger Aero style */
        .os-window-title-bar {
            background: var(--fa-title-active-gradient);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 10px 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--glass-border-dark);
            cursor: grab;
            border-radius: 18px 18px 0 0;
            position: relative;
            font-size: 1.1rem;
            font-weight: bold;
            color: white;
            text-shadow: 0 1px 3px rgba(0,0,0,0.7);
            box-shadow: inset 0 1px 4px rgba(255,255,255,0.2);
        }
        /* Glassy internal highlight for title bar */
        .os-window-title-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(255,255,255,0.08) 0%, transparent 60%);
            pointer-events: none;
            border-radius: inherit;
        }

        .os-window-title-bar.inactive {
            background: var(--fa-title-inactive-gradient);
            border-bottom: 1px solid rgba(0, 122, 204, 0.5);
            box-shadow: inset 0 1px 4px rgba(255,255,255,0.1);
        }
        .os-window-title-bar.inactive::after {
            background: linear-gradient(to bottom, rgba(255,255,255,0.05) 0%, transparent 60%);
        }

        /* Window title and logo container */
        .os-window-title-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .os-window-title-content .icon-image {
            width: 32px;
            height: 32px;
            filter: drop-shadow(0 0 8px rgba(0, 191, 255, 0.7));
        }

        .os-window-title {
            color: white;
            text-shadow: 0 1px 3px rgba(0,0,0,0.7);
        }

        /* Window control buttons (minimize, maximize, close) - Smaller and more prominent */
        .os-window-controls {
            display: flex;
            gap: 6px;
        }

        .os-window-controls .control-button {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            color: white;
            cursor: pointer;
            transition: background-color 0.15s ease, transform 0.1s ease, box-shadow 0.15s ease;
            box-shadow: inset 0 1px 4px rgba(255,255,255,0.7), 0 1px 4px rgba(0,0,0,0.4);
            border: 1px solid rgba(0, 191, 255, 0.6);
            background: rgba(0,191,255,0.15);
            position: relative;
            overflow: hidden;
        }
        .os-window-controls .control-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at top left, rgba(255,255,255,0.3) 0%, transparent 60%);
            border-radius: 50%;
            opacity: 0.8;
            pointer-events: none;
        }

        /* Specific button colors for hover/active states */
        .os-window-controls .control-button.close { background: rgba(0,191,255,0.15); border-color: rgba(0,191,255,0.6); }
        .os-window-controls .control-button.minimize { background: rgba(0,191,255,0.15); border-color: rgba(0,191,255,0.6); }
        .os-window-controls .control-button.maximize { background: rgba(0,191,255,0.15); border-color: rgba(0,191,255,0.6); }

        .os-window-controls .control-button:hover {
            transform: scale(1.1);
            filter: brightness(1.2);
            box-shadow: inset 0 1px 6px rgba(255,255,255,0.8), 0 2px 8px rgba(0,0,0,0.5);
            background: rgba(0,191,255,0.3);
        }
        .os-window-controls .control-button.close:hover { background: rgba(0,191,255,0.3); border-color: rgba(0,191,255,0.8); }
        .os-window-controls .control-button.minimize:hover { background: rgba(0,191,255,0.3); border-color: rgba(0,191,255,0.8); }
        .os-window-controls .control-button.maximize:hover { background: rgba(0,191,255,0.3); border-color: rgba(0,191,255,0.8); }

        .os-window-controls .control-button:active {
            transform: scale(0.95);
            opacity: 1;
            box-shadow: inset 0 0 6px rgba(0,0,0,0.7), inset 0 -1px 4px rgba(255,255,255,0.5);
            filter: brightness(0.9);
            background: rgba(0,191,255,0.08);
        }
        .os-window-controls .control-button .icon-image {
            width: 0.9em;
            height: 0.9em;
            filter: drop-shadow(0 0 8px rgba(0, 191, 255, 0.7));
        }

        /* Window content area */
        .os-window-content {
            flex-grow: 1;
            padding: 25px;
            color: var(--text-color);
            font-size: 1rem;
            line-height: 1.7;
            overflow: auto;
        }

        /* Status bar at the bottom of each window */
        .os-window-status-bar {
            background: linear-gradient(to top, rgba(0, 191, 255, 0.4) 0%, rgba(0, 122, 204, 0.4) 100%);
            border-top: 2px solid rgba(255, 255, 255, 0.5);
            padding: 10px 20px;
            color: white;
            text-align: right;
            border-radius: 0 0 18px 18px;
            box-shadow: inset 0 -2px 8px rgba(0,0,0,0.5);
        }

        /* Markdown specific styles within window content - tuned for Aero readability */
        .os-window-content .markdown-content h1 { font-size: 2.4em; margin-bottom: 0.7em; color: white; border-bottom: 3px solid var(--primary-blue); padding-bottom: 0.5em; text-shadow: 0 0 10px rgba(255,255,255,0.6); }
        .os-window-content .markdown-content h2 { font-size: 2em; margin-bottom: 0.6em; color: white; text-shadow: 0 0 8px rgba(255,255,255,0.4); }
        .os-window-content .markdown-content h3 { font-size: 1.6em; margin-bottom: 0.5em; color: white; text-shadow: 0 0 5px rgba(255,255,255,0.6); }
        .os-window-content .markdown-content p { margin-bottom: 1.4em; opacity: 0.98; color: var(--text-color); }
        .os-window-content .markdown-content ul, .os-window-content .markdown-content ol { margin-left: 2.5em; margin-bottom: 1.4em; list-style-type: disc; opacity: 0.95; color: var(--text-color); }
        .os-window-content .markdown-content li { margin-bottom: 0.8em; }
        .os-window-content .markdown-content strong { font-weight: bold; color: white; text-shadow: 0 0 4px rgba(255,255,255,0.6); }
        .os-window-content .markdown-content em { font-style: italic; opacity: 0.95; color: var(--text-color); }
        .os-window-content .markdown-content a { color: var(--primary-blue); text-decoration: underline; text-shadow: 0 0 8px rgba(0,191,255,0.4); }
        .os-window-content .markdown-content code { background-color: rgba(0,0,0,0.5); padding: 0.3em 0.6em; border-radius: 8px; font-family: monospace; font-size: 0.95em; border: 1px solid rgba(255,255,255,0.3); color: white; }
        .os-window-content .markdown-content pre { background-color: rgba(0,0,0,0.6); padding: 1.5em; border-radius: 12px; overflow-x: auto; margin-bottom: 1.8em; border: 2px solid rgba(255,255,255,0.4); box-shadow: inset 0 0 8px rgba(0,0,0,0.6); color: white; }
        .os-window-content .markdown-content blockquote { border-left: 8px solid var(--primary-blue); padding-left: 2em; margin-left: 0; opacity: 0.85; background-color: rgba(0,191,255,0.25); border-radius: 10px; padding-top: 1em; padding-bottom: 1em; color: var(--text-color); }


        /* Window pop-in animation - more subtle */
        @keyframes windowPopIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* Works grid specific styles */
        .works-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 25px;
            padding: 20px;
        }

        .work-card {
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));
            border: 2px solid var(--glass-border-light);
            border-bottom: 2px solid var(--glass-border-dark);
            border-right: 2px solid var(--glass-border-dark);
            border-radius: 20px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.25s ease-in-out, filter 0.25s ease, box-shadow 0.25s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6), inset 0 0 12px rgba(255,255,255,0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding-bottom: 15px;
            position: relative;
            overflow: hidden;
        }
        .work-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at top left, rgba(255,255,255,0.15) 0%, transparent 55%);
            border-radius: inherit;
            pointer-events: none;
        }


        .work-card:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 8px 25px var(--fa-glow-blue), inset 0 0 15px rgba(255,255,255,0.3);
            border-color: var(--primary-blue);
            filter: brightness(1.2);
            background: linear-gradient(to bottom, rgba(0, 191, 255, 0.2), rgba(0, 122, 204, 0.1));
        }

        .work-card img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 18px 18px 0 0;
            filter: brightness(0.95);
            transition: filter 0.2s ease;
        }

        .work-card:hover img {
            filter: brightness(1.2);
        }

        .work-card-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-top: 15px;
            color: white;
            text-shadow: 0 0 8px rgba(0,191,255,0.4);
        }

        .work-card-category {
            font-size: 0.9rem;
            color: var(--text-color);
            opacity: 0.95;
            margin-top: 6px;
        }

        /* Work Detail Window Specific Styles */
        .work-detail-content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .work-detail-content .gallery-main-image-container {
            position: relative;
            width: 100%;
            max-width: 700px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border-radius: 15px;
            overflow: hidden;
            border: 3px solid var(--glass-border-light);
        }

        .work-detail-content .gallery-main-image {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 12px;
        }

        .work-detail-content .gallery-nav-button {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border: 2px solid rgba(255,255,255,0.6);
            padding: 15px;
            cursor: pointer;
            font-size: 2rem;
            border-radius: 50%;
            transition: background-color 0.25s ease, filter 0.25s ease, box-shadow 0.25s ease;
            z-index: 2;
            box-shadow: 0 6px 15px rgba(0,0,0,0.6);
        }

        .work-detail-content .gallery-nav-button:hover {
            background: rgba(0, 0, 0, 0.95);
            filter: brightness(1.4);
            box-shadow: 0 8px 20px rgba(0,0,0,0.8);
        }
        .work-detail-content .gallery-nav-button .icon-image {
            width: 2em;
            height: 2em;
            filter: drop-shadow(0 0 8px rgba(0, 191, 255, 0.7));
        }

        .work-detail-content .gallery-nav-button.prev {
            left: 20px;
        }

        .work-detail-content .gallery-nav-button.next {
            right: 20px;
        }

        .work-detail-content .gallery-thumbnails {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
            margin-bottom: 25px;
        }

        .work-detail-content .gallery-thumbnail {
            width: 100px;
            height: 80px;
            object-fit: cover;
            border-radius: 10px;
            border: 3px solid transparent;
            cursor: pointer;
            transition: border-color 0.25s ease, transform 0.15s ease, filter 0.25s ease, box-shadow 0.25s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }

        .work-detail-content .gallery-thumbnail.active {
            border-color: var(--primary-blue);
            transform: scale(1.15);
            box-shadow: 0 0 20px var(--fa-glow-blue);
        }
        .work-detail-content .gallery-thumbnail:hover {
            filter: brightness(1.2);
            box-shadow: 0 0 12px var(--fa-glow-blue);
        }

        .work-detail-content h3 {
            font-size: 2rem;
            font-weight: bold;
            color: white;
            margin-bottom: 15px;
            text-align: center;
            text-shadow: 0 0 10px rgba(0,191,255,0.6);
        }
        .work-detail-content p {
            margin-bottom: 15px;
            text-align: justify;
            font-size: 1rem;
            color: var(--text-color);
        }
        .work-detail-content .category-tag {
            display: inline-block;
            background-color: rgba(0, 191, 255, 0.5);
            border: 1px solid var(--primary-blue);
            border-radius: 10px;
            padding: 6px 12px;
            font-size: 0.9rem;
            color: white;
            margin-top: 15px;
            text-shadow: 0 0 5px rgba(0,0,0,0.6);
            box-shadow: inset 0 0 8px rgba(255,255,255,0.2);
        }
        .service-category-card {
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));
            border: 2px solid var(--glass-border-light);
            border-bottom: 2px solid var(--glass-border-dark);
            border-right: 2px solid var(--glass-border-dark);
            border-radius: 15px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.25s ease-in-out, filter 0.25s ease, box-shadow 0.25s ease;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5), inset 0 0 10px rgba(255,255,255,0.2);
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 120px;
            position: relative;
            overflow: hidden;
        }
        .service-category-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at top left, rgba(255,255,255,0.2) 0%, transparent 60%);
            border-radius: inherit;
            pointer-events: none;
        }
        .service-category-card:hover {
            transform: translateY(-8px) scale(1.03);
            box-shadow: 0 10px 25px var(--fa-glow-blue), inset 0 0 12px rgba(255,255,255,0.3);
            border-color: var(--primary-blue);
            filter: brightness(1.2);
            background: linear-gradient(to right, rgba(0, 191, 255, 0.3), rgba(0, 122, 204, 0.2));
        }

        /* Taskbar icon for minimized windows - more glassy */
        .taskbar-minimized-icon {
            background: linear-gradient(to top, rgba(0, 191, 255, 0.4), rgba(0, 122, 204, 0.3));
            border: 1px solid var(--glass-border-light);
            border-radius: 12px;
            padding: 8px 12px;
            margin: 0 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            font-size: 0.9rem;
            box-shadow: inset 0 1px 6px rgba(255,255,255,0.7), 0 2px 8px rgba(0,0,0,0.6);
            transition: all 0.25s ease;
            white-space: nowrap;
            max-width: 160px;
            overflow: hidden;
            text-overflow: ellipsis;
            position: relative;
            overflow: hidden;
        }
        .taskbar-minimized-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at top left, rgba(255,255,255,0.4) 0%, transparent 60%);
            border-radius: inherit;
            pointer-events: none;
        }


        .taskbar-minimized-icon:hover {
            background: linear-gradient(to top, rgba(0, 191, 255, 0.5), rgba(0, 122, 204, 0.4));
            transform: translateY(-4px);
            box-shadow: inset 0 1px 8px rgba(255,255,255,0.8), 0 4px 15px rgba(0,0,0,0.7);
        }

        /* Active taskbar icon style */
        .taskbar-minimized-icon.active {
            background: linear-gradient(to bottom, rgba(0, 191, 255, 0.8) 0%, rgba(0, 122, 204, 0.8) 100%);
            border-color: var(--primary-blue);
            box-shadow: inset 0 1px 8px rgba(0,0,0,0.8), 0 0 12px var(--primary-blue);
            transform: translateY(0);
        }
        .taskbar-minimized-icon.active::before {
            background: radial-gradient(circle at top left, rgba(255,255,255,0.5) 0%, transparent 60%);
        }


        .taskbar-minimized-icon .icon-image {
            width: 1.2em;
            height: 1.2em;
            filter: drop-shadow(0 0 8px rgba(0, 191, 255, 0.7));
            transition: filter 0.2s ease;
        }
        .taskbar-minimized-icon.active .icon-image {
            filter: brightness(2) drop-shadow(0 0 12px rgba(255,255,255,1));
        }

        /* Loading spinner styles */
        .loading-spinner {
            border: 5px solid rgba(255, 255, 255, 0.4);
            border-top: 5px solid var(--primary-blue);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 0.8s linear infinite;
            margin: 25px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Sub-menu for language selection */
        .start-menu-submenu {
            position: absolute;
            left: 100%;
            top: 0;
            width: 250px;
            background: linear-gradient(to bottom right, rgba(0, 191, 255, 0.35), rgba(0, 122, 204, 0.25));
            backdrop-filter: blur(28px);
            -webkit-backdrop-filter: blur(28px);
            border: 2px solid var(--glass-border-light);
            border-radius: 20px;
            box-shadow: 0 10px 40px var(--fa-glow-blue), inset 0 0 20px rgba(255, 255, 255, 0.4);
            padding: 15px;
            display: none;
            flex-direction: column;
            z-index: 101;
        }
        .start-menu-item.has-submenu:hover .start-menu-submenu {
            display: flex;
        }

        /* Toggle switch styles - more Aero-like */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 70px;
            height: 40px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #909090;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 40px;
            box-shadow: inset 0 0 6px rgba(0,0,0,0.5);
            border: 2px solid rgba(255,255,255,0.4);
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 32px;
            width: 32px;
            left: 4px;
            bottom: 4px;
            background: linear-gradient(to bottom, #FFFFFF 0%, #F0F0F0 100%);
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 3px 8px rgba(0,0,0,0.4), inset 0 1px 4px rgba(255,255,255,0.5);
        }

        input:checked + .toggle-slider {
            background: linear-gradient(to right, var(--primary-blue) 0%, var(--mid-blue) 100%);
            border-color: var(--dark-blue);
        }

        input:focus + .toggle-slider {
            box-shadow: 0 0 1px var(--primary-blue), inset 0 0 8px rgba(0,0,0,0.5);
        }

        input:checked + .toggle-slider:before {
            -webkit-transform: translateX(30px);
            -ms-transform: translateX(30px);
            transform: translateX(30px);
        }

        /* Round sliders */
        .toggle-slider.round {
            border-radius: 40px;
        }

        .toggle-slider.round:before {
            border-radius: 50%;
        }

        /* Custom Scrollbar Styles (for Webkit browsers like Chrome/Safari) */
        /* Track */
        ::-webkit-scrollbar {
            width: 20px;
        }

        /* Handle */
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, rgba(0, 191, 255, 0.9), rgba(0, 122, 204, 0.9));
            border-radius: 15px;
            border: 4px solid rgba(255, 255, 255, 0.5);
            transition: background 0.2s ease, box-shadow 0.2s ease;
            box-shadow: inset 0 0 10px rgba(255,255,255,0.3);
        }

        /* Handle on hover */
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, rgba(0, 191, 255, 1), rgba(0, 122, 204, 1));
            box-shadow: inset 0 0 12px rgba(255,255,255,0.4), 0 0 20px rgba(0,191,255,0.8);
        }

        /* Track background */
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
        }

        /* Buttons (arrows) - more prominent and glossy */
        ::-webkit-scrollbar-button {
            background: linear-gradient(to bottom, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0.15) 100%);
            border-radius: 50%;
            height: 28px;
            width: 28px;
            display: block;
            border: 2px solid rgba(255, 255, 255, 0.8);
            box-shadow: inset 0 2px 8px rgba(255,255,255,0.9), 0 2px 10px rgba(0,0,0,0.7);
            transition: background-color 0.15s ease, transform 0.08s ease, box-shadow 0.15s ease;
        }

        ::-webkit-scrollbar-button:hover {
            background: linear-gradient(to bottom, rgba(255,255,255,0.5) 0%, rgba(255,255,255,0.2) 100%);
            transform: scale(1.15);
            filter: brightness(1.3);
            box-shadow: inset 0 2px 10px rgba(255,255,255,1), 0 4px 15px rgba(0,0,0,0.8);
        }

        ::-webkit-scrollbar-button:active {
            background: linear-gradient(to top, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0.15) 100%);
            transform: scale(0.9);
            opacity: 1;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.9), inset 0 -2px 8px rgba(255,255,255,0.7);
            filter: brightness(0.8);
        }

        /* For Firefox scrollbars */
        html {
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 191, 255, 0.9) rgba(255, 255, 255, 0.15);
        }
    </style>
</head>
<body>
    <!-- Desktop background layer for dynamic Frutiger Aero style background -->
    <div class="desktop-background" id="desktop-background"></div>

    <!-- Desktop container, simulating a screen -->
    <div class="desktop-container" id="desktop-container">
        <!-- Desktop Layout - holds the main desktop area and the taskbar -->
        <div class="desktop-layout">
            <!-- Main Desktop Area - where icons and windows reside -->
            <div class="main-desktop-area" id="main-desktop-area">
                <!-- Initial welcome message, will be hidden when windows open -->
                <!-- Removed the welcome message entirely as requested -->
                
                <!-- Desktop Icons (Shortcuts) -->
                <div class="desktop-icons-container" id="desktop-icons-container">
                    <div class="desktop-icon" data-section="works" data-title-zh="我的作品集" data-title-en="My Works">
                        <span class="icon-placeholder" data-asset-key="icon_works"></span>
                        <span class="desktop-icon-label" data-lang-key="worksIcon">作品集</span>
                    </div>
                    <div class="desktop-icon" data-section="characters" data-title-zh="角色库" data-title-en="Characters">
                        <span class="icon-placeholder" data-asset-key="icon_characters"></span>
                        <span class="desktop-icon-label" data-lang-key="charactersIcon">角色</span>
                    </div>
                    <!-- About Me icon changed to mazko.exe with M icon -->
                    <div class="desktop-icon" data-section="about" data-title-zh="关于 MAZKO" data-title-en="About MAZKO">
                        <span class="icon-placeholder" data-asset-key="icon_mazko_logo"></span>
                        <span class="desktop-icon-label" data-lang-key="mazkoExeIcon">MAZKO</span>
                    </div>
                    <div class="desktop-icon" data-section="services" data-title-zh="服务与报价" data-title-en="Services & Pricing">
                        <span class="icon-placeholder" data-asset-key="icon_services"></span>
                        <span class="desktop-icon-label" data-lang-key="servicesIcon">服务</span>
                    </div>
                    <div class="desktop-icon" data-section="socials" data-title-zh="社交媒体" data-title-en="Social Media">
                        <span class="icon-placeholder" data-asset-key="icon_socials"></span>
                        <span class="desktop-icon-label" data-lang-key="socialsIcon">社交</span>
                    </div>
                </div>
                <!-- Windows will be appended here by JavaScript -->
            </div>

            <!-- Start Menu -->
            <div id="start-menu" class="start-menu hidden">
                <div class="start-menu-header" data-section="about" data-title-zh="关于 MAZKO" data-title-en="About MAZKO"> <!-- Make header clickable to open About Me -->
                    <span class="icon-placeholder" data-asset-key="icon_mazko_logo"></span>
                    <span data-lang-key="profileName">MAZKO</span>
                </div>
                <a href="#" class="start-menu-item" data-section="works" data-lang-key="worksMenuItem" data-title-zh="我的作品集" data-title-en="My Works">
                    <span class="icon-placeholder" data-asset-key="icon_works"></span>
                    <span class="menu-item-label"></span>
                </a>
                <a href="#" class="start-menu-item" data-section="characters" data-lang-key="charactersMenuItem" data-title-zh="角色库" data-title-en="Characters">
                    <span class="icon-placeholder" data-asset-key="icon_characters"></span>
                    <span class="menu-item-label"></span>
                </a>
                <a href="#" class="start-menu-item" data-section="services" data-lang-key="servicesMenuItem" data-title-zh="服务与报价" data-title-en="Services & Pricing">
                    <span class="icon-placeholder" data-asset-key="icon_services"></span>
                    <span class="menu-item-label"></span>
                </a>
                <a href="#" class="start-menu-item" data-section="socials" data-lang-key="socialsMenuItem" data-title-zh="社交媒体" data-title-en="Social Media">
                    <span class="icon-placeholder" data-asset-key="icon_socials"></span>
                    <span class="menu-item-label"></span>
                </a>
                <!-- Removed the horizontal line as requested -->
                <!-- <div class="border-t border-gray-600 my-2 mx-4"></div> -->
                <!-- Settings and Shutdown Buttons in a container, now using start-menu-footer-button class -->
                <div class="start-menu-buttons-container">
                    <button class="start-menu-footer-button" data-section="settings" data-lang-key="settingsMenuItem" title="设置" data-title-zh="系统设置" data-title-en="Settings">
                        <span class="icon-placeholder" data-asset-key="icon_settings"></span>
                        <!-- Removed text span as requested -->
                    </button>
                    <button class="start-menu-footer-button" data-section="shutdown" data-lang-key="shutdownMenuItem" title="关闭系统" data-title-zh="关闭系统" data-title-en="Shutdown">
                        <span class="icon-placeholder" data-asset-key="icon_shutdown"></span>
                        <!-- Removed text span as requested -->
                    </button>
                </div>
            </div>

            <!-- Taskbar at the bottom -->
            <div class="taskbar" id="taskbar">
                <!-- Start Button changed to M icon -->
                <button class="start-button" id="start-button-taskbar">
                    <span class="icon-placeholder" data-asset-key="icon_mazko_logo" id="start-button-icon-placeholder"></span>
                    <!-- <span data-lang-key="startButton">开始</span> Removed text -->
                </button>

                <!-- Taskbar icons for open/minimized windows -->
                <div id="taskbar-icons" class="taskbar-icons-container">
                    <!-- Minimized window icons will be appended here -->
                </div>

                <!-- Right side system tray -->
                <div class="system-tray">
                    <div class="system-tray-icon">
                        <span class="icon-placeholder" data-asset-key="icon_wifi"></span>
                    </div>
                    <div class="system-tray-icon">
                        <span class="icon-placeholder" data-asset-key="icon_battery"></span>
                    </div>
                    <div class="system-tray-icon">
                        <span class="icon-placeholder" data-asset-key="icon_volume"></span>
                    </div>
                    <span class="text-sm text-white opacity-80" id="current-time"></span> <!-- Time display, kept white for contrast -->
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('Script started parsing.'); // Added for debugging
        
        /**
         * @object ASSETS
         * @description Centralized management of all image and icon paths.
         * All assets are now Base64 encoded for self-containment.
         */
        const ASSETS = {
            // Cursor images (simple black dot for default, cross for active, arrow for pointer)
            'cursor_default': 'data:image/svg+xml,%3Csvg width=\'16\' height=\'16\' viewBox=\'0 0 16 16\' fill=\'none\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Ccircle cx=\'8\' cy=\'8\' r=\'2\' fill=\'%23000000\'/%3E%3C/svg%3E',
            'cursor_active': 'data:image/svg+xml,%3Csvg width=\'16\' height=\'16\' viewBox=\'0 0 16 16\' fill=\'none\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M8 0V16M0 8H16\' stroke=\'%23000000\' stroke-width=\'2\'/%3E%3C/svg%3E',
            'cursor_pointer': 'data:image/svg+xml,%3Csvg width=\'16\' height=\'16\' viewBox=\'0 0 16 16\' fill=\'none\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M1 1L15 8L1 15V1L1 1Z\' fill=\'%23000000\' stroke=\'%23000000\' stroke-width=\'1\'/%3E%3C/svg%3E',

            // Desktop Icons / Start Menu Icons (simple SVG icons)
            'icon_works': 'data:image/svg+xml,%3Csvg width=\'64\' height=\'64\' viewBox=\'0 0 24 24\' fill=\'none\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M2 12V4C2 3.44772 2.44772 3 3 3H9L11 7H21C21.5523 7 22 7.44772 22 8V20C22 20.5523 21.5523 21 21 21H3C2.44772 21 2 20.5523 2 20V12Z\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3C/svg%3E',
            'icon_characters': 'data:image/svg+xml,%3Csvg width=\'64\' height=\'64\' viewBox=\'0 0 24 24\' fill=\'none\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M17 21V19C17 17.9391 16.5786 16.9217 15.8284 16.1716C15.0783 15.4214 14.0609 15 13 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21M17 21H23V19C23 17.9391 22.5786 16.9217 21.8284 16.1716C21.0783 15.4214 20.0609 15 19 15H17M9 3C11.2091 3 13 4.79086 13 7C13 9.20914 11.2091 11 9 11C6.79086 11 5 9.20914 5 7C5 4.79086 6.79086 3 9 3Z\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3C/svg%3E',
            'icon_mazko_logo': 'data:image/svg+xml,%3Csvg width=\'64\' height=\'64\' viewBox=\'0 0 24 24\' fill=\'none\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M7.5 12C7.5 10.16 8.96 8.75 10.75 8.75C12.54 8.75 14 10.16 14 12C14 13.84 12.54 15.25 10.75 15.25C8.96 15.25 7.5 13.84 7.5 12ZM10.75 7.5C13.29 7.5 15.33 9.38 15.33 12C15.33 14.62 13.29 16.5 10.75 16.5C8.21 16.5 6.17 14.62 6.17 12C6.17 9.38 8.21 7.5 10.75 7.5ZM2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2C6.48 2 2 6.48 2 12ZM3.33 12C3.33 7.21 7.21 3.33 12 3.33C16.79 3.33 20.67 7.21 20.67 12C20.67 16.79 16.79 20.67 12 20.67C7.21 20.67 3.33 16.79 3.33 12Z\' fill=\'%23FFFFFF\'/%3E%3C/svg%3E', // A generic 'M' shape in a circle, like a logo
            'icon_services': 'data:image/svg+xml,%3Csvg width=\'64\' height=\'64\' viewBox=\'0 0 24 24\' fill=\'none\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M18 13.5V18C18 19.1046 17.1046 20 16 20H4C2.89543 20 2 19.1046 2 18V6C2 4.89543 2.89543 4 4 4H10.5M18 13.5L22 9.5M22 9.5L18 5.5M22 9.5H16M13 10L10.5 12.5L13 15\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3C/svg%3E',
            'icon_socials': 'data:image/svg+xml,%3Csvg width=\'64\' height=\'64\' viewBox=\'0 0 24 24\' fill=\'none\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M18 8C19.6569 8 21 6.65685 21 5C21 3.34315 19.6569 2 18 2C16.3431 2 15 3.34315 15 5C15 6.65685 16.3431 8 18 8Z\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3Cpath d=\'M6 15C7.65685 15 9 13.6569 9 12C9 10.3431 7.65685 9 6 9C4.34315 9 3 10.3431 3 12C3 13.6569 4.34315 15 6 15Z\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3Cpath d=\'M18 22C19.6569 22 21 20.6569 21 19C21 17.3431 19.6569 16 18 16C16.3431 16 15 17.3431 15 19C15 20.6569 16.3431 22 18 22Z\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3Cpath d=\'M8.59 13.51L15.42 17.49\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3Cpath d=\'M15.41 6.51L8.59 10.49\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3C/svg%3E',

            // Taskbar System Tray Icons (simple SVG icons)
            'icon_wifi': 'data:image/svg+xml,%3Csvg width=\'24\' height=\'24\' viewBox=\'0 0 24 24\' fill=\'none\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M12 18V22\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3Cpath d=\'M12 12L12.01 12\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3Cpath d=\'M2.99998 8.00002C5.99998 5.00002 9.00002 3.00002 12 3.00002C15 3.00002 18 5.00002 21 8.00002\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3Cpath d=\'M5.99998 11C7.99998 9 10 7.99998 12 7.99998C14 7.99998 16 9 18 11\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3C/svg%3E',
            'icon_battery': 'data:image/svg+xml,%3Csvg width=\'24\' height=\'24\' viewBox=\'0 0 24 24\' fill=\'none\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M15 6H19C19.5523 6 20 6.44772 20 7V17C20 17.5523 19.5523 18 19 18H5C4.44772 18 4 17.5523 4 17V7C4 6.44772 4.44772 6 5 6H9M15 6V4C15 3.44772 14.5523 3 14 3H10C9.44772 3 9 3.44772 9 4V6M15 6H9M22 10V14\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3C/svg%3E',
            'icon_volume': 'data:image/svg+xml,%3Csvg width=\'24\' height=\'24\' viewBox=\'0 0 24 24\' fill=\'none\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M11 5L6 9H2V15H6L11 19V5Z\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3Cpath d=\'M19.07 4.93C20.6695 6.52936 21.5583 8.70776 21.5583 11C21.5583 13.2922 20.6695 15.4706 19.07 17.07\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3Cpath d=\'M15.54 8.46C16.3262 9.24614 16.7644 10.2986 16.7644 11.39C16.7644 12.4814 16.3262 13.5339 15.54 14.32\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3C/svg%3E',

            // Start Menu Footer Button Icons (simple SVG icons)
            'icon_settings': 'data:image/svg+xml,%3Csvg width=\'32\' height=\'32\' viewBox=\'0 0 24 24\' fill=\'none\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M12 2C12.5523 2 13 2.44772 13 3V5.07409C14.7351 5.25367 16.3475 5.92383 17.7088 6.98066L19.2912 5.3983C19.6817 5.00782 20.3183 5.00782 20.7088 5.3983L21.5983 6.28779C21.9888 6.67828 21.9888 7.31482 21.5983 7.70531L19.9575 9.34612C21.0143 10.7074 21.6845 12.3198 21.864 14H24V14C24 14.5523 23.5523 15 23 15H20.9259C20.7463 16.7351 20.0762 18.3475 19.0193 19.7088L20.6017 21.2912C20.9922 21.6817 20.9922 22.3183 20.6017 22.7088L19.7122 23.5983C19.3217 23.9888 18.6852 23.9888 18.2947 23.5983L16.6539 21.9575C15.2926 23.0143 13.6802 23.6845 12 23.864V24C11.4477 24 11 23.5523 11 23V21.864C9.26493 21.6845 7.65251 21.0143 6.29119 19.9575L4.70883 21.54C4.31834 21.9305 3.68179 21.9305 3.29131 21.54L2.40181 20.6505C2.01132 20.26 2.01132 19.6235 2.40181 19.233L4.04262 17.5922C2.98576 16.2309 2.31557 14.6185 2.13603 12.8833H0V12C0 11.4477 0.447715 11 1 11H3.07409C3.25367 9.26493 3.92383 7.65251 4.98066 6.29119L3.3983 4.70883C3.00782 4.31834 3.00782 3.68179 3.3983 3.29131L4.28779 2.40181C4.67828 2.01132 5.31482 2.01132 5.70531 2.40181L7.34612 4.04262C8.70744 2.98576 10.3198 2.31557 12 2.13603V2Z\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3Ccircle cx=\'12\' cy=\'12\' r=\'3\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3C/svg%3E',
            'icon_shutdown': 'data:image/svg+xml,%3Csvg width=\'32\' height=\'32\' viewBox=\'0 0 24 24\' fill=\'none\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M12 2V12\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3Cpath d=\'M18.364 5.63604C20.4184 7.69036 21.5817 10.3913 21.5817 13.2091C21.5817 16.0269 20.4184 18.7277 18.364 20.7821C16.3096 22.8364 13.6087 24 10.7909 24C7.97314 24 5.27228 22.8364 3.21796 20.7821C1.16364 18.7277 0 16.0269 0 13.2091C0 10.3913 1.16364 7.69036 3.21796 5.63604\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3C/svg%3E',

            // Window Control Button Icons (simple SVG icons)
            'icon_minus': 'data:image/svg+xml,%3Csvg width=\'24\' height=\'24\' viewBox=\'0 0 24 24\' fill=\'none\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M5 12H19\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3C/svg%3E',
            'icon_square': 'data:image/svg+xml,%3Csvg width=\'24\' height=\'24\' viewBox=\'0 0 24 24\' fill=\'none\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Crect x=\'3\' y=\'3\' width=\'18\' height=\'18\' rx=\'2\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3C/svg%3E',
            'icon_times': 'data:image/svg+xml,%3Csvg width=\'24\' height=\'24\' viewBox=\'0 0 24 24\' fill=\'none\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M6 18L18 6M6 6L18 18\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3C/svg%3E',
            'icon_window_restore': 'data:image/svg+xml,%3Csvg width=\'24\' height=\'24\' viewBox=\'0 0 24 24\' fill=\'none\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M4 14C4 12.8954 4.89543 12 6 12H18C19.1046 12 20 12.8954 20 14V18C20 19.1046 19.1046 20 18 20H6C4.89543 20 4 19.1046 4 18V14Z\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3Cpath d=\'M8 4C8 2.89543 8.89543 2 10 2H18C19.1046 2 20 2.89543 20 4V8\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3C/svg%3E',

            // Gallery Navigation Button Icons (simple SVG icons)
            'icon_chevron_left': 'data:image/svg+xml,%3Csvg width=\'24\' height=\'24\' viewBox=\'0 0 24 24\' fill=\'none\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M15 18L9 12L15 6\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3C/svg%3E',
            'icon_chevron_right': 'data:image/svg+xml,%3Csvg width=\'24\' height=\'24\' viewBox=\'0 0 24 24\' fill=\'none\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M9 18L15 12L9 6\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3C/svg%3E',

            // Social Media Icons (simple SVG icons)
            'icon_weibo': 'data:image/svg+xml,%3Csvg width=\'24\' height=\'24\' viewBox=\'0 0 24 24\' fill=\'none\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2Z\' fill=\'%23EA4C89\'/%3E%3Cpath d=\'M15.5 8C15.5 7.44772 15.0523 7 14.5 7H9.5C8.94772 7 8.5 7.44772 8.5 8V16C8.5 16.5523 8.94772 17 9.5 17H14.5C15.0523 17 15.5 16.5523 15.5 16V8Z\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3Cpath d=\'M12 10.5C12.8284 10.5 13.5 9.82843 13.5 9C13.5 8.17157 12.8284 7.5 12 7.5C11.1716 7.5 10.5 8.17157 10.5 9C10.5 9.82843 11.1716 10.5 12 10.5Z\' fill=\'%23FFFFFF\'/%3E%3Cpath d=\'M12 13C12.8284 13 13.5 12.3284 13.5 11.5C13.5 10.6716 12.8284 10 12 10C11.1716 10 10.5 10.6716 10.5 11.5C10.5 12.3284 11.1716 13 12 13Z\' fill=\'%23FFFFFF\'/%3E%3C/svg%3E',
            'icon_instagram': 'data:image/svg+xml,%3Csvg width=\'24\' height=\'24\' viewBox=\'0 0 24 24\' fill=\'none\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Crect x=\'2\' y=\'2\' width=\'20\' height=\'20\' rx=\'5\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3Cpath d=\'M16 3H16.01\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3Cpath d=\'M12 7C9.23858 7 7 9.23858 7 12C7 14.7614 9.23858 17 12 17C14.7614 17 17 14.7614 17 12C17 9.23858 14.7614 7 12 7Z\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3C/svg%3E',
            'icon_artstation': 'data:image/svg+xml,%3Csvg width=\'24\' height=\'24\' viewBox=\'0 0 24 24\' fill=\'none\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2Z\' fill=\'%2313AFF0\'/%3E%3Cpath d=\'M12 6L18 18H6L12 6Z\' fill=\'%23FFFFFF\'/%3E%3C/svg%3E',
            'icon_behance_square': 'data:image/svg+xml,%3Csvg width=\'24\' height=\'24\' viewBox=\'0 0 24 24\' fill=\'none\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Crect x=\'2\' y=\'2\' width=\'20\' height=\'20\' rx=\'2\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3Cpath d=\'M16 10C16 8.89543 15.1046 8 14 8H10C8.89543 8 8 8.89543 8 10V14C8 15.1046 8.89543 16 10 16H14C15.1046 16 16 15.1046 16 14V10Z\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3Cpath d=\'M10 8L14 16\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3C/svg%3E',
            'icon_envelope': 'data:image/svg+xml,%3Csvg width=\'24\' height=\'24\' viewBox=\'0 0 24 24\' fill=\'none\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M4 4H20C21.1046 4 22 4.89543 22 6V18C22 19.1046 21.1046 20 20 20H4C2.89543 20 2 19.1046 2 18V6C2 4.89543 2.89543 4 4 4Z\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3Cpath d=\'M22 6L12 13L2 6\' stroke=\'%23FFFFFF\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3C/svg%3E',

            // Desktop Background Image (a simple blue gradient base64 image)
            'desktop_background_image': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAEgAE/2vG/FwAAAABJRU5ErkJggg==' // A very small solid blue image for placeholder
        };

        /**
         * @function getAssetUrl
         * @description Retrieves the URL of the specified asset from the ASSETS object.
         * @param {string} assetKey - Key name in the ASSETS object.
         * @returns {string} URL path of the corresponding asset.
         */
        function getAssetUrl(assetKey) {
            return ASSETS[assetKey] || ''; 
        }

        /**
         * @object LANG_CONTENT
         * @description Centralized multi-language content for the UI.
         */
        const LANG_CONTENT = {
            zh: {
                systemName: 'MAX OS',
                systemVersion: 'v1.0.0',
                welcomeMessage: '欢迎来到 MAZKO 的虚拟终端',
                loadingMessage: '加载中...',
                errorLoadingContent: '加载内容失败：',
                unknownModule: '未知模块',
                profileName: 'MAZKO',
                startButton: '开始',
                // Desktop Icons / Menu Items
                worksIcon: '作品集',
                worksMenuItem: '我的作品集',
                charactersIcon: '角色',
                charactersMenuItem: '角色库',
                mazkoExeIcon: 'MAZKO',
                servicesIcon: '服务',
                servicesMenuItem: '服务与报价',
                socialsIcon: '社交',
                socialsMenuItem: '社交媒体',
                settingsMenuItem: '系统设置',
                shutdownMenuItem: '关机',
                shutdownMessage: '系统正在关机，再见！', // Added missing translation

                // Works Section
                worksTitle: '我的作品集',
                worksClickPrompt: '点击作品查看详情',
                worksDetailsSuffix: ' 作品详情',

                // Characters Section
                charactersTitle: '角色库',
                charactersDescription: '这里展示了我设计的一些角色，它们来自不同的世界和故事。',

                // About Section
                aboutTitle: '关于 MAZKO',
                aboutContent: `
# 关于 MAZKO

MAZKO 是一位专注于 **赛博朋克、Y2K、PSX 和故障艺术风格** 的数字艺术家。

我的创作领域涵盖：

* **三维模型与渲染**：高精度与低多边形模型，专注于复古未来主义美学。
* **概念艺术与插画**：将抽象想法转化为具象视觉，带有独特的赛博朋克氛围。
* **视觉特效与动画**：为您的项目增添动态和沉浸感。
* **用户界面设计**：秉持 Frutiger Aero、Y2K 等风格，创造直观而美观的界面。

我致力于通过艺术表达对科技、未来与怀旧的思考。

**联系我：**

欢迎通过以下方式与我联系，共同探索数字艺术的无限可能。

`,

                // Services Section
                services: {
                    title: '服务与报价',
                    description: '我提供以下数字艺术服务。每个服务都旨在满足您特定的创意需求。',
                    categories: [
                        {
                            id: 'character-modeling-category',
                            name: '角色建模与设计',
                            nameEn: 'Character Modeling & Design',
                            shortDescription: '创建独特且风格化的 3D/2D 角色。',
                            detailContent: `
# 角色建模与设计

我擅长从概念到最终渲染的各类角色设计，尤其是在 **PSX风格和低多边形** 领域有深入研究。

服务包括：

* **概念草图**：根据您的想法，提供多角度的角色概念图。
* **3D建模**：使用 Blender/ZBrush 等工具进行角色高低模制作。
* **纹理绘制**：结合 Substance Painter，为角色赋予复古像素或科幻质感。
* **骨骼绑定与动画（基础）**：提供基础的角色绑定和姿态设置。

**报价示例：**

* **PSX风格低多边形角色**：¥1500 - ¥5000 (根据细节复杂程度)
* **精细概念角色插画**：¥800 - ¥3000 (根据细节和背景)

**项目周期**：通常为 1-3 周。
`
                        },
                        {
                            id: 'poster-design-category',
                            name: '海报与视觉设计',
                            nameEn: 'Poster & Visual Design',
                            shortDescription: '制作具有赛博朋克和故障艺术感的宣传海报。',
                            detailContent: `
# 海报与视觉设计

我能为您创作出引人注目的 **赛博朋克、Y2K 或故障艺术风格** 的海报和各类视觉宣传品。

服务包括：

* **活动海报**：音乐节、游戏发布、艺术展览等主题海报。
* **品牌视觉**：符合您品牌调性的独特图形元素和宣传图。
* **数字插画**：用于网站、社交媒体或印刷品的定制插画。
* **动态图形（基础）**：为海报添加简单的动画效果。

**报价示例：**

* **单页概念海报**：¥1200 - ¥4000 (根据复杂度和修订次数)
* **系列视觉宣传图（3张）：**：¥3000 - ¥8000

**项目周期**：通常为 0.5-2 周。
`
                        }
                    ]
                },

                // Socials Section
                socialsTitle: '社交媒体',
                socialsDescription: '欢迎在以下平台关注我，与我互动。',
                socialsLinks: [
                    { name: '微博', url: 'https://weibo.com/yourprofile', iconAssetKey: 'icon_weibo' },
                    { name: 'Instagram', url: 'https://instagram.com/yourprofile', iconAssetKey: 'icon_instagram' },
                    { name: 'ArtStation', url: 'https://artstation.com/yourprofile', iconAssetKey: 'icon_artstation' },
                    { name: 'Behance', url: 'https://behance.net/yourprofile', iconAssetKey: 'icon_behance_square' },
                    { name: '邮箱', url: 'mailto:your.email@example.com', iconAssetKey: 'icon_envelope' }
                ],

                // Settings Section
                settings: {
                    title: '系统设置',
                    description: '调整您的系统偏好设置。',
                    options: [
                        { id: 'language-toggle', type: 'language-toggle', label: '切换语言' }, // Added missing label
                        { id: 'desktop-icons-toggle', type: 'toggle', checked: true, label: '显示桌面图标' },
                        { id: 'enable-animations', type: 'toggle', checked: true, disabled: true, label: '启用系统动画 (暂不可用)' },
                        { id: 'reset-settings', type: 'button', label: '重置所有设置' }
                    ]
                },
            },
            // Add English content for multi-language support
            en: {
                systemName: 'MAX OS',
                systemVersion: 'v1.0.0',
                welcomeMessage: 'Welcome to MAZKO\'s Virtual Terminal',
                loadingMessage: 'Loading...',
                errorLoadingContent: 'Failed to load content: ',
                unknownModule: 'Unknown Module',
                profileName: 'MAZKO',
                startButton: 'Start',
                // Desktop Icons / Menu Items
                worksIcon: 'Works',
                worksMenuItem: 'My Works',
                charactersIcon: 'Characters',
                charactersMenuItem: 'Characters Library',
                mazkoExeIcon: 'MAZKO',
                servicesIcon: 'Services',
                servicesMenuItem: 'Services & Pricing',
                socialsIcon: 'Socials',
                socialsMenuItem: 'Social Media',
                settingsMenuItem: 'System Settings',
                shutdownMenuItem: 'Shutdown',
                shutdownMessage: 'System is shutting down. Goodbye!', // Added missing translation

                // Works Section
                worksTitle: 'My Works',
                worksClickPrompt: 'Click on a work to view details',
                worksDetailsSuffix: ' Work Details',

                // Characters Section
                charactersTitle: 'Characters Library',
                charactersDescription: 'Here are some characters I designed, from different worlds and stories.',

                // About Section
                aboutTitle: 'About MAZKO',
                aboutContent: `
# About MAZKO

MAZKO is a digital artist specializing in **Cyberpunk, Y2K, PSX, and Glitch Art styles**.

My creative fields include:

* **3D Modeling & Rendering**: High-fidelity and low-poly models, focused on retro-futuristic aesthetics.
* **Concept Art & Illustration**: Transforming abstract ideas into concrete visuals, with a unique cyberpunk vibe.
* **Visual Effects & Animation**: Adding dynamic and immersive elements to your projects.
* **User Interface Design**: Adhering to Frutiger Aero, Y2K, and other styles to create intuitive and aesthetically pleasing interfaces.

I am dedicated to expressing thoughts on technology, the future, and nostalgia through art.

**Contact me:**

Feel free to contact me through the following methods to explore the endless possibilities of digital art.

`,

                // Services Section
                services: {
                    title: 'Services & Pricing',
                    description: 'I offer the following digital art services. Each service is designed to meet your specific creative needs.',
                    categories: [
                        {
                            id: 'character-modeling-category',
                            name: 'Character Modeling & Design',
                            nameEn: 'Character Modeling & Design',
                            shortDescription: 'Creating unique and stylized 3D/2D characters.',
                            detailContent: `
# Character Modeling & Design

I specialize in all types of character design from concept to final render, with a deep focus on **PSX style and low-poly**.

Services include：

* **Concept Sketches**: Providing multi-angle character concepts based on your ideas.
* **3D Modeling**: Creating high and low-poly characters using tools like Blender/ZBrush.
* **Texture Painting**: Using Substance Painter to give characters retro-pixel or sci-fi textures.
* **Rigging & Basic Animation**: Providing basic character rigging and pose setup.

**Pricing Examples:**

* **PSX Style Low-Poly Character**: ¥1500 - ¥5000 (depending on detail complexity)
* **Detailed Concept Character Illustration**: ¥800 - ¥3000 (depending on detail and background)

**Project Cycle**: Typically 1-3 weeks.
`
                        },
                        {
                            id: 'poster-design-category',
                            name: 'Poster & Visual Design',
                            nameEn: 'Poster & Visual Design',
                            shortDescription: '制作具有赛博朋克和故障艺术感的宣传海报。',
                            detailContent: `
# Poster & Visual Design

I can create striking **Cyberpunk, Y2K, or Glitch Art style** posters and various visual promotional materials for you.

Services include：

* **活动海报**：音乐节、游戏发布、艺术展览等主题海报。
* **品牌视觉**：符合您品牌调性的独特图形元素和宣传图。
* **数字插画**：用于网站、社交媒体或印刷品的定制插画。
* **动态图形（基础）**：为海报添加简单的动画效果。

**报价示例：**

* **单页概念海报**：¥1200 - ¥4000 (根据复杂度和修订次数)
* **系列视觉宣传图（3张）：**：¥3000 - ¥8000

**项目周期**：通常为 0.5-2 周。
`
                        }
                    ]
                },

                // Socials Section
                socialsTitle: '社交媒体',
                socialsDescription: '欢迎在以下平台关注我，与我互动。',
                socialsLinks: [
                    { name: '微博', url: 'https://weibo.com/yourprofile', iconAssetKey: 'icon_weibo' },
                    { name: 'Instagram', url: 'https://instagram.com/yourprofile', iconAssetKey: 'icon_instagram' },
                    { name: 'ArtStation', url: 'https://artstation.com/yourprofile', iconAssetKey: 'icon_artstation' },
                    { name: 'Behance', url: 'https://behance.net/yourprofile', iconAssetKey: 'icon_behance_square' },
                    { name: '邮箱', url: 'mailto:your.email@example.com', iconAssetKey: 'icon_envelope' }
                ],

                // Settings Section
                settings: {
                    title: '系统设置',
                    description: '调整您的系统偏好设置。',
                    options: [
                        { id: 'language-toggle', type: 'language-toggle', label: '切换语言' }, // Added missing label
                        { id: 'desktop-icons-toggle', type: 'toggle', checked: true, label: '显示桌面图标' },
                        { id: 'enable-animations', type: 'toggle', checked: true, disabled: true, label: '启用系统动画 (暂不可用)' },
                        { id: 'reset-settings', type: 'button', label: '重置所有设置' }
                    ]
                },
            }
        };


        let currentLanguage = 'zh'; // Moved declaration outside DOMContentLoaded

        document.addEventListener('DOMContentLoaded', () => {
            console.log('Script started parsing.'); // Added for debugging
            
            // JavaScript for dynamic elements (e.g., time display)
            function updateTime() {
                const now = new Date();
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const timeElement = document.getElementById('current-time');
                if (timeElement) {
                    timeElement.textContent = `${hours}:${minutes}`;
                } else {
                    console.warn('Time element not found.');
                }
            }

            // Update time every minute
            setInterval(updateTime, 60000); // Update every minute for HH:MM
            // Initial call to display time immediately
            updateTime();

            // Get elements for the desktop environment
            const startButton = document.getElementById('start-button-taskbar');
            const startMenu = document.getElementById('start-menu');
            const startMenuHeader = document.querySelector('.start-menu-header'); // Get the header
            const mainDesktopArea = document.getElementById('main-desktop-area');
            // Removed welcome message elements as requested
            // const welcomeMessage = document.getElementById('welcome-message');
            // let welcomeMessageText = document.getElementById('welcome-message-text'); 
            const taskbarIconsContainer = document.getElementById('taskbar-icons');
            const desktopIconsContainer = document.getElementById('desktop-icons-container');
            const desktopBackground = document.getElementById('desktop-background'); // Get desktop background element
            let highestZIndex = 5; // To manage window stacking order

            // Store references to open windows to re-render them on language change
            const openWindowsMap = new Map(); // Map<windowId, {section, chineseTitle, englishTitle, windowElement}>

            console.log('Core DOM elements and variables initialized.');

            /**
             * @function updateCursors
             * @description Dynamically updates CSS custom properties for cursors based on paths defined in ASSETS.
             * @returns {void}
             */
            function updateCursors() {
                const root = document.documentElement;
                root.style.setProperty('--cursor-default', `url('${getAssetUrl('cursor_default')}'), auto`);
                root.style.setProperty('--cursor-active', `url('${getAssetUrl('cursor_active')}'), auto`);
                root.style.setProperty('--cursor-pointer', `url('${getAssetUrl('cursor_pointer')}'), auto`);
                console.log('Custom cursors updated.');
            }

            /**
             * @function renderDynamicAssets
             * @description Iterates through all placeholder elements with `data-asset-key` attribute and replaces them with `<img>` tags, loading the corresponding images.
             * @returns {void}
             */
            function renderDynamicAssets() {
                document.querySelectorAll('.icon-placeholder[data-asset-key]').forEach(placeholder => {
                    const assetKey = placeholder.dataset.assetKey;
                    const iconUrl = getAssetUrl(assetKey);
                    if (iconUrl) {
                        // If placeholder already has an image, avoid adding duplicates
                        if (placeholder.querySelector('img')) {
                            placeholder.querySelector('img').src = iconUrl;
                        } else {
                            const img = document.createElement('img');
                            img.src = iconUrl;
                            img.alt = assetKey.replace('icon_', '').replace(/_/g, ' '); // Simple alt text
                            img.classList.add('icon-image'); // Apply general icon styles defined in CSS
                            placeholder.innerHTML = ''; // Clear any existing content
                            placeholder.appendChild(img);
                        }
                    } else {
                        console.warn(`Asset not found for key: ${assetKey}`);
                        // If asset not found, display a default broken icon, or keep it empty
                        placeholder.innerHTML = '⚠️';
                    }
                });

                // Check and set desktop background image (if defined in ASSETS)
                const desktopBgImage = getAssetUrl('desktop_background_image');
                console.log('Attempting to set desktop background. Path:', desktopBgImage); // Debug: Check path
                if (desktopBgImage && desktopBackground) {
                    // Set CSS variable for the image URL
                    desktopBackground.style.setProperty('--desktop-image-url', `url('${desktopBgImage}')`);
                    
                    desktopBackground.classList.add('desktop-background-image-active');
                    console.log('Desktop background image applied CSS properties. ClassList:', desktopBackground.classList.value);
                } else if (desktopBackground) {
                    // Ensure default background and effects are active if no image is used
                    desktopBackground.classList.remove('desktop-background-image-active');
                    desktopBackground.classList.add('desktop-background');
                    desktopBackground.style.removeProperty('--desktop-image-url'); // Remove the CSS variable
                    // Re-apply default background gradients if no image is set
                    desktopBackground.style.backgroundImage = `
                        radial-gradient(circle at 10% 90%, rgba(0,191,255,0.3) 0%, transparent 45%),
                        radial-gradient(circle at 90% 10%, rgba(0,191,255,0.3) 0%, transparent 45%),
                        radial-gradient(ellipse at center, rgba(0,122,204,0.15) 0%, transparent 55%),
                        linear-gradient(to bottom right, #3A92CE, #CCEEFF)
                    `;
                    desktopBackground.style.opacity = '0.95';
                    desktopBackground.style.filter = 'brightness(0.9) contrast(1.1)';
                    console.log('No desktop background image specified, falling back to gradients.');
                }
            }


            /**
             * @function updateUIForLanguage
             * @description Updates all UI text based on the current language setting.
             * @returns {void}
             */
            function updateUIForLanguage() {
                const langData = LANG_CONTENT[currentLanguage];

                // Update Start Menu header profile name
                const profileNameElement = startMenu.querySelector('[data-lang-key="profileName"]');
                if (profileNameElement) {
                    profileNameElement.textContent = langData.profileName;
                }

                // Update Desktop Icons
                document.querySelectorAll('.desktop-icon').forEach(icon => {
                    const langKey = icon.querySelector('.desktop-icon-label').dataset.langKey;
                    if (langKey && langData[langKey]) {
                        icon.querySelector('.desktop-icon-label').textContent = langData[langKey];
                    }
                    // Update data-title for window opening (using current language for display, but keep zh/en for internal)
                    icon.dataset.title = icon.dataset[`title-${currentLanguage}`];
                });

                // Update Start Menu Items (links and buttons)
                document.querySelectorAll('.start-menu-item').forEach(item => {
                    const langKey = item.dataset.langKey;
                    // Ensure both language versions exist before attempting to access
                    const chineseLabel = LANG_CONTENT.zh[langKey] || '';
                    const englishLabel = LANG_CONTENT.en[langKey] || '';

                    const labelSpan = item.querySelector('.menu-item-label');
                    if (labelSpan) {
                        labelSpan.textContent = `${chineseLabel} [${englishLabel}]`; 
                    }
                });

                // Update Start Menu Footer Buttons (now icon-only)
                document.querySelectorAll('.start-menu-footer-button').forEach(button => {
                    const langKey = button.dataset.langKey;
                    if (langKey && langData[langKey]) {
                        button.title = langData[langKey];
                    }
                });
                
                // Re-open/re-render all active windows
                reopenAllWindows();
                // Re-render all dynamic assets (icons) for current language
                renderDynamicAssets();
            }

            /**
             * @function getWindowTitles
             * @description Generates window titles in both Chinese and English based on the section and optional content.
             * @param {string} section - The section identifier (e.g., 'works', 'about', 'work-detail-123').
             * @param {Object} [currentWork=null] - The work object if the section is a work detail.
             * @param {Object} [currentCategory=null] - The service category object if the section is a service category detail.
             * @returns {{chineseTitle: string, englishTitle: string}} An object containing the Chinese and English titles.
             */
            function getWindowTitles(section, currentWork = null, currentCategory = null) {
                let chineseTitle = LANG_CONTENT[currentLanguage]?.unknownModule || 'Untitled Window';
                let englishTitle = LANG_CONTENT['en']?.unknownModule || 'Untitled Window';

                if (section.startsWith('work-detail-') && currentWork) {
                    chineseTitle = currentWork.title + (LANG_CONTENT[currentLanguage]?.worksDetailsSuffix || '');
                    englishTitle = currentWork.title + (LANG_CONTENT['en']?.worksDetailsSuffix || ''); 
                } else if (section.startsWith('service-category-') && currentCategory) {
                    chineseTitle = currentCategory.name;
                    englishTitle = currentCategory.nameEn || currentCategory.name; // Use nameEn if available, otherwise fallback
                } else {
                    // For main sections, use data-title-zh and data-title-en from desktop icons or menu items
                    const desktopIcon = document.querySelector(`.desktop-icon[data-section="${section}"]`);
                    const startMenuItem = document.querySelector(`.start-menu-item[data-section="${section}"]`);
                    const startMenuFooterButton = document.querySelector(`.start-menu-footer-button[data-section="${section}"]`);
                    const startMenuHeader = document.querySelector('.start-menu-header[data-section="about"]'); // For about section

                    if (desktopIcon) {
                        chineseTitle = desktopIcon.dataset.titleZh;
                        englishTitle = desktopIcon.dataset.titleEn;
                    } else if (startMenuItem) {
                        chineseTitle = LANG_CONTENT['zh'][`${section}MenuItem`]; 
                        englishTitle = LANG_CONTENT['en'][`${section}MenuItem`]; 
                    } else if (startMenuFooterButton) {
                        chineseTitle = LANG_CONTENT['zh'][`${section}MenuItem`]; 
                        englishTitle = LANG_CONTENT['en'][`${section}MenuItem`]; 
                    } else if (section === 'about' && startMenuHeader) {
                        chineseTitle = startMenuHeader.dataset.titleZh;
                        englishTitle = startMenuHeader.dataset.titleEn;
                    } else if (section === 'settings') {
                        chineseTitle = LANG_CONTENT[currentLanguage]?.settings?.title; 
                        englishTitle = LANG_CONTENT['en']?.settings?.title; 
                    } else if (section === 'shutdown') {
                        chineseTitle = LANG_CONTENT[currentLanguage]?.shutdownMenuItem; 
                        englishTitle = LANG_CONTENT['en'][`${section}MenuItem`]; 
                    }
                }
                return { chineseTitle, englishTitle };
            }


            /**
             * @function reopenAllWindows
             * @description Re-opens all currently active windows to update their content based on the current language.
             * @returns {Promise<void>}
             */
            async function reopenAllWindows() {
                // Get a snapshot of currently open windows and their original positions/sizes
                const activeWindowsData = [];
                document.querySelectorAll('.os-window').forEach(win => {
                    // Only re-open if not minimized, as minimized state will be re-applied
                    if (!win.classList.contains('minimized')) {
                        activeWindowsData.push({
                            section: win.dataset.section,
                            windowId: win.dataset.windowId,
                            originalLeft: win.dataset.originalLeft,
                            originalTop: win.dataset.originalTop,
                            originalWidth: win.dataset.originalWidth,
                            originalHeight: win.dataset.originalHeight,
                            isMaximized: win.classList.contains('maximized')
                        });
                        win.remove(); // Remove old window
                    }
                });
                // Clear taskbar icons for removed windows
                taskbarIconsContainer.innerHTML = '';

                // Re-open windows one by one
                for (const winData of activeWindowsData) {
                    const data = await fetchContent(winData.section); // Re-fetch content in new language
                    let contentHTML = '';
                    let isMarkdown = false;
                    let currentWork = null;
                    let currentCategory = null;

                    if (winData.section.startsWith('work-detail-')) {
                        const workId = winData.windowId.replace('work-detail-', '');
                        const worksData = await fetchContent('works'); // Re-fetch works data to find the work
                        currentWork = worksData.find(w => w.id === workId);
                    } else if (winData.section.startsWith('service-category-')) {
                        const categoryId = winData.windowId.replace('service-category-', '');
                        // Get category directly from LANG_CONTENT as it's static
                        currentCategory = LANG_CONTENT[currentLanguage]?.services?.categories.find(cat => cat.id === categoryId);
                    }

                    const { chineseTitle, englishTitle } = getWindowTitles(winData.section, currentWork, currentCategory);

                    // Re-generate content based on section and new language
                    switch (winData.section) {
                        case 'works':
                            contentHTML = `
                                <h2 class="text-xl font-bold mb-4">${chineseTitle}</h2>
                                <div class="works-grid">
                                    ${data?.map(work => `
                                        <div class="work-card" data-work-id="${work.id}">
                                            <img src="${work.thumbnail}" alt="${work.title}">
                                            <div class="work-card-title">${work.title}</div>
                                            <div class="work-card-category">${work.category}</div>
                                        </div>
                                    `).join('')}
                                </div>
                                <p class="mt-4 opacity-70 text-center">${LANG_CONTENT[currentLanguage]?.worksClickPrompt}</p>
                            `;
                            break;
                        case 'characters':
                            contentHTML = `
                                <h2 class="text-xl font-bold mb-4">${chineseTitle}</h2>
                                <p>${LANG_CONTENT[currentLanguage]?.charactersDescription}</p>
                                <div class="grid grid-cols-2 gap-4 mt-4">
                                    ${data?.map(char => `
                                        <div class="flex flex-col items-center">
                                            <img src="${char.image}" alt="${char.name}" class="rounded-lg shadow-md mb-2">
                                            <p class="font-bold">${char.name}</p>
                                            <p class="text-sm opacity-80 text-center">${char.description}</p>
                                        </div>
                                    `).join('')}
                                </div>
                            `;
                            break;
                        case 'about':
                            contentHTML = LANG_CONTENT[currentLanguage]?.aboutContent;
                            isMarkdown = true;
                            break;
                        case 'services':
                            contentHTML = marked.parse(LANG_CONTENT[currentLanguage]?.services?.description || '') + `
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                                    ${data?.categories.map(category => `
                                        <div class="service-category-card p-4 rounded-lg border border-primary-blue hover:bg-glass-bg cursor-pointer transition-all duration-200" data-category-id="${category.id}">
                                            <h3 class="font-bold text-lg text-light-blue">${category.name}</h3>
                                            <p class="text-sm opacity-80 mt-1">${category.shortDescription}</p>
                                        </div>
                                    `).join('')}
                                </div>
                            `;
                            break;
                        case 'socials':
                            contentHTML = marked.parse(LANG_CONTENT[currentLanguage]?.socialsDescription || '') + `
                                <div class="flex flex-wrap gap-4 mt-4">
                                    ${data?.links.map(link => `
                                        <a href="${link.url}" target="_blank" class="flex items-center space-x-2 text-white hover:text-primary-blue transition-colors">
                                            <span class="icon-placeholder" data-asset-key="${link.iconAssetKey}"></span>
                                            <span>${link.name}</span>
                                        </a>
                                    `).join('')}
                                </div>
                            `;
                            break;
                        case 'settings': // New case for settings window
                            contentHTML = marked.parse(LANG_CONTENT[currentLanguage]?.settings?.description || '') + `
                                <div class="flex flex-col gap-4 mt-4">
                                    ${data?.options.map(option => {
                                        const labelText = LANG_CONTENT[currentLanguage]?.settings?.options.find(opt => opt.id === option.id)?.label || option.label; 
                                        if (option.type === 'toggle') {
                                            return `
                                                <div class="flex items-center justify-between p-3 rounded-lg bg-white bg-opacity-5 border border-white border-opacity-20">
                                                    <label for="${option.id}" class="text-lg">${labelText}</label>
                                                    <label class="toggle-switch">
                                                        <input type="checkbox" id="${option.id}" ${option.checked ? 'checked' : ''} ${option.disabled ? 'disabled' : ''}>
                                                        <span class="toggle-slider round"></span>
                                                    </label>
                                                </div>
                                            `;
                                        } else if (option.type === 'language-toggle') {
                                            return `
                                                <div class="flex items-center justify-between p-3 rounded-lg bg-white bg-opacity-5 border border-white border-opacity-20">
                                                    <span class="text-lg">${labelText}</span>
                                                    <label class="toggle-switch">
                                                        <input type="checkbox" id="${option.id}" ${currentLanguage === 'en' ? 'checked' : ''}>
                                                        <span class="toggle-slider round"></span>
                                                    </label>
                                                </div>
                                            `;
                                        } else if (option.type === 'button') {
                                            return `
                                                <button id="${option.id}" class="py-2 px-4 rounded-lg bg-primary-blue hover:bg-dark-blue transition-colors text-white font-bold ${option.disabled ? 'opacity-50 cursor-not-allowed' : ''}" ${option.disabled ? 'disabled' : ''}>
                                                    ${labelText}
                                                </button>
                                            `;
                                        }
                                        return '';
                                    }).join('')}
                                </div>
                            `;
                            break;
                        case 'service-category-character-modeling-category': 
                        case 'service-category-poster-design-category':
                            contentHTML = currentCategory ? currentCategory.detailContent : `<p class="text-xl text-red-400">${LANG_CONTENT[currentLanguage]?.unknownModule}</p>`;
                            isMarkdown = true;
                            break;
                        case 'work-detail-' + winData.windowId.replace('work-detail-', ''):
                            if (currentWork) {
                                let currentImageIndex = 0; // This state is lost on re-render, will default to 0
                                contentHTML = `
                                    <div class="work-detail-content">
                                        <div class="gallery-main-image-container">
                                            <img src="${currentWork.images[currentImageIndex]}" alt="${currentWork.title}" class="gallery-main-image">
                                            ${currentWork.images.length > 1 ? `
                                                <button class="gallery-nav-button prev" data-direction="prev"><span class="icon-placeholder" data-asset-key="icon_chevron_left"></span></button>
                                                <button class="gallery-nav-button next" data-direction="next"><span class="icon-placeholder" data-asset-key="icon_chevron_right"></span></button>
                                            ` : ''}
                                        </div>
                                        ${currentWork.images.length > 1 ? `
                                            <div class="gallery-thumbnails">
                                                ${currentWork.images.map((imgSrc, index) => `
                                                    <img src="${imgSrc}" alt="${currentWork.title} thumbnail ${index + 1}" class="gallery-thumbnail ${index === currentImageIndex ? 'active' : ''}" data-index="${index}">
                                                `).join('')}
                                            </div>
                                        ` : ''}
                                        <h3>${currentWork.title}</h3>
                                        <p class="text-sm opacity-90 mb-2">${currentWork.category}</p>
                                        <p>${currentWork.description}</p>
                                        <div class="flex flex-wrap gap-2 mt-4">
                                            ${currentWork.tags.map(tag => `<span class="category-tag">${tag}</span>`).join('')}
                                        </div>
                                    </div>
                                `;
                            } else {
                                contentHTML = `<p class="text-xl text-red-400">${LANG_CONTENT[currentLanguage]?.unknownModule}</p>`;
                            }
                            break;
                        default:
                            contentHTML = `<p class="text-xl text-red-400">${LANG_CONTENT[currentLanguage]?.unknownModule || 'Unknown Module'}</p>`;
                    }

                    // Re-open the window with its original properties
                    const newWindowElement = await openWindow(winData.section, chineseTitle, englishTitle, contentHTML, winData.windowId, {
                        left: winData.originalLeft,
                        top: winData.originalTop,
                        width: winData.originalWidth,
                        height: winData.originalHeight
                    }, isMarkdown);

                    if (winData.isMaximized) {
                        newWindowElement.classList.add('maximized');
                        // Re-apply maximized styles if necessary, or let CSS handle it
                        newWindowElement.style.borderRadius = '0';
                        newWindowElement.style.boxShadow = 'none';
                    }
                }
            }


            // --- Desktop Icon Positioning Logic ---
            /**
             * @function positionDesktopIcons
             * @description Positions desktop icons in a grid layout within the main desktop area.
             * @returns {void}
             */
            function positionDesktopIcons() {
                const iconWidth = 80; // Defined in CSS .desktop-icon width
                const iconHeight = 100; // Approximate height including label and padding
                const paddingX = 20; // Horizontal padding from desktop edge
                const paddingY = 20; // Vertical padding from desktop edge
                const gapX = 20; // Gap between icons horizontally
                const gapY = 20; // Gap between icons vertically

                const icons = Array.from(desktopIconsContainer.children);
                let currentX = paddingX;
                let currentY = paddingY;
                let column = 0;

                icons.forEach((icon, index) => {
                    // Check if icon fits in current column, otherwise move to next column
                    if (currentY + iconHeight > mainDesktopArea.clientHeight - (paddingY + 10)) { // Add small buffer for taskbar
                        column++;
                        currentX = paddingX + (column * (iconWidth + gapX));
                        currentY = paddingY;
                    }

                    icon.style.left = `${currentX}px`;
                    icon.style.top = `${currentY}px`;
                    currentY += (iconHeight + gapY);
                });
            }

            // Call positioning function initially and on window resize
            positionDesktopIcons();
            window.addEventListener('resize', positionDesktopIcons);

            console.log('Desktop icon positioning logic initialized.');

            // --- Mock Data Fetching (Simulating Headless CMS API Calls) ---
            // In a real application, these would be actual fetch() calls to your CMS API endpoints.

            /**
             * @function fetchContent
             * @description Simulates fetching content for a given section. In a real app, this would be an API call.
             * @param {string} section - The section identifier (e.g., 'works', 'about').
             * @returns {Promise<Object|null>} A promise that resolves with the content data or null if not found.
             */
            async function fetchContent(section) {
                console.log(`Fetching content for: ${section} in language: ${currentLanguage}...`);
                // Simulate network delay
                await new Promise(resolve => setTimeout(resolve, 300)); 

                const langData = LANG_CONTENT[currentLanguage];
                let data = null;

                switch (section) {
                    case 'works':
                        data = [
                            {
                                id: 'work-001',
                                title: '地下俱乐部场景',
                                category: '场景设计 / PSX风格',
                                thumbnail: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACoCAMAAACu/rWvAAAAA1BMVEW+v789k9bCAAAAR0lEQVR42u3BAQ0AAADCoNu/uFFdAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4G4QAAcmT+x+WAAAAAElFTkSuQmCC', // Base64 placeholder for 400x300 blue image
                                images: [
                                    'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAyAAAAHgCAMAAADr20JBAAAAA1BMVEW+v789k9bCAAAAR0lEQVR42u3BAQ0AAADCoNu/uFFdAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4G4QAAcmT+x+WAAAAAElFTkSuQmCC', // Base64 placeholder for 800x600 blue image
                                    'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAyAAAAHgCAMAAADr20JBAAAAA1BMVEW+v789k9bCAAAAR0lEQVR42u3BAQ0AAADCoNu/uFFdAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4G4QAAcmT+x+WAAAAAElFTkSuQmCC', // Base64 placeholder for 800x600 dark blue image
                                    'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAyAAAAHgCAMAAADr20JBAAAAA1BMVEW+v789k9bCAAAAR0lEQVR42u3BAQ0AAADCoNu/uFFdAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4G4QAAcmT+x+WAAAAAElFTkSuQmCC'  // Base64 placeholder for 800x600 light blue image
                                ],
                                description: '一个充满霓虹灯和低多边形元素的地下俱乐部场景，融合了Y2K和故障美学。',
                                tags: ['场景', 'PSX', 'Y2K', 'Blender']
                            },
                            {
                                id: 'work-002',
                                title: '赛博朋克角色 - KAI',
                                category: '角色设计 / Lowpoly',
                                thumbnail: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACoCAMAAACu/rWvAAAAA1BMVEW+v789k9bCAAAAR0lEQVR42u3BAQ0AAADCoNu/uFFdAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4G4QAAcmT+x+WAAAAAElFTkSuQmCC', // Base64 placeholder for 400x300 blue image
                                images: [
                                    'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAyAAAAHgCAMAAADr20JBAAAAA1BMVEW+v789k9bCAAAAR0lEQVR42u3BAQ0AAADCoNu/uFFdAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4G4QAAcmT+x+WAAAAAElFTkSuQmCC', // Base64 placeholder for 800x600 blue image
                                    'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAyAAAAHgCAMAAADr20JBAAAAA1BMVEW+v789k9bCAAAAR0lEQVR42u3BAQ0AAADCoNu/uFFdAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4G4QAAcmT+x+WAAAAAElFTkSuQmCC', // Base64 placeholder for 800x600 dark blue image
                                    'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAyAAAAHgCAMAAADr20JBAAAAA1BMVEW+v789k9bCAAAAR0lEQVR42u3BAQ0AAADCoNu/uFFdAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4G4QAAcmT+x+WAAAAAElFTkSuQmCC'  // Base64 placeholder for 800x600 light blue image
                                ],
                                description: '一个具有复古科幻感的赛博朋克角色，采用低多边形建模和像素质感纹理。',
                                tags: ['角色', 'Lowpoly', '赛博朋K', 'Substance Painter']
                            }
                        ];
                        break;
                    case 'characters':
                        data = [
                            {
                                id: 'char-001',
                                name: '星际漫游者',
                                description: '一个孤独的星际旅行者，探索宇宙深处的奥秘。PSX风格，低多边形设计。',
                                image: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAAHgCAMAAADr20JBAAAAA1BMVEW+v789k9bCAAAAR0lEQVR42u3BAQ0AAADCoNu/uFFdAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4G4QAAcmT+x+WAAAAAElFTkSuQmCC' // Base64 placeholder for 200x200 blue image
                            },
                            {
                                id: 'char-002',
                                name: '都市忍者',
                                description: '穿梭于霓虹都市阴影中的神秘忍者。',
                                image: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAAHgCAMAAADr20JBAAAAA1BMVEW+v789k9bCAAAAR0lEQVR42u3BAQ0AAADCoNu/uFFdAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4G4QAAcmT+x+WAAAAAElFTkSuQmCC' // Base64 placeholder for 200x200 dark blue image
                            }
                        ];
                        break;
                    case 'about':
                        data = {
                            title: langData.aboutTitle,
                            content: langData.aboutContent
                        };
                        break;
                    case 'services':
                        data = {
                            title: langData.services.title,
                            description: langData.services.description,
                            categories: langData.services.categories
                        };
                        break;
                    case 'socials':
                        data = {
                            title: langData.socialsTitle,
                            description: langData.socialsDescription,
                            links: langData.socialsLinks
                        };
                        break;
                    case 'settings': // New case for settings
                        data = langData.settings;
                        break;
                    case 'shutdown':
                        data = null; // No specific data needed for shutdown
                        break;
                    default:
                        data = null;
                }
                console.log(`Content fetched for ${section}:`, data);
                return data;
            }

            /**
             * @function setActiveTaskbarIcon
             * @description Sets the active state for a taskbar icon.
             * @param {string} windowId - The ID of the window whose taskbar icon should be set active.
             * @returns {void}
             */
            function setActiveTaskbarIcon(windowId) {
                document.querySelectorAll('.taskbar-minimized-icon').forEach(icon => {
                    if (icon.dataset.windowId === windowId) {
                        icon.classList.add('active');
                    } else {
                        icon.classList.remove('active');
                    }
                });
            }

            /**
             * @function bringToFront
             * @description Brings a specified window element to the front of the stacking order.
             * @param {HTMLElement} windowElement - The window HTML element to bring to front.
             * @returns {void}
             */
            function bringToFront(windowElement) {
                highestZIndex++;
                windowElement.style.zIndex = highestZIndex;
                console.log(`Window "${windowElement.dataset.windowId}" brought to front. New z-index: ${highestZIndex}`);
                setActiveTaskbarIcon(windowElement.dataset.windowId); // Set its taskbar icon as active
                // Also set window title bar to active style
                document.querySelectorAll('.os-window-title-bar').forEach(bar => bar.classList.add('inactive'));
                const titleBar = windowElement.querySelector('.os-window-title-bar');
                if (titleBar) {
                    titleBar.classList.remove('inactive');
                }
            }
            /**
             * @function openWindow
             * @description Creates and opens a new window or brings an existing one to the front.
             * @param {string} section - The section identifier this window belongs to.
             * @param {string} chineseTitle - The Chinese title for the window.
             * @param {string} englishTitle - The English title for the window.
             * @param {string} contentHTML - The HTML content to display inside the window.
             * @param {string} [windowId=section] - A unique ID for this specific window instance.
             * @param {Object} [initialProps={}] - Initial position and size properties (left, top, width, height).
             * @param {boolean} [isMarkdown=false] - Whether the contentHTML should be parsed as Markdown.
             * @returns {Promise<HTMLElement>} A promise that resolves with the created or existing window element.
             */
            async function openWindow(section, chineseTitle, englishTitle, contentHTML, windowId = section, initialProps = {}, isMarkdown = false) {
                console.log(`Attempting to open window: ${chineseTitle} [${englishTitle}] (Section: ${section}, ID: ${windowId}, Markdown: ${isMarkdown}`);

                // Check if a window for this section already exists
                let existingWindow = document.querySelector(`.os-window[data-window-id="${windowId}"]`);
                if (existingWindow) {
                    bringToFront(existingWindow);
                    // If it exists and is minimized, restore it
                    if (existingWindow.classList.contains('minimized')) {
                        restoreWindow(existingWindow);
                    }
                    return existingWindow; // Return existing window
                }

                const windowElement = document.createElement('div');
                windowElement.classList.add('os-window');
                windowElement.dataset.section = section; // Store section for identification
                windowElement.dataset.windowId = windowId; // Unique ID for this specific window instance
                
                // Store initial position and size for restore functionality
                const desktopWidth = mainDesktopArea.offsetWidth;
                const desktopHeight = mainDesktopArea.offsetHeight;
                const defaultWidth = Math.min(desktopWidth * 0.7, 800); // Max 800px or 70%
                const defaultHeight = Math.min(desktopHeight * 0.7, 600); // Max 600px or 70%

                // Position new windows slightly offset from each other
                const openWindows = document.querySelectorAll('.os-window:not(.minimized)');
                let offsetX = 50 * (openWindows.length % 5); // Max 5 offsets before repeating
                let offsetY = 50 * (openWindows.length % 5);

                windowElement.style.width = initialProps.width || `${defaultWidth}px`;
                windowElement.style.height = initialProps.height || `${defaultHeight}px`;
                windowElement.style.left = initialProps.left || `${(desktopWidth / 2 - defaultWidth / 2) + offsetX}px`;
                windowElement.style.top = initialProps.top || `${(desktopHeight / 2 - defaultHeight / 2) + offsetY}px`;

                // Ensure window is within bounds after offset
                if (parseFloat(windowElement.style.left) + parseFloat(windowElement.style.width) > desktopWidth) {
                    windowElement.style.left = `${desktopWidth - parseFloat(windowElement.style.width) - 20}px`;
                }
                if (parseFloat(windowElement.style.top) + parseFloat(windowElement.style.height) > desktopHeight) {
                    windowElement.style.top = `${desktopHeight - parseFloat(windowElement.style.height) - 20}px`;
                }

                // Store current position and size for restoration
                windowElement.dataset.originalLeft = windowElement.style.left;
                windowElement.dataset.originalTop = windowElement.style.top;
                windowElement.dataset.originalWidth = windowElement.style.width;
                windowElement.dataset.originalHeight = windowElement.style.height;


                bringToFront(windowElement); // Bring new window to front
                console.log(`New window "${windowId}" created at left: ${windowElement.style.left}, top: ${windowElement.style.top}`);

                // Parse Markdown if required
                const finalContent = isMarkdown ? marked.parse(contentHTML) : contentHTML;
                const contentClass = isMarkdown ? 'markdown-content' : '';

                // Construct the full title bar text
                const fullTitle = `${chineseTitle} [${englishTitle}]`;
                windowElement.dataset.windowTitle = fullTitle; // Store the full title in dataset

                // Construct window HTML dynamically, using data-asset-key for icons
                windowElement.innerHTML = `
                    <div class="os-window-title-bar">
                        <div class="os-window-title-content">
                            <span class="icon-placeholder" data-asset-key="icon_mazko_logo"></span>
                            <span class="os-window-title">${fullTitle}</span>
                        </div>
                        <div class="os-window-controls">
                            <div class="control-button minimize" title="最小化">
                                <span class="icon-placeholder" data-asset-key="icon_minus"></span>
                            </div>
                            <div class="control-button maximize" title="最大化">
                                <span class="icon-placeholder" data-asset-key="icon_square"></span>
                            </div>
                            <div class="control-button close" title="关闭">
                                <span class="icon-placeholder" data-asset-key="icon_times"></span>
                            </div>
                        </div>
                    </div>
                    <div class="os-window-content ${contentClass}">
                        ${finalContent}
                    </div>
                    <div class="os-window-status-bar">
                        ${LANG_CONTENT[currentLanguage].systemName} ${LANG_CONTENT[currentLanguage].systemVersion}
                    </div>
                `;

                mainDesktopArea.appendChild(windowElement); // Append to main desktop area
                console.log(`Window "${windowId}" appended to main desktop area.`);
                renderDynamicAssets(); // Render icons for the newly created window

                // Add to map for language switching
                openWindowsMap.set(windowId, {
                    section: section,
                    chineseTitle: chineseTitle, // Store both for re-rendering
                    englishTitle: englishTitle,
                    windowElement: windowElement
                });

                // Immediately create and add taskbar icon for the new window
                createTaskbarIcon(windowElement, chineseTitle, windowId);


                // Make window draggable
                const titleBar = windowElement.querySelector('.os-window-title-bar');
                let isDraggingWindow = false; // Renamed to avoid conflict with desktop icon dragging
                let offsetXWindow, offsetYWindow;

                if (titleBar) { // Ensure titleBar exists
                    titleBar.addEventListener('mousedown', (e) => {
                        isDraggingWindow = true;
                        offsetXWindow = e.clientX - windowElement.getBoundingClientRect().left;
                        offsetYWindow = e.clientY - windowElement.getBoundingClientRect().top;
                        titleBar.style.cursor = 'grabbing'; // Changed to grab cursor
                        bringToFront(windowElement); // Bring to front when dragging starts
                        console.log(`Started dragging window "${windowId}".`);
                    });
                } else {
                    console.error(`Title bar not found for window "${windowId}". Dragging disabled.`);
                }

                document.addEventListener('mousemove', (e) => {
                    if (!isDraggingWindow) return;
                    let newX = e.clientX - offsetXWindow;
                    let newY = e.clientY - offsetYWindow;

                    // Boundary checks for dragging within mainDesktopArea
                    const parentRect = mainDesktopArea.getBoundingClientRect();
                    const windowRect = windowElement.getBoundingClientRect();

                    if (newX < 0) newX = 0;
                    if (newY < 0) newY = 0;
                    if (newX + windowRect.width > parentRect.width) newX = parentRect.width - windowRect.width;
                    if (newY + windowRect.height > parentRect.height) newY = parentRect.height - windowRect.height;

                    windowElement.style.left = `${newX}px`;
                    windowElement.style.top = `${newY}px`;
                });

                document.addEventListener('mouseup', () => {
                    if (isDraggingWindow) {
                        isDraggingWindow = false;
                        if (titleBar) titleBar.style.cursor = 'grab'; // Changed to grab cursor
                        console.log(`Stopped dragging window "${windowId}".`);
                    }
                });

                // Handle window control buttons
                const closeButton = windowElement.querySelector('.control-button.close');
                const minimizeButton = windowElement.querySelector('.control-button.minimize');
                const maximizeButton = windowElement.querySelector('.control-button.maximize');

                if (closeButton) {
                    closeButton.addEventListener('click', () => {
                        windowElement.remove();
                        openWindowsMap.delete(windowId); // Remove from map
                        // Remove taskbar icon if it exists
                        const taskbarIcon = document.querySelector(`.taskbar-minimized-icon[data-window-id="${windowId}"]`);
                        if (taskbarIcon) {
                            taskbarIcon.remove();
                        }
                        console.log(`Window "${windowId}" closed.`);
                    });
                } else {
                    console.error(`Close button not found for window "${windowId}".`);
                }

                if (minimizeButton) {
                    minimizeButton.addEventListener('click', () => {
                        minimizeWindow(windowElement, chineseTitle, windowId);
                    });
                }
                if (maximizeButton) {
                    maximizeButton.addEventListener('click', () => {
                        toggleMaximizeWindow(windowElement);
                    });
                }

                // Bring to front on click anywhere on the window
                windowElement.addEventListener('mousedown', () => {
                    bringToFront(windowElement);
                });

                return windowElement; // Return the newly created window element
            }

            /**
             * @function createTaskbarIcon
             * @description Creates and appends a taskbar icon for a given window.
             * @param {HTMLElement} windowElement - The window HTML element for which to create an icon.
             * @param {string} title - The title of the window (used for display in taskbar).
             * @param {string} windowId - The unique ID of the window.
             * @returns {void}
             */
            function createTaskbarIcon(windowElement, title, windowId) {
                console.log('createTaskbarIcon received title:', title, 'type:', typeof title, 'windowId:', windowId); // Debug log
                let taskbarIcon = document.querySelector(`.taskbar-minimized-icon[data-window-id="${windowId}"]`);
                if (!taskbarIcon) {
                    taskbarIcon = document.createElement('div');
                    taskbarIcon.classList.add('taskbar-minimized-icon');
                    taskbarIcon.dataset.windowId = windowId;

                    // Initialize displayTitle with a safe fallback
                    let displayTitle = String(title || 'Untitled Window'); // Ensure it's a string, even if title is null/undefined

                    // Attempt to get a more specific display title from language content if available
                    const langData = LANG_CONTENT[currentLanguage];
                    const section = windowElement.dataset.section;

                    if (langData && section) { // Ensure both langData and section are defined
                        if (langData[`${section}MenuItem`]) {
                            displayTitle = String(langData[`${section}MenuItem`]); // Use the simplified menu item label
                        } else if (section === 'about' && langData.mazkoExeIcon) {
                            displayTitle = String(langData.mazkoExeIcon);
                        } else if (section.startsWith('service-category-')) {
                            const categoryId = section.replace('service-category-', '');
                            if (langData.services && langData.services.categories) {
                                const category = langData.services.categories.find(cat => cat.id === categoryId);
                                if (category && category.name) {
                                    displayTitle = String(category.name);
                                    if (windowElement.dataset.windowTitle) { // Try to use actual window title if available
                                        displayTitle = windowElement.dataset.windowTitle.split(' [')[0].trim();
                                    }
                                }
                            }
                        } else if (section.startsWith('work-detail-')) {
                            // For work-detail windows, the 'title' parameter already contains the full title
                            // so no further modification needed here.
                            displayTitle = String(title); // Ensure it's explicitly a string
                        }
                    }
                    // Final fallback to ensure displayTitle is always a non-empty string
                    displayTitle = displayTitle.trim() || 'Untitled'; // Trim and ensure it's not empty

                    taskbarIcon.innerHTML = `<span class="icon-placeholder" data-asset-key="icon_window_restore"></span> <span>${displayTitle}</span>`;
                    taskbarIconsContainer.appendChild(taskbarIcon);
                    renderDynamicAssets(); // Render icons for the newly created taskbar icon

                    taskbarIcon.addEventListener('click', () => {
                        restoreWindow(windowElement);
                    });
                }
                setActiveTaskbarIcon(windowId); // Set its taskbar icon as active
            }

            /**
             * @function minimizeWindow
             * @description Minimizes a given window.
             * @param {HTMLElement} windowElement - The window HTML element to minimize.
             * @param {string} title - The title of the window.
             * @param {string} windowId - The ID of the window.
             * @returns {void}
             */
            function minimizeWindow(windowElement, title, windowId) {
                windowElement.classList.add('minimized');
                console.log(`Window "${windowId}" minimized.`);
                // Ensure taskbar icon is active even when minimized
                setActiveTaskbarIcon(windowId); 
            }

            /**
             * @function restoreWindow
             * @description Restores a minimized or maximized window to its original size and position.
             * @param {HTMLElement} windowElement - The window HTML element to restore.
             * @returns {void}
             */
            function restoreWindow(windowElement) {
                windowElement.classList.remove('minimized');
                windowElement.classList.remove('maximized'); // Ensure it's not maximized either
                windowElement.style.width = windowElement.dataset.originalWidth;
                windowElement.style.height = windowElement.dataset.originalHeight;
                windowElement.style.left = windowElement.dataset.originalLeft;
                windowElement.style.top = windowElement.dataset.originalTop;
                windowElement.style.borderRadius = '20px'; // Restore border-radius for Aero
                windowElement.style.boxShadow = '0 10px 40px var(--fa-glow-blue), inset 0 0 25px rgba(255, 255, 255, 0.4)'; // Restore shadow using updated glow variable
                bringToFront(windowElement);
                console.log(`Window "${windowElement.dataset.windowId}" restored.`);
                setActiveTaskbarIcon(windowElement.dataset.windowId); // Set its taskbar icon as active
            }

            /**
             * @function toggleMaximizeWindow
             * @description Toggles the maximized state of a window.
             * @param {HTMLElement} windowElement - The window HTML element to toggle.
             * @returns {void}
             */
            function toggleMaximizeWindow(windowElement) {
                if (windowElement.classList.contains('maximized')) {
                    // Restore
                    windowElement.classList.remove('maximized');
                    windowElement.style.width = windowElement.dataset.originalWidth;
                    windowElement.style.height = windowElement.dataset.originalHeight;
                    windowElement.style.left = windowElement.dataset.originalLeft;
                    windowElement.style.top = windowElement.dataset.originalTop;
                    windowElement.style.borderRadius = '20px'; // Restore border-radius for Aero
                    windowElement.style.boxShadow = '0 10px 40px var(--fa-glow-blue), inset 0 0 25px rgba(255, 255, 255, 0.4)'; // Restore shadow using updated glow variable
                    console.log(`Window "${windowElement.dataset.windowId}" restored from maximized.`);
                } else {
                    // Maximize
                    // Save current position and size before maximizing (if not already saved)
                    if (!windowElement.dataset.originalLeft) {
                        windowElement.dataset.originalLeft = windowElement.style.left;
                        windowElement.dataset.originalTop = windowElement.style.top;
                        windowElement.dataset.originalWidth = windowElement.style.width;
                        windowElement.dataset.originalHeight = windowElement.style.height;
                    }
                    windowElement.classList.add('maximized');
                    // CSS handles the full-screen positioning via the .maximized class
                    console.log(`Window "${windowElement.dataset.windowId}" maximized.`);
                }
                bringToFront(windowElement); // Bring to front after state change
                setActiveTaskbarIcon(windowElement.dataset.windowId); // Set its taskbar icon as active
            }

            /**
             * @function openWorkDetail
             * @description Opens a detailed work view window with a gallery.
             * @param {Object} work - The work object containing details like title, images, description, etc.
             * @returns {void}
             */
            function openWorkDetail(work) {
                // Initialize current image index for this work
                let currentImageIndex = 0;

                const { chineseTitle, englishTitle } = getWindowTitles('work-detail-' + work.id, work);

                const detailContent = `
                    <div class="work-detail-content">
                        <div class="gallery-main-image-container">
                            <img src="${work.images[currentImageIndex]}" alt="${work.title}" class="gallery-main-image">
                            ${work.images.length > 1 ? `
                                <button class="gallery-nav-button prev" data-direction="prev"><span class="icon-placeholder" data-asset-key="icon_chevron_left"></span></button>
                                <button class="gallery-nav-button next" data-direction="next"><span class="icon-placeholder" data-asset-key="icon_chevron_right"></span></button>
                            ` : ''}
                        </div>
                        ${work.images.length > 1 ? `
                            <div class="gallery-thumbnails">
                                ${work.images.map((imgSrc, index) => `
                                    <img src="${imgSrc}" alt="${work.title} thumbnail ${index + 1}" class="gallery-thumbnail ${index === currentImageIndex ? 'active' : ''}" data-index="${index}">
                                `).join('')}
                            </div>
                        ` : ''}
                        <h3>${work.title}</h3>
                        <p class="text-sm opacity-90 mb-2">${work.category}</p>
                        <p>${work.description}</p>
                        <div class="flex flex-wrap gap-2 mt-4">
                            ${work.tags.map(tag => `<span class="category-tag">${tag}</span>`).join('')}
                        </div>
                    </div>
                `;
                
                openWindow('work-detail-' + work.id, chineseTitle, englishTitle, detailContent, 'work-detail-' + work.id);

                // Add event listeners for gallery navigation after the window is opened and content is rendered
                setTimeout(() => {
                    const detailWindow = document.querySelector(`.os-window[data-window-id="work-detail-${work.id}"]`);
                    if (!detailWindow) return;

                    const mainImage = detailWindow.querySelector('.gallery-main-image');
                    const thumbnailsContainer = detailWindow.querySelector('.gallery-thumbnails');
                    const prevButton = detailWindow.querySelector('.gallery-nav-button.prev');
                    const nextButton = detailWindow.querySelector('.gallery-nav-button.next');

                    function updateGallery() {
                        if (mainImage) {
                            mainImage.src = work.images[currentImageIndex];
                        }
                        if (thumbnailsContainer) {
                            thumbnailsContainer.querySelectorAll('.gallery-thumbnail').forEach((thumb, idx) => {
                                if (idx === currentImageIndex) {
                                    thumb.classList.add('active');
                                } else {
                                    thumb.classList.remove('active');
                                }
                            });
                        }
                        renderDynamicAssets(); // Render newly inserted icons (chevrons)
                    }

                    if (prevButton) {
                        prevButton.addEventListener('click', () => {
                            currentImageIndex = (currentImageIndex - 1 + work.images.length) % work.images.length;
                            updateGallery();
                        });
                    }
                    if (nextButton) {
                        nextButton.addEventListener('click', () => { 
                            currentImageIndex = (currentImageIndex + 1) % work.images.length; 
                            updateGallery();
                        });
                    }
                    if (thumbnailsContainer) {
                        thumbnailsContainer.addEventListener('click', (e) => {
                            if (e.target.classList.contains('gallery-thumbnail')) {
                                const index = parseInt(e.target.dataset.index);
                                if (!isNaN(index)) {
                                    currentImageIndex = index;
                                    updateGallery();
                                }
                            }
                        });
                    }
                    updateGallery(); // Initial update to set the first image and active thumbnail
                }, 100); // Small delay to ensure DOM is ready
            }

            /**
             * @function openServiceCategoryDetail
             * @description Opens a detailed view window for a specific service category.
             * @param {Object} category - The service category object containing details.
             * @returns {void}
             */
            function openServiceCategoryDetail(category) {
                const { chineseTitle, englishTitle } = getWindowTitles('service-category-' + category.id, null, category);
                const contentHTML = category.detailContent;
                openWindow('service-category-' + category.id, chineseTitle, englishTitle, contentHTML, 'service-category-' + category.id, {}, true); // Pass true for Markdown
            }


            // Toggle Start Menu visibility
            if (startButton && startMenu) { // Ensure elements exist before adding listeners
                console.log('START button and Start Menu elements found. Attaching event listeners.');
                startButton.addEventListener('click', (event) => {
                    event.stopPropagation(); // Prevent click from propagating to document
                    console.log('START button clicked!'); // Debug: Confirm button click
                    startMenu.classList.toggle('hidden');
                    startMenu.classList.toggle('visible');
                    console.log(`Start Menu visibility toggled. Current classes: ${startMenu.classList}`);
                });

                // Hide Start Menu when clicking outside of it
                document.addEventListener('click', (event) => {
                    if (!startMenu.contains(event.target) && !startButton.contains(event.target)) {
                        if (startMenu.classList.contains('visible')) {
                            startMenu.classList.add('hidden');
                            startMenu.classList.remove('visible');
                            console.log('Clicked outside menu, Start Menu hidden.');
                        }
                    }
                });
            } else {
                console.error('Error: START button or Start Menu element not found in the DOM. Check IDs and HTML structure.');
            }

            // Handle Start Menu item clicks (for links)
            document.querySelectorAll('.start-menu-item, .start-menu-footer-button').forEach(item => {
                item.addEventListener('click', async (event) => { // Made async to await fetchContent
                    event.preventDefault(); // Prevent default link behavior

                    const section = item.dataset.section;
                    const { chineseTitle, englishTitle } = getWindowTitles(section);
                    
                    startMenu.classList.add('hidden'); // Hide menu after clicking an item
                    startMenu.classList.remove('visible'); // Ensure it's explicitly removed
                    console.log(`Start Menu item "${section}" clicked. Menu hidden.`);

                    let content = '';
                    let data = null;
                    let isMarkdown = false;

                    // Show loading spinner while fetching data
                    content = `
                        <div class="flex flex-col items-center justify-center h-full">
                            <div class="loading-spinner"></div>
                            <p class="mt-4 text-lg">${LANG_CONTENT[currentLanguage]?.loadingMessage}</p>
                        </div>
                    `;
                    // Pass windowId to openWindow for correct targeting
                    const openedWindow = await openWindow(section, chineseTitle, englishTitle, content, section); 

                    try {
                        data = await fetchContent(section); // Fetch data
                    } catch (error) {
                        console.error(`${LANG_CONTENT[currentLanguage]?.errorLoadingContent} ${section}:`, error);
                        content = `<p class="text-xl text-red-400">${LANG_CONTENT[currentLanguage]?.errorLoadingContent} ${error.message || LANG_CONTENT[currentLanguage]?.unknownModule}</p>`;
                        // Update existing window with error message
                        if (openedWindow) {
                            openedWindow.querySelector('.os-window-content').innerHTML = content;
                            renderDynamicAssets(); // Re-render icons after content update
                        }
                        return;
                    }

                    // Re-render content based on fetched data
                    switch (section) {
                        case 'works':
                            content = `
                                <h2 class="text-xl font-bold mb-4">${LANG_CONTENT[currentLanguage]?.worksTitle}</h2>
                                <div class="works-grid">
                                    ${data?.map(work => `
                                        <div class="work-card" data-work-id="${work.id}">
                                            <img src="${work.thumbnail}" alt="${work.title}">
                                            <div class="work-card-title">${work.title}</div>
                                            <div class="work-card-category">${work.category}</div>
                                        </div>
                                    `).join('')}
                                </div>
                                <p class="mt-4 opacity-70 text-center">${LANG_CONTENT[currentLanguage]?.worksClickPrompt}</p>
                            `;
                            // Update content of existing window
                            if (openedWindow) {
                                openedWindow.querySelector('.os-window-content').innerHTML = content;
                                // Attach event listeners to newly created work cards
                                setTimeout(() => { // Use setTimeout to ensure elements are rendered
                                    openedWindow.querySelectorAll('.work-card').forEach(card => {
                                        card.addEventListener('click', () => {
                                            const workId = card.dataset.workId;
                                            const selectedWork = data?.find(w => w.id === workId); // Use fetched data
                                            if (selectedWork) {
                                                console.log(`Work card "${workId}" clicked. Opening detail window.`);
                                                openWorkDetail(selectedWork);
                                            } else {
                                                console.warn(`Work with ID "${workId}" not found.`);
                                            }
                                        });
                                    });
                                }, 100); // Small delay
                                renderDynamicAssets(); // Re-render icons after content update
                            }
                            break;
                        case 'characters':
                            content = `
                                <h2 class="text-xl font-bold mb-4">${LANG_CONTENT[currentLanguage]?.charactersTitle}</h2>
                                <p>${LANG_CONTENT[currentLanguage]?.charactersDescription}</p>
                                <div class="grid grid-cols-2 gap-4 mt-4">
                                    ${data?.map(char => `
                                        <div class="flex flex-col items-center">
                                            <img src="${char.image}" alt="${char.name}" class="rounded-lg shadow-md mb-2">
                                            <p class="font-bold">${char.name}</p>
                                            <p class="text-sm opacity-80 text-center">${char.description}</p>
                                        </div>
                                    `).join('')}
                                </div>
                            `;
                            if (openedWindow) {
                                openedWindow.querySelector('.os-window-content').innerHTML = content;
                                renderDynamicAssets(); // Re-render icons after content update
                            }
                            break;
                        case 'about':
                            content = data?.content;
                            isMarkdown = true;
                            if (openedWindow) {
                                openedWindow.querySelector('.os-window-content').innerHTML = marked.parse(content || '');
                                renderDynamicAssets(); // Re-render icons after content update
                            }
                            break;
                        case 'services':
                            content = marked.parse(data?.description || '') + `
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                                    ${data?.categories.map(category => `
                                        <div class="service-category-card p-4 rounded-lg border border-primary-blue hover:bg-glass-bg cursor-pointer transition-all duration-200" data-category-id="${category.id}">
                                            <h3 class="font-bold text-lg text-light-blue">${category.name}</h3>
                                            <p class="text-sm opacity-80 mt-1">${category.shortDescription}</p>
                                        </div>
                                    `).join('')}
                                </div>
                            `;
                            if (openedWindow) {
                                openedWindow.querySelector('.os-window-content').innerHTML = content;
                                // Attach event listeners to newly created service category cards
                                setTimeout(() => {
                                    openedWindow.querySelectorAll('.service-category-card').forEach(card => {
                                        card.addEventListener('click', () => {
                                            const categoryId = card.dataset.categoryId;
                                            const selectedCategory = data?.categories.find(cat => cat.id === categoryId);
                                            if (selectedCategory) {
                                                console.log(`Service category "${categoryId}" clicked. Opening detail window.`);
                                                openServiceCategoryDetail(selectedCategory);
                                            } else {
                                                console.warn(`Service category with ID "${categoryId}" not found.`);
                                            }
                                        });
                                    });
                                }, 100);
                                renderDynamicAssets(); // Re-render icons after content update
                            }
                            break;
                        case 'socials':
                            content = marked.parse(data?.description || '') + `
                                <div class="flex flex-wrap gap-4 mt-4">
                                    ${data?.links.map(link => `
                                        <a href="${link.url}" target="_blank" class="flex items-center space-x-2 text-white hover:text-primary-blue transition-colors">
                                            <span class="icon-placeholder" data-asset-key="${link.iconAssetKey}"></span>
                                            <span>${link.name}</span>
                                        </a>
                                    `).join('')}
                                </div>
                            `;
                            if (openedWindow) {
                                openedWindow.querySelector('.os-window-content').innerHTML = content;
                                renderDynamicAssets(); // Re-render icons after content update
                            }
                            break;
                        case 'settings':
                            content = marked.parse(data?.description || '') + `
                                <div class="flex flex-col gap-4 mt-4">
                                    ${data?.options.map(option => {
                                        const labelText = LANG_CONTENT[currentLanguage]?.settings?.options.find(opt => opt.id === option.id)?.label || option.label;
                                        if (option.type === 'toggle') {
                                            return `
                                                <div class="flex items-center justify-between p-3 rounded-lg bg-white bg-opacity-5 border border-white border-opacity-20">
                                                    <label for="${option.id}" class="text-lg">${labelText}</label>
                                                    <label class="toggle-switch">
                                                        <input type="checkbox" id="${option.id}" ${option.checked ? 'checked' : ''} ${option.disabled ? 'disabled' : ''}>
                                                        <span class="toggle-slider round"></span>
                                                    </label>
                                                </div>
                                            `;
                                        } else if (option.type === 'language-toggle') {
                                            return `
                                                <div class="flex items-center justify-between p-3 rounded-lg bg-white bg-opacity-5 border border-white border-opacity-20">
                                                    <span class="text-lg">${labelText}</span>
                                                    <label class="toggle-switch">
                                                        <input type="checkbox" id="${option.id}" ${currentLanguage === 'en' ? 'checked' : ''}>
                                                        <span class="toggle-slider round"></span>
                                                    </label>
                                                </div>
                                            `;
                                        } else if (option.type === 'button') {
                                            return `
                                                <button id="${option.id}" class="py-2 px-4 rounded-lg bg-primary-blue hover:bg-dark-blue transition-colors text-white font-bold ${option.disabled ? 'opacity-50 cursor-not-allowed' : ''}" ${option.disabled ? 'disabled' : ''}>
                                                    ${labelText}
                                                </button>
                                            `;
                                        }
                                        return '';
                                    }).join('')}
                                </div>
                            `;
                            if (openedWindow) {
                                openedWindow.querySelector('.os-window-content').innerHTML = content;
                                setTimeout(() => {
                                    const languageToggle = openedWindow.querySelector('#language-toggle');
                                    if (languageToggle) {
                                        languageToggle.addEventListener('change', (e) => {
                                            const newLang = e.target.checked ? 'en' : 'zh';
                                            if (newLang !== currentLanguage) {
                                                currentLanguage = newLang;
                                                console.log(`Language switched via settings toggle to: ${currentLanguage}`);
                                                updateUIForLanguage();
                                                // Re-render the settings window to reflect the new language
                                                const { chineseTitle: settingsZh, englishTitle: settingsEn } = getWindowTitles('settings');
                                                openWindow('settings', settingsZh, settingsEn, content, 'settings');
                                            }
                                        });
                                    }

                                    const desktopIconsToggle = openedWindow.querySelector('#desktop-icons-toggle');
                                    if (desktopIconsToggle) {
                                        desktopIconsToggle.addEventListener('change', (e) => {
                                            if (e.target.checked) {
                                                desktopIconsContainer.style.display = 'block';
                                                console.log('Desktop icons enabled.');
                                            } else {
                                                desktopIconsContainer.style.display = 'none';
                                                console.log('Desktop icons disabled.');
                                            }
                                        });
                                    }
                                }, 100);
                                renderDynamicAssets(); // Re-render icons after content update
                            }
                            break;
                        case 'shutdown':
                            content = `
                                <h2 class="text-xl font-bold mb-4 text-red-400">${LANG_CONTENT[currentLanguage]?.shutdownMenuItem}...</h2>
                                <p>${LANG_CONTENT[currentLanguage]?.shutdownMessage}</p>
                                <p class="mt-4 opacity-70">${(LANG_CONTENT[currentLanguage]?.loadingMessage || '加载中...').replace('加载中...', '请稍候...')}</p>
                            `;
                            if (openedWindow) {
                                openedWindow.querySelector('.os-window-content').innerHTML = content;
                                renderDynamicAssets(); // Re-render icons after content update
                            }
                            // For a real shutdown, you might redirect or show a final message
                            setTimeout(() => {
                                console.log(LANG_CONTENT[currentLanguage]?.shutdownMessage);
                                mainDesktopArea.innerHTML = `<div id="welcome-message" class="absolute inset-0 flex items-center justify-center pointer-events-none">
                                    <p class="text-3xl text-white opacity-70" id="welcome-message-text">${LANG_CONTENT[currentLanguage]?.shutdownMessage}</p>
                                </div>`;
                                // Clear all open windows from map and taskbar
                                openWindowsMap.clear();
                                taskbarIconsContainer.innerHTML = '';
                                renderDynamicAssets(); // Ensure icons in shutdown message are rendered if any
                            }, 2000);
                            break;
                    }
                });
            });


            // Handle Start Menu header click to open About Me
            if (startMenuHeader) {
                startMenuHeader.addEventListener('click', async (event) => {
                    event.preventDefault();
                    event.stopPropagation(); // Prevent start menu from closing immediately
                    startMenu.classList.add('hidden');
                    startMenu.classList.remove('visible');

                    const section = 'about';
                    // Directly get titles from LANG_CONTENT, as getWindowTitles is for generic sections
                    const aboutTitleForWindow = LANG_CONTENT[currentLanguage]?.aboutTitle;
                    const aboutContentForWindow = LANG_CONTENT[currentLanguage]?.aboutContent;

                    if (aboutContentForWindow) { // Check if content exists
                        openWindow('about', aboutTitleForWindow, LANG_CONTENT['en']?.aboutTitle, aboutContentForWindow, 'about', {}, true);
                    } else {
                        console.error(`Error: 'about' content not found for language ${currentLanguage} or is undefined.`);
                        openWindow('about', 'Error', 'Error', `<p class="text-xl text-red-400">Failed to load About MAZKO content.</p>`, 'about', {}, false);
                    }
                });
            }


            // --- Desktop Icon Dragging Logic ---
            let isDraggingIcon = false;
            let currentDraggedIcon = null;
            let initialMouseX, initialMouseY;
            let initialIconX, initialIconY;

            if (desktopIconsContainer) {
                desktopIconsContainer.querySelectorAll('.desktop-icon').forEach(icon => {
                    // Set initial positions (from inline style)
                    icon.style.position = 'absolute'; // Ensure position is absolute for dragging

                    icon.addEventListener('mousedown', (e) => {
                        if (e.button !== 0) return; // Only allow left-click drag
                        isDraggingIcon = true;
                        currentDraggedIcon = icon;
                        initialMouseX = e.clientX;
                        initialMouseY = e.clientY;
                        initialIconX = icon.offsetLeft;
                        initialIconY = icon.offsetTop;

                        // Bring the icon to front while dragging (optional, but good UX)
                        currentDraggedIcon.style.zIndex = highestZIndex + 1; 

                        e.preventDefault(); // Prevent default browser drag behavior (e.g., ghost image)
                        console.log(`Started dragging icon: ${icon.dataset.title}`);
                    });

                    // Handle icon click (separate from drag)
                    icon.addEventListener('click', (event) => {
                        // If it was a drag, don't open the window
                        if (currentDraggedIcon === icon && (Math.abs(event.clientX - initialMouseX) > 5 || Math.abs(event.clientY - initialMouseY) > 5)) {
                            console.log("Icon was dragged, preventing click action.");
                            return; 
                        }

                        const section = icon.dataset.section;
                        const { chineseTitle, englishTitle } = getWindowTitles(section);
                        
                        let existingWindow = document.querySelector(`.os-window[data-window-id="${section}"]`);
                        if (existingWindow) {
                            if (existingWindow.classList.contains('minimized')) {
                                restoreWindow(existingWindow);
                            } else {
                                bringToFront(existingWindow);
                            }
                            return;
                        }

                        // Simulate click on the corresponding start menu item or button to trigger window opening logic
                        // For mazko.exe, directly open the about window
                        if (section === 'about') {
                            console.log('Desktop MAZKO icon clicked. currentLanguage:', currentLanguage);
                            // Directly access aboutTitle and aboutContent from LANG_CONTENT
                            const aboutTitleForWindow = LANG_CONTENT[currentLanguage]?.aboutTitle;
                            const aboutContentForWindow = LANG_CONTENT[currentLanguage]?.aboutContent;

                            if (aboutContentForWindow) { // Check if content exists
                                openWindow('about', aboutTitleForWindow, LANG_CONTENT['en']?.aboutTitle, aboutContentForWindow, 'about', {}, true);
                            } else {
                                console.error(`Error: 'about' content not found for language ${currentLanguage} or is undefined.`);
                                openWindow('about', 'Error', 'Error', `<p class="text-xl text-red-400">Failed to load About MAZKO content.</p>`, 'about', {}, false);
                            }
                        } else {
                            // Find the corresponding start menu item or button and click it
                            const startMenuItem = document.querySelector(`.start-menu-item[data-section="${section}"]`);
                            const startMenuFooterButton = document.querySelector(`.start-menu-footer-button[data-section="${section}"]`);
                            if (startMenuItem) {
                                startMenuItem.click();
                            } else if (startMenuFooterButton) {
                                startMenuFooterButton.click();
                            } else {
                                console.warn(`No start menu item or footer button found for section: ${section}`);
                            }
                        }
                    });
                });
            }

            document.addEventListener('mousemove', (e) => {
                if (!isDraggingIcon || !currentDraggedIcon) return;

                const dx = e.clientX - initialMouseX;
                const dy = e.clientY - initialMouseY;

                let newX = initialIconX + dx;
                let newY = initialIconY + dy;

                // Boundary checks for dragging within mainDesktopArea
                const desktopRect = mainDesktopArea.getBoundingClientRect();
                const iconRect = currentDraggedIcon.getBoundingClientRect();

                // Calculate bounds relative to the desktop area's top-left corner
                const minX = 0;
                const minY = 0;
                const maxX = desktopRect.width - iconRect.width;
                const maxY = desktopRect.height - iconRect.height;

                newX = Math.max(minX, Math.min(newX, maxX));
                newY = Math.max(minY, Math.min(newY, maxY));

                currentDraggedIcon.style.left = `${newX}px`;
                currentDraggedIcon.style.top = `${newY}px`;
            });

            document.addEventListener('mouseup', () => {
                if (isDraggingIcon) {
                    isDraggingIcon = false;
                    if (currentDraggedIcon) {
                        // Reset z-index if desired, or keep it high if windows can overlap icons
                        currentDraggedIcon.style.zIndex = 2; 
                        console.log(`Stopped dragging icon: ${currentDraggedIcon.dataset.title}`);
                    }
                    currentDraggedIcon = null;
                }
            });

            // Handle window focus/blur to update title bar active state
            document.addEventListener('mousedown', (e) => {
                const clickedWindow = e.target.closest('.os-window');
                document.querySelectorAll('.os-window').forEach(win => {
                    const titleBar = win.querySelector('.os-window-title-bar');
                    if (titleBar) {
                        if (win === clickedWindow) {
                            titleBar.classList.remove('inactive');
                        } else {
                            titleBar.classList.add('inactive');
                        }
                    }
                });
            });

            // Initial UI update based on default language
            updateCursors(); // Set cursors initially
            updateUIForLanguage(); // Render text and initial assets
            renderDynamicAssets(); // Render all initial icons
            console.log('All event listeners attached and script initialization complete.');
        });
    </script>
</body>
</html>
